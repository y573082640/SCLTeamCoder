<?xml version="1.0" encoding="utf-8"?>
<project>
    <pous>
      <pou name="_BUFFER_CLEAR" pouType="function">
        <interface>
          <returnType>
            <BOOL />
          </returnType>
          <inputVars>
            <variable name="PT">
              <type>
                <pointer>
                  <baseType>
                    <BYTE />
                  </baseType>
                </pointer>
              </type>
            </variable>
            <variable name="SIZE">
              <type>
                <UINT />
              </type>
            </variable>
          </inputVars>
          <localVars>
            <variable name="ptw">
              <type>
                <pointer>
                  <baseType>
                    <DWORD />
                  </baseType>
                </pointer>
              </type>
            </variable>
            <variable name="temp">
              <type>
                <DWORD />
              </type>
            </variable>
            <variable name="end">
              <type>
                <DWORD />
              </type>
            </variable>
            <variable name="end32">
              <type>
                <DWORD />
              </type>
            </variable>
          </localVars>
        </interface>
        <body>
          <ST>
            (* this routine uses 32 bit access to gain speed *)
(* first access bytes till pointer is aligned for 32 bit access *)
temp := pt;
end := temp + UINT_TO_DWORD(size);
end32 := end - 3;
WHILE (pt &lt; end) AND ((temp AND 16#00000003) &gt; 0) DO
	pt^ := 0;
	pt := pt + 1;
	temp := temp + 1;
END_WHILE;
(* pointer is aligned, now copy 32 bits at a time *)
ptw := pt;
WHILE ptw &lt; end32 DO (* *)
	ptw^ := 0;
	ptw := ptw + 4;
END_WHILE;
(* copy the remaining bytes in byte mode *)
pt := ptw;
WHILE pt &lt; end DO
	pt^ := 0;
	pt := pt + 1;
END_WHILE;

_BUFFER_CLEAR := TRUE;

(* revision History
hm 	5. mar. 2008	rev 1.0
	original version

hm	16. mar. 2008	rev 1.1
	added type conversion to avoid warnings under codesys 30
	chaged type of input size to uint
	deleted unused variable i

hm	31. oct. 2008	rev 1.2
	corrected an error while routine would write outside of arrays

*)
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>59dc9731-88ff-4cd6-bf31-70755659bec9</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="_BUFFER_INIT" pouType="function">
        <interface>
          <returnType>
            <BOOL />
          </returnType>
          <inputVars>
            <variable name="PT">
              <type>
                <pointer>
                  <baseType>
                    <BYTE />
                  </baseType>
                </pointer>
              </type>
            </variable>
            <variable name="SIZE">
              <type>
                <UINT />
              </type>
            </variable>
            <variable name="INIT">
              <type>
                <BYTE />
              </type>
            </variable>
          </inputVars>
          <localVars>
            <variable name="ptw">
              <type>
                <pointer>
                  <baseType>
                    <DWORD />
                  </baseType>
                </pointer>
              </type>
            </variable>
            <variable name="temp">
              <type>
                <DWORD />
              </type>
            </variable>
            <variable name="end">
              <type>
                <DWORD />
              </type>
            </variable>
            <variable name="end32">
              <type>
                <DWORD />
              </type>
            </variable>
          </localVars>
        </interface>
        <body>
          <ST>
            (* this routine uses 32 bit access to gain speed *)
(* first access bytes till pointer is aligned for 32 bit access *)
temp := pt;
end := temp + UINT_TO_DWORD(size);
end32 := end - 3;
WHILE (pt &lt; end) AND ((temp AND 16#00000003) &gt; 0) DO
	pt^ := init;
	pt := pt + 1;
	temp := temp + 1;
END_WHILE;
(* pointer is aligned, now copy 32 bits at a time *)
ptw := pt;
temp := SHL(BYTE_TO_DWORD(init),24) OR SHL(BYTE_TO_DWORD(init),16) OR SHL(BYTE_TO_DWORD(init),8) OR BYTE_TO_DWORD(init);
WHILE ptw &lt; end32 DO
	ptw^ := temp;
	ptw := ptw + 4;
END_WHILE;
(* copy the remaining bytes in byte mode *)
pt := ptw;
WHILE pt &lt; end DO
	pt^ := init;
	pt := pt + 1;
END_WHILE;

_BUFFER_INIT := TRUE;

(* revision History
hm 	5. mar. 2008	rev 1.0
	original version

hm	16. mar. 2008	rev 1.1
	added type conversion to avoid warnings under codesys 3.0
	chaged type of input size to uint.

hm	31. oct. 2008	rev 1.2
	corrected an error while routine would write outside of arrays

*)
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>4cb01627-0c79-4cfd-b400-50cf0f85ff57</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="_BUFFER_INSERT" pouType="function">
        <interface>
          <returnType>
            <INT />
          </returnType>
          <inputVars>
            <variable name="STR">
              <type>
                <string length="STRING_LENGTH" />
              </type>
            </variable>
            <variable name="POS">
              <type>
                <INT />
              </type>
            </variable>
            <variable name="PT">
              <type>
                <pointer>
                  <baseType>
                    <array>
                      <dimension lower="0" upper="32767" />
                      <baseType>
                        <BYTE />
                      </baseType>
                    </array>
                  </baseType>
                </pointer>
              </type>
            </variable>
            <variable name="SIZE">
              <type>
                <UINT />
              </type>
            </variable>
          </inputVars>
          <localVars>
            <variable name="end">
              <type>
                <INT />
              </type>
            </variable>
            <variable name="lx">
              <type>
                <INT />
              </type>
            </variable>
            <variable name="i">
              <type>
                <INT />
              </type>
            </variable>
          </localVars>
        </interface>
        <body>
          <ST>
            lx := LEN(str);
end := pos + lx;
(* first move the upper part of the buffer to make space for the string *)
FOR i := UINT_TO_INT(size) - 1 TO end BY -1 DO
	pt^[i] := pt^[i-lx];
END_FOR;
(* copy the string *)
_BUFFER_INSERT := _STRING_TO_BUFFER(str, pos, PT, size);


(* revision History
hm 	9. mar. 2008	rev 1.0
	original version

hm	16. mar. 2008	rev 1.1
	changed type of input size to uint

hm	13. may. 2008	rev 1.2
	changed type of pointer to array[1..32767]
	changed size of string to STRING_LENGTH

hm	23. mar. 2009	rev 1.3
	avoid writing to input pos

hm	12. nov. 2009	rev 1.4
	code optimized

hm 2. jan 2012	rev 1.5
	function now returns the next position after the input string

*)
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>ba53f157-0c2b-4daa-ad6c-04b090c90356</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="_BUFFER_UPPERCASE" pouType="function">
        <interface>
          <returnType>
            <BOOL />
          </returnType>
          <inputVars>
            <variable name="PT">
              <type>
                <pointer>
                  <baseType>
                    <array>
                      <dimension lower="0" upper="32000" />
                      <baseType>
                        <BYTE />
                      </baseType>
                    </array>
                  </baseType>
                </pointer>
              </type>
            </variable>
            <variable name="SIZE">
              <type>
                <INT />
              </type>
            </variable>
          </inputVars>
          <localVars>
            <variable name="pos">
              <type>
                <INT />
              </type>
            </variable>
          </localVars>
        </interface>
        <body>
          <ST>
            pos := 0;
WHILE pos &lt; size DO
	PT^[pos] := TO_UPPER(pt^[pos]);
	pos := pos + 1;
END_WHILE;

_BUFFER_UPPERCASE := TRUE;

(* revision History
hm 	20. jan. 2011	rev 1.0
	original version

*)
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>cb8cb535-dc85-4978-9486-de6155c8cde6</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="_STRING_TO_BUFFER" pouType="function">
        <interface>
          <returnType>
            <INT />
          </returnType>
          <inputVars>
            <variable name="STR">
              <type>
                <string length="STRING_LENGTH" />
              </type>
            </variable>
            <variable name="POS">
              <type>
                <INT />
              </type>
            </variable>
            <variable name="PT">
              <type>
                <pointer>
                  <baseType>
                    <array>
                      <dimension lower="0" upper="32767" />
                      <baseType>
                        <BYTE />
                      </baseType>
                    </array>
                  </baseType>
                </pointer>
              </type>
            </variable>
            <variable name="SIZE">
              <type>
                <UINT />
              </type>
            </variable>
          </inputVars>
          <localVars>
            <variable name="ps">
              <type>
                <pointer>
                  <baseType>
                    <BYTE />
                  </baseType>
                </pointer>
              </type>
            </variable>
            <variable name="i">
              <type>
                <INT />
              </type>
            </variable>
            <variable name="end">
              <type>
                <INT />
              </type>
            </variable>
          </localVars>
        </interface>
        <body>
          <ST>
            ps := ADR(str);
end := MIN(pos + LEN(str), UINT_TO_INT(size));
IF end &gt; 0 THEN end := end -1; END_IF;
FOR i := pos TO end DO
	pt^[i] := ps^;
	ps := ps + 1;
END_FOR;

_STRING_TO_BUFFER := i;

(* revision History

hm 	5. mar. 2008	rev 1.0
	original version

hm	16. mar. 2008	rev 1.1
	changed type of input size to uint

hm	13. may. 2008	rev 1.2
	changed type of pointer to array[1..32767]
	changed size of string to STRING_LENGTH

hm	12. nov. 2009	rev 1.3
	limit end to size - 1

hm	2. jan 2012	rev 1.4
	return the position after the input string when finished
*)
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>9beddcac-3fcf-4ece-b459-50982c22bc15</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="BUFFER_COMP" pouType="function">
        <interface>
          <returnType>
            <INT />
          </returnType>
          <inputVars>
            <variable name="PT1">
              <type>
                <pointer>
                  <baseType>
                    <array>
                      <dimension lower="0" upper="32767" />
                      <baseType>
                        <BYTE />
                      </baseType>
                    </array>
                  </baseType>
                </pointer>
              </type>
            </variable>
            <variable name="SIZE1">
              <type>
                <INT />
              </type>
            </variable>
            <variable name="PT2">
              <type>
                <pointer>
                  <baseType>
                    <array>
                      <dimension lower="0" upper="32767" />
                      <baseType>
                        <BYTE />
                      </baseType>
                    </array>
                  </baseType>
                </pointer>
              </type>
            </variable>
            <variable name="SIZE2">
              <type>
                <INT />
              </type>
            </variable>
            <variable name="START">
              <type>
                <INT />
              </type>
            </variable>
          </inputVars>
          <localVars>
            <variable name="i">
              <type>
                <INT />
              </type>
            </variable>
            <variable name="j">
              <type>
                <INT />
              </type>
            </variable>
            <variable name="end">
              <type>
                <INT />
              </type>
            </variable>
            <variable name="firstbyte">
              <type>
                <BYTE />
              </type>
            </variable>
          </localVars>
        </interface>
        <body>
          <ST>
            (* search for first character match *)
IF size2 &lt;= size1 THEN
	end := size1 - size2;
	firstbyte := PT2^[0];
	FOR i := START TO end DO
		IF PT1^[i] = firstbyte THEN
			(* first character matches, now compare rest of array *)
			j := 1;
			WHILE j &lt; size2 DO
				IF pt2^[j] &lt;&gt; pt1^[j+i] THEN EXIT; END_IF;
				j := j + 1;
			END_WHILE;
			(* when J &gt; size2 a match was found return the position i in buffer1 *)
			IF j = size2 THEN
				BUFFER_COMP := i;
				RETURN;
			END_IF;
		END_IF;
	END_FOR;
END_IF;
BUFFER_COMP := -1;


(*
hm 14. nov. 2008	rev 1.0
	original version

hm	12. nov. 2009	rev 1.1
	performance increase

*)
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>f8de5ead-5941-44fb-982d-b6abd8c5d87c</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="BUFFER_SEARCH" pouType="function">
        <interface>
          <returnType>
            <INT />
          </returnType>
          <inputVars>
            <variable name="PT">
              <type>
                <pointer>
                  <baseType>
                    <array>
                      <dimension lower="0" upper="32767" />
                      <baseType>
                        <BYTE />
                      </baseType>
                    </array>
                  </baseType>
                </pointer>
              </type>
            </variable>
            <variable name="SIZE">
              <type>
                <INT />
              </type>
            </variable>
            <variable name="STR">
              <type>
                <string length="STRING_LENGTH" />
              </type>
            </variable>
            <variable name="POS">
              <type>
                <INT />
              </type>
            </variable>
            <variable name="IGN">
              <type>
                <BOOL />
              </type>
            </variable>
          </inputVars>
          <localVars>
            <variable name="ps">
              <type>
                <pointer>
                  <baseType>
                    <array>
                      <dimension lower="0" upper="STRING_LENGTH" />
                      <baseType>
                        <BYTE />
                      </baseType>
                    </array>
                  </baseType>
                </pointer>
              </type>
            </variable>
            <variable name="chx">
              <type>
                <BYTE />
              </type>
            </variable>
            <variable name="i">
              <type>
                <INT />
              </type>
            </variable>
            <variable name="end">
              <type>
                <INT />
              </type>
            </variable>
            <variable name="k">
              <type>
                <INT />
              </type>
            </variable>
            <variable name="lx">
              <type>
                <INT />
              </type>
            </variable>
          </localVars>
        </interface>
        <body>
          <ST>
            ps := ADR(STR);
lx := LEN(STR);
end := MIN(SIZE - lx, SIZE - 1);
lx := lx - 1;
FOR i := pos TO end DO
	FOR k := 0 TO lx DO
		IF IGN THEN chx := TO_UPPER(pt^[i+k]); ELSE chx := pt^[i+k]; END_IF;
		IF ps^[k] &lt;&gt; chx THEN EXIT; END_IF;
	END_FOR;
	IF k &gt; lx THEN
		BUFFER_SEARCH := i;
		RETURN;
	END_IF;
END_FOR;
BUFFER_SEARCH := -1;


(* revision History

hm 5. mar. 2008	rev 1.0
	original version

hm	16. mar. 2008	rev 1.1
	chaged type of input size to uint

hm	13. may. 2008	rev 1.2
	changed type of pointer to array[1..32767]
	changed size of string to STRING_LENGTH

hm	12. nov. 2009	rev 1.3
	limit end to array size

hm	25. jan. 2011	rev 1.4
	ign = True will now ignore case
	return -1 if nothing found
*)
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>41b38b66-a32d-4fc5-9e04-40d2b9e1dbd2</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="BUFFER_TO_STRING" pouType="function">
        <interface>
          <returnType>
            <string length="STRING_LENGTH" />
          </returnType>
          <inputVars>
            <variable name="PT">
              <type>
                <pointer>
                  <baseType>
                    <array>
                      <dimension lower="0" upper="32767" />
                      <baseType>
                        <BYTE />
                      </baseType>
                    </array>
                  </baseType>
                </pointer>
              </type>
            </variable>
            <variable name="SIZE">
              <type>
                <UINT />
              </type>
            </variable>
            <variable name="START">
              <type>
                <UINT />
              </type>
            </variable>
            <variable name="STOP">
              <type>
                <UINT />
              </type>
            </variable>
          </inputVars>
          <localVars>
            <variable name="ps">
              <type>
                <pointer>
                  <baseType>
                    <BYTE />
                  </baseType>
                </pointer>
              </type>
            </variable>
            <variable name="i">
              <type>
                <UINT />
              </type>
            </variable>
            <variable name="stp">
              <type>
                <UINT />
              </type>
            </variable>
            <variable name="sta">
              <type>
                <UINT />
              </type>
            </variable>
          </localVars>
        </interface>
        <body>
          <ST>
            ps := ADR(BUFFER_TO_STRING);
IF size = 0 THEN RETURN; END_IF;
sta := MIN(start, size -1);
stp := MIN(stop, size -1);

(* check for maximum string_length *)
IF UINT_TO_INT(stp - sta + 1) &gt;= STRING_LENGTH THEN
	stp := sta + INT_TO_UINT(STRING_LENGTH) - 1;
END_IF;

FOR i := sta TO stp DO
	ps^ := pt^[i];
	ps := ps + 1;
END_FOR;

(* terminate the string *)

ps^ := 0;



(* revision History
hm 	5. mar. 2008	rev 1.0
	original version

hm	16. mar. 2008	rev 1.1
	changed type of input size to uint

hm	13. may. 2008	rev 1.2
	changed type of pointer to array[0..32767]
	changed size of string to STRING_LENGTH

hm	12. jun. 2008	rev 1.3
	check for pointer overrun
	change input start and stop to uint
	added type conversions to avoid warnings under codesys 3.0

hm	23. mar. 2009	rev 1.4
	avoid writing to input stop

hm	12. nov. 2009 rev 1.5
	limit start and stop to size -1

*)
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>d1da716a-5cf9-4fd2-9ae8-f59b34233cf8</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="DRIVER_1" pouType="functionBlock">
        <interface>
          <inputVars>
            <variable name="Toggle_Mode">
              <type>
                <BOOL />
              </type>
              <addData>
                <data name="http://www.3s-software.com/plcopenxml/attributes" handleUnknown="implementation">
                  <Attributes>
                    <Attribute Name="input_constant" Value="" />
                  </Attributes>
                </data>
              </addData>
            </variable>
            <variable name="Timeout">
              <type>
                <TIME />
              </type>
              <addData>
                <data name="http://www.3s-software.com/plcopenxml/attributes" handleUnknown="implementation">
                  <Attributes>
                    <Attribute Name="input_constant" Value="" />
                  </Attributes>
                </data>
              </addData>
            </variable>
            <variable name="SET">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="IN">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="RST">
              <type>
                <BOOL />
              </type>
            </variable>
          </inputVars>
          <outputVars>
            <variable name="Q">
              <type>
                <BOOL />
              </type>
            </variable>
          </outputVars>
          <localVars>
            <variable name="off">
              <type>
                <derived name="TON" />
              </type>
            </variable>
            <variable name="edge">
              <type>
                <BOOL />
              </type>
            </variable>
          </localVars>
        </interface>
        <body>
          <ST>
            IF off.Q THEN Q := FALSE; END_IF;
IF rst THEN
	Q := FALSE;
ELSIF set THEN
	Q := TRUE;
ELSIF IN AND NOT edge THEN
	IF toggle_mode THEN q := NOT Q; ELSE q := TRUE; END_IF;
END_IF;
edge := in;
IF timeout &gt; t#0s THEN off(in := Q, PT := Timeout); END_IF;


(* revision history
hm	2. jan 2008		rev 1.0
	original version

*)
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>48fbcf54-293b-438c-b3c4-19668ebeb969</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="DRIVER_4" pouType="functionBlock">
        <interface>
          <inputVars>
            <variable name="Toggle_Mode">
              <type>
                <BOOL />
              </type>
              <addData>
                <data name="http://www.3s-software.com/plcopenxml/attributes" handleUnknown="implementation">
                  <Attributes>
                    <Attribute Name="input_constant" Value="" />
                  </Attributes>
                </data>
              </addData>
            </variable>
            <variable name="Timeout">
              <type>
                <TIME />
              </type>
              <addData>
                <data name="http://www.3s-software.com/plcopenxml/attributes" handleUnknown="implementation">
                  <Attributes>
                    <Attribute Name="input_constant" Value="" />
                  </Attributes>
                </data>
              </addData>
            </variable>
            <variable name="SET">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="IN0">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="IN1">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="IN2">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="IN3">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="RST">
              <type>
                <BOOL />
              </type>
            </variable>
          </inputVars>
          <outputVars>
            <variable name="Q0">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="Q1">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="Q2">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="Q3">
              <type>
                <BOOL />
              </type>
            </variable>
          </outputVars>
          <localVars>
            <variable name="d0">
              <type>
                <derived name="DRIVER_1" />
              </type>
            </variable>
            <variable name="d1">
              <type>
                <derived name="DRIVER_1" />
              </type>
            </variable>
            <variable name="d2">
              <type>
                <derived name="DRIVER_1" />
              </type>
            </variable>
            <variable name="d3">
              <type>
                <derived name="DRIVER_1" />
              </type>
            </variable>
          </localVars>
        </interface>
        <body>
          <ST>
            D0(Set:=set, in:=in0, rst:=rst, toggle_mode:=toggle_mode, timeout:=timeout);
D1(Set:=set, in:=in1, rst:=rst, toggle_mode:=toggle_mode, timeout:=timeout);
D2(Set:=set, in:=in2, rst:=rst, toggle_mode:=toggle_mode, timeout:=timeout);
D3(Set:=set, in:=in3, rst:=rst, toggle_mode:=toggle_mode, timeout:=timeout);
Q0 := D0.Q;
Q1 := D1.Q;
Q2 := D2.Q;
Q3 := D3.Q;


(* revision history
hm	2. jan 2008		rev 1.0
	original version

*)
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>f10e32c3-a8b4-4a40-8029-2ffa0944ca72</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="DRIVER_4C" pouType="functionBlock">
        <interface>
          <inputVars>
            <variable name="IN">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="RST">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="Timeout">
              <type>
                <TIME />
              </type>
              <addData>
                <data name="http://www.3s-software.com/plcopenxml/attributes" handleUnknown="implementation">
                  <Attributes>
                    <Attribute Name="input_constant" Value="" />
                  </Attributes>
                </data>
              </addData>
            </variable>
            <variable name="SX">
              <type>
                <array>
                  <dimension lower="1" upper="7" />
                  <baseType>
                    <BYTE />
                  </baseType>
                </array>
              </type>
              <initialValue>
                <arrayValue>
                  <value>
                    <simpleValue value="1" />
                  </value>
                  <value>
                    <simpleValue value="3" />
                  </value>
                  <value>
                    <simpleValue value="7" />
                  </value>
                  <value>
                    <simpleValue value="15" />
                  </value>
                </arrayValue>
              </initialValue>
              <addData>
                <data name="http://www.3s-software.com/plcopenxml/attributes" handleUnknown="implementation">
                  <Attributes>
                    <Attribute Name="input_constant" Value="" />
                  </Attributes>
                </data>
              </addData>
            </variable>
          </inputVars>
          <outputVars>
            <variable name="SN">
              <type>
                <INT />
              </type>
            </variable>
            <variable name="Q0">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="Q1">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="Q2">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="Q3">
              <type>
                <BOOL />
              </type>
            </variable>
          </outputVars>
          <localVars>
            <variable name="off">
              <type>
                <derived name="TON" />
              </type>
            </variable>
            <variable name="edge">
              <type>
                <BOOL />
              </type>
            </variable>
          </localVars>
        </interface>
        <body>
          <ST>
            IF RST OR off.Q THEN
	SN := 0;
ELSIF IN AND NOT edge THEN
	SN := SN + 1;
	IF SN &gt; 7 OR SX[SN] = 0 THEN SN := 0; END_IF;
END_IF;
edge := in;
IF SN &gt; 0 THEN
	Q0 := SX[SN].0;
	Q1 := SX[SN].1;
	Q2 := SX[SN].2;
	Q3 := SX[SN].3;
ELSE
	Q0 := FALSE;
	Q1 := FALSE;
	Q2 := FALSE;
	Q3 := FALSE;
END_IF;

(* maximaum timeout *)
IF timeout &gt; t#0s THEN off(in := SN &gt; 0, PT := Timeout); END_IF;


(* revision history
hm	23. mar. 2009	rev 1.0
	original version

*)
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>6cd9213f-aeba-4791-a57b-d12327bb1b73</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="FLOW_CONTROL" pouType="functionBlock">
        <interface>
          <inputVars>
            <variable name="IN">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="REQ">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="ENQ">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="RST">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="T_AUTO">
              <type>
                <TIME />
              </type>
              <initialValue>
                <simpleValue value="TIME#60m0s0ms" />
              </initialValue>
              <addData>
                <data name="http://www.3s-software.com/plcopenxml/attributes" handleUnknown="implementation">
                  <Attributes>
                    <Attribute Name="input_constant" Value="" />
                  </Attributes>
                </data>
              </addData>
            </variable>
            <variable name="T_DELAY">
              <type>
                <TIME />
              </type>
              <initialValue>
                <simpleValue value="TIME#1380m0s0ms" />
              </initialValue>
              <addData>
                <data name="http://www.3s-software.com/plcopenxml/attributes" handleUnknown="implementation">
                  <Attributes>
                    <Attribute Name="input_constant" Value="" />
                  </Attributes>
                </data>
              </addData>
            </variable>
          </inputVars>
          <outputVars>
            <variable name="Q">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="STATUS">
              <type>
                <BYTE />
              </type>
            </variable>
          </outputVars>
          <localVars>
            <variable name="timer">
              <type>
                <derived name="TP_1D" />
              </type>
            </variable>
          </localVars>
        </interface>
        <body>
          <ST>
            STATUS := 100;
IF RST THEN
	Q := FALSE;
	timer(rst := TRUE);
	timer.RST := FALSE;
	STATUS := 103;
ELSIF ENQ THEN
	IF IN THEN
		status := 101;
	END_IF;
	IF REQ THEN
		(* timer will generate a timed pulse after TP goes high *)
		timer.PT1 := T_AUTO;
		timer.PTD := T_DELAY;
		timer.IN := TRUE;
		STATUS := 102;
	END_IF;
END_IF;


(* set output and run timer *)
timer();
timer.IN := FALSE;
Q := (IN AND ENQ) OR timer.Q;



(* revision history
hm 	28. jun. 2008 	rev 1.0
	original version

*)
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>6224028f-623a-4492-8df9-17f577f4cbe0</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="FT_Profile" pouType="functionBlock">
        <interface>
          <inputVars>
            <variable name="K">
              <type>
                <REAL />
              </type>
              <initialValue>
                <simpleValue value="1.0" />
              </initialValue>
            </variable>
            <variable name="O">
              <type>
                <REAL />
              </type>
            </variable>
            <variable name="M">
              <type>
                <REAL />
              </type>
              <initialValue>
                <simpleValue value="1.0" />
              </initialValue>
            </variable>
            <variable name="E">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="value_0">
              <type>
                <REAL />
              </type>
              <addData>
                <data name="http://www.3s-software.com/plcopenxml/attributes" handleUnknown="implementation">
                  <Attributes>
                    <Attribute Name="input_constant" Value="" />
                  </Attributes>
                </data>
              </addData>
            </variable>
            <variable name="time_1">
              <type>
                <TIME />
              </type>
              <addData>
                <data name="http://www.3s-software.com/plcopenxml/attributes" handleUnknown="implementation">
                  <Attributes>
                    <Attribute Name="input_constant" Value="" />
                  </Attributes>
                </data>
              </addData>
            </variable>
            <variable name="value_1">
              <type>
                <REAL />
              </type>
              <addData>
                <data name="http://www.3s-software.com/plcopenxml/attributes" handleUnknown="implementation">
                  <Attributes>
                    <Attribute Name="input_constant" Value="" />
                  </Attributes>
                </data>
              </addData>
            </variable>
            <variable name="time_2">
              <type>
                <TIME />
              </type>
              <addData>
                <data name="http://www.3s-software.com/plcopenxml/attributes" handleUnknown="implementation">
                  <Attributes>
                    <Attribute Name="input_constant" Value="" />
                  </Attributes>
                </data>
              </addData>
            </variable>
            <variable name="value_2">
              <type>
                <REAL />
              </type>
              <addData>
                <data name="http://www.3s-software.com/plcopenxml/attributes" handleUnknown="implementation">
                  <Attributes>
                    <Attribute Name="input_constant" Value="" />
                  </Attributes>
                </data>
              </addData>
            </variable>
            <variable name="time_3">
              <type>
                <TIME />
              </type>
              <addData>
                <data name="http://www.3s-software.com/plcopenxml/attributes" handleUnknown="implementation">
                  <Attributes>
                    <Attribute Name="input_constant" Value="" />
                  </Attributes>
                </data>
              </addData>
            </variable>
            <variable name="value_3">
              <type>
                <REAL />
              </type>
              <addData>
                <data name="http://www.3s-software.com/plcopenxml/attributes" handleUnknown="implementation">
                  <Attributes>
                    <Attribute Name="input_constant" Value="" />
                  </Attributes>
                </data>
              </addData>
            </variable>
            <variable name="time_10">
              <type>
                <TIME />
              </type>
              <addData>
                <data name="http://www.3s-software.com/plcopenxml/attributes" handleUnknown="implementation">
                  <Attributes>
                    <Attribute Name="input_constant" Value="" />
                  </Attributes>
                </data>
              </addData>
            </variable>
            <variable name="value_10">
              <type>
                <REAL />
              </type>
              <addData>
                <data name="http://www.3s-software.com/plcopenxml/attributes" handleUnknown="implementation">
                  <Attributes>
                    <Attribute Name="input_constant" Value="" />
                  </Attributes>
                </data>
              </addData>
            </variable>
            <variable name="time_11">
              <type>
                <TIME />
              </type>
              <addData>
                <data name="http://www.3s-software.com/plcopenxml/attributes" handleUnknown="implementation">
                  <Attributes>
                    <Attribute Name="input_constant" Value="" />
                  </Attributes>
                </data>
              </addData>
            </variable>
            <variable name="value_11">
              <type>
                <REAL />
              </type>
              <addData>
                <data name="http://www.3s-software.com/plcopenxml/attributes" handleUnknown="implementation">
                  <Attributes>
                    <Attribute Name="input_constant" Value="" />
                  </Attributes>
                </data>
              </addData>
            </variable>
            <variable name="time_12">
              <type>
                <TIME />
              </type>
              <addData>
                <data name="http://www.3s-software.com/plcopenxml/attributes" handleUnknown="implementation">
                  <Attributes>
                    <Attribute Name="input_constant" Value="" />
                  </Attributes>
                </data>
              </addData>
            </variable>
            <variable name="value_12">
              <type>
                <REAL />
              </type>
              <addData>
                <data name="http://www.3s-software.com/plcopenxml/attributes" handleUnknown="implementation">
                  <Attributes>
                    <Attribute Name="input_constant" Value="" />
                  </Attributes>
                </data>
              </addData>
            </variable>
            <variable name="time_13">
              <type>
                <TIME />
              </type>
              <addData>
                <data name="http://www.3s-software.com/plcopenxml/attributes" handleUnknown="implementation">
                  <Attributes>
                    <Attribute Name="input_constant" Value="" />
                  </Attributes>
                </data>
              </addData>
            </variable>
            <variable name="value_13">
              <type>
                <REAL />
              </type>
              <addData>
                <data name="http://www.3s-software.com/plcopenxml/attributes" handleUnknown="implementation">
                  <Attributes>
                    <Attribute Name="input_constant" Value="" />
                  </Attributes>
                </data>
              </addData>
            </variable>
          </inputVars>
          <outputVars>
            <variable name="Y">
              <type>
                <REAL />
              </type>
            </variable>
            <variable name="RUN">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="ET">
              <type>
                <TIME />
              </type>
            </variable>
          </outputVars>
          <localVars>
            <variable name="tx">
              <type>
                <TIME />
              </type>
            </variable>
            <variable name="edge">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="state">
              <type>
                <BYTE />
              </type>
            </variable>
            <variable name="ta">
              <type>
                <TIME />
              </type>
            </variable>
            <variable name="tb">
              <type>
                <TIME />
              </type>
            </variable>
            <variable name="t0">
              <type>
                <TIME />
              </type>
            </variable>
            <variable name="temp">
              <type>
                <REAL />
              </type>
            </variable>
            <variable name="va">
              <type>
                <REAL />
              </type>
            </variable>
            <variable name="vb">
              <type>
                <REAL />
              </type>
            </variable>
          </localVars>
        </interface>
        <body>
          <ST>
            (* read system time *)
tx := DWORD_TO_TIME(T_PLC_MS());

(* determine start condition *)
IF E AND NOT edge THEN
	RUN := TRUE;
	ET := t#0s;
	t0 := tx;
	ta := tx;
	tb := multime(time_1, M);
	va := value_0;
	vb := value_1;
	temp := value_0;
	state := 1;
END_IF;
edge := E;

(* generate startup profile *)
IF run THEN
	CASE state OF
		1:	IF tx - ta &gt;= tb THEN
				ta := ta + tb;
				tb := multime(time_2 - time_1, M);
				va := value_1;
				vb := value_2;
				temp := value_1;
				state := 2;
			ELSE
				temp := ((vb - va) * TIME_TO_REAL(tx - ta) / TIME_TO_REAL(tb) + va);
			END_IF;
		2:	IF tx - ta &gt;= tb THEN
				ta := ta + tb;
				tb := multime(time_3 - time_2, M);
				va := value_2;
				vb := value_3;
				temp := value_2;
				state := 3;
			ELSE
				temp := ((vb - va) * TIME_TO_REAL(tx - ta) / TIME_TO_REAL(tb) + va);
			END_IF;
		3:	IF tx - ta &gt;= tb THEN
				ta := ta + tb;
				tb := multime(time_10 - time_3, M);
				va := value_3;
				vb := value_10;
				temp := value_3;
				state := 4;
			ELSE
				temp := ((vb - va) * TIME_TO_REAL(tx - ta) / TIME_TO_REAL(tb) + va);
			END_IF;
		4 :	IF tx - ta &gt;= tb THEN
				ta := ta + tb;
				tb := multime(time_11 - time_10, M);
				va := value_10;
				vb := value_11;
				temp := value_10;
				IF E THEN state := 5; ELSE state := 6; END_IF;
			ELSE
				temp := ((vb - va) * TIME_TO_REAL(tx - ta) / TIME_TO_REAL(tb) + va);
			END_IF;
		5:	(* extend the signal while E is true *)
			IF E THEN
				ta := tx;
			ELSE
				state := 6;
			END_IF;
		6:	IF tx - ta &gt;= tb THEN
				ta := ta + tb;
				tb := multime(time_12 - time_11, M);
				va := value_11;
				vb := value_12;
				temp := value_11;
				state := 7;
			ELSE
				temp := ((vb - va) * TIME_TO_REAL(tx - ta) / TIME_TO_REAL(tb) + va);
			END_IF;
		7:	IF tx - ta &gt;= tb THEN
				ta := ta + tb;
				tb := multime(time_13 - time_12, M);
				va := value_12;
				vb := value_13;
				temp := value_12;
				state := 8;
			ELSE
				temp := ((vb - va) * TIME_TO_REAL(tx - ta) / TIME_TO_REAL(tb) + va);
			END_IF;
		8:	IF tx - ta &gt;= tb THEN
				temp := value_13;
				run := FALSE;
			ELSE
				temp := ((vb - va) * TIME_TO_REAL(tx - ta) / TIME_TO_REAL(tb) + va);
			END_IF;
	END_CASE;
	Y := temp * K + O;
	ET := tx - t0;
END_IF;

(* revision history
hm	27 feb 2007		rev 1.0
	original version

hm	15. sep2007		rev 1.1
	replaced Time() with T_PLC_MS for compatibility and performance reasons

*)
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>ddd1ffb9-63dd-4f7a-9afe-050c4a01801a</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="INC_DEC" pouType="functionBlock">
        <interface>
          <inputVars>
            <variable name="CHa">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="CHb">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="RST">
              <type>
                <BOOL />
              </type>
            </variable>
          </inputVars>
          <outputVars>
            <variable name="dir">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="cnt">
              <type>
                <INT />
              </type>
            </variable>
          </outputVars>
          <localVars>
            <variable name="edgea">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="clk">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="clka">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="clkb">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="edgeb">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="axb">
              <type>
                <BOOL />
              </type>
            </variable>
          </localVars>
        </interface>
        <body>
          <ST>
            axb := cha XOR chb;

(* create pulses for channel a *)
clka := cha XOR edgea;
edgea := cha;

clkb := chb XOR edgeb;
edgeb := chb;

(* create pulses for both channels *)
clk := clka OR clkb;

(* set the direction output *)
IF axb AND clka THEN dir := TRUE; END_IF;
IF axb AND clkb THEN dir := FALSE; END_IF;

(* increment or decrement the counter *)
IF clk AND dir THEN cnt := cnt + 1; END_IF;
IF clk AND NOT dir THEN cnt := cnt -1; END_IF;

(* reset the counter if rst active *)
IF rst THEN cnt := 0; END_IF;

          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>14dcf7a8-4449-4272-bf64-7f28b29a3190</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="INTERLOCK" pouType="functionBlock">
        <interface>
          <inputVars>
            <variable name="I1">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="I2">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="TL">
              <type>
                <TIME />
              </type>
            </variable>
          </inputVars>
          <outputVars>
            <variable name="Q1">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="Q2">
              <type>
                <BOOL />
              </type>
            </variable>
          </outputVars>
          <localVars>
            <variable name="T1">
              <type>
                <derived name="TOF" />
              </type>
            </variable>
            <variable name="T2">
              <type>
                <derived name="TOF" />
              </type>
            </variable>
          </localVars>
        </interface>
        <body>
          <ST>
            (* the input signal have a run delay to lockout the other input *)
T1(IN := I1, PT := TL);
T2(IN := I2, PT := TL);

Q1 := I1 AND NOT t2.Q;
Q2 := I2 AND NOT t1.Q;


(* revision history

hm	28 sep 2007		rev 1.0
	original version

*)
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>207646fb-ecbb-4c81-ab2c-6084b63e5dc0</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="INTERLOCK_4" pouType="functionBlock">
        <interface>
          <inputVars>
            <variable name="I0">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="I1">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="I2">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="I3">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="E">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="MODE">
              <type>
                <INT />
              </type>
            </variable>
          </inputVars>
          <outputVars>
            <variable name="OUT">
              <type>
                <BYTE />
              </type>
            </variable>
            <variable name="TP">
              <type>
                <BOOL />
              </type>
            </variable>
          </outputVars>
          <localVars>
            <variable name="in">
              <type>
                <BYTE />
              </type>
            </variable>
            <variable name="last">
              <type>
                <BYTE />
              </type>
            </variable>
            <variable name="old">
              <type>
                <BYTE />
              </type>
            </variable>
            <variable name="lmode">
              <type>
                <INT />
              </type>
            </variable>
          </localVars>
        </interface>
        <body>
          <ST>
            (* check if enable is active *)
IF E THEN
(* reset all vars when there is a mode change on thy fly *)
	IF mode &lt;&gt; lmode THEN
		out := 0;
		last := 0;
		old := 0;
		lmode := mode;
	END_IF;
	(* load inputs into in *)
	in.0 := I0;
	in.1 := I1;
	in.2 := I2;
	in.3 := I3;
	(* only execute when there is any change *)
	IF in &lt;&gt; last THEN
		(* only execute when inputs have chages state *)
		CASE mode OF
			0:	(* output directly display inputs as bits in byte out *)
				out := in;

			1:	(* the input with the highest number will be acepted *)
				IF in.3 THEN out := 8;
				ELSIF in.2 THEN out := 4;
				ELSIF in.1 THEN out := 2;
				ELSE out := in;
				END_IF;

			2:	(* input last pressed will be displayed only *)
				last := ((in XOR last) AND in);
				IF last.3 THEN out := 8;
				ELSIF last.2 THEN out := 4;
				ELSIF last.1 THEN out := 2;
				ELSE out := last;
				END_IF;

			3:	(* any input active will disable all other inputs *)
				IF (out AND in) = 0 THEN
					IF in.3 THEN out := 8;
					ELSIF in.2 THEN out := 4;
					ELSIF in.1 THEN out := 2;
					ELSE out := in;
					END_IF;
				END_IF;

		END_CASE;
		last := in;
	END_IF;
	tp := out &lt;&gt; old;
	old := out;
ELSE
	out := 0;
	last := 0;
	old := 0;
	lmode := 0;
	tp := FALSE;
END_IF;


(* revision history
hm	24. oct 2008	rev 1.0
	original version

hm	14. mar. 2009	rev 1.1
	replaced double assignments

*)
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>5e76f95e-5d6b-4bf1-b909-1ac2e00ee1e6</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="MANUAL" pouType="function">
        <interface>
          <returnType>
            <BOOL />
          </returnType>
          <inputVars>
            <variable name="IN">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="ON">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="OFF">
              <type>
                <BOOL />
              </type>
            </variable>
          </inputVars>
        </interface>
        <body>
          <ST>
            MANUAL := NOT OFF AND (IN OR ON);



(* revision history
hm	21. nov 2008	rev 1.0
	original version


*)
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>e406b62a-95de-452e-a590-1bc782c8a6de</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="MANUAL_1" pouType="functionBlock">
        <interface>
          <inputVars>
            <variable name="IN">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="MAN">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="M_I">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="SET">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="RST">
              <type>
                <BOOL />
              </type>
            </variable>
          </inputVars>
          <outputVars>
            <variable name="Q">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="STATUS">
              <type>
                <BYTE />
              </type>
            </variable>
          </outputVars>
          <localVars>
            <variable name="S_edge">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="r_edge">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="edge">
              <type>
                <BOOL />
              </type>
            </variable>
          </localVars>
        </interface>
        <body>
          <ST>
            IF NOT man THEN
	Q := IN;
	STATUS := 100;
	edge := FALSE;
ELSIF NOT s_edge AND set THEN
	Q := TRUE;
	edge := TRUE;
	status := 101;
ELSIF NOT r_edge AND rst THEN
	Q := FALSE;
	edge := TRUE;
	status := 102;
ELSIF NOT edge THEN
	Q := M_I;
	status := 103;
END_IF;

(* remember levels of manual signals *)
s_edge := SET;
r_edge := RST;



(* revision history
hm	17. jun 2008	rev 1.0
	original version

hm	17. oct 2008	rev 1.1
	deleted unnecessary variable m_edge

hm	14. mar. 2009	rev 1.2
	replaced double assignments

*)
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>bc2f5441-c0fb-4b0a-8c15-092916f58300</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="MANUAL_2" pouType="functionBlock">
        <interface>
          <inputVars>
            <variable name="IN">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="ENA">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="ON">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="OFF">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="MAN">
              <type>
                <BOOL />
              </type>
            </variable>
          </inputVars>
          <outputVars>
            <variable name="Q">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="STATUS">
              <type>
                <BYTE />
              </type>
            </variable>
          </outputVars>
        </interface>
        <body>
          <ST>
            IF ena THEN
	IF NOT ON AND NOT OFF THEN
		Q := IN;
		STATUS := 100;
	ELSIF on AND NOT off THEN
		Q := TRUE;
		STATUS := 101;
	ELSIF NOT on AND off THEN
		q := FALSE;
		STATUS := 102;
	ELSE
		Q := MAN;
		STATUS := 103;
	END_IF;
ELSE
	Q := FALSE;
	STATUS := 104;
END_IF;



(* revision history
hm	22. sep. 2008		rev 1.0
	original version

*)
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>6d938e92-f0e8-4113-bb29-5b67dddcee31</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="MANUAL_4" pouType="functionBlock">
        <interface>
          <inputVars>
            <variable name="I0">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="I1">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="I2">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="I3">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="MAN">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="STP">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="M0">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="M1">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="M2">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="M3">
              <type>
                <BOOL />
              </type>
            </variable>
          </inputVars>
          <outputVars>
            <variable name="Q0">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="Q1">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="Q2">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="Q3">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="STATUS">
              <type>
                <BYTE />
              </type>
            </variable>
          </outputVars>
          <localVars>
            <variable name="edge">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="pos">
              <type>
                <INT />
              </type>
            </variable>
            <variable name="tog">
              <type>
                <BOOL />
              </type>
            </variable>
          </localVars>
        </interface>
        <body>
          <ST>
            IF man THEN
	IF NOT TOG THEN
		Q0 := M0;
		Q1 := M1;
		Q2 := M2;
		Q3 := M3;
		STATUS := 101;
	END_IF;
	IF STP AND NOT edge THEN
		tog := TRUE;
		CASE pos OF
			0:	Q0 := TRUE;
				Q1 := FALSE;
				Q2 := FALSE;
				Q3 := FALSE;
				STATUS := 110;
			1:	Q0 := FALSE;
				Q1 := TRUE;
				Q2 := FALSE;
				Q3 := FALSE;
				STATUS := 111;
			2:	Q0 := FALSE;
				Q1 := FALSE;
				Q2 := TRUE;
				Q3 := FALSE;
				STATUS := 112;
			3:	Q0 := FALSE;
				Q1 := FALSE;
				Q2 := FALSE;
				Q3 := TRUE;
				STATUS := 113;
		END_CASE;
		pos := INC(pos,1,3);
	END_IF;
ELSE
	Q0 := I0;
	Q1 := I1;
	Q2 := I2;
	Q3 := I3;
	STATUS := 100;
	tog := FALSE;
	pos := 0;
END_IF;

(* remember status of stp *)
edge := STP;



(* revision history
hm	17. jun 2008		rev 1.0
	original version

*)
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>bd33e619-51b8-4e77-a2e9-0db36e76f3ad</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="PARSET" pouType="functionBlock">
        <interface>
          <inputVars>
            <variable name="A0">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="A1">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="X01">
              <type>
                <REAL />
              </type>
              <addData>
                <data name="http://www.3s-software.com/plcopenxml/attributes" handleUnknown="implementation">
                  <Attributes>
                    <Attribute Name="input_constant" Value="" />
                  </Attributes>
                </data>
              </addData>
            </variable>
            <variable name="X02">
              <type>
                <REAL />
              </type>
              <addData>
                <data name="http://www.3s-software.com/plcopenxml/attributes" handleUnknown="implementation">
                  <Attributes>
                    <Attribute Name="input_constant" Value="" />
                  </Attributes>
                </data>
              </addData>
            </variable>
            <variable name="X03">
              <type>
                <REAL />
              </type>
              <addData>
                <data name="http://www.3s-software.com/plcopenxml/attributes" handleUnknown="implementation">
                  <Attributes>
                    <Attribute Name="input_constant" Value="" />
                  </Attributes>
                </data>
              </addData>
            </variable>
            <variable name="X04">
              <type>
                <REAL />
              </type>
              <addData>
                <data name="http://www.3s-software.com/plcopenxml/attributes" handleUnknown="implementation">
                  <Attributes>
                    <Attribute Name="input_constant" Value="" />
                  </Attributes>
                </data>
              </addData>
            </variable>
            <variable name="X11">
              <type>
                <REAL />
              </type>
              <addData>
                <data name="http://www.3s-software.com/plcopenxml/attributes" handleUnknown="implementation">
                  <Attributes>
                    <Attribute Name="input_constant" Value="" />
                  </Attributes>
                </data>
              </addData>
            </variable>
            <variable name="X12">
              <type>
                <REAL />
              </type>
              <addData>
                <data name="http://www.3s-software.com/plcopenxml/attributes" handleUnknown="implementation">
                  <Attributes>
                    <Attribute Name="input_constant" Value="" />
                  </Attributes>
                </data>
              </addData>
            </variable>
            <variable name="X13">
              <type>
                <REAL />
              </type>
              <addData>
                <data name="http://www.3s-software.com/plcopenxml/attributes" handleUnknown="implementation">
                  <Attributes>
                    <Attribute Name="input_constant" Value="" />
                  </Attributes>
                </data>
              </addData>
            </variable>
            <variable name="X14">
              <type>
                <REAL />
              </type>
              <addData>
                <data name="http://www.3s-software.com/plcopenxml/attributes" handleUnknown="implementation">
                  <Attributes>
                    <Attribute Name="input_constant" Value="" />
                  </Attributes>
                </data>
              </addData>
            </variable>
            <variable name="X21">
              <type>
                <REAL />
              </type>
              <addData>
                <data name="http://www.3s-software.com/plcopenxml/attributes" handleUnknown="implementation">
                  <Attributes>
                    <Attribute Name="input_constant" Value="" />
                  </Attributes>
                </data>
              </addData>
            </variable>
            <variable name="X22">
              <type>
                <REAL />
              </type>
              <addData>
                <data name="http://www.3s-software.com/plcopenxml/attributes" handleUnknown="implementation">
                  <Attributes>
                    <Attribute Name="input_constant" Value="" />
                  </Attributes>
                </data>
              </addData>
            </variable>
            <variable name="X23">
              <type>
                <REAL />
              </type>
              <addData>
                <data name="http://www.3s-software.com/plcopenxml/attributes" handleUnknown="implementation">
                  <Attributes>
                    <Attribute Name="input_constant" Value="" />
                  </Attributes>
                </data>
              </addData>
            </variable>
            <variable name="X24">
              <type>
                <REAL />
              </type>
              <addData>
                <data name="http://www.3s-software.com/plcopenxml/attributes" handleUnknown="implementation">
                  <Attributes>
                    <Attribute Name="input_constant" Value="" />
                  </Attributes>
                </data>
              </addData>
            </variable>
            <variable name="X31">
              <type>
                <REAL />
              </type>
              <addData>
                <data name="http://www.3s-software.com/plcopenxml/attributes" handleUnknown="implementation">
                  <Attributes>
                    <Attribute Name="input_constant" Value="" />
                  </Attributes>
                </data>
              </addData>
            </variable>
            <variable name="X32">
              <type>
                <REAL />
              </type>
              <addData>
                <data name="http://www.3s-software.com/plcopenxml/attributes" handleUnknown="implementation">
                  <Attributes>
                    <Attribute Name="input_constant" Value="" />
                  </Attributes>
                </data>
              </addData>
            </variable>
            <variable name="X33">
              <type>
                <REAL />
              </type>
              <addData>
                <data name="http://www.3s-software.com/plcopenxml/attributes" handleUnknown="implementation">
                  <Attributes>
                    <Attribute Name="input_constant" Value="" />
                  </Attributes>
                </data>
              </addData>
            </variable>
            <variable name="X34">
              <type>
                <REAL />
              </type>
              <addData>
                <data name="http://www.3s-software.com/plcopenxml/attributes" handleUnknown="implementation">
                  <Attributes>
                    <Attribute Name="input_constant" Value="" />
                  </Attributes>
                </data>
              </addData>
            </variable>
            <variable name="TC">
              <type>
                <TIME />
              </type>
              <addData>
                <data name="http://www.3s-software.com/plcopenxml/attributes" handleUnknown="implementation">
                  <Attributes>
                    <Attribute Name="input_constant" Value="" />
                  </Attributes>
                </data>
              </addData>
            </variable>
          </inputVars>
          <outputVars>
            <variable name="P1">
              <type>
                <REAL />
              </type>
            </variable>
            <variable name="P2">
              <type>
                <REAL />
              </type>
            </variable>
            <variable name="P3">
              <type>
                <REAL />
              </type>
            </variable>
            <variable name="P4">
              <type>
                <REAL />
              </type>
            </variable>
          </outputVars>
          <localVars>
            <variable name="X">
              <type>
                <array>
                  <dimension lower="0" upper="3" />
                  <dimension lower="1" upper="4" />
                  <baseType>
                    <REAL />
                  </baseType>
                </array>
              </type>
            </variable>
            <variable name="S1">
              <type>
                <REAL />
              </type>
            </variable>
            <variable name="S2">
              <type>
                <REAL />
              </type>
            </variable>
            <variable name="S3">
              <type>
                <REAL />
              </type>
            </variable>
            <variable name="S4">
              <type>
                <REAL />
              </type>
            </variable>
            <variable name="tx">
              <type>
                <DWORD />
              </type>
            </variable>
            <variable name="last">
              <type>
                <DWORD />
              </type>
            </variable>
            <variable name="start">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="set">
              <type>
                <BYTE />
              </type>
            </variable>
            <variable name="init">
              <type>
                <BOOL />
              </type>
            </variable>
          </localVars>
        </interface>
        <body>
          <ST>
            (* read system_time *)
tx := T_PLC_MS();

(* init sequence *)
IF NOT init THEN
	set.0 := NOT A0;
	init := TRUE;
	X[0,1] := X01;
	X[0,2] := X02;
	X[0,3] := X03;
	X[0,4] := X04;
	X[1,1] := X11;
	X[1,2] := X12;
	X[1,3] := X13;
	X[1,4] := X14;
	X[2,1] := X21;
	X[2,2] := X22;
	X[2,3] := X23;
	X[2,4] := X24;
	X[3,1] := X31;
	X[3,2] := X32;
	X[3,3] := X33;
	X[3,4] := X34;
	P1 := X01;
	P2 := X02;
	P3 := X03;
	P4 := X04;
END_IF;

(* check for input change *)
IF (A0 XOR set.0) OR (A1 XOR set.1) THEN
	(* a new set is selected *)
	set.0 := A0;
	set.1 := A1;
	IF tc &gt; t#0s THEN
		start := TRUE;
		last := tx;
		(* save the step speed for the output changes in S *)
		S1 := (X[set,1] - P1)/DWORD_TO_REAL(TIME_TO_DWORD(tc));
		S2 := (X[set,2] - P2)/DWORD_TO_REAL(TIME_TO_DWORD(tc));
		S3 := (X[set,3] - P3)/DWORD_TO_REAL(TIME_TO_DWORD(tc));
		S4 := (X[set,4] - P4)/DWORD_TO_REAL(TIME_TO_DWORD(tc));
	END_IF;
ELSIF start AND tx - last &lt; TIME_TO_DWORD(tc) THEN
	(* ramp the outputs to the new value *)
	P1 := X[set,1] - S1 * DWORD_TO_REAL(TIME_TO_DWORD(Tc) - tx + last);
	P2 := X[set,2] - S2 * DWORD_TO_REAL(TIME_TO_DWORD(Tc) - tx + last);
	P3 := X[set,3] - S3 * DWORD_TO_REAL(TIME_TO_DWORD(Tc) - tx + last);
	P4 := X[set,4] - S4 * DWORD_TO_REAL(TIME_TO_DWORD(Tc) - tx + last);
ELSE
	(* make sure outputs match the correct set values *)
	start := FALSE;
	P1 := X[set,1];
	P2 := X[set,2];
	P3 := X[set,3];
	P4 := X[set,4];
END_IF;

(* revision history
hm	2.11.2007		rev 1.0
	original version

hm	16. mar. 2008	rev 1.1
	added type conversions to avoid warnings under codesys 3.0

*)

          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>c7ffbf82-e0ce-4a23-8c83-26ecf5e8d48c</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="PARSET2" pouType="functionBlock">
        <interface>
          <inputVars>
            <variable name="X">
              <type>
                <REAL />
              </type>
            </variable>
            <variable name="X01">
              <type>
                <REAL />
              </type>
              <addData>
                <data name="http://www.3s-software.com/plcopenxml/attributes" handleUnknown="implementation">
                  <Attributes>
                    <Attribute Name="input_constant" Value="" />
                  </Attributes>
                </data>
              </addData>
            </variable>
            <variable name="X02">
              <type>
                <REAL />
              </type>
              <addData>
                <data name="http://www.3s-software.com/plcopenxml/attributes" handleUnknown="implementation">
                  <Attributes>
                    <Attribute Name="input_constant" Value="" />
                  </Attributes>
                </data>
              </addData>
            </variable>
            <variable name="X03">
              <type>
                <REAL />
              </type>
              <addData>
                <data name="http://www.3s-software.com/plcopenxml/attributes" handleUnknown="implementation">
                  <Attributes>
                    <Attribute Name="input_constant" Value="" />
                  </Attributes>
                </data>
              </addData>
            </variable>
            <variable name="X04">
              <type>
                <REAL />
              </type>
              <addData>
                <data name="http://www.3s-software.com/plcopenxml/attributes" handleUnknown="implementation">
                  <Attributes>
                    <Attribute Name="input_constant" Value="" />
                  </Attributes>
                </data>
              </addData>
            </variable>
            <variable name="X11">
              <type>
                <REAL />
              </type>
              <addData>
                <data name="http://www.3s-software.com/plcopenxml/attributes" handleUnknown="implementation">
                  <Attributes>
                    <Attribute Name="input_constant" Value="" />
                  </Attributes>
                </data>
              </addData>
            </variable>
            <variable name="X12">
              <type>
                <REAL />
              </type>
              <addData>
                <data name="http://www.3s-software.com/plcopenxml/attributes" handleUnknown="implementation">
                  <Attributes>
                    <Attribute Name="input_constant" Value="" />
                  </Attributes>
                </data>
              </addData>
            </variable>
            <variable name="X13">
              <type>
                <REAL />
              </type>
              <addData>
                <data name="http://www.3s-software.com/plcopenxml/attributes" handleUnknown="implementation">
                  <Attributes>
                    <Attribute Name="input_constant" Value="" />
                  </Attributes>
                </data>
              </addData>
            </variable>
            <variable name="X14">
              <type>
                <REAL />
              </type>
              <addData>
                <data name="http://www.3s-software.com/plcopenxml/attributes" handleUnknown="implementation">
                  <Attributes>
                    <Attribute Name="input_constant" Value="" />
                  </Attributes>
                </data>
              </addData>
            </variable>
            <variable name="X21">
              <type>
                <REAL />
              </type>
              <addData>
                <data name="http://www.3s-software.com/plcopenxml/attributes" handleUnknown="implementation">
                  <Attributes>
                    <Attribute Name="input_constant" Value="" />
                  </Attributes>
                </data>
              </addData>
            </variable>
            <variable name="X22">
              <type>
                <REAL />
              </type>
              <addData>
                <data name="http://www.3s-software.com/plcopenxml/attributes" handleUnknown="implementation">
                  <Attributes>
                    <Attribute Name="input_constant" Value="" />
                  </Attributes>
                </data>
              </addData>
            </variable>
            <variable name="X23">
              <type>
                <REAL />
              </type>
              <addData>
                <data name="http://www.3s-software.com/plcopenxml/attributes" handleUnknown="implementation">
                  <Attributes>
                    <Attribute Name="input_constant" Value="" />
                  </Attributes>
                </data>
              </addData>
            </variable>
            <variable name="X24">
              <type>
                <REAL />
              </type>
              <addData>
                <data name="http://www.3s-software.com/plcopenxml/attributes" handleUnknown="implementation">
                  <Attributes>
                    <Attribute Name="input_constant" Value="" />
                  </Attributes>
                </data>
              </addData>
            </variable>
            <variable name="X31">
              <type>
                <REAL />
              </type>
              <addData>
                <data name="http://www.3s-software.com/plcopenxml/attributes" handleUnknown="implementation">
                  <Attributes>
                    <Attribute Name="input_constant" Value="" />
                  </Attributes>
                </data>
              </addData>
            </variable>
            <variable name="X32">
              <type>
                <REAL />
              </type>
              <addData>
                <data name="http://www.3s-software.com/plcopenxml/attributes" handleUnknown="implementation">
                  <Attributes>
                    <Attribute Name="input_constant" Value="" />
                  </Attributes>
                </data>
              </addData>
            </variable>
            <variable name="X33">
              <type>
                <REAL />
              </type>
              <addData>
                <data name="http://www.3s-software.com/plcopenxml/attributes" handleUnknown="implementation">
                  <Attributes>
                    <Attribute Name="input_constant" Value="" />
                  </Attributes>
                </data>
              </addData>
            </variable>
            <variable name="X34">
              <type>
                <REAL />
              </type>
              <addData>
                <data name="http://www.3s-software.com/plcopenxml/attributes" handleUnknown="implementation">
                  <Attributes>
                    <Attribute Name="input_constant" Value="" />
                  </Attributes>
                </data>
              </addData>
            </variable>
            <variable name="L1">
              <type>
                <REAL />
              </type>
              <addData>
                <data name="http://www.3s-software.com/plcopenxml/attributes" handleUnknown="implementation">
                  <Attributes>
                    <Attribute Name="input_constant" Value="" />
                  </Attributes>
                </data>
              </addData>
            </variable>
            <variable name="L2">
              <type>
                <REAL />
              </type>
              <addData>
                <data name="http://www.3s-software.com/plcopenxml/attributes" handleUnknown="implementation">
                  <Attributes>
                    <Attribute Name="input_constant" Value="" />
                  </Attributes>
                </data>
              </addData>
            </variable>
            <variable name="L3">
              <type>
                <REAL />
              </type>
              <addData>
                <data name="http://www.3s-software.com/plcopenxml/attributes" handleUnknown="implementation">
                  <Attributes>
                    <Attribute Name="input_constant" Value="" />
                  </Attributes>
                </data>
              </addData>
            </variable>
            <variable name="TC">
              <type>
                <TIME />
              </type>
              <addData>
                <data name="http://www.3s-software.com/plcopenxml/attributes" handleUnknown="implementation">
                  <Attributes>
                    <Attribute Name="input_constant" Value="" />
                  </Attributes>
                </data>
              </addData>
            </variable>
          </inputVars>
          <outputVars>
            <variable name="P1">
              <type>
                <REAL />
              </type>
            </variable>
            <variable name="P2">
              <type>
                <REAL />
              </type>
            </variable>
            <variable name="P3">
              <type>
                <REAL />
              </type>
            </variable>
            <variable name="P4">
              <type>
                <REAL />
              </type>
            </variable>
          </outputVars>
          <localVars>
            <variable name="Pset">
              <type>
                <derived name="parset" />
              </type>
            </variable>
            <variable name="init">
              <type>
                <BOOL />
              </type>
            </variable>
          </localVars>
        </interface>
        <body>
          <ST>
            (* init sequence *)
IF NOT init THEN
	init := TRUE;
	pset(TC:=TC, X01:=X01, X02:=X02, X03:=X03, X04:=X04, X11:=X11, X12:=X12, X13:=X13, X14:=X14, X21:=X21, X22:=X22, X23:=X23, X24:=X24, X31:=X31, X32:=X32, X33:=X33, X34:=X34);
END_IF;
IF ABS(X) &lt; L1 THEN
	pset(A0 := FALSE, A1 := FALSE);
ELSIF ABS(X) &lt; L2 THEN
	pset(A0 := TRUE, A1 := FALSE);
ELSIF ABS(x) &lt; L3 THEN
	pset(A0 := FALSE, A1 := TRUE);
ELSE
	pset(A0 := TRUE, A1 := TRUE);
END_IF;
P1 := pset.P1;
P2 := pset.P2;
P3 := pset.P3;
P4 := pset.P4;

(* revision history
hm		3.11.2007		rev 1.0
	original version

*)

          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>4bb9ca08-52a2-48a1-a876-f09de0beaf52</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="SIGNAL" pouType="functionBlock">
        <interface>
          <inputVars>
            <variable name="IN">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="SIG">
              <type>
                <BYTE />
              </type>
            </variable>
            <variable name="TS">
              <type>
                <TIME />
              </type>
            </variable>
          </inputVars>
          <outputVars>
            <variable name="Q">
              <type>
                <BOOL />
              </type>
            </variable>
          </outputVars>
          <localVars>
            <variable name="tx">
              <type>
                <DWORD />
              </type>
            </variable>
            <variable name="step">
              <type>
                <BYTE />
              </type>
            </variable>
          </localVars>
          <localVars constant="true">
            <variable name="one">
              <type>
                <BYTE />
              </type>
              <initialValue>
                <simpleValue value="1" />
              </initialValue>
            </variable>
          </localVars>
        </interface>
        <body>
          <ST>
            IF in THEN
	(* an alarm is present read system time first *)
	tx := T_PLC_MS();
	(* calculate the step counter which is the lowest 3 bits of (time / ts) *)
	IF ts &gt; t#0s THEN
		step := DWORD_TO_BYTE(tx / TIME_TO_DWORD(ts) AND 16#0000_0007);
	ELSE
		step := DWORD_TO_BYTE(SHR(tx,7) AND 16#0000_0007);
	END_IF;
	(* convert the value 0-7 in step into one bit only (bit 0-7) *)
	step := SHL(one,step);
	(* generate the output signal *)
	Q := (step AND sig) &gt; 0;
ELSE
	Q := FALSE;
END_IF;

(* revision history
hm	13.12.2007		rev 1.0
	original version

*)
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>24cfb59f-ee48-4229-ba89-50181bb43988</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="SIGNAL_4" pouType="functionBlock">
        <interface>
          <inputVars>
            <variable name="IN1">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="IN2">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="IN3">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="IN4">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="TS">
              <type>
                <TIME />
              </type>
            </variable>
            <variable name="S1">
              <type>
                <BYTE />
              </type>
              <initialValue>
                <simpleValue value="2#11111111" />
              </initialValue>
              <addData>
                <data name="http://www.3s-software.com/plcopenxml/attributes" handleUnknown="implementation">
                  <Attributes>
                    <Attribute Name="input_constant" Value="" />
                  </Attributes>
                </data>
              </addData>
            </variable>
            <variable name="S2">
              <type>
                <BYTE />
              </type>
              <initialValue>
                <simpleValue value="2#11110000" />
              </initialValue>
              <addData>
                <data name="http://www.3s-software.com/plcopenxml/attributes" handleUnknown="implementation">
                  <Attributes>
                    <Attribute Name="input_constant" Value="" />
                  </Attributes>
                </data>
              </addData>
            </variable>
            <variable name="S3">
              <type>
                <BYTE />
              </type>
              <initialValue>
                <simpleValue value="2#10101010" />
              </initialValue>
              <addData>
                <data name="http://www.3s-software.com/plcopenxml/attributes" handleUnknown="implementation">
                  <Attributes>
                    <Attribute Name="input_constant" Value="" />
                  </Attributes>
                </data>
              </addData>
            </variable>
            <variable name="S4">
              <type>
                <BYTE />
              </type>
              <initialValue>
                <simpleValue value="2#10100000" />
              </initialValue>
              <addData>
                <data name="http://www.3s-software.com/plcopenxml/attributes" handleUnknown="implementation">
                  <Attributes>
                    <Attribute Name="input_constant" Value="" />
                  </Attributes>
                </data>
              </addData>
            </variable>
          </inputVars>
          <outputVars>
            <variable name="Q">
              <type>
                <BOOL />
              </type>
            </variable>
          </outputVars>
          <localVars>
            <variable name="sig">
              <type>
                <derived name="SIGNAL" />
              </type>
            </variable>
          </localVars>
        </interface>
        <body>
          <ST>
            (* an alarm is present read system time first *)
(* check if an alarm is present if yes set sig to the alarm pattern otherwise exit the routine *)
IF in1 THEN
	sig(in := TRUE, sig := s1, TS := TS);
ELSIF in2 THEN
	sig(in := TRUE, sig := s2, TS := TS);
ELSIF in3 THEN
	sig(in := TRUE, sig := s3, TS := TS);
ELSIF in4 THEN
	sig(in := TRUE, sig := s4, TS := TS);
ELSE
	sig(in := FALSE);
END_IF;

(* set the output *)
Q := sig.Q;


(* revision history
hm	13.12.2007		rev 1.0
	original version

*)

          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>073ee3b9-d55b-48f5-86da-174d318c7b85</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="SRAMP" pouType="functionBlock">
        <interface>
          <inputVars>
            <variable name="X">
              <type>
                <REAL />
              </type>
            </variable>
            <variable name="A_UP">
              <type>
                <REAL />
              </type>
            </variable>
            <variable name="A_DN">
              <type>
                <REAL />
              </type>
            </variable>
            <variable name="VU_MAX">
              <type>
                <REAL />
              </type>
            </variable>
            <variable name="VD_MAX">
              <type>
                <REAL />
              </type>
            </variable>
            <variable name="LIMIT_HIGH">
              <type>
                <REAL />
              </type>
            </variable>
            <variable name="LIMIT_LOW">
              <type>
                <REAL />
              </type>
            </variable>
            <variable name="RST">
              <type>
                <BOOL />
              </type>
            </variable>
          </inputVars>
          <outputVars>
            <variable name="Y">
              <type>
                <REAL />
              </type>
            </variable>
            <variable name="V">
              <type>
                <REAL />
              </type>
            </variable>
          </outputVars>
          <localVars>
            <variable name="cycle_time">
              <type>
                <derived name="TC_S" />
              </type>
            </variable>
            <variable name="init">
              <type>
                <BOOL />
              </type>
            </variable>
          </localVars>
        </interface>
        <body>
          <ST>
            (* read the system_time in microseconds *)
cycle_time();

(* assure range of inputs *)
A_up := MAX(0.0, A_UP);
A_dn := MIN(0.0, A_dn);
VU_max := MAX(0.0, VU_max);
VD_max := MIN(0.0, VD_MAX);

(* calculate the output offset *)
IF rst OR NOT init THEN
	init := TRUE;
	Y := 0.0;
	V := 0.0;
ELSIF X = Y THEN
	v := 0.0;
ELSIF X &gt; Y THEN
	(* output is too low &gt;&gt; ramp up and brake at the end *)
	(* accelerate the speed and limit to vu_max *)
	v := MIN(v + A_UP * cycle_time.TC, vu_max);
	(* calculate the max speed to be able to brake and select the lowest *)
	v := MIN(SQRT((Y-X) * 2.0 * A_DN), v);
	(* calculate the output and obey limits *)
	y := LIMIT(limit_low, y + MIN(v * cycle_time.TC, X-Y), limit_high);
ELSIF X &lt; Y THEN
	(* output is too high &gt;&gt; ramp dn and brake at the end *)
	(* accelerate the speed and limit to vd_max *)
	v := MAX(v + A_DN * cycle_time.TC, vd_max);
	(* calculate the max speed to be able to brake and select the lowest *)
	v := MAX(-SQRT((Y-X) * 2.0 * A_UP), v);
	(* calculate the output and obey limits *)
	y := LIMIT(limit_low, y + MAX(v * cycle_time.TC, X-Y), limit_high);
END_IF;


(* revision history
hm	13. mar. 2008	rev 1.0
	original version

hm	11. mar. 2009	rev 1.1
	real constants updated to new systax using dot																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																											

*)



          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>1816c0bc-7135-40b9-a3ad-2123ba5ff2ca</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="TUNE" pouType="functionBlock">
        <interface>
          <inputVars>
            <variable name="SET">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="SU">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="SD">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="RST">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="SS">
              <type>
                <REAL />
              </type>
              <initialValue>
                <simpleValue value="0.1" />
              </initialValue>
              <addData>
                <data name="http://www.3s-software.com/plcopenxml/attributes" handleUnknown="implementation">
                  <Attributes>
                    <Attribute Name="input_constant" Value="" />
                  </Attributes>
                </data>
              </addData>
            </variable>
            <variable name="Limit_L">
              <type>
                <REAL />
              </type>
              <addData>
                <data name="http://www.3s-software.com/plcopenxml/attributes" handleUnknown="implementation">
                  <Attributes>
                    <Attribute Name="input_constant" Value="" />
                  </Attributes>
                </data>
              </addData>
            </variable>
            <variable name="LIMIT_H">
              <type>
                <REAL />
              </type>
              <initialValue>
                <simpleValue value="100.0" />
              </initialValue>
              <addData>
                <data name="http://www.3s-software.com/plcopenxml/attributes" handleUnknown="implementation">
                  <Attributes>
                    <Attribute Name="input_constant" Value="" />
                  </Attributes>
                </data>
              </addData>
            </variable>
            <variable name="RST_val">
              <type>
                <REAL />
              </type>
              <addData>
                <data name="http://www.3s-software.com/plcopenxml/attributes" handleUnknown="implementation">
                  <Attributes>
                    <Attribute Name="input_constant" Value="" />
                  </Attributes>
                </data>
              </addData>
            </variable>
            <variable name="SET_val">
              <type>
                <REAL />
              </type>
              <initialValue>
                <simpleValue value="100.0" />
              </initialValue>
              <addData>
                <data name="http://www.3s-software.com/plcopenxml/attributes" handleUnknown="implementation">
                  <Attributes>
                    <Attribute Name="input_constant" Value="" />
                  </Attributes>
                </data>
              </addData>
            </variable>
            <variable name="T1">
              <type>
                <TIME />
              </type>
              <initialValue>
                <simpleValue value="TIME#500ms" />
              </initialValue>
              <addData>
                <data name="http://www.3s-software.com/plcopenxml/attributes" handleUnknown="implementation">
                  <Attributes>
                    <Attribute Name="input_constant" Value="" />
                  </Attributes>
                </data>
              </addData>
            </variable>
            <variable name="T2">
              <type>
                <TIME />
              </type>
              <initialValue>
                <simpleValue value="TIME#2s0ms" />
              </initialValue>
              <addData>
                <data name="http://www.3s-software.com/plcopenxml/attributes" handleUnknown="implementation">
                  <Attributes>
                    <Attribute Name="input_constant" Value="" />
                  </Attributes>
                </data>
              </addData>
            </variable>
            <variable name="S1">
              <type>
                <REAL />
              </type>
              <initialValue>
                <simpleValue value="2.0" />
              </initialValue>
              <addData>
                <data name="http://www.3s-software.com/plcopenxml/attributes" handleUnknown="implementation">
                  <Attributes>
                    <Attribute Name="input_constant" Value="" />
                  </Attributes>
                </data>
              </addData>
            </variable>
            <variable name="S2">
              <type>
                <REAL />
              </type>
              <initialValue>
                <simpleValue value="10.0" />
              </initialValue>
              <addData>
                <data name="http://www.3s-software.com/plcopenxml/attributes" handleUnknown="implementation">
                  <Attributes>
                    <Attribute Name="input_constant" Value="" />
                  </Attributes>
                </data>
              </addData>
            </variable>
          </inputVars>
          <outputVars>
            <variable name="Y">
              <type>
                <REAL />
              </type>
            </variable>
          </outputVars>
          <localVars>
            <variable name="tx">
              <type>
                <DWORD />
              </type>
            </variable>
            <variable name="start">
              <type>
                <DWORD />
              </type>
            </variable>
            <variable name="start2">
              <type>
                <DWORD />
              </type>
            </variable>
            <variable name="state">
              <type>
                <INT />
              </type>
            </variable>
            <variable name="in">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="step">
              <type>
                <REAL />
              </type>
            </variable>
            <variable name="SPEED">
              <type>
                <REAL />
              </type>
            </variable>
            <variable name="Y_start">
              <type>
                <REAL />
              </type>
            </variable>
            <variable name="Y_start2">
              <type>
                <REAL />
              </type>
            </variable>
          </localVars>
        </interface>
        <body>
          <ST>
            (* read system time *)
tx := T_PLC_MS();

IF rst THEN
	Y := RST_val;
	state := 0;
ELSIF set THEN
	Y := SET_val;
	state := 0;
ELSIF state &gt; 0 THEN
	(* key has been pushed state machine operating *)
	(* first read the correct input *)
	IF state = 1 THEN
		(* step up *)
		in := su;
	ELSE
		(* step down *)
		in := sd;
	END_IF;
	(* check for single step operation *)
	IF NOT in AND tx - start &lt;= TIME_TO_DWORD(T1) THEN
		Y := Y_start + step;
		state := 0;
	(* check if fast ramp needs to be generated *)
	ELSIF in AND tx - start &gt;= TIME_TO_DWORD(T2) THEN
		Y := Y_start2 + DWORD_TO_REAL(tx - start2) * s2 / speed;
	(* check if slow ramp needs to be generated *)
	ELSIF in AND tx - start &gt;= TIME_TO_DWORD(T1) THEN
		Y := Y_start + DWORD_TO_REAL(tx - start - TIME_TO_DWORD(T1)) * S1 / speed;
		start2 := tx;
		Y_start2 := Y;
	ELSIF NOT in THEN
		state := 0;
	END_IF;
ELSIF su THEN
	(* slow step up *)
	state := 1;
	start := tx;
	step := ss;
	speed := 1000.0;
	Y_start := Y;
ELSIF sd THEN
	(* slow step down *)
	state := 2;
	start := tx;
	step := -ss;
	speed := -1000.0;
	Y_start := Y;
END_IF;

(* make sure output does not exceed limits *)
Y := LIMIT(LIMIT_L, Y, LIMIT_H);

(* revision history
hm	3.11.2007		rev 1.0
	original version

hm	16. mar. 2008	rev 1.1
	added type conversions to avoid warnings under codesys 3.0

hm	11. mar. 2009	rev 1.2
	real constants updated to new systax using dot																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																											

*)
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>2d407c98-a444-4499-aa14-010986e7a02c</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="TUNE2" pouType="functionBlock">
        <interface>
          <inputVars>
            <variable name="SET">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="SU">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="SD">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="FU">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="FD">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="RST">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="SS">
              <type>
                <REAL />
              </type>
              <initialValue>
                <simpleValue value="0.1" />
              </initialValue>
              <addData>
                <data name="http://www.3s-software.com/plcopenxml/attributes" handleUnknown="implementation">
                  <Attributes>
                    <Attribute Name="input_constant" Value="" />
                  </Attributes>
                </data>
              </addData>
            </variable>
            <variable name="FS">
              <type>
                <REAL />
              </type>
              <initialValue>
                <simpleValue value="5.0" />
              </initialValue>
              <addData>
                <data name="http://www.3s-software.com/plcopenxml/attributes" handleUnknown="implementation">
                  <Attributes>
                    <Attribute Name="input_constant" Value="" />
                  </Attributes>
                </data>
              </addData>
            </variable>
            <variable name="Limit_L">
              <type>
                <REAL />
              </type>
              <addData>
                <data name="http://www.3s-software.com/plcopenxml/attributes" handleUnknown="implementation">
                  <Attributes>
                    <Attribute Name="input_constant" Value="" />
                  </Attributes>
                </data>
              </addData>
            </variable>
            <variable name="LIMIT_H">
              <type>
                <REAL />
              </type>
              <initialValue>
                <simpleValue value="100.0" />
              </initialValue>
              <addData>
                <data name="http://www.3s-software.com/plcopenxml/attributes" handleUnknown="implementation">
                  <Attributes>
                    <Attribute Name="input_constant" Value="" />
                  </Attributes>
                </data>
              </addData>
            </variable>
            <variable name="RST_val">
              <type>
                <REAL />
              </type>
              <addData>
                <data name="http://www.3s-software.com/plcopenxml/attributes" handleUnknown="implementation">
                  <Attributes>
                    <Attribute Name="input_constant" Value="" />
                  </Attributes>
                </data>
              </addData>
            </variable>
            <variable name="SET_val">
              <type>
                <REAL />
              </type>
              <initialValue>
                <simpleValue value="100.0" />
              </initialValue>
              <addData>
                <data name="http://www.3s-software.com/plcopenxml/attributes" handleUnknown="implementation">
                  <Attributes>
                    <Attribute Name="input_constant" Value="" />
                  </Attributes>
                </data>
              </addData>
            </variable>
            <variable name="TR">
              <type>
                <TIME />
              </type>
              <initialValue>
                <simpleValue value="TIME#500ms" />
              </initialValue>
              <addData>
                <data name="http://www.3s-software.com/plcopenxml/attributes" handleUnknown="implementation">
                  <Attributes>
                    <Attribute Name="input_constant" Value="" />
                  </Attributes>
                </data>
              </addData>
            </variable>
            <variable name="S1">
              <type>
                <REAL />
              </type>
              <initialValue>
                <simpleValue value="2.0" />
              </initialValue>
              <addData>
                <data name="http://www.3s-software.com/plcopenxml/attributes" handleUnknown="implementation">
                  <Attributes>
                    <Attribute Name="input_constant" Value="" />
                  </Attributes>
                </data>
              </addData>
            </variable>
            <variable name="S2">
              <type>
                <REAL />
              </type>
              <initialValue>
                <simpleValue value="10.0" />
              </initialValue>
              <addData>
                <data name="http://www.3s-software.com/plcopenxml/attributes" handleUnknown="implementation">
                  <Attributes>
                    <Attribute Name="input_constant" Value="" />
                  </Attributes>
                </data>
              </addData>
            </variable>
          </inputVars>
          <outputVars>
            <variable name="Y">
              <type>
                <REAL />
              </type>
            </variable>
          </outputVars>
          <localVars>
            <variable name="tx">
              <type>
                <DWORD />
              </type>
            </variable>
            <variable name="start">
              <type>
                <DWORD />
              </type>
            </variable>
            <variable name="state">
              <type>
                <INT />
              </type>
            </variable>
            <variable name="in">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="step">
              <type>
                <REAL />
              </type>
            </variable>
            <variable name="SPEED">
              <type>
                <REAL />
              </type>
            </variable>
            <variable name="Y_start">
              <type>
                <REAL />
              </type>
            </variable>
          </localVars>
        </interface>
        <body>
          <ST>
            (* read system time *)
tx := T_PLC_MS();

IF rst THEN
	Y := RST_val;
	state := 0;
ELSIF set THEN
	Y := SET_val;
	state := 0;
ELSIF state &gt; 0 THEN
	(* key has been pushed state machine operating *)
	(* first read the correct input *)
	CASE state OF
		1 :	(* slow up *)
			in := su;
		2 :	(* slow down *)
			in := sd;
		3 :	(* fast up *)
			in := fu;
		4 :	(* fast down *)
			in := fd;
	END_CASE;
	(* check for single step operation *)
	IF NOT in AND tx - start &lt;= TIME_TO_DWORD(TR) THEN
		Y := Y_start + step;
		state := 0;
	(* check if ramp needs to be generated *)
	ELSIF in AND tx - start &gt;= TIME_TO_DWORD(TR) THEN
		Y := Y_start + DWORD_TO_REAL(tx - start - TIME_TO_DWORD(TR)) * speed;
	ELSIF NOT in THEN
		state := 0;
	END_IF;
ELSIF su THEN
	(* slow step up *)
	state := 1;
	start := tx;
	step := ss;
	speed := s1 * 1.0E-3;
	Y_start := Y;
ELSIF sd THEN
	(* slow step down *)
	state := 2;
	start := tx;
	step := -ss;
	speed := -s1 * 1.0E-3;
	Y_start := Y;
ELSIF fu THEN
	(* fast step up *)
	state := 3;
	start := tx;
	step := fs;
	speed := s2 * 1.0E-3;
	y_start := Y;
ELSIF fd THEN
	(* fast step down *)
	state := 4;
	start := tx;
	step := -fs;
	speed := -s2 * 1.0E-3;
	y_start := Y;
END_IF;

(* make sure output does not exceed limits *)
Y := LIMIT(LIMIT_L, Y, LIMIT_H);

(* revision history
hm	3.11.2007		rev 1.0
	original version

hm	16. 3. 2008	rev 1.1
	added type conversions to avoid warnings in codesys 3.0
	improved performance

hm	11. mar. 2009	rev 1.2
	real constants updated to new systax using dot																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																											

*)
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>d80d42f0-6a30-4553-9dc0-b7f0b1663486</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="BAND_B" pouType="function">
        <interface>
          <returnType>
            <BYTE />
          </returnType>
          <inputVars>
            <variable name="X">
              <type>
                <BYTE />
              </type>
            </variable>
            <variable name="B">
              <type>
                <BYTE />
              </type>
            </variable>
          </inputVars>
        </interface>
        <body>
          <ST>
            IF X &lt; B THEN
	BAND_B := 0;
ELSIF X &gt; BYTE#255-B THEN
	BAND_B := 255;
ELSE
	BAND_B := X;
END_IF;



(* revision history
hm	21. nov. 2008	rev 1.0
	original version

*)

          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>bf5e8bee-5f1d-43f8-841f-53e205c34b83</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="CONTROL_SET1" pouType="functionBlock">
        <interface>
          <inputVars>
            <variable name="Kt">
              <type>
                <REAL />
              </type>
            </variable>
            <variable name="Tt">
              <type>
                <REAL />
              </type>
            </variable>
            <variable name="PI">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="PID">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="P_K">
              <type>
                <REAL />
              </type>
              <initialValue>
                <simpleValue value="0.5" />
              </initialValue>
              <addData>
                <data name="http://www.3s-software.com/plcopenxml/attributes" handleUnknown="implementation">
                  <Attributes>
                    <Attribute Name="input_constant" Value="" />
                  </Attributes>
                </data>
              </addData>
            </variable>
            <variable name="PI_K">
              <type>
                <REAL />
              </type>
              <initialValue>
                <simpleValue value="0.45" />
              </initialValue>
              <addData>
                <data name="http://www.3s-software.com/plcopenxml/attributes" handleUnknown="implementation">
                  <Attributes>
                    <Attribute Name="input_constant" Value="" />
                  </Attributes>
                </data>
              </addData>
            </variable>
            <variable name="PI_TN">
              <type>
                <REAL />
              </type>
              <initialValue>
                <simpleValue value="0.83" />
              </initialValue>
              <addData>
                <data name="http://www.3s-software.com/plcopenxml/attributes" handleUnknown="implementation">
                  <Attributes>
                    <Attribute Name="input_constant" Value="" />
                  </Attributes>
                </data>
              </addData>
            </variable>
            <variable name="PID_K">
              <type>
                <REAL />
              </type>
              <initialValue>
                <simpleValue value="0.6" />
              </initialValue>
              <addData>
                <data name="http://www.3s-software.com/plcopenxml/attributes" handleUnknown="implementation">
                  <Attributes>
                    <Attribute Name="input_constant" Value="" />
                  </Attributes>
                </data>
              </addData>
            </variable>
            <variable name="PID_TN">
              <type>
                <REAL />
              </type>
              <initialValue>
                <simpleValue value="0.5" />
              </initialValue>
              <addData>
                <data name="http://www.3s-software.com/plcopenxml/attributes" handleUnknown="implementation">
                  <Attributes>
                    <Attribute Name="input_constant" Value="" />
                  </Attributes>
                </data>
              </addData>
            </variable>
            <variable name="PID_TV">
              <type>
                <REAL />
              </type>
              <initialValue>
                <simpleValue value="0.125" />
              </initialValue>
              <addData>
                <data name="http://www.3s-software.com/plcopenxml/attributes" handleUnknown="implementation">
                  <Attributes>
                    <Attribute Name="input_constant" Value="" />
                  </Attributes>
                </data>
              </addData>
            </variable>
          </inputVars>
          <outputVars>
            <variable name="KP">
              <type>
                <REAL />
              </type>
            </variable>
            <variable name="TN">
              <type>
                <REAL />
              </type>
            </variable>
            <variable name="TV">
              <type>
                <REAL />
              </type>
            </variable>
            <variable name="KI">
              <type>
                <REAL />
              </type>
            </variable>
            <variable name="KD">
              <type>
                <REAL />
              </type>
            </variable>
          </outputVars>
        </interface>
        <body>
          <ST>
            IF pi AND PID THEN
	KP := 0.0;
	TN := 0.0;
	TV := 0.0;
ELSIF PID THEN
	KP := PID_K * Kt;
	TN := PID_TN * Tt;
	TV := PID_TV * Tt;
ELSIF PI THEN
	KP := PI_K * Kt;
	TN := PI_TN * Tt;
ELSE
	KP := P_K * Kt;
END_IF;

(* KI and KD are calculated *)
IF tn &gt; 0.0 THEN KI := KP / TN; ELSE KI := 0.0; END_IF;
KD := KP * TV;

(* revision history
hm	4. nov 2007	rev 1.0
	original version

hm	11. mar. 2009	rev 1.1
	real constants updated to new systax using dot																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																											

*)
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>f16726fc-0fb2-437e-92cf-05b8cf48d8f9</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="CONTROL_SET2" pouType="functionBlock">
        <interface>
          <inputVars>
            <variable name="KS">
              <type>
                <REAL />
              </type>
            </variable>
            <variable name="TU">
              <type>
                <REAL />
              </type>
            </variable>
            <variable name="TG">
              <type>
                <REAL />
              </type>
            </variable>
            <variable name="PI">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="PID">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="P_K">
              <type>
                <REAL />
              </type>
              <initialValue>
                <simpleValue value="1.0" />
              </initialValue>
              <addData>
                <data name="http://www.3s-software.com/plcopenxml/attributes" handleUnknown="implementation">
                  <Attributes>
                    <Attribute Name="input_constant" Value="" />
                  </Attributes>
                </data>
              </addData>
            </variable>
            <variable name="PI_K">
              <type>
                <REAL />
              </type>
              <initialValue>
                <simpleValue value="0.9" />
              </initialValue>
              <addData>
                <data name="http://www.3s-software.com/plcopenxml/attributes" handleUnknown="implementation">
                  <Attributes>
                    <Attribute Name="input_constant" Value="" />
                  </Attributes>
                </data>
              </addData>
            </variable>
            <variable name="PI_TN">
              <type>
                <REAL />
              </type>
              <initialValue>
                <simpleValue value="3.33" />
              </initialValue>
              <addData>
                <data name="http://www.3s-software.com/plcopenxml/attributes" handleUnknown="implementation">
                  <Attributes>
                    <Attribute Name="input_constant" Value="" />
                  </Attributes>
                </data>
              </addData>
            </variable>
            <variable name="PID_K">
              <type>
                <REAL />
              </type>
              <initialValue>
                <simpleValue value="1.2" />
              </initialValue>
              <addData>
                <data name="http://www.3s-software.com/plcopenxml/attributes" handleUnknown="implementation">
                  <Attributes>
                    <Attribute Name="input_constant" Value="" />
                  </Attributes>
                </data>
              </addData>
            </variable>
            <variable name="PID_TN">
              <type>
                <REAL />
              </type>
              <initialValue>
                <simpleValue value="2.0" />
              </initialValue>
              <addData>
                <data name="http://www.3s-software.com/plcopenxml/attributes" handleUnknown="implementation">
                  <Attributes>
                    <Attribute Name="input_constant" Value="" />
                  </Attributes>
                </data>
              </addData>
            </variable>
            <variable name="PID_TV">
              <type>
                <REAL />
              </type>
              <initialValue>
                <simpleValue value="0.5" />
              </initialValue>
              <addData>
                <data name="http://www.3s-software.com/plcopenxml/attributes" handleUnknown="implementation">
                  <Attributes>
                    <Attribute Name="input_constant" Value="" />
                  </Attributes>
                </data>
              </addData>
            </variable>
          </inputVars>
          <outputVars>
            <variable name="KP">
              <type>
                <REAL />
              </type>
            </variable>
            <variable name="TN">
              <type>
                <REAL />
              </type>
            </variable>
            <variable name="TV">
              <type>
                <REAL />
              </type>
            </variable>
            <variable name="KI">
              <type>
                <REAL />
              </type>
            </variable>
            <variable name="KD">
              <type>
                <REAL />
              </type>
            </variable>
          </outputVars>
          <localVars>
            <variable name="TX">
              <type>
                <REAL />
              </type>
            </variable>
          </localVars>
        </interface>
        <body>
          <ST>
            IF TU &gt; 0.0 AND KS &gt; 0.0 THEN TX := TG / TU / KS; END_IF;
IF pi AND PID THEN
	KP := 0.0;
	TN := 0.0;
	TV := 0.0;
ELSIF PID THEN
	KP := PID_K * TX;
	TN := PID_TN * TU;
	TV := PID_TV * TU;
ELSIF PI THEN
	KP := PI_K * TX;
	TN := PI_TN * TU;
ELSE
	KP := P_K * TX;
END_IF;

(* KI and KD are calculated *)
IF TN &gt; 0.0 THEN KI := KP / TN; ELSE KI := 0.0; END_IF;
KD := KP * TV;

(* revision history
hm	4. nov 2007	rev 1.0
	original version

hm	11. mar. 2009	rev 1.1
	real constants updated to new systax using dot																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																											

*)
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>4d9ddb09-e3ef-4c52-9a68-7e6cb43a4e8f</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="CTRL_IN" pouType="function">
        <interface>
          <returnType>
            <REAL />
          </returnType>
          <inputVars>
            <variable name="SET_POINT">
              <type>
                <REAL />
              </type>
            </variable>
            <variable name="ACTUAL">
              <type>
                <REAL />
              </type>
            </variable>
            <variable name="NOISE">
              <type>
                <REAL />
              </type>
            </variable>
          </inputVars>
        </interface>
        <body>
          <ST>
            (* calculate the process error DIFF *)
CTRL_IN := DEAD_ZONE(SET_POINT - ACTUAL, NOISE);


(* revision history
hm 	2. jun. 2008 	rev 1.0
	original version

*)
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>0047bafd-cad5-41b7-9dd7-b40b2b64641f</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="CTRL_OUT" pouType="functionBlock">
        <interface>
          <inputVars>
            <variable name="CI">
              <type>
                <REAL />
              </type>
            </variable>
            <variable name="OFFSET">
              <type>
                <REAL />
              </type>
            </variable>
            <variable name="MAN_IN">
              <type>
                <REAL />
              </type>
            </variable>
            <variable name="LIM_L">
              <type>
                <REAL />
              </type>
            </variable>
            <variable name="LIM_H">
              <type>
                <REAL />
              </type>
            </variable>
            <variable name="MANUAL">
              <type>
                <BOOL />
              </type>
            </variable>
          </inputVars>
          <outputVars>
            <variable name="Y">
              <type>
                <REAL />
              </type>
            </variable>
            <variable name="LIM">
              <type>
                <BOOL />
              </type>
            </variable>
          </outputVars>
        </interface>
        <body>
          <ST>
            Y := SEL(MANUAL, CI, MAN_IN) + OFFSET;

(* Limit the output *)
IF Y &gt; LIM_L AND Y &lt; LIM_H THEN
	LIM := FALSE;
ELSE
	Y := LIMIT(LIM_L, Y, LIM_H);
	LIM := TRUE;
END_IF;



(* revision history
hm 	2. jun. 2008 	rev 1.0
	original version

hm	5. nov. 2008	rev 1.1
	optimized code
*)
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>43c34fe2-68e7-4cbf-8a59-2fe3cd0ecf2d</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="CTRL_PI" pouType="functionBlock">
        <interface>
          <inputVars>
            <variable name="ACT">
              <type>
                <REAL />
              </type>
            </variable>
            <variable name="SET">
              <type>
                <REAL />
              </type>
            </variable>
            <variable name="SUP">
              <type>
                <REAL />
              </type>
            </variable>
            <variable name="OFS">
              <type>
                <REAL />
              </type>
            </variable>
            <variable name="M_I">
              <type>
                <REAL />
              </type>
            </variable>
            <variable name="MAN">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="RST">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="KP">
              <type>
                <REAL />
              </type>
              <initialValue>
                <simpleValue value="1.0" />
              </initialValue>
            </variable>
            <variable name="KI">
              <type>
                <REAL />
              </type>
              <initialValue>
                <simpleValue value="1.0" />
              </initialValue>
            </variable>
            <variable name="LL">
              <type>
                <REAL />
              </type>
              <initialValue>
                <simpleValue value="-1000.0" />
              </initialValue>
            </variable>
            <variable name="LH">
              <type>
                <REAL />
              </type>
              <initialValue>
                <simpleValue value="1000.0" />
              </initialValue>
            </variable>
          </inputVars>
          <outputVars>
            <variable name="Y">
              <type>
                <REAL />
              </type>
            </variable>
            <variable name="DIFF">
              <type>
                <REAL />
              </type>
            </variable>
            <variable name="LIM">
              <type>
                <BOOL />
              </type>
            </variable>
          </outputVars>
          <localVars>
            <variable name="pi">
              <type>
                <derived name="FT_PIWL" />
              </type>
            </variable>
            <variable name="co">
              <type>
                <derived name="CTRL_OUT" />
              </type>
            </variable>
          </localVars>
        </interface>
        <body>
          <ST>
            DIFF := CTRL_IN(SET, ACT, SUP);
pi(in := DIFF, kp := KP, ki := KI, lim_l := LL, lim_h := LH, rst := RST);
co(ci := pi.Y, OFFSET := OFS, man_in := M_I, lim_l := LL, lim_h := LH, MANUAL := MAN);
Y := co.Y;
LIM := co.LIM;


(* revision history
hm 	31.10.2007 		rev 1.0
	original version

hm	3.11.2007		rev 1.1
	added noise input to filter noise
	added output diff
	set limit output false when output is within limits
	overfolw was not set correctly

hm	5. jan 2008		rev 1.2
	improved performance

hm	20. jun. 2008	rev 2.0
	rewritten using new modular approach

*)
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>c76324b6-fb78-4715-8f42-9c3a33154ba4</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="CTRL_PID" pouType="functionBlock">
        <interface>
          <inputVars>
            <variable name="ACT">
              <type>
                <REAL />
              </type>
            </variable>
            <variable name="SET">
              <type>
                <REAL />
              </type>
            </variable>
            <variable name="SUP">
              <type>
                <REAL />
              </type>
            </variable>
            <variable name="OFS">
              <type>
                <REAL />
              </type>
            </variable>
            <variable name="M_I">
              <type>
                <REAL />
              </type>
            </variable>
            <variable name="MAN">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="RST">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="KP">
              <type>
                <REAL />
              </type>
              <initialValue>
                <simpleValue value="1.0" />
              </initialValue>
            </variable>
            <variable name="TN">
              <type>
                <REAL />
              </type>
              <initialValue>
                <simpleValue value="1.0" />
              </initialValue>
            </variable>
            <variable name="TV">
              <type>
                <REAL />
              </type>
              <initialValue>
                <simpleValue value="1.0" />
              </initialValue>
            </variable>
            <variable name="LL">
              <type>
                <REAL />
              </type>
              <initialValue>
                <simpleValue value="-1000.0" />
              </initialValue>
            </variable>
            <variable name="LH">
              <type>
                <REAL />
              </type>
              <initialValue>
                <simpleValue value="1000.0" />
              </initialValue>
            </variable>
          </inputVars>
          <outputVars>
            <variable name="Y">
              <type>
                <REAL />
              </type>
            </variable>
            <variable name="DIFF">
              <type>
                <REAL />
              </type>
            </variable>
            <variable name="LIM">
              <type>
                <BOOL />
              </type>
            </variable>
          </outputVars>
          <localVars>
            <variable name="pid">
              <type>
                <derived name="FT_PIDWL" />
              </type>
            </variable>
            <variable name="co">
              <type>
                <derived name="CTRL_OUT" />
              </type>
            </variable>
          </localVars>
        </interface>
        <body>
          <ST>
            DIFF := CTRL_IN(SET, ACT, SUP);
pid(in := DIFF, kp := KP, tn := TN, tv := TV, lim_l := LL, lim_h := LH, rst := RST);
co(ci := pid.Y, OFFSET := OFS, man_in := M_I, lim_l := LL, lim_h := LH, MANUAL := MAN);
Y := co.Y;
LIM := co.LIM;



(* revision history

hm 1.12.2006	 	rev 1.1
	changed algorithm to trapezregel for higher accuracy.

hm 3.1.2007		rev 1.2
	added integ_band to select when the integrator is active.

hm	3.3.2007		rev 1.3
	added default values to inputs KP, TN, TV, LIMIT_L und LIMIT_H.

hm 31.oct 2007	rev 1.4
	total rewrite of the module to avoid failures when one of the limits is 0

hm	3.11.2007	rev 1.5
	added noise input to filter noise
	added output diff
	set limit output false when output is within limits
	overfolw was not set correctly

hm	5. jan 2008	rev 1.6
	improved code for better performance
*)
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>ab0cf855-249d-44e2-b9ab-a4b97937a26d</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="CTRL_PWM" pouType="functionBlock">
        <interface>
          <inputVars>
            <variable name="CI">
              <type>
                <REAL />
              </type>
            </variable>
            <variable name="MAN_IN">
              <type>
                <REAL />
              </type>
            </variable>
            <variable name="MANUAL">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="F">
              <type>
                <REAL />
              </type>
            </variable>
          </inputVars>
          <outputVars>
            <variable name="Q">
              <type>
                <BOOL />
              </type>
            </variable>
          </outputVars>
          <localVars>
            <variable name="PW">
              <type>
                <derived name="PWM_DC" />
              </type>
            </variable>
          </localVars>
        </interface>
        <body>
          <ST>
            PW(F := F, DC := SEL(MANUAL,CI,MAN_IN));
Q := PW.Q;


(* revision history
hm 3. jun. 2008 	rev 1.0
	original version

hm	21. oct. 2008	rev 1.1
	optimized code

*)
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>98117ca0-f1e4-4802-b598-02b97c8f6ea0</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="DEAD_BAND" pouType="function">
        <interface>
          <returnType>
            <REAL />
          </returnType>
          <inputVars>
            <variable name="X">
              <type>
                <REAL />
              </type>
            </variable>
            <variable name="L">
              <type>
                <REAL />
              </type>
            </variable>
          </inputVars>
        </interface>
        <body>
          <ST>
            IF X &gt; L THEN
	DEAD_BAND := X - L;
ELSIF X &lt; -L THEN
	DEAD_BAND := X + L;
ELSE
	DEAD_BAND := 0.0;
END_IF;


(* revision history
hm	2. nov. 2007	rev 1.0
	original version

hm	14. jun. 2008	rev 1.1
	improved performance

hm	18. jan. 2011	rev 1.2
	assign 0 before return
*)
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>b3f87a0b-74ae-4142-a71c-fb1a41be6d9d</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="DEAD_BAND_A" pouType="functionBlock">
        <interface>
          <inputVars>
            <variable name="X">
              <type>
                <REAL />
              </type>
            </variable>
            <variable name="T">
              <type>
                <TIME />
              </type>
            </variable>
            <variable name="KL">
              <type>
                <REAL />
              </type>
              <initialValue>
                <simpleValue value="1.0" />
              </initialValue>
            </variable>
            <variable name="LM">
              <type>
                <REAL />
              </type>
            </variable>
          </inputVars>
          <outputVars>
            <variable name="Y">
              <type>
                <REAL />
              </type>
            </variable>
            <variable name="L">
              <type>
                <REAL />
              </type>
            </variable>
          </outputVars>
          <localVars>
            <variable name="tp1">
              <type>
                <derived name="FT_PT1" />
              </type>
            </variable>
            <variable name="tp2">
              <type>
                <derived name="FT_PT1" />
              </type>
            </variable>
          </localVars>
        </interface>
        <body>
          <ST>
            (* filter the input signal *)
tp1(in := X, T:= T);

(* filter the HF portion to generate a stable L *)
tp2(in := ABS(tp1.out - X), T := MULTIME(T, 4.0));

(* now we determine L which is half the width of the dead band *)
L := MIN(KL * tp2.out, LM);

IF X &gt; L THEN
	Y := X - L;
ELSIF X &lt; -L THEN
	Y := X + L;
ELSE
	Y := 0.0;
END_IF;


(* revision history
hm	14. jun. 2008	rev 1.0
	original version

hm	11. mar. 2009	rev 1.1
	real constants updated to new systax using dot

*)
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>21dcc8ee-0b20-412c-ae91-9a7a35731c85</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="DEAD_ZONE" pouType="function">
        <interface>
          <returnType>
            <REAL />
          </returnType>
          <inputVars>
            <variable name="X">
              <type>
                <REAL />
              </type>
            </variable>
            <variable name="L">
              <type>
                <REAL />
              </type>
            </variable>
          </inputVars>
        </interface>
        <body>
          <ST>
            IF ABS(x) &gt; L THEN
	dead_zone := X;
ELSE
	DEAD_ZONE := 0.0;
END_IF;

(* revision history
hm	12. feb. 2007	rev 1.0
	original version

hm	14. jun. 2008	rev 1.1
	improved performance

hm	11. mar. 2009	rev 1.2
	real constants updated to new systax using dot

*)
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>b5154b31-3a82-4e6d-881b-552d95257649</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="DEAD_ZONE2" pouType="functionBlock">
        <interface>
          <inputVars>
            <variable name="X">
              <type>
                <REAL />
              </type>
            </variable>
            <variable name="L">
              <type>
                <REAL />
              </type>
            </variable>
          </inputVars>
          <outputVars>
            <variable name="Y">
              <type>
                <REAL />
              </type>
            </variable>
          </outputVars>
        </interface>
        <body>
          <ST>
            IF ABS(x) &gt; L THEN
	Y := X;
ELSIF Y &gt; 0.0 THEN
	Y := L;
ELSE
	Y := -L;
END_IF;



(* revision history

hm	12. feb. 2007	rev 1.0
	original version

hm	11. mar. 2009	rev 1.1
	real constants updated to new systax using dot

*)

          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>f6120ceb-12cc-4083-82f8-0aae23aca788</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="FT_DERIV" pouType="functionBlock">
        <interface>
          <inputVars>
            <variable name="in">
              <type>
                <REAL />
              </type>
            </variable>
            <variable name="K">
              <type>
                <REAL />
              </type>
              <initialValue>
                <simpleValue value="1.0" />
              </initialValue>
            </variable>
            <variable name="run">
              <type>
                <BOOL />
              </type>
              <initialValue>
                <simpleValue value="TRUE" />
              </initialValue>
            </variable>
          </inputVars>
          <outputVars>
            <variable name="out">
              <type>
                <REAL />
              </type>
            </variable>
          </outputVars>
          <localVars>
            <variable name="old">
              <type>
                <REAL />
              </type>
            </variable>
            <variable name="tx">
              <type>
                <DWORD />
              </type>
            </variable>
            <variable name="last">
              <type>
                <DWORD />
              </type>
            </variable>
            <variable name="init">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="tc">
              <type>
                <REAL />
              </type>
            </variable>
          </localVars>
        </interface>
        <body>
          <ST>
            (* read system time *)
tx := T_PLC_US();
tc := DWORD_TO_REAL(tx - last);
last := tx;

(* init on first startup *)
IF NOT init THEN
	init := TRUE;
	old := in;
ELSIF run AND tc &gt; 0.0 THEN
	out := (in - old) / tc * 1000000.0 * K;
	old := in;
ELSE
	out := 0.0;
END_IF;



(*
hm 3.1.2007			rev 1.1
	added init code for startup
	set the default for K to 1

hm	15. sep 2007	rev 1.2
	replaced Time() with T_PLC_US for compatibility and performance reasons
	increased accuracy and work in microseconds internally

hm 29 oct 2007	rev 1.3
	prohibit calculation when tx - last = 0 to avoid division by 0 and increase accuracy on fast systems

hm	6. nov. 2008	rev 1.4
	improved performance

hm	11. mar. 2009	rev 1.5
	inproved code
*)
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>27a12931-b57b-41eb-b4bf-e0ca74997e26</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="FT_IMP" pouType="functionBlock">
        <interface>
          <inputVars>
            <variable name="in">
              <type>
                <REAL />
              </type>
            </variable>
            <variable name="T">
              <type>
                <TIME />
              </type>
            </variable>
            <variable name="K">
              <type>
                <REAL />
              </type>
              <initialValue>
                <simpleValue value="1.0" />
              </initialValue>
            </variable>
          </inputVars>
          <outputVars>
            <variable name="out">
              <type>
                <REAL />
              </type>
            </variable>
          </outputVars>
          <localVars>
            <variable name="t1">
              <type>
                <derived name="FT_PT1" />
              </type>
            </variable>
          </localVars>
        </interface>
        <body>
          <ST>
            T1(in:= in, T:=T);
out := (in - t1.out) * K;

(*
hm 3.1.2007	rev 1.1
	added factor K

*)
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>f35d77c6-300d-458e-81aa-49f6a9041207</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="FT_INT" pouType="functionBlock">
        <interface>
          <inputVars>
            <variable name="IN">
              <type>
                <REAL />
              </type>
            </variable>
            <variable name="K">
              <type>
                <REAL />
              </type>
              <initialValue>
                <simpleValue value="1" />
              </initialValue>
            </variable>
            <variable name="RUN">
              <type>
                <BOOL />
              </type>
              <initialValue>
                <simpleValue value="TRUE" />
              </initialValue>
            </variable>
            <variable name="RST">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="OUT_MIN">
              <type>
                <REAL />
              </type>
              <initialValue>
                <simpleValue value="-1E+37" />
              </initialValue>
            </variable>
            <variable name="OUT_MAX">
              <type>
                <REAL />
              </type>
              <initialValue>
                <simpleValue value="1E+37" />
              </initialValue>
            </variable>
          </inputVars>
          <outputVars>
            <variable name="OUT">
              <type>
                <REAL />
              </type>
            </variable>
            <variable name="LIM">
              <type>
                <BOOL />
              </type>
            </variable>
          </outputVars>
          <localVars>
            <variable name="INTeg">
              <type>
                <derived name="INTEGRATE" />
              </type>
            </variable>
          </localVars>
        </interface>
        <body>
          <ST>
            IF rst THEN
	out := 0.0;
ELSE
	integ(X := IN, E := RUN, K := K, Y := out);
END_IF;

(* limit the outputs *)
IF out &gt;= OUT_MAX THEN
	out := out_max;
	LIM := TRUE;
ELSIF out &lt;= out_min THEN
	out := out_min;
	lim := TRUE;
ELSE
	lim := FALSE;
END_IF;


(*
hm 13.12.2006	rev 1.1
	changed to "trapezregel" which increases accuracy
	before out := out + in * time new: out := out + (in + in_last) / 2 * time

hm 15.1.2007		rev 1.2
	added default for k to be 1.

hm	15.9.2007		rev 1.3
	replaced time() with T_PLC_US for compatibility and performance reason
	increased internal accuracy to microseconds

hm 29. oct 2007		rev 1.4
	changed code so int will not be called is time difference is 0 to increase accuracy on systems
	with cycle times below 1ms

hm	2. dec 2007	 	rev 1.5
	changed code for better performance

hm	5. jan 2008		rev 1.6
	further improvements in performance

hm	8. feb 2008		rev 1.7
	deleted limits +/- 1000 now limit is the range of real
	added variables out1 and out2 to extend the resolution
	corrected an error with elapsed time
	deleted unusfull output ET

hm	13. mar 2008	rev 1.8
	changed preset value out_min to -1e37.
	stop integrator at the limits.

hm	16. mar 2008	rev 1.9
	added type conversion to avoid warning under codesys 3.0

hm	2. jun. 2008	rev 2.0
	rewritten with clear code
	limits can now be set without run

hm	3. nov. 2008	rev 2.1
	optimized code using INTEGRATE and LIMX

hm	10. mar. 2009	rev 2.2
	removed nested comments
*)

          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>49a475f3-b336-4c38-9b9b-bb3674bdeb77</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="FT_INT2" pouType="functionBlock">
        <interface>
          <inputVars>
            <variable name="IN">
              <type>
                <REAL />
              </type>
            </variable>
            <variable name="K">
              <type>
                <REAL />
              </type>
              <initialValue>
                <simpleValue value="1.0" />
              </initialValue>
            </variable>
            <variable name="RUN">
              <type>
                <BOOL />
              </type>
              <initialValue>
                <simpleValue value="TRUE" />
              </initialValue>
            </variable>
            <variable name="RST">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="OUT_MIN">
              <type>
                <REAL />
              </type>
              <initialValue>
                <simpleValue value="-1E+38" />
              </initialValue>
            </variable>
            <variable name="OUT_MAX">
              <type>
                <REAL />
              </type>
              <initialValue>
                <simpleValue value="1E+38" />
              </initialValue>
            </variable>
          </inputVars>
          <outputVars>
            <variable name="OUT">
              <type>
                <REAL />
              </type>
            </variable>
            <variable name="LIM">
              <type>
                <BOOL />
              </type>
            </variable>
          </outputVars>
          <localVars>
            <variable name="integ">
              <type>
                <derived name="INTEGRATE" />
              </type>
            </variable>
            <variable name="ix">
              <type>
                <REAL />
              </type>
            </variable>
            <variable name="val">
              <type>
                <derived name="REAL2" />
              </type>
            </variable>
          </localVars>
        </interface>
        <body>
          <ST>
            IF RST THEN
	val := R2_SET(0.0);
	out := 0.0;
ELSE
	integ(X := IN, E := RUN, K := K, Y := ix);
	val := R2_ADD(val, ix);
	ix := 0.0;
	OUT := val.RX;
END_IF;

(* check output for limits *)
IF out &gt; OUT_MIN AND out &lt; OUT_MAX THEN
	LIM := FALSE;
ELSE
	OUT := LIMIT(OUT_MIN, OUT, OUT_MAX);
	val := R2_SET(OUT);
	LIM := TRUE;
END_IF;



(*	revision history
hm	2. jun. 2008	rev 1.0
	original version

hm	5. nov. 2008	rev 1.1
	rewritten code using integrate

hm	11. mar. 2009	rev 1.2
	real constants updated to new systax using dot

*)

          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>0bda6810-0d38-4dc9-b0f8-7c65487333e6</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="FT_PD" pouType="functionBlock">
        <interface>
          <inputVars>
            <variable name="IN">
              <type>
                <REAL />
              </type>
            </variable>
            <variable name="KP">
              <type>
                <REAL />
              </type>
              <initialValue>
                <simpleValue value="1.0" />
              </initialValue>
            </variable>
            <variable name="TV">
              <type>
                <REAL />
              </type>
              <initialValue>
                <simpleValue value="1.0" />
              </initialValue>
            </variable>
          </inputVars>
          <outputVars>
            <variable name="Y">
              <type>
                <REAL />
              </type>
            </variable>
          </outputVars>
          <localVars>
            <variable name="diff">
              <type>
                <derived name="FT_DERIV" />
              </type>
            </variable>
          </localVars>
        </interface>
        <body>
          <ST>
            (* run differentiator *)
diff(IN := IN, K := TV);

(* combine both values *)
Y := KP * (diff.out + IN);



(* revision history
hm 	3. jun. 2008 	rev 1.0
	original version


*)
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>456c7c79-c79e-4bf8-a9fe-b2d72735db4f</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="FT_PDT1" pouType="functionBlock">
        <interface>
          <inputVars>
            <variable name="IN">
              <type>
                <REAL />
              </type>
            </variable>
            <variable name="KP">
              <type>
                <REAL />
              </type>
              <initialValue>
                <simpleValue value="1.0" />
              </initialValue>
            </variable>
            <variable name="TV">
              <type>
                <REAL />
              </type>
              <initialValue>
                <simpleValue value="1.0" />
              </initialValue>
            </variable>
            <variable name="T1">
              <type>
                <REAL />
              </type>
              <initialValue>
                <simpleValue value="1.0" />
              </initialValue>
            </variable>
          </inputVars>
          <outputVars>
            <variable name="Y">
              <type>
                <REAL />
              </type>
            </variable>
          </outputVars>
          <localVars>
            <variable name="diff">
              <type>
                <derived name="FT_DERIV" />
              </type>
            </variable>
            <variable name="TP">
              <type>
                <derived name="FT_PT1" />
              </type>
            </variable>
          </localVars>
        </interface>
        <body>
          <ST>
            (* run differentiator *)
diff(IN := IN, K := TV);

(* Run PT1 filter *)
tp(in := diff.out, T := REAL_TO_TIME(T1));

(* combine both values *)
Y := KP * (tp.out + IN);



(* revision history
hm 	3. jun. 2008 	rev 1.0
	original version


*)
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>64afdbce-d8ca-4122-9d14-66d9827c5041</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="FT_PI" pouType="functionBlock">
        <interface>
          <inputVars>
            <variable name="IN">
              <type>
                <REAL />
              </type>
            </variable>
            <variable name="KP">
              <type>
                <REAL />
              </type>
              <initialValue>
                <simpleValue value="1.0" />
              </initialValue>
            </variable>
            <variable name="KI">
              <type>
                <REAL />
              </type>
              <initialValue>
                <simpleValue value="1.0" />
              </initialValue>
            </variable>
            <variable name="ILIM_L">
              <type>
                <REAL />
              </type>
              <initialValue>
                <simpleValue value="-1E+38" />
              </initialValue>
            </variable>
            <variable name="ILIM_H">
              <type>
                <REAL />
              </type>
              <initialValue>
                <simpleValue value="1E+38" />
              </initialValue>
            </variable>
            <variable name="IEN">
              <type>
                <BOOL />
              </type>
              <initialValue>
                <simpleValue value="TRUE" />
              </initialValue>
            </variable>
            <variable name="RST">
              <type>
                <BOOL />
              </type>
            </variable>
          </inputVars>
          <outputVars>
            <variable name="Y">
              <type>
                <REAL />
              </type>
            </variable>
            <variable name="LIM">
              <type>
                <BOOL />
              </type>
            </variable>
          </outputVars>
          <localVars>
            <variable name="integ">
              <type>
                <derived name="FT_INT" />
              </type>
            </variable>
          </localVars>
        </interface>
        <body>
          <ST>
            (* run integrator *)
integ(IN := IN, K := KI, RUN := IEN, RST := RST, OUT_MIN := ILIM_L, OUT_MAX := ILIM_H);

(* check if integrator has reached its limits and set overflow *)
LIM := integ.LIM;
Y := KP * IN + integ.Out;



(* revision history
hm 	3. jun. 2008 	rev 2.0
	original version


*)
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>d4773521-85d8-405c-adc6-2aeff0d24719</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="FT_PID" pouType="functionBlock">
        <interface>
          <inputVars>
            <variable name="IN">
              <type>
                <REAL />
              </type>
            </variable>
            <variable name="KP">
              <type>
                <REAL />
              </type>
              <initialValue>
                <simpleValue value="1.0" />
              </initialValue>
            </variable>
            <variable name="TN">
              <type>
                <REAL />
              </type>
              <initialValue>
                <simpleValue value="1.0" />
              </initialValue>
            </variable>
            <variable name="TV">
              <type>
                <REAL />
              </type>
              <initialValue>
                <simpleValue value="1.0" />
              </initialValue>
            </variable>
            <variable name="ILIM_L">
              <type>
                <REAL />
              </type>
              <initialValue>
                <simpleValue value="-1E+38" />
              </initialValue>
            </variable>
            <variable name="ILIM_H">
              <type>
                <REAL />
              </type>
              <initialValue>
                <simpleValue value="1E+38" />
              </initialValue>
            </variable>
            <variable name="IEN">
              <type>
                <BOOL />
              </type>
              <initialValue>
                <simpleValue value="TRUE" />
              </initialValue>
            </variable>
            <variable name="RST">
              <type>
                <BOOL />
              </type>
            </variable>
          </inputVars>
          <outputVars>
            <variable name="Y">
              <type>
                <REAL />
              </type>
            </variable>
            <variable name="LIM">
              <type>
                <BOOL />
              </type>
            </variable>
          </outputVars>
          <localVars>
            <variable name="integ">
              <type>
                <derived name="FT_INT" />
              </type>
            </variable>
            <variable name="diff">
              <type>
                <derived name="FT_DERIV" />
              </type>
            </variable>
          </localVars>
        </interface>
        <body>
          <ST>
            (* run integrator only if TN &gt; 0 *)
IF TN &gt; 0.0 THEN
	integ(IN := IN, K := 1.0 / TN, RUN := IEN, RST := RST, OUT_MIN := ILIM_L, OUT_MAX := ILIM_H);
ELSE
	integ(RST := FALSE);
END_IF;

(* run differentiator *)
diff(IN := IN, K := TV);

(* combine both values *)
Y := KP * (integ.Out + diff.out + IN);

(* check if integrator has reached its limits and set overflow *)
LIM := integ.LIM;



(* revision history
hm 3. jun. 2008 	rev 2.0
	original version

hm	11. mar. 2009	rev 2.1
	real constants updated to new systax using dot

*)
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>9edbd8f6-abc6-4c7a-b65c-76e33cf2d4d2</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="FT_PIDW" pouType="functionBlock">
        <interface>
          <inputVars>
            <variable name="IN">
              <type>
                <REAL />
              </type>
            </variable>
            <variable name="KP">
              <type>
                <REAL />
              </type>
              <initialValue>
                <simpleValue value="1.0" />
              </initialValue>
            </variable>
            <variable name="TN">
              <type>
                <REAL />
              </type>
              <initialValue>
                <simpleValue value="1.0" />
              </initialValue>
            </variable>
            <variable name="TV">
              <type>
                <REAL />
              </type>
              <initialValue>
                <simpleValue value="1.0" />
              </initialValue>
            </variable>
            <variable name="LIM_L">
              <type>
                <REAL />
              </type>
              <initialValue>
                <simpleValue value="-1E+38" />
              </initialValue>
            </variable>
            <variable name="LIM_H">
              <type>
                <REAL />
              </type>
              <initialValue>
                <simpleValue value="1E+38" />
              </initialValue>
            </variable>
            <variable name="RST">
              <type>
                <BOOL />
              </type>
            </variable>
          </inputVars>
          <outputVars>
            <variable name="Y">
              <type>
                <REAL />
              </type>
            </variable>
            <variable name="LIM">
              <type>
                <BOOL />
              </type>
            </variable>
          </outputVars>
          <localVars>
            <variable name="integ">
              <type>
                <derived name="INTEGRATE" />
              </type>
            </variable>
            <variable name="diff">
              <type>
                <derived name="FT_DERIV" />
              </type>
            </variable>
            <variable name="YI">
              <type>
                <REAL />
              </type>
            </variable>
          </localVars>
        </interface>
        <body>
          <ST>
            (* run the integrator *)
IF tn = 0.0 OR rst THEN
	integ(E := FALSE, Y := YI);
	YI := 0.0;
ELSE
	integ(X := IN, K := 1.0 / TN, E := NOT LIM, Y := YI);
END_IF;

(* add up integrator and linear part *)
Y := KP * (IN + YI);

(* run differentiator *)
diff(IN := IN, K := TV);

(* set lim before differentiator is added to stop integrator if necessary *)
IF Y &gt; LIM_L AND Y &lt; LIM_H THEN
	LIM := FALSE;
ELSE
	LIM := TRUE;
END_IF;

(* add differential part and limit output Y *)

Y := LIMIT(LIM_L, Y + KP * diff.out, LIM_H);




(* revision history
hm 3. jun. 2008 	rev 1.0
	original version

hm	5. nov. 2008	rev 1.1
	changed code to use integrate

hm	11. mar. 2009	rev 1.2
	real constants updated to new systax using dot

*)
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>e412e94f-9bd6-40cb-b206-8fb8cb995755</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="FT_PIDWL" pouType="functionBlock">
        <interface>
          <inputVars>
            <variable name="IN">
              <type>
                <REAL />
              </type>
            </variable>
            <variable name="KP">
              <type>
                <REAL />
              </type>
              <initialValue>
                <simpleValue value="1.0" />
              </initialValue>
            </variable>
            <variable name="TN">
              <type>
                <REAL />
              </type>
              <initialValue>
                <simpleValue value="1.0" />
              </initialValue>
            </variable>
            <variable name="TV">
              <type>
                <REAL />
              </type>
              <initialValue>
                <simpleValue value="1.0" />
              </initialValue>
            </variable>
            <variable name="LIM_L">
              <type>
                <REAL />
              </type>
              <initialValue>
                <simpleValue value="-1E+38" />
              </initialValue>
            </variable>
            <variable name="LIM_H">
              <type>
                <REAL />
              </type>
              <initialValue>
                <simpleValue value="1E+38" />
              </initialValue>
            </variable>
            <variable name="RST">
              <type>
                <BOOL />
              </type>
            </variable>
          </inputVars>
          <outputVars>
            <variable name="Y">
              <type>
                <REAL />
              </type>
            </variable>
            <variable name="LIM">
              <type>
                <BOOL />
              </type>
            </variable>
          </outputVars>
          <localVars>
            <variable name="piwl">
              <type>
                <derived name="FT_PIWL" />
              </type>
            </variable>
            <variable name="diff">
              <type>
                <derived name="FT_DERIV" />
              </type>
            </variable>
          </localVars>
        </interface>
        <body>
          <ST>
            (* if rst then *)
IF rst THEN
	piwl(rst := TRUE);
	piwl.RST := FALSE;
ELSE
	(* run PIWL controller first *)
	(* we need to check if TN = 0 and do alternative calls *)
	IF TN = 0.0 THEN
		piwl(in := IN * KP, KP := 1.0, KI := 0.0, LIM_L := LIM_L, LIM_H := LIM_H);
	ELSE
		piwl(in := IN * KP, KP := 1.0, KI := 1.0 / TN, LIM_L := LIM_L, LIM_H := LIM_H);
	END_IF;

	(* run differentiator and add_to_output *)
	diff(IN := IN, K := KP * TV);
	Y := piwl.Y + diff.out;

	(* limit the output *)
	IF Y &lt; LIM_L THEN
		LIM := TRUE;
		Y := LIM_L;
	ELSIF Y &gt; LIM_H THEN
		LIM := TRUE;
		Y := LIM_H;
	ELSE
		LIM := FALSE;
	END_IF;
END_IF;



(* revision history
hm 13. jun. 2008 	rev 1.0
	original version

hm	25. jan 2008	rev 1.1
	multiply differential part with KP

hm	11. mar. 2009	rev 1.2
	real constants updated to new systax using dot

hm	13. nov. 2009	rev 1.3
	fixed code for negative KP

*)
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>e7af284d-149a-4b6f-ad31-9e5a5861f444</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="FT_PIW" pouType="functionBlock">
        <interface>
          <inputVars>
            <variable name="IN">
              <type>
                <REAL />
              </type>
            </variable>
            <variable name="KP">
              <type>
                <REAL />
              </type>
              <initialValue>
                <simpleValue value="1.0" />
              </initialValue>
            </variable>
            <variable name="KI">
              <type>
                <REAL />
              </type>
              <initialValue>
                <simpleValue value="1.0" />
              </initialValue>
            </variable>
            <variable name="LIM_L">
              <type>
                <REAL />
              </type>
              <initialValue>
                <simpleValue value="-1E+38" />
              </initialValue>
            </variable>
            <variable name="LIM_H">
              <type>
                <REAL />
              </type>
              <initialValue>
                <simpleValue value="1E+38" />
              </initialValue>
            </variable>
            <variable name="RST">
              <type>
                <BOOL />
              </type>
            </variable>
          </inputVars>
          <outputVars>
            <variable name="Y">
              <type>
                <REAL />
              </type>
            </variable>
            <variable name="LIM">
              <type>
                <BOOL />
              </type>
            </variable>
          </outputVars>
          <localVars>
            <variable name="integ">
              <type>
                <derived name="FT_INT" />
              </type>
            </variable>
          </localVars>
        </interface>
        <body>
          <ST>
            (* run integrator *)
integ(IN := IN, K := KI, RUN := NOT LIM, RST := RST);

(* set output value *)
Y := KP * IN + integ.Out;

(* check for limits and set integrator for anti wind up *)
IF Y &lt; LIM_L THEN
	Y := LIM_L;
	LIM := TRUE;
ELSIF Y &gt; LIM_H THEN
	Y := LIM_H;
	LIM := TRUE;
ELSE
	LIM := FALSE;
END_IF;



(* revision history
hm 	3. jun. 2008 	rev 1.0
	original version


*)
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>cc4437ff-7bd0-40c1-889a-ea61253ce3b8</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="FT_PIWL" pouType="functionBlock">
        <interface>
          <inputVars>
            <variable name="IN">
              <type>
                <REAL />
              </type>
            </variable>
            <variable name="KP">
              <type>
                <REAL />
              </type>
              <initialValue>
                <simpleValue value="1.0" />
              </initialValue>
            </variable>
            <variable name="KI">
              <type>
                <REAL />
              </type>
              <initialValue>
                <simpleValue value="1.0" />
              </initialValue>
            </variable>
            <variable name="LIM_L">
              <type>
                <REAL />
              </type>
              <initialValue>
                <simpleValue value="-1E+38" />
              </initialValue>
            </variable>
            <variable name="LIM_H">
              <type>
                <REAL />
              </type>
              <initialValue>
                <simpleValue value="1E+38" />
              </initialValue>
            </variable>
            <variable name="RST">
              <type>
                <BOOL />
              </type>
            </variable>
          </inputVars>
          <outputVars>
            <variable name="Y">
              <type>
                <REAL />
              </type>
            </variable>
            <variable name="LIM">
              <type>
                <BOOL />
              </type>
            </variable>
          </outputVars>
          <localVars>
            <variable name="init">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="tx">
              <type>
                <DWORD />
              </type>
            </variable>
            <variable name="tc">
              <type>
                <REAL />
              </type>
            </variable>
            <variable name="t_last">
              <type>
                <DWORD />
              </type>
            </variable>
            <variable name="in_last">
              <type>
                <REAL />
              </type>
            </variable>
            <variable name="i">
              <type>
                <REAL />
              </type>
            </variable>
            <variable name="p">
              <type>
                <REAL />
              </type>
            </variable>
          </localVars>
        </interface>
        <body>
          <ST>
            (* initialize at power_up *)
IF NOT init OR RST THEN
	init := TRUE;
	in_last := in;
	t_last := T_PLC_US();
	i := 0.0;
	tc := 0.0;
ELSE
	(* read last cycle time in Microseconds *)
	tx := T_PLC_US();
	tc := DWORD_TO_REAL(tx - t_last);
	t_last := tx;

	(* calculate proportional part *)
	p := KP * IN;

	(* run integrator *)
	i := (IN + in_last) * 5.0E-7 * KI * tc + i;
	in_last := IN;

	(* calculate output Y *)
	Y := p + i;

	(* check output for limits *)
	IF Y &gt;= LIM_H THEN
		Y := LIM_H;
		IF ki &lt;&gt; 0.0 THEN
			i := LIM_H - p;
		ELSE
			i := 0.0;
		END_IF;
		LIM := TRUE;
	ELSIF Y &lt;= LIM_L THEN
		Y := LIM_L;
		IF ki &lt;&gt; 0.0 THEN
			i := LIM_L - p;
		ELSE
			i := 0.0;
		END_IF;
		LIM := TRUE;
	ELSE
		LIM := FALSE;
	END_IF;
END_IF;




(* revision history
hm 13. jun. 2008 	rev 1.0
	original version

hm	27. oct. 2008	rev 1.1
	integrator will not be adjusted when ki = 0

hm	25. jan 2009	rev 1.2
	module will also work with negative K

hm	11. mar. 2009	rev 1.3
	real constants updated to new systax using dot

*)
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>58fa0d31-fcbd-4492-bb9a-c6644f575a89</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="FT_PT1" pouType="functionBlock">
        <interface>
          <inputVars>
            <variable name="in">
              <type>
                <REAL />
              </type>
            </variable>
            <variable name="T">
              <type>
                <TIME />
              </type>
            </variable>
            <variable name="K">
              <type>
                <REAL />
              </type>
              <initialValue>
                <simpleValue value="1.0" />
              </initialValue>
            </variable>
          </inputVars>
          <outputVars>
            <variable name="out">
              <type>
                <REAL />
              </type>
            </variable>
          </outputVars>
          <localVars>
            <variable name="last">
              <type>
                <DWORD />
              </type>
            </variable>
            <variable name="tx">
              <type>
                <DWORD />
              </type>
            </variable>
            <variable name="init">
              <type>
                <BOOL />
              </type>
            </variable>
          </localVars>
        </interface>
        <body>
          <ST>
            (* read system time *)
tx := T_PLC_US();

(* startup initialisation *)
IF NOT init OR T = t#0s THEN
	init := TRUE;
	out := K * in;
ELSE
	out := out + (in * K - out) * DWORD_TO_REAL(Tx - last) / TIME_TO_REAL(T) * 1.0E-3;
	IF ABS(out) &lt; 1.0E-20 THEN out := 0.0; END_IF;
END_IF;
last := tx;


(*
hm 1.1.2007	rev 1.1
	corrected error while startup value was not correct
	for very small time values real output would run out of range.

hm 3.1.2007	rev 1.2
	corrected an error for falling edge failures.
	added output faktor K.

hm 27. 2. 2007	rev 1.3
	output will be input during init for definitive startup condition.

hm	15.9.2007	rev 1.4
	changed time() to T_PLC_US() for compatibilitxy resons
	increased internal accuracy to Microseconds instead of Milliseconds

hm	23. oct 2007	rev 1.5
	added out := in to the init statements

hm	30. nov 2007	rev 1.6
	changed out to be K * in during initialization

hm	5. jan 2008	rev 1.7
	improved code for better performance

hm	16. mar. 2008	rev 1.8
	added type conversion to avoid warning under codesys 3.0

hm	14. jun. 2008	rev 1.9
	improved code

hm	11. mar. 2009	rev 1.10
	real constants updated to new systax using dot

hm	18. jan. 2011	rev 1.11
	avoid underrun of out
*)
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>4733c3e9-f2ce-4def-9fbe-5914256249e3</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="FT_PT2" pouType="functionBlock">
        <interface>
          <inputVars>
            <variable name="in">
              <type>
                <REAL />
              </type>
            </variable>
            <variable name="T">
              <type>
                <TIME />
              </type>
            </variable>
            <variable name="D">
              <type>
                <REAL />
              </type>
            </variable>
            <variable name="K">
              <type>
                <REAL />
              </type>
              <initialValue>
                <simpleValue value="1.0" />
              </initialValue>
            </variable>
          </inputVars>
          <outputVars>
            <variable name="out">
              <type>
                <REAL />
              </type>
            </variable>
          </outputVars>
          <localVars>
            <variable name="init">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="int1">
              <type>
                <derived name="INTEGRATE" />
              </type>
            </variable>
            <variable name="int2">
              <type>
                <derived name="INTEGRATE" />
              </type>
            </variable>
            <variable name="tn">
              <type>
                <REAL />
              </type>
            </variable>
            <variable name="I1">
              <type>
                <REAL />
              </type>
            </variable>
            <variable name="I2">
              <type>
                <REAL />
              </type>
            </variable>
            <variable name="tn2">
              <type>
                <REAL />
              </type>
            </variable>
          </localVars>
        </interface>
        <body>
          <ST>
            (* startup initialisation *)
IF NOT init OR T = T#0s THEN
	init := TRUE;
	out := K * in;
	I2 := out;
ELSE
	TN := TIME_TO_REAL(T) * 1.0E-3;
	tn2 := TN * TN;
	int1(X := in * K / tn2 - I1 * 0.5 * D / TN - I2 / TN2, Y := I1);
	int2(X := I1,Y := I2);
	out := I2;
END_IF;


(* revision history

15.1.2007 hm		rev 1.1
	changed formula to new more acurate formula

hm 15.9.2007		rev 1.2
	deleted unused code for init system time reading tx	

hm	30.11.2007	rev 1.3
	changed out to be K * in during initialization
	avoind divide by 0 if tn = 0

hm	3. nov. 2008	rev 1.4
	optimized code and fixed a problem with init

hm	11. mar. 2009	rev 1.5
	real constants updated to new systax using dot

*)
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>968d239d-74b6-40e5-b258-299c0262889f</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="FT_TN16" pouType="functionBlock">
        <interface>
          <inputVars>
            <variable name="in">
              <type>
                <REAL />
              </type>
            </variable>
            <variable name="T">
              <type>
                <TIME />
              </type>
            </variable>
          </inputVars>
          <outputVars>
            <variable name="out">
              <type>
                <REAL />
              </type>
            </variable>
            <variable name="trig">
              <type>
                <BOOL />
              </type>
            </variable>
          </outputVars>
          <localVars>
            <variable name="length">
              <type>
                <INT />
              </type>
              <initialValue>
                <simpleValue value="16" />
              </initialValue>
            </variable>
            <variable name="X">
              <type>
                <array>
                  <dimension lower="0" upper="15" />
                  <baseType>
                    <REAL />
                  </baseType>
                </array>
              </type>
            </variable>
            <variable name="cnt">
              <type>
                <INT />
              </type>
            </variable>
            <variable name="last">
              <type>
                <TIME />
              </type>
            </variable>
            <variable name="tx">
              <type>
                <TIME />
              </type>
            </variable>
            <variable name="init">
              <type>
                <BOOL />
              </type>
            </variable>
          </localVars>
        </interface>
        <body>
          <ST>
            (* read system time *)
tx := DWORD_TO_TIME(T_PLC_MS());

trig := FALSE;
IF NOT init THEN
	x[cnt] := in;
	init := TRUE;
	last := tx;
ELSIF tx - last &gt;= T / length THEN
	IF cnt = length - 1 THEN cnt := 0; ELSE cnt := cnt + 1; END_IF;
	Out := X[cnt];
	x[cnt] := in;
	last := tx;
	Trig := TRUE;
END_IF;

(* revision history
hm		1. jan 2007	rev 1.0
	original version

hm		16. sep 2007	rev 1.1
	changes time() to T_plc_ms() for compatibility reasons

*)
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>e0c851ce-0b9e-4b35-990b-02bbae50819b</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="FT_TN64" pouType="functionBlock">
        <interface>
          <inputVars>
            <variable name="in">
              <type>
                <REAL />
              </type>
            </variable>
            <variable name="T">
              <type>
                <TIME />
              </type>
            </variable>
          </inputVars>
          <outputVars>
            <variable name="out">
              <type>
                <REAL />
              </type>
            </variable>
            <variable name="trig">
              <type>
                <BOOL />
              </type>
            </variable>
          </outputVars>
          <localVars>
            <variable name="length">
              <type>
                <INT />
              </type>
              <initialValue>
                <simpleValue value="64" />
              </initialValue>
            </variable>
            <variable name="X">
              <type>
                <array>
                  <dimension lower="0" upper="63" />
                  <baseType>
                    <REAL />
                  </baseType>
                </array>
              </type>
            </variable>
            <variable name="cnt">
              <type>
                <INT />
              </type>
            </variable>
            <variable name="last">
              <type>
                <TIME />
              </type>
            </variable>
            <variable name="tx">
              <type>
                <TIME />
              </type>
            </variable>
            <variable name="init">
              <type>
                <BOOL />
              </type>
            </variable>
          </localVars>
        </interface>
        <body>
          <ST>
            (* read system time *)
tx := DWORD_TO_TIME(T_PLC_MS());

trig := FALSE;
IF NOT init THEN
	x[cnt] := in;
	init := TRUE;
	last := tx;
ELSIF tx - last &gt;= T / length THEN
	IF cnt = length - 1 THEN cnt := 0; ELSE cnt := cnt + 1; END_IF;
	Out := X[cnt];
	x[cnt] := in;
	last := tx;
	trig := TRUE;
END_IF;

(* revision history
hm		1. jan 2007		rev 1.0
	original version

hm		16. sep 2007	rev 1.1
	changes time() to T_plc_ms() for compatibility reasons

*)
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>632709f5-a08b-4dcb-9b36-bed2877db16d</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="FT_TN8" pouType="functionBlock">
        <interface>
          <inputVars>
            <variable name="in">
              <type>
                <REAL />
              </type>
            </variable>
            <variable name="T">
              <type>
                <TIME />
              </type>
            </variable>
          </inputVars>
          <outputVars>
            <variable name="out">
              <type>
                <REAL />
              </type>
            </variable>
            <variable name="trig">
              <type>
                <BOOL />
              </type>
            </variable>
          </outputVars>
          <localVars>
            <variable name="length">
              <type>
                <INT />
              </type>
              <initialValue>
                <simpleValue value="8" />
              </initialValue>
            </variable>
            <variable name="X">
              <type>
                <array>
                  <dimension lower="0" upper="7" />
                  <baseType>
                    <REAL />
                  </baseType>
                </array>
              </type>
            </variable>
            <variable name="cnt">
              <type>
                <INT />
              </type>
            </variable>
            <variable name="last">
              <type>
                <TIME />
              </type>
            </variable>
            <variable name="tx">
              <type>
                <TIME />
              </type>
            </variable>
            <variable name="init">
              <type>
                <BOOL />
              </type>
            </variable>
          </localVars>
        </interface>
        <body>
          <ST>
            tx := DWORD_TO_TIME(T_PLC_MS());
trig := FALSE;
IF NOT init THEN
	x[cnt] := in;
	init := TRUE;
	last := tx;
ELSIF tx - last &gt;= T / length THEN
	IF cnt = length - 1 THEN cnt := 0; ELSE cnt := cnt + 1; END_IF;
	Out := X[cnt];
	x[cnt] := in;
	last := tx;
	trig := TRUE;
END_IF;

(* revision history
hm		1. jan 2007		rev 1.0
	original version

hm		16. sep 2007	rev 1.1
	changes time() to T_plc_ms() for compatibility reasons

*)
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>bf8f50ab-1682-4e11-8b2c-6e7799c54d08</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="HYST" pouType="functionBlock">
        <interface>
          <inputVars>
            <variable name="In">
              <type>
                <REAL />
              </type>
            </variable>
            <variable name="ON">
              <type>
                <REAL />
              </type>
            </variable>
            <variable name="OFF">
              <type>
                <REAL />
              </type>
            </variable>
          </inputVars>
          <outputVars>
            <variable name="Q">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="win">
              <type>
                <BOOL />
              </type>
            </variable>
          </outputVars>
        </interface>
        <body>
          <ST>
            IF ON &gt;= OFF THEN
	IF IN &lt; OFF THEN
		Q := FALSE;
		WIN := FALSE;
	ELSIF  IN &gt; ON THEN
		Q := TRUE;
		WIN := FALSE;
	ELSE
		WIN := TRUE;
	END_IF;
ELSE
	IF IN &gt; OFF THEN
		Q := FALSE;
		WIN := FALSE;
	ELSIF  IN &lt; ON THEN
		Q := TRUE;
		WIN := FALSE;
	ELSE
		WIN := TRUE;
	END_IF;
END_IF;


(* revision history
hm		2.  jun 2008	rev 1.0
	original version

*)
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>1a576a02-fc4e-4d56-9554-06f6d96b7ba1</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="HYST_1" pouType="functionBlock">
        <interface>
          <inputVars>
            <variable name="In">
              <type>
                <REAL />
              </type>
            </variable>
            <variable name="high">
              <type>
                <REAL />
              </type>
            </variable>
            <variable name="low">
              <type>
                <REAL />
              </type>
            </variable>
          </inputVars>
          <outputVars>
            <variable name="Q">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="win">
              <type>
                <BOOL />
              </type>
            </variable>
          </outputVars>
        </interface>
        <body>
          <ST>
            IF in &lt; low THEN
	Q := FALSE;
	win := FALSE;
ELSIF in &gt; high THEN
	Q := TRUE;
	win := FALSE;
ELSE
	win := TRUE;
END_IF;




(* revision history
hm		4.  aug. 2006	rev 1.0
	original version

hm		2. jun. 2008	rev 1.1
	improved performance
*)
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>8245b3b8-03d2-458c-9d37-447adb698ab2</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="HYST_2" pouType="functionBlock">
        <interface>
          <inputVars>
            <variable name="IN">
              <type>
                <REAL />
              </type>
            </variable>
            <variable name="VAL">
              <type>
                <REAL />
              </type>
            </variable>
            <variable name="HYS">
              <type>
                <REAL />
              </type>
            </variable>
          </inputVars>
          <outputVars>
            <variable name="Q">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="WIN">
              <type>
                <BOOL />
              </type>
            </variable>
          </outputVars>
          <localVars>
            <variable name="tmp">
              <type>
                <REAL />
              </type>
            </variable>
          </localVars>
        </interface>
        <body>
          <ST>
            tmp := val - hys * 0.5;
IF in &lt; tmp THEN
	Q := FALSE;
	win := FALSE;
ELSIF in &gt; tmp + hys THEN
	Q := TRUE;
	win := FALSE;
ELSE
	win := TRUE;
END_IF;



(* revision history
hm		4. aug 2006	rev 1.0
	original version

hm		5. jan 2008	rev 1.1
	improved code for better performance

hm		2. jun. 2008	rev 1.2
	improved performance
*)
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>fcaab8a7-833a-4741-961d-117fbb2f6d03</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="HYST_3" pouType="functionBlock">
        <interface>
          <inputVars>
            <variable name="in">
              <type>
                <REAL />
              </type>
            </variable>
            <variable name="hyst">
              <type>
                <REAL />
              </type>
            </variable>
            <variable name="val1">
              <type>
                <REAL />
              </type>
            </variable>
            <variable name="val2">
              <type>
                <REAL />
              </type>
            </variable>
          </inputVars>
          <outputVars>
            <variable name="Q1">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="Q2">
              <type>
                <BOOL />
              </type>
            </variable>
          </outputVars>
          <localVars>
            <variable name="X">
              <type>
                <REAL />
              </type>
            </variable>
          </localVars>
        </interface>
        <body>
          <ST>
            X := hyst * 0.5;
IF in &lt; val1 - X THEN
	q1 := TRUE;
ELSIF in &gt; val1 + X THEN
	q1 := FALSE;
END_IF;
IF in &lt; val2 - X THEN
	q2 := FALSE;
ELSIF in &gt; val2 + X THEN
	q2 := TRUE;
END_IF;



(* revision history
hm	22. jan 2007	rev 1.0
	original version

hm	27. dec 2007	rev 1.1
	changed code for better performance

hm	5. jan 2008	rev 1.2
	further performance iprovements

*)

          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>fc393937-d828-41d9-918b-526b6a79d06e</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="INTEGRATE" pouType="functionBlock">
        <interface>
          <inputVars>
            <variable name="E">
              <type>
                <BOOL />
              </type>
              <initialValue>
                <simpleValue value="TRUE" />
              </initialValue>
            </variable>
            <variable name="X">
              <type>
                <REAL />
              </type>
            </variable>
            <variable name="K">
              <type>
                <REAL />
              </type>
              <initialValue>
                <simpleValue value="1.0" />
              </initialValue>
            </variable>
          </inputVars>
          <inOutVars>
            <variable name="Y">
              <type>
                <REAL />
              </type>
            </variable>
          </inOutVars>
          <localVars>
            <variable name="X_last">
              <type>
                <REAL />
              </type>
            </variable>
            <variable name="init">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="last">
              <type>
                <DWORD />
              </type>
            </variable>
            <variable name="tx">
              <type>
                <DWORD />
              </type>
            </variable>
          </localVars>
        </interface>
        <body>
          <ST>
            (*read system time *)
tx := T_PLC_MS();

IF NOT init THEN
	init := TRUE;
	X_last := X;
ELSIF E THEN
	Y := (X + X_LAST) * 0.5E-3 * DWORD_TO_REAL(tx-last) * K + Y;
	X_last := X;
END_IF;
last := tx;



(*
hm 3. nov. 2008	rev 1.0
original version
	
*)

          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>d3d5a6cb-4d65-41b0-97b7-f75f8ebac7b8</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="ASTRO" pouType="functionBlock">
        <interface>
          <inputVars>
            <variable name="m">
              <type>
                <REAL />
              </type>
            </variable>
            <variable name="AE">
              <type>
                <REAL />
              </type>
            </variable>
            <variable name="PC">
              <type>
                <REAL />
              </type>
            </variable>
            <variable name="LJ">
              <type>
                <REAL />
              </type>
            </variable>
          </inputVars>
          <outputVars>
            <variable name="Ym">
              <type>
                <REAL />
              </type>
            </variable>
            <variable name="YAE">
              <type>
                <REAL />
              </type>
            </variable>
            <variable name="YPC">
              <type>
                <REAL />
              </type>
            </variable>
            <variable name="YLJ">
              <type>
                <REAL />
              </type>
            </variable>
          </outputVars>
        </interface>
        <body>
          <ST>
            YAE :=	AE
		+ m * 6.6845871535E-012
		+ PC * 206265.0
		+ LJ * 63240.0;
Ym := YAE * 149.597870E9;
YPC := YAE * 4.8481322570E-006;
YLJ := YAE * 1.5812776724E-005;


(*
Länge Meter m SI-Basiseinheit
Astronomische Einheit* AE 1 AE = 149,597 870 · E9 m
Parsec pc 1 pc = 206265 AE = 30,857 · E15 m
Lichtjahr Lj 1 Lj = 9,460 530 · E15 m = 63240 AE = 0,306 59 pc
Ångström Å 1 Å = E–l0 m
typograph. Punkt p 1 p = 0,376 065 mm • im Druckereigewerbe
inch** in 1 in = 2,54 · E–2 m = 25,4 mm***
foot ft 1 ft = 0,3048 m = 30,48 cm
yard yd 1 yd = 0,9144 m
mile mile 1 mile = 1609,344 m
Internat. Seemeile sm 1 sm = 1852 m
Fathom fm 1 fm = 1,829 m • in der Seeschifffahrt
*)

(* revision history

hm	27. mar. 2007	rev 1.0
	original version

hm	11. mar. 2009	rev 1.1
	improved code

*)

          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>cd0c805f-eb5c-461e-a06d-dbafa73abf74</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="BFT_TO_MS" pouType="function">
        <interface>
          <returnType>
            <REAL />
          </returnType>
          <inputVars>
            <variable name="BFT">
              <type>
                <INT />
              </type>
            </variable>
          </inputVars>
        </interface>
        <body>
          <ST>
            BFT_TO_MS := EXPT(BFT, 1.5) * 0.836;


(* revision history
hm	12. 6. 2008		rev 1.0
	original version

*)
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>d76d8a98-c795-4e3b-8b3b-0477228cda6e</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="C_TO_F" pouType="function">
        <interface>
          <returnType>
            <REAL />
          </returnType>
          <inputVars>
            <variable name="celsius">
              <type>
                <REAL />
              </type>
            </variable>
          </inputVars>
        </interface>
        <body>
          <ST>
            C_TO_F := celsius * 1.8 + 32.0;


(* revision history

hm	4. aug. 2006	rev 1.0
	original version

hm	11. mar. 2009	rev 1.1
	real constants updated to new systax using dot

*)
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>f0395924-6575-430f-a863-4ce190a3b792</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="C_TO_K" pouType="function">
        <interface>
          <returnType>
            <REAL />
          </returnType>
          <inputVars>
            <variable name="Celsius">
              <type>
                <REAL />
              </type>
            </variable>
          </inputVars>
        </interface>
        <body>
          <ST>
            C_TO_K := Celsius - phys.T0;

(* revision history

hm	4. aug 2006	rev 1.0
	original version

hm	19. aug 2009	rev 1.1
	fixed calculation error

*)

          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>bddb4bad-3d0a-4259-8ccc-f717b638fc84</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="DEG_TO_DIR" pouType="function">
        <interface>
          <returnType>
            <string length="3" />
          </returnType>
          <inputVars>
            <variable name="DEG">
              <type>
                <INT />
              </type>
            </variable>
            <variable name="N">
              <type>
                <INT />
              </type>
            </variable>
            <variable name="L">
              <type>
                <INT />
              </type>
            </variable>
          </inputVars>
          <localVars>
            <variable name="ly">
              <type>
                <INT />
              </type>
            </variable>
          </localVars>
        </interface>
        <body>
          <ST>
            IF L = 0 THEN ly := LANGUAGE.DEFAULT; ELSE ly := MIN(L, LANGUAGE.LMAX); END_IF;
DEG_TO_DIR := LANGUAGE.DIRS[ly, ((SHL(DEG,N-1) + 45) / 90) MOD SHL(INT#2,N)*SHR(INT#8,N)];



(*
DIR := ((SHL(DEG,N-1) + 45) / 90) MOD SHL(INT#2,N);
explanation :
DIR is calculated BY the following formula:
DIR := ((DIR + 45) / 90) MOD 4 if N = 1 digit
North = 0, East = 1 ....
DIR := ((DIR + 22,5) / 45) MOD 8 if N = 2 digit
convert to integer calculation
DIR := ((DIR*2 + 45) / 90) MOD 8
N = 0, NE = 1 ....
ther above formula replaces 2^N with shift for performance
*)



(* revision histroy
hm	11. jun. 2008	rev 1.0
	original release

hm	22. oct. 2008	rev 1.1
	changed size of string variables to 30
*)
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>77a5eccc-c1f7-456c-a8c5-d131b189aead</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="DIR_TO_DEG" pouType="function">
        <interface>
          <returnType>
            <INT />
          </returnType>
          <inputVars>
            <variable name="DIR">
              <type>
                <string length="3" />
              </type>
            </variable>
            <variable name="L">
              <type>
                <INT />
              </type>
            </variable>
          </inputVars>
          <localVars>
            <variable name="ly">
              <type>
                <INT />
              </type>
            </variable>
            <variable name="i">
              <type>
                <INT />
              </type>
            </variable>
          </localVars>
        </interface>
        <body>
          <ST>
            IF L = 0 THEN ly := LANGUAGE.DEFAULT; ELSE ly := MIN(L, LANGUAGE.LMAX); END_IF;
FOR i := 0 TO 15 DO
	IF language.DIRS[ly, i] = DIR THEN EXIT; END_IF;
END_FOR;
DIR_TO_DEG := SHR(i * 45 + 1, 1);






(* revision histroy
hm	22. oct. 2008	rev 1.1
	original release

*)
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>3820404d-7826-426f-8010-75abff716cf5</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="ENERGY" pouType="functionBlock">
        <interface>
          <inputVars>
            <variable name="J">
              <type>
                <REAL />
              </type>
            </variable>
            <variable name="C">
              <type>
                <REAL />
              </type>
            </variable>
            <variable name="Wh">
              <type>
                <REAL />
              </type>
            </variable>
          </inputVars>
          <outputVars>
            <variable name="YJ">
              <type>
                <REAL />
              </type>
            </variable>
            <variable name="YC">
              <type>
                <REAL />
              </type>
            </variable>
            <variable name="YWh">
              <type>
                <REAL />
              </type>
            </variable>
          </outputVars>
        </interface>
        <body>
          <ST>
            YJ := J + Wh * 3600.0 + C * 4.1868;
YC := YJ * 0.238845896627496;
YWh := YJ * 2.7777777778E-004;

(*
Arbeit, Energie, Joule* J 1 J = 1 N · m = 1 W · s = (1/3,6) E–6 kW · h = 1 kg · m2/s2
Wärmemenge Kilowattstunde kW · h 1 kW · h = 3,6 MJ = 860 kcal
Elektronvolt eV 1 eV = 160,218 92 E–21 J
Erg erg 1 erg = 1E–7 J
Kalorie calorie 1 calalorie = 4,1868 J = 1,163 E–3 W · h
Therm therm 1 therm = 105,50 · 106 J
*)

(* revision history

hm	27. mar. 2007	rev 1.0
	original version

hm	11. mar. 2009	rev 1.1
	improved code

hm 16. jan 2010	rev 1.2
	avoid the string cal in comments for codesys import bug


*)
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>6b25b803-7c74-4e47-9473-8cf4a80d2cac</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="F_TO_C" pouType="function">
        <interface>
          <returnType>
            <REAL />
          </returnType>
          <inputVars>
            <variable name="fahrenheit">
              <type>
                <REAL />
              </type>
            </variable>
          </inputVars>
        </interface>
        <body>
          <ST>
            F_TO_C := (fahrenheit - 32.0) * 0.5555555555555;

(* revision history
hm	4. aug 2006	rev 1.0
	original version

hm	11. mar. 2009	rev 1.1
	real constants updated to new systax using dot

*)
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>c41beaf0-4315-40cb-9b4d-bf158c59b9fe</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="F_TO_OM" pouType="function">
        <interface>
          <returnType>
            <REAL />
          </returnType>
          <inputVars>
            <variable name="F">
              <type>
                <REAL />
              </type>
            </variable>
          </inputVars>
        </interface>
        <body>
          <ST>
            F_TO_OM := math.PI2 * F;


(* revision history
hm	22. jan. 2007	rev 1.0
	original version

hm	18. oct. 2008	rev 1.1
	unsing math constants

*)
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>3181568a-b90b-450a-aced-0867e58527c3</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="F_TO_PT" pouType="function">
        <interface>
          <returnType>
            <TIME />
          </returnType>
          <inputVars>
            <variable name="F">
              <type>
                <REAL />
              </type>
            </variable>
          </inputVars>
        </interface>
        <body>
          <ST>
            F_TO_PT := DWORD_TO_TIME(REAL_TO_DWORD(1.0 / F * 1000.0));


(* revision history

hm	4. aug. 2006	rev 1.0
	original version

hm	11. mar. 2009	rev 1.1
	real constants updated to new systax using dot

*)

          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>7e084c84-33f2-4e37-8f7d-47eeb3ed5ff6</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="GEO_TO_DEG" pouType="function">
        <interface>
          <returnType>
            <REAL />
          </returnType>
          <inputVars>
            <variable name="D">
              <type>
                <INT />
              </type>
            </variable>
            <variable name="M">
              <type>
                <INT />
              </type>
            </variable>
            <variable name="SEC">
              <type>
                <REAL />
              </type>
            </variable>
          </inputVars>
        </interface>
        <body>
          <ST>
            GEO_TO_DEG := INT_TO_REAL(D) + INT_TO_REAL(M) * 0.016666666666667 + sec * 0.00027777777777778;


(* revision histroy
hm	22. jan. 2009	rev 1.0
	original release


*)
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>8bf3c0ca-2737-4e65-ba10-8b9aaaa6b8bc</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="K_TO_C" pouType="function">
        <interface>
          <returnType>
            <REAL />
          </returnType>
          <inputVars>
            <variable name="Kelvin">
              <type>
                <REAL />
              </type>
            </variable>
          </inputVars>
        </interface>
        <body>
          <ST>
            K_TO_C := Kelvin + phys.T0;


(* revision history

hm	4. aug 2006	rev 1.0
	original version

hm	19. aug 2009	rev 1.1
	fixed calculation error

*)

          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>da1ca4fa-d4a5-45f8-9691-b7f2835bf60e</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="KMH_TO_MS" pouType="function">
        <interface>
          <returnType>
            <REAL />
          </returnType>
          <inputVars>
            <variable name="kmh">
              <type>
                <REAL />
              </type>
            </variable>
          </inputVars>
        </interface>
        <body>
          <ST>
            KMH_TO_MS := kmh * 0.2777777777777;

(* revision history
hm	4. feb 2007		rev 1.0
	original version

hm	6. jan 2008		rev 1.1
	improved performance

*)


          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>e602bc32-42d2-497e-9dac-4e0e661141a3</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="LENGTH" pouType="functionBlock">
        <interface>
          <inputVars>
            <variable name="m">
              <type>
                <REAL />
              </type>
            </variable>
            <variable name="p">
              <type>
                <REAL />
              </type>
            </variable>
            <variable name="in">
              <type>
                <REAL />
              </type>
            </variable>
            <variable name="ft">
              <type>
                <REAL />
              </type>
            </variable>
            <variable name="yd">
              <type>
                <REAL />
              </type>
            </variable>
            <variable name="mile">
              <type>
                <REAL />
              </type>
            </variable>
            <variable name="sm">
              <type>
                <REAL />
              </type>
            </variable>
            <variable name="fm">
              <type>
                <REAL />
              </type>
            </variable>
          </inputVars>
          <outputVars>
            <variable name="Ym">
              <type>
                <REAL />
              </type>
            </variable>
            <variable name="Yp">
              <type>
                <REAL />
              </type>
            </variable>
            <variable name="Yin">
              <type>
                <REAL />
              </type>
            </variable>
            <variable name="Yft">
              <type>
                <REAL />
              </type>
            </variable>
            <variable name="Yyd">
              <type>
                <REAL />
              </type>
            </variable>
            <variable name="Ymile">
              <type>
                <REAL />
              </type>
            </variable>
            <variable name="Ysm">
              <type>
                <REAL />
              </type>
            </variable>
            <variable name="Yfm">
              <type>
                <REAL />
              </type>
            </variable>
          </outputVars>
        </interface>
        <body>
          <ST>
            Ym :=	m
		+ p * 0.000376065
		+ in * 0.0254
		+ ft * 0.3048
		+ yd * 0.9144
		+ mile * 1609.344
		+ sm * 1852.0
		+ fm * 1.829;
Yp := Ym * 2659.11478068951;
Yin := Ym * 39.37007874016;
Yft := Ym * 3.28083989501;
Yyd := Ym * 1.09361329834;
Ymile := Ym * 0.00062137119;
Ysm := Ym * 0.00053995680;
Yfm := Ym * 0.54674685621;

(*
Länge Meter m SI-Basiseinheit
Astronomische Einheit* AE 1 AE = 149,597 870 · E9 m
Parsec pc 1 pc = 206265 AE = 30,857 · E15 m
Lichtjahr Lj 1 Lj = 9,460 530 · E15 m = 63240 AE = 0,306 59 pc
Ångström Å 1 Å = E–l0 m
typograph. Punkt p 1 p = 0,376 065 mm • im Druckereigewerbe
inch** in 1 in = 2,54 · E–2 m = 25,4 mm***
foot ft 1 ft = 0,3048 m = 30,48 cm
yard yd 1 yd = 0,9144 m
mile mile 1 mile = 1609,344 m
Internat. Seemeile sm 1 sm = 1852 m
Fathom fm 1 fm = 1,829 m • in der Seeschifffahrt
*)

(* revision history

hm	27. mar. 2007	rev 1.0
	original version

hm	11. mar. 2009	rev 1.1
	improved code

*)

          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>3afe3bb0-5811-48eb-8a0a-e725c992f834</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="MS_TO_BFT" pouType="function">
        <interface>
          <returnType>
            <INT />
          </returnType>
          <inputVars>
            <variable name="MS">
              <type>
                <REAL />
              </type>
            </variable>
          </inputVars>
        </interface>
        <body>
          <ST>
            MS_TO_BFT := REAL_TO_INT(EXPT(MS * 1.196172, 0.666667));


(* revision history
hm	12. 6. 2008		rev 1.0
	original version

*)
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>8d290827-5a32-4df0-9beb-112fe75dcea4</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="MS_TO_KMH" pouType="function">
        <interface>
          <returnType>
            <REAL />
          </returnType>
          <inputVars>
            <variable name="ms">
              <type>
                <REAL />
              </type>
            </variable>
          </inputVars>
        </interface>
        <body>
          <ST>
            MS_TO_KMH := ms * 3.6;


          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>02ebbc4f-735c-4f73-8639-c907c5fb1971</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="OM_TO_F" pouType="function">
        <interface>
          <returnType>
            <REAL />
          </returnType>
          <inputVars>
            <variable name="OM">
              <type>
                <REAL />
              </type>
            </variable>
          </inputVars>
        </interface>
        <body>
          <ST>
            OM_TO_F := OM / math.PI2;


(* revision history
hm	22. jan. 2007	rev 1.0
	original version

hm	18. oct. 2008	rev 1.1
	using math constants

*)
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>212ab559-be4e-4682-a73c-e4689a763f90</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="PRESSURE" pouType="functionBlock">
        <interface>
          <inputVars>
            <variable name="mws">
              <type>
                <REAL />
              </type>
            </variable>
            <variable name="torr">
              <type>
                <REAL />
              </type>
            </variable>
            <variable name="att">
              <type>
                <REAL />
              </type>
            </variable>
            <variable name="atm">
              <type>
                <REAL />
              </type>
            </variable>
            <variable name="pa">
              <type>
                <REAL />
              </type>
            </variable>
            <variable name="bar">
              <type>
                <REAL />
              </type>
            </variable>
          </inputVars>
          <outputVars>
            <variable name="Ymws">
              <type>
                <REAL />
              </type>
            </variable>
            <variable name="Ytorr">
              <type>
                <REAL />
              </type>
            </variable>
            <variable name="Yatt">
              <type>
                <REAL />
              </type>
            </variable>
            <variable name="Yatm">
              <type>
                <REAL />
              </type>
            </variable>
            <variable name="Ypa">
              <type>
                <REAL />
              </type>
            </variable>
            <variable name="Ybar">
              <type>
                <REAL />
              </type>
            </variable>
          </outputVars>
        </interface>
        <body>
          <ST>
            Ybar := bar +
		pa * 1.0E-5 +
		0.980665 * att +
		1.01325 * atm +
		0.001333224 * torr +
		0.0980665 * mws;
Ymws := ybar * 10.1971621297793;
Ytorr := ybar * 750.0615050434140;
Yatt := ybar * 1.0197162129779;
yatm := ybar * 0.9869232667160;
Ypa := ybar * 100000.0;


(*
Druck, Pascal Pa 1 Pa = 1 N/m2 = 1 kg/(s2 E m) . 0,75 E 10.2 mmHg
mechanische 1 MPa = 1 N/mm2 . fur Festigkeitsangaben
Spannung Bar bar 1 bar = 105 Pa = 103 mbar = 105 kg/(s2 E m)
Millimeter- mmHg 1 mmHg = 133,322 Pa = 1,333 22 mbar
Quecksilbersaule . nur in Heilkunde zulassig
physik. Atmosphare atm 1 atm = 1,013 25 bar
techn. Atmosphare at 1 at = 1 kp/cm2 = 0,980665 bar
Torr Torr 1 Torr = (101325/760) Pa = 1,333224 mbar
Meter-Wassersaule mWS 1 mWS = 9806,65 Pa = 98,0665 mbar
psi lbf/in2 1 lbf/in2 = 68,947 57 mbar = 6894,757 Pa

*)

(* revision history

hm	27. mar. 2007	rev 1.0
	original version

hm	11. mar. 2009	rev 1.1
	improved code

*)
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>6cb0bb3e-f5f6-40fc-87c6-0a45f829f913</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="PT_TO_F" pouType="function">
        <interface>
          <returnType>
            <REAL />
          </returnType>
          <inputVars>
            <variable name="PT">
              <type>
                <TIME />
              </type>
            </variable>
          </inputVars>
        </interface>
        <body>
          <ST>
            PT_TO_F := 1000.0 / DWORD_TO_REAL(TIME_TO_DWORD(PT));


(*	revision history
hm	4. aug. 2006	rev 1.0
	original version

hm	11. mar. 2009	rev 1.1
	real constants updated to new systax using dot

*)

          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>d51111a0-d1f8-45b1-a52e-3ccedd4ba8e3</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="SPEED" pouType="functionBlock">
        <interface>
          <inputVars>
            <variable name="ms">
              <type>
                <REAL />
              </type>
            </variable>
            <variable name="kmh">
              <type>
                <REAL />
              </type>
            </variable>
            <variable name="kn">
              <type>
                <REAL />
              </type>
            </variable>
            <variable name="mh">
              <type>
                <REAL />
              </type>
            </variable>
          </inputVars>
          <outputVars>
            <variable name="Yms">
              <type>
                <REAL />
              </type>
            </variable>
            <variable name="Ykmh">
              <type>
                <REAL />
              </type>
            </variable>
            <variable name="Ykn">
              <type>
                <REAL />
              </type>
            </variable>
            <variable name="Ymh">
              <type>
                <REAL />
              </type>
            </variable>
          </outputVars>
        </interface>
        <body>
          <ST>
            Yms := ms +
		kmh * 0.27777777777778 +
		kn * 0.5144444 +
		mh * 0.44704;
Ykmh := Yms * 3.6;
Ykn := Yms * 1.94384466037535;
Ymh := Yms * 2.23693629205440;

(*
Geschwindigkeit Meter durch Sekunde m/s 1 m/s = 3,6 km/h
km durch (pro) Stunde, nicht „Stundenkilometer“ verwenden
Knoten kn 1 kn = 1 sm/h = 0,5144 m/s

*)

(* revision history
hm	27. mar. 2009	rev 1.0
	original version

hm	11. mar. 2009	rev 1.1
	improved code

*)
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>0703ab18-c601-416e-9499-6e42634f8d58</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="TEMPERATURE" pouType="functionBlock">
        <interface>
          <inputVars>
            <variable name="K">
              <type>
                <REAL />
              </type>
            </variable>
            <variable name="C">
              <type>
                <REAL />
              </type>
              <initialValue>
                <simpleValue value="-273.15" />
              </initialValue>
            </variable>
            <variable name="F">
              <type>
                <REAL />
              </type>
              <initialValue>
                <simpleValue value="-459.67" />
              </initialValue>
            </variable>
            <variable name="Re">
              <type>
                <REAL />
              </type>
              <initialValue>
                <simpleValue value="-218.52" />
              </initialValue>
            </variable>
            <variable name="Ra">
              <type>
                <REAL />
              </type>
            </variable>
          </inputVars>
          <outputVars>
            <variable name="YK">
              <type>
                <REAL />
              </type>
            </variable>
            <variable name="YC">
              <type>
                <REAL />
              </type>
            </variable>
            <variable name="YF">
              <type>
                <REAL />
              </type>
            </variable>
            <variable name="YRe">
              <type>
                <REAL />
              </type>
            </variable>
            <variable name="YRa">
              <type>
                <REAL />
              </type>
            </variable>
          </outputVars>
        </interface>
        <body>
          <ST>
            YK := K + (C + 273.15) + (F + 459.67) * 0.555555555555 + (Re * 1.25 + 273.15) + (Ra * 0.555555555555);
YC := YK -273.15;
YF := YK * 1.8 - 459.67;
YRe := (YK - 273.15) * 0.8;
YRa := YK * 1.8;


(* revision history
hm	21. feb. 2008	rev 1.0
	original version

*)
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>c2a15a88-3651-4d81-99cc-d6b7d81d69eb</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="ALARM_2" pouType="functionBlock">
        <interface>
          <inputVars>
            <variable name="X">
              <type>
                <REAL />
              </type>
            </variable>
            <variable name="LO_1">
              <type>
                <REAL />
              </type>
            </variable>
            <variable name="HI_1">
              <type>
                <REAL />
              </type>
            </variable>
            <variable name="LO_2">
              <type>
                <REAL />
              </type>
            </variable>
            <variable name="HI_2">
              <type>
                <REAL />
              </type>
            </variable>
            <variable name="HYS">
              <type>
                <REAL />
              </type>
            </variable>
          </inputVars>
          <outputVars>
            <variable name="Q1_LO">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="Q1_HI">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="Q2_LO">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="Q2_HI">
              <type>
                <BOOL />
              </type>
            </variable>
          </outputVars>
          <localVars>
            <variable name="tmp">
              <type>
                <REAL />
              </type>
            </variable>
          </localVars>
        </interface>
        <body>
          <ST>
            tmp := X - Hys * 0.5;
IF tmp &gt; LO_1 THEN Q1_LO := FALSE; END_IF;
IF tmp &gt; LO_2 THEN Q2_LO := FALSE; END_IF;
IF tmp &gt; HI_1 THEN Q1_HI := TRUE; END_IF;
IF tmp &gt; HI_2 THEN Q2_HI := TRUE; END_IF;
tmp := tmp + hys;
IF tmp &lt; LO_1 THEN Q1_LO := TRUE; END_IF;
IF tmp &lt; LO_2 THEN Q2_LO := TRUE; END_IF;
IF tmp &lt; HI_1 THEN Q1_HI := FALSE; END_IF;
IF tmp &lt; HI_2 THEN Q2_HI := FALSE; END_IF;



(* revision history
hm	19. may. 2008		rev 1.0
	original version

hm	11. mar. 2009	rev 1.1
	improved code
*)

          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>16869708-80ac-4fb7-b602-69fbe45d8345</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="BAR_GRAPH" pouType="functionBlock">
        <interface>
          <inputVars>
            <variable name="X">
              <type>
                <REAL />
              </type>
            </variable>
            <variable name="rst">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="trigger_Low">
              <type>
                <REAL />
              </type>
              <addData>
                <data name="http://www.3s-software.com/plcopenxml/attributes" handleUnknown="implementation">
                  <Attributes>
                    <Attribute Name="input_constant" Value="" />
                  </Attributes>
                </data>
              </addData>
            </variable>
            <variable name="trigger_High">
              <type>
                <REAL />
              </type>
              <addData>
                <data name="http://www.3s-software.com/plcopenxml/attributes" handleUnknown="implementation">
                  <Attributes>
                    <Attribute Name="input_constant" Value="" />
                  </Attributes>
                </data>
              </addData>
            </variable>
            <variable name="Alarm_low">
              <type>
                <BOOL />
              </type>
              <addData>
                <data name="http://www.3s-software.com/plcopenxml/attributes" handleUnknown="implementation">
                  <Attributes>
                    <Attribute Name="input_constant" Value="" />
                  </Attributes>
                </data>
              </addData>
            </variable>
            <variable name="Alarm_high">
              <type>
                <BOOL />
              </type>
              <addData>
                <data name="http://www.3s-software.com/plcopenxml/attributes" handleUnknown="implementation">
                  <Attributes>
                    <Attribute Name="input_constant" Value="" />
                  </Attributes>
                </data>
              </addData>
            </variable>
            <variable name="log_scale">
              <type>
                <BOOL />
              </type>
              <addData>
                <data name="http://www.3s-software.com/plcopenxml/attributes" handleUnknown="implementation">
                  <Attributes>
                    <Attribute Name="input_constant" Value="" />
                  </Attributes>
                </data>
              </addData>
            </variable>
          </inputVars>
          <outputVars>
            <variable name="LOW">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="Q1">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="Q2">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="Q3">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="Q4">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="Q5">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="Q6">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="HIGH">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="Alarm">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="Status">
              <type>
                <BYTE />
              </type>
            </variable>
          </outputVars>
          <localVars>
            <variable name="init">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="T1">
              <type>
                <REAL />
              </type>
            </variable>
            <variable name="T2">
              <type>
                <REAL />
              </type>
            </variable>
            <variable name="T3">
              <type>
                <REAL />
              </type>
            </variable>
            <variable name="T4">
              <type>
                <REAL />
              </type>
            </variable>
            <variable name="T5">
              <type>
                <REAL />
              </type>
            </variable>
          </localVars>
          <tempVars>
            <variable name="temp">
              <type>
                <REAL />
              </type>
            </variable>
          </tempVars>
        </interface>
        <body>
          <ST>
            IF NOT init THEN
	init := TRUE;
	IF log_scale THEN
		temp := EXP(LN(Trigger_high / Trigger_low) * 0.166666666666666666666);
		T1 := trigger_low * temp;
		T2 := T1 * temp;
		T3 := T2 * temp;
		T4 := T3 * temp;
		T5 := T4 * temp;
	ELSE
		temp := (trigger_high - trigger_low) * 0.142857142;
		T1 := trigger_low + temp;
		T2 := T1 + temp;
		T3 := T2 + temp;
		T4 := T3 + temp;
		T5 := T4 + temp;
	END_IF;
END_IF;

(* clear outputs before checking *)
Q1 := FALSE;
Q2 := FALSE;
Q3 := FALSE;
Q4 := FALSE;
Q5 := FALSE;
Q6 := FALSE;
status := 110;

(* low, high and alarm can only be cleared with rst depending on alarm_low and alarm_high *)
IF NOT alarm_low THEN low := FALSE; END_IF;
IF NOT alarm_high THEN high := FALSE; END_IF;
IF rst THEN
	alarm := FALSE;
	low := FALSE;
	high := FALSE;
END_IF;

(* check and set outputs *)
IF X &lt; trigger_low THEN
	Low := TRUE;
	status := 111;
	IF alarm_low THEN
		alarm := TRUE;
		status := 1;
	END_IF;
ELSIF X &lt; T1 THEN
	Q1 := TRUE;
ELSIF x &lt; t2 THEN
	Q2 := TRUE;
ELSIF x &lt; t3 THEN
	Q3 := TRUE;
ELSIF x &lt; T4 THEN
	Q4 := TRUE;
ELSIF x &lt; T5 THEN
	q5 := TRUE;
ELSIF x &lt; trigger_high THEN
	q6 := TRUE;
ELSE
	high := TRUE;
	status := 112;
	IF alarm_high THEN
		alarm := TRUE;
		status := 2;
	END_IF;
END_IF;

(* revision history
hm	22. feb 2007	rev 1.0
	original version

hm	2. dec 2007		rev 1.1
	chaged code for better performance

hm	6. jan 2008		rev 1.2
	further performance improvement

*)
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>8c830dae-9154-43e1-af51-605a7523ae5a</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="CALIBRATE" pouType="functionBlock">
        <interface>
          <inputVars>
            <variable name="X">
              <type>
                <REAL />
              </type>
            </variable>
            <variable name="CO">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="CS">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="Y_Offset">
              <type>
                <REAL />
              </type>
              <addData>
                <data name="http://www.3s-software.com/plcopenxml/attributes" handleUnknown="implementation">
                  <Attributes>
                    <Attribute Name="input_constant" Value="" />
                  </Attributes>
                </data>
              </addData>
            </variable>
            <variable name="Y_Scale">
              <type>
                <REAL />
              </type>
              <addData>
                <data name="http://www.3s-software.com/plcopenxml/attributes" handleUnknown="implementation">
                  <Attributes>
                    <Attribute Name="input_constant" Value="" />
                  </Attributes>
                </data>
              </addData>
            </variable>
          </inputVars>
          <outputVars>
            <variable name="Y">
              <type>
                <REAL />
              </type>
            </variable>
          </outputVars>
          <localVars retain="true">
            <variable name="offset">
              <type>
                <REAL />
              </type>
            </variable>
            <variable name="Scale">
              <type>
                <REAL />
              </type>
              <initialValue>
                <simpleValue value="1.0" />
              </initialValue>
            </variable>
          </localVars>
        </interface>
        <body>
          <ST>
            (* check for calibration *)
IF CO THEN
	OFFSET := Y_Offset - X;
ELSIF CS THEN
	SCALE := Y_scale / (X + OFFSET);
END_IF;
(* calculate output *)
Y := (X + OFFSET) * SCALE;


(* revision history
hm 22.2.2007		rev 1.2
	changed VAR RETAIN PERSISTENT to VAR RETAIN for better compatibility
	wago lon contollers do not support persisitent

hm	11. mar. 2009	rev 1.3
	changed real constants to use dot syntax

*)
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>7b48808d-e883-4fdb-958a-a3e603644170</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="CYCLE_TIME" pouType="functionBlock">
        <interface>
          <inputVars>
            <variable name="RST">
              <type>
                <BOOL />
              </type>
            </variable>
          </inputVars>
          <outputVars>
            <variable name="ct_min">
              <type>
                <TIME />
              </type>
            </variable>
            <variable name="ct_max">
              <type>
                <TIME />
              </type>
            </variable>
            <variable name="ct_last">
              <type>
                <TIME />
              </type>
            </variable>
            <variable name="systime">
              <type>
                <TIME />
              </type>
            </variable>
            <variable name="sysdays">
              <type>
                <INT />
              </type>
            </variable>
            <variable name="cycles">
              <type>
                <DWORD />
              </type>
            </variable>
          </outputVars>
          <localVars>
            <variable name="last_cycle">
              <type>
                <TIME />
              </type>
            </variable>
            <variable name="tx">
              <type>
                <TIME />
              </type>
            </variable>
            <variable name="init">
              <type>
                <BOOL />
              </type>
            </variable>
          </localVars>
        </interface>
        <body>
          <ST>
            tx := DWORD_TO_TIME(T_PLC_MS()) - last_cycle;
IF rst THEN
	ct_min := t#10h;
	ct_max := t#0ms;
	cycles := 0;
ELSIF last_cycle &gt; t#0s THEN
	IF tx &lt; ct_min THEN ct_min := tx;
	ELSIF tx &gt; ct_max THEN ct_max := tx;
	END_IF;
	ct_last := tx;
ELSIF ct_min = t#0s THEN
	ct_min := t#0s - t#1ms;
END_IF;
IF init THEN
	systime := systime + tx;
		IF systime &gt;= t#1d THEN
			systime := systime - t#1d;
			sysdays := sysdays + 1;
		END_IF;
END_IF;
init := TRUE;
last_cycle := last_cycle + tx;
cycles := cycles + 1;

(*	revision history
hm 12.12.2006		rev 1.1
	added cycles output, a dword cycle counter.
hm 10.3.2007			rev 1.2
	changed initialization of ct_min to t#10h for compatibility with siemens s7

hm	16.9.2007		rev 1.2
	changed Time() in T_PLC_MS() for compatibility resons

*)
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>914a8317-d528-4bba-b7cc-2393906a28cc</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="DT_SIMU" pouType="functionBlock">
        <interface>
          <inputVars>
            <variable name="START">
              <type>
                <DT />
              </type>
            </variable>
            <variable name="SPEED">
              <type>
                <REAL />
              </type>
              <initialValue>
                <simpleValue value="1.0" />
              </initialValue>
            </variable>
          </inputVars>
          <outputVars>
            <variable name="DTS">
              <type>
                <DT />
              </type>
            </variable>
          </outputVars>
          <localVars>
            <variable name="tc">
              <type>
                <DWORD />
              </type>
            </variable>
            <variable name="init">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="last">
              <type>
                <DWORD />
              </type>
            </variable>
            <variable name="tx">
              <type>
                <DWORD />
              </type>
            </variable>
            <variable name="td">
              <type>
                <DWORD />
              </type>
            </variable>
          </localVars>
        </interface>
        <body>
          <ST>
            (* read system timer *)
tx := T_PLC_MS();
tc := REAL_TO_DWORD(DWORD_TO_REAL(tx - last) * speed);

IF NOT init THEN
	init := TRUE;
	DTS := Start;
	tc := 0;
	last := tx;
ELSIF SPEED = 0.0 THEN
	DTS := DWORD_TO_DT(DT_TO_DWORD(DTS) + 1);
ELSIF tc &gt;= 1000 THEN
	td := (tc / 1000) * 1000;
	DTS := DTS + DWORD_TO_TIME(td);
	last := last + REAL_TO_DWORD(DWORD_TO_REAL(td) / speed);
END_IF;

(* revision history
hm	11. sep. 2008	rev 1.0
	original version

hm	16. nov	2008	rev 1.1
	added type conversions for compatibility reasons

hm	8.	mar. 2009	rev 1.2
	added increment by cycle mode

*)

          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>6c416aec-a031-4c8b-b586-91ed5f449209</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="FLOW_METER" pouType="functionBlock">
        <interface>
          <inputVars>
            <variable name="VX">
              <type>
                <REAL />
              </type>
            </variable>
            <variable name="E">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="RST">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="PULSE_MODE">
              <type>
                <BOOL />
              </type>
              <addData>
                <data name="http://www.3s-software.com/plcopenxml/attributes" handleUnknown="implementation">
                  <Attributes>
                    <Attribute Name="input_constant" Value="" />
                  </Attributes>
                </data>
              </addData>
            </variable>
            <variable name="UPDATE_TIME">
              <type>
                <TIME />
              </type>
              <initialValue>
                <simpleValue value="TIME#1s0ms" />
              </initialValue>
              <addData>
                <data name="http://www.3s-software.com/plcopenxml/attributes" handleUnknown="implementation">
                  <Attributes>
                    <Attribute Name="input_constant" Value="" />
                  </Attributes>
                </data>
              </addData>
            </variable>
          </inputVars>
          <outputVars>
            <variable name="F">
              <type>
                <REAL />
              </type>
            </variable>
          </outputVars>
          <inOutVars>
            <variable name="X">
              <type>
                <REAL />
              </type>
            </variable>
            <variable name="Y">
              <type>
                <UDINT />
              </type>
            </variable>
          </inOutVars>
          <localVars>
            <variable name="tx">
              <type>
                <TIME />
              </type>
            </variable>
            <variable name="tl">
              <type>
                <TIME />
              </type>
            </variable>
            <variable name="int1">
              <type>
                <derived name="INTEGRATE" />
              </type>
            </variable>
            <variable name="init">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="e_last">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="tmp">
              <type>
                <INT />
              </type>
            </variable>
            <variable name="x_last">
              <type>
                <REAL />
              </type>
            </variable>
            <variable name="y_last">
              <type>
                <UDINT />
              </type>
            </variable>
          </localVars>
        </interface>
        <body>
          <ST>
            IF NOT init THEN	(* init on power up *)
	init := TRUE;
	tl := tx;
	x_last := X;
	y_last := Y;
	int1.K := 2.7777777777777777E-4;
END_IF;

(* run integrator *)
int1(E := NOT (RST OR PULSE_MODE) AND E, X := VX, Y := X);	(* gated operation *)

IF RST THEN		(* reset *)
	X := 0.0;
	Y := 0;
	tl := tx;
	x_last := 0.0;
	y_last := 0;
ELSIF E AND PULSE_MODE THEN	(* check for pulse mode *)
	IF NOT e_last THEN X := X + VX; END_IF;
END_IF;
e_last := E;

(* reduce X to be less than 1 and increase Y respectively *)
IF X &gt; 1.0 THEN
	tmp := FLOOR(X);
	Y := Y + INT_TO_UDINT(tmp);
	X := X - INT_TO_REAL(tmp);
END_IF;

(* calculate the current flow *)
tx := DWORD_TO_TIME(T_PLC_MS());
IF tx - tl &gt;= UPDATE_TIME AND UPDATE_TIME &gt; t#0s THEN
	F := (UDINT_TO_REAL(Y - y_last) + X - x_last) / TIME_TO_REAL(tx - tl) * 3.6E6;
	y_last := Y;
	x_last := X;
	tl := tx;
END_IF;



(* revision history
hm	23. jan. 2011	rev 1.0
	original version

*)

          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>d93ec902-c70a-46d0-87ce-9087d4c97954</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="M_D" pouType="functionBlock">
        <interface>
          <inputVars>
            <variable name="start">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="stop">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="tmax">
              <type>
                <TIME />
              </type>
              <initialValue>
                <simpleValue value="TIME#14400m0s0ms" />
              </initialValue>
            </variable>
            <variable name="rst">
              <type>
                <BOOL />
              </type>
            </variable>
          </inputVars>
          <outputVars>
            <variable name="PT">
              <type>
                <TIME />
              </type>
            </variable>
            <variable name="ET">
              <type>
                <TIME />
              </type>
            </variable>
            <variable name="run">
              <type>
                <BOOL />
              </type>
            </variable>
          </outputVars>
          <localVars>
            <variable name="edge">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="T0">
              <type>
                <TIME />
              </type>
            </variable>
            <variable name="tx">
              <type>
                <TIME />
              </type>
            </variable>
            <variable name="startup">
              <type>
                <BOOL />
              </type>
            </variable>
          </localVars>
        </interface>
        <body>
          <ST>
            (* check for rst input *)
IF rst OR et &gt;= tmax THEN
	pt := t#0ms;
	et := t#0ms;
	startup := FALSE;
	run := FALSE;
END_IF;

(* avoid timers to start when input is true at startup *)
IF NOT startup THEN
	edge := start;
	startup := TRUE;
END_IF;

(* read system timer *)
tx := DWORD_TO_TIME(T_PLC_MS());

(* detect rising edge on start *)
IF start AND NOT edge AND NOT stop THEN
	t0 := tx;
	run := TRUE;
	pt := t#0s;
ELSIF stop AND run THEN
	pt := et;
	run := FALSE;
END_IF;
edge := start;
IF run THEN et := tx - t0; END_IF;

(* revision history
hm		2.5.2007	rev 1.0
	original version

hm		16.9.2007	rev 1.1
	changes time() to T_plc_ms() for compatibility reasons

hm	27. feb 2009	rev 1.2
	deleted unnecessary init with 0
*)

          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>23847fd0-ff05-4567-9694-beabecbe834f</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="M_T" pouType="functionBlock">
        <interface>
          <inputVars>
            <variable name="IN">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="TMAX">
              <type>
                <TIME />
              </type>
              <initialValue>
                <simpleValue value="TIME#14400m0s0ms" />
              </initialValue>
            </variable>
            <variable name="RST">
              <type>
                <BOOL />
              </type>
            </variable>
          </inputVars>
          <outputVars>
            <variable name="PT">
              <type>
                <TIME />
              </type>
            </variable>
            <variable name="ET">
              <type>
                <TIME />
              </type>
            </variable>
          </outputVars>
          <localVars>
            <variable name="edge">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="start">
              <type>
                <TIME />
              </type>
            </variable>
            <variable name="tx">
              <type>
                <TIME />
              </type>
            </variable>
          </localVars>
        </interface>
        <body>
          <ST>
            (* read system time *)
tx := DWORD_TO_TIME(T_PLC_MS());

IF RST OR ET &gt;= TMAX THEN
	PT :=  t#0s;
	ET := t#0s;
ELSIF IN THEN
	IF NOT edge THEN start := tx; END_IF;
	ET := tx - start;
ELSE
	PT := ET;
END_IF;
edge := IN;



(* revision history
hm	4. aug. 2006	rev 1.0
	original version

hm	2. may. 2007	rev 1.1
	added init variable to avoid unreasonable measurement if falling edge occurs first.
	added et (elapsed time) output to count from 0 at rising edge until a falling edge resets et to 0.
	added reset input.

hm	16. sep. 2007	rev 1.2
	changes time() to T_plc_ms() for compatibility reasons

hm	17. dec. 2008	rev 1.3
	code optimized

hm	10. mar. 2009	rev 1.4
	removed nested comments
	removed double assignments

*)
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>35ecb9a4-19fc-43ea-8b1f-d7e51e47887f</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="M_TX" pouType="functionBlock">
        <interface>
          <inputVars>
            <variable name="in">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="tmax">
              <type>
                <TIME />
              </type>
              <initialValue>
                <simpleValue value="TIME#14400m0s0ms" />
              </initialValue>
            </variable>
            <variable name="rst">
              <type>
                <BOOL />
              </type>
            </variable>
          </inputVars>
          <outputVars>
            <variable name="TH">
              <type>
                <TIME />
              </type>
            </variable>
            <variable name="TL">
              <type>
                <TIME />
              </type>
            </variable>
            <variable name="DC">
              <type>
                <REAL />
              </type>
            </variable>
            <variable name="F">
              <type>
                <REAL />
              </type>
            </variable>
            <variable name="ET">
              <type>
                <TIME />
              </type>
            </variable>
          </outputVars>
          <localVars>
            <variable name="edge">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="start">
              <type>
                <TIME />
              </type>
            </variable>
            <variable name="stop">
              <type>
                <TIME />
              </type>
            </variable>
            <variable name="tx">
              <type>
                <TIME />
              </type>
            </variable>
            <variable name="rise">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="fall">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="startup">
              <type>
                <BOOL />
              </type>
            </variable>
          </localVars>
        </interface>
        <body>
          <ST>
            (* check FOR rst input *)
IF rst OR (et &gt;= tmax) THEN
	rise := FALSE;
	fall := FALSE;
	startup := FALSE;
	th := t#0ms;
	tl := t#0ms;
	DC := 0.0;
	F := 0.0;
	ET := t#0s;
END_IF;

(* avoid timers to start when input is true at startup *)
IF NOT startup THEN
	edge := in;
	startup := TRUE;
END_IF;

(* read system timer *)
tx := DWORD_TO_TIME(T_PLC_MS());

(* edge trigger rising and falling edge *)
IF in XOR edge THEN
	edge := in;
	(* rising edge starts measurement *)
	IF in THEN
		start := Tx;
		rise := TRUE;
		IF fall THEN tl := start - stop; END_IF;
		IF th &gt; t#0ms AND tl &gt; t#0ms THEN
			dc := TIME_TO_REAL(th) / TIME_TO_REAL(th+tl);
			f := 1000.0 / TIME_TO_REAL(th + tl);
		END_IF;
	(* falling edge starts second cycle measurement *)
	ELSE
		stop := Tx;
		fall := TRUE;
		IF rise THEN th := stop - start; END_IF;
		IF th &gt; t#0ms AND tl &gt; t#0ms THEN
			dc := TIME_TO_REAL(th) /  TIME_TO_REAL(th+tl);
			f := 1000.0 / TIME_TO_REAL(th + tl);
		END_IF;
	END_IF;
END_IF;
IF rise THEN et := tx - start; END_IF;

(* revision history
hm	4. aug. 2006	rev 1.0
	original version

hm	2. mai. 2007	rev 1.1
	made sure that no undefined values would be measured at startup conditions
	added output et
	added rst input
	added tmax input

hm	16. sep. 2007	rev 1.2
	changes time() to T_plc_ms() for compatibility reasons

hm	27. feb. 2009	rev 1.3
	deleted unnecessary init with 0

hm	11. mar. 2009	rev 1.4
	changed real constants to use dot syntax

*)
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>0ab4b2d2-a9f3-485d-96c1-16d5cb928a0a</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="METER" pouType="functionBlock">
        <interface>
          <inputVars>
            <variable name="M1">
              <type>
                <REAL />
              </type>
            </variable>
            <variable name="M2">
              <type>
                <REAL />
              </type>
            </variable>
            <variable name="I1">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="I2">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="D">
              <type>
                <REAL />
              </type>
              <initialValue>
                <simpleValue value="1.0" />
              </initialValue>
            </variable>
            <variable name="RST">
              <type>
                <BOOL />
              </type>
            </variable>
          </inputVars>
          <inOutVars>
            <variable name="MX">
              <type>
                <REAL />
              </type>
            </variable>
          </inOutVars>
          <localVars>
            <variable name="MR">
              <type>
                <derived name="REAL2" />
              </type>
            </variable>
            <variable name="MX1">
              <type>
                <REAL />
              </type>
              <documentation>
                 current consumption value on M1 and M2 
              </documentation>
            </variable>
            <variable name="MX2">
              <type>
                <REAL />
              </type>
              <documentation>
                 current consumption value on M1 and M2 
              </documentation>
            </variable>
            <variable name="tx">
              <type>
                <DWORD />
              </type>
            </variable>
            <variable name="last">
              <type>
                <DWORD />
              </type>
            </variable>
            <variable name="tc">
              <type>
                <REAL />
              </type>
            </variable>
            <variable name="init">
              <type>
                <BOOL />
              </type>
            </variable>
          </localVars>
        </interface>
        <body>
          <ST>
            (* measure the last cycle time and make sure we onle execute once every millisecond *)
tx := T_PLC_MS();
IF NOT init THEN
	init := TRUE;
	last := tx;
	mr.RX := mx;
	mr.R1 := 0.0;
ELSIF tx = last THEN
	RETURN;
ELSE
	tc := DWORD_TO_REAL(tx - last) * 0.001;
END_IF;
last := tx;

(* reset *)
IF rst THEN
	mr.R1 := 0.0;
	mr.RX := 0.0;
ELSE
	(* current consumption measurement *)
	IF I1 THEN MX1 := M1; ELSE MX1 := 0.0; END_IF;
	IF I2 THEN MX2 := M2; ELSE MX2 := 0.0; END_IF;
	(* add up the current values in a double real *)
	MR := R2_ADD(MR,(SEL(I1,0.0,mx1) + SEL(I2, 0.0, mx2)) / D * TC);
	(* set the current output value *)
	MX := mr.RX;
END_IF;




(* revision history

hm	16. sep.2007		rev 1.0
	original version

hm	7. feb 2008		rev 1.1
	use new version of ft_int to avoid a counting stop at high values
	deleted unnecessary limits

hm	24. mar. 2008	rev 1.2
	use data_type real2 to extend accuracy to 15 digits total
	do not use ft_int which adds unnecessary overhead

hm	8. feb. 2009	rev 1.3
	changed mx to be I/O
	make sure calculation works for cycle times &lt; 1 ms

hm	8. mar. 2009	rev 1.4
	last was not updated
	code improvements

*)

          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>fd04cf92-c4fd-440a-b880-8f4d174aa676</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="METER_STAT" pouType="functionBlock">
        <interface>
          <inputVars>
            <variable name="IN">
              <type>
                <REAL />
              </type>
            </variable>
            <variable name="DI">
              <type>
                <DATE />
              </type>
            </variable>
            <variable name="RST">
              <type>
                <BOOL />
              </type>
            </variable>
          </inputVars>
          <inOutVars>
            <variable name="Last_Day">
              <type>
                <REAL />
              </type>
            </variable>
            <variable name="Current_Day">
              <type>
                <REAL />
              </type>
            </variable>
            <variable name="Last_Week">
              <type>
                <REAL />
              </type>
            </variable>
            <variable name="Current_Week">
              <type>
                <REAL />
              </type>
            </variable>
            <variable name="Last_Month">
              <type>
                <REAL />
              </type>
            </variable>
            <variable name="Current_Month">
              <type>
                <REAL />
              </type>
            </variable>
            <variable name="Last_Year">
              <type>
                <REAL />
              </type>
            </variable>
            <variable name="Current_Year">
              <type>
                <REAL />
              </type>
            </variable>
          </inOutVars>
          <localVars retain="true">
            <variable name="Year_Start">
              <type>
                <REAL />
              </type>
            </variable>
            <variable name="Month_Start">
              <type>
                <REAL />
              </type>
            </variable>
            <variable name="Week_Start">
              <type>
                <REAL />
              </type>
            </variable>
            <variable name="Day_Start">
              <type>
                <REAL />
              </type>
            </variable>
            <variable name="last_run">
              <type>
                <DATE />
              </type>
            </variable>
          </localVars>
        </interface>
        <body>
          <ST>
            IF rst THEN
	Last_Day := 0.0;
	Current_Day := 0.0;
	Day_start := IN;
	Last_week := 0.0;
	Current_week := 0.0;
	Week_start := in;
	Last_month := 0.0;
	Current_month := 0.0;
	month_start := in;
	last_year := 0.0;
	current_year := 0.0;
	year_start := in;
ELSE
	Current_Day := IN - Day_Start;
	Current_Week := In - Week_Start;
	Current_Month := IN - Month_Start;
	Current_Year := IN - Year_Start;
END_IF;

IF YEAR_OF_DATE(DI) &gt; YEAR_OF_DATE(last_run) THEN
	(* a new year has started *)
	last_year := current_year;
	current_year := 0.0;
	year_start := in;
	last_month := current_month;
	current_month := 0.0;
	month_start := in;
	last_day := current_day;
	current_day := 0.0;
	day_start := in;
ELSIF MONTH_OF_DATE(DI) &gt; MONTH_OF_DATE(last_run) THEN
	(* a new month has started, january is alrerady done by year change *)
	last_month := current_month;
	current_month := 0.0;
	month_start := in;
	last_day := current_day;
	current_day := 0.0;
	day_start := in;
ELSIF DAY_OF_YEAR(di) &gt; DAY_OF_YEAR(last_run) THEN
	(* day has chaged, first day of year and first day of month has already been taken care of *)
	last_day := current_day;
	current_day := 0.0;
	day_start := in;
END_IF;
IF DAY_OF_WEEK(DI) &lt; DAY_OF_WEEK(last_run) THEN
	(* a new week has started *)
	last_week := current_week;
	current_week := 0.0;
	week_start := in;
END_IF;
last_run := di;

(* revision history
hm	16. sep. 2007	rev 1.0
	original version

hm	7. oct. 2008	rev 1.1
	changed function year_to_year_of_date
	changed function month to month_of_date
	changed function weekday to day_of_week

hm	11. mar. 2009	rev 1.2
	changed real constants to use dot syntax

hm	18. jul. 2009	rev 1.3
	changes all outputs to be I/O
*)

          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>3b68b3ea-d5fb-465d-80ee-6c9a33ebae3a</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="ONTIME" pouType="functionBlock">
        <interface>
          <inputVars>
            <variable name="IN">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="RST">
              <type>
                <BOOL />
              </type>
            </variable>
          </inputVars>
          <inOutVars>
            <variable name="SECONDS">
              <type>
                <UDINT />
              </type>
            </variable>
            <variable name="CYCLES">
              <type>
                <UDINT />
              </type>
            </variable>
          </inOutVars>
          <localVars>
            <variable name="tx">
              <type>
                <DWORD />
              </type>
            </variable>
            <variable name="last">
              <type>
                <DWORD />
              </type>
            </variable>
            <variable name="edge">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="init">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="ms">
              <type>
                <DWORD />
              </type>
            </variable>
          </localVars>
        </interface>
        <body>
          <ST>
            (* read system time *)
tx := T_PLC_MS();

(* make sure the first cycle works correctly *)
IF NOT init THEN
	init := TRUE;
	last := tx;
	ms := 0;
END_IF;
IF RST THEN
	SECONDS := 0;
	CYCLES := 0;
	last := tx;
	ms := 0;
ELSIF IN THEN
	(* add the current milliseconds *)
	ms := (tx - last) + ms;
	IF ms &gt;= 1000 THEN
		seconds := seconds + 1;
		ms := ms - 1000;
	END_IF;
	cycles := cycles + BOOL_TO_UINT(NOT edge);
END_IF;
last := tx;
edge := in;


(* revision history
hm 22.2.2007		rev 1.1
	changed VAR RETAIN PERSISTENT to VAR RETAIN for better compatibility
	wago lon contollers do not support persisitent

hm 2.8.2007		rev 1.2
	adding time up in a real number will automatically lead to the point where 
	small time scales like the cycle time will be below the resolution of real and therefore
	ontime would not increase in small steps as necessary
	the time is now measured internally in two  dwords and be converted to real only for
	output purposes.
	deleted the variable power because it was unnecessary

hm	16.9.2007		rev 1.3
	changes time() to T_plc_ms() for compatibility reasons

hm	2. dec. 2007	rev 1.4
	chaged code for better performance

hm	16. mar. 2008	rev 1.5
	added type conversions to avoid warnings under codesys 3.0

hm	21. oct. 2008	rev 2.0
	changed module for much better performance and allow for external result storage

hm	10. nov. 2008	rev 2.1
	increased internal resolution to milliseconds

hm	16. nov. 2008	rev 2.2
	changed typecast to avoid warnings

hm	17. dec. 2008	rev 2.3
	fixed an error when in would be true for more then 49 days

hm	17. jan 2011	rev 2.4
	init will not clear seconds and cycles, only rst clears these values	

hm	18. mar. 2011	rev 2.5
	reset was not working

*)
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>7fb880dd-8903-414f-840a-a9181656b092</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="T_PLC_MS" pouType="function">
        <interface>
          <returnType>
            <DWORD />
          </returnType>
          <localVars constant="true">
            <variable name="debug">
              <type>
                <BOOL />
              </type>
              <initialValue>
                <simpleValue value="0" />
              </initialValue>
            </variable>
            <variable name="N">
              <type>
                <INT />
              </type>
              <initialValue>
                <simpleValue value="0" />
              </initialValue>
            </variable>
            <variable name="offset">
              <type>
                <DWORD />
              </type>
              <initialValue>
                <simpleValue value="0" />
              </initialValue>
            </variable>
          </localVars>
          <localVars>
            <variable name="tx">
              <type>
                <TIME />
              </type>
            </variable>
          </localVars>
        </interface>
        <body>
          <ST>
            tx := TIME();
T_PLC_MS := TIME_TO_DWORD(Tx);
(* hier muss die korrektur für step7 stattfinden
plctime muss den vollen wertebereich von time ausnutzen:
wenn bei step7 time -24tage bis plus 24 tage ist dann muss der timer auch beim überlauf auf -24tage springen 
und auf keinen fall auf 0 !!!!
für siemens muss ein weiterer fb im main eingebunden werden der sicherstellt das alle 32 bits durchgezählt werden.
es kann nur ein fb sein den er muss sich das oberste (32te) bit merken.
oder etwa spring s7 bei überlauf auf -24 tage????? dann wäre keine korrektur nötig.
*)
IF debug THEN
	T_PLC_MS := (SHL(T_PLC_MS,N) OR SHL(DWORD#1,N)-1) + OFFSET;
END_IF;

(* revision history
hm	14.9.2007	rev 1.0
	original version

hm	12. nov 2007	rev 1.1
	added temporaray variable tx because some compilers could not handle time() as an argument

hm	16. nov. 2008	rev 1.2
	initialized constants with 0 for compatibility reasons
*)
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>d9a873f2-5686-430e-85e6-69dfa64edd33</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="T_PLC_US" pouType="function">
        <interface>
          <returnType>
            <DWORD />
          </returnType>
          <localVars constant="true">
            <variable name="debug">
              <type>
                <BOOL />
              </type>
              <initialValue>
                <simpleValue value="0" />
              </initialValue>
            </variable>
            <variable name="N">
              <type>
                <INT />
              </type>
              <initialValue>
                <simpleValue value="0" />
              </initialValue>
            </variable>
            <variable name="offset">
              <type>
                <DWORD />
              </type>
              <initialValue>
                <simpleValue value="0" />
              </initialValue>
            </variable>
          </localVars>
          <localVars>
            <variable name="tx">
              <type>
                <TIME />
              </type>
            </variable>
          </localVars>
        </interface>
        <body>
          <ST>
            tx := TIME();
T_PLC_US := TIME_TO_DWORD(Tx)*1000;
(* hier muss die korrektur für step7 stattfinden
plctime muss den vollen wertebereich von time ausnutzen:
wenn bei step7 time -24tage bis plus 24 tage ist dann muss der timer auch beim überlauf auf -24tage springen 
und auf keinen fall auf 0 !!!!
für siemens muss ein weiterer fb im main eingebunden werden der sicherstellt das alle 32 bits durchgezählt werden.
es kann nur ein fb sein den er muss sich das oberste (32te) bit merken.
oder etwa spring s7 bei überlauf auf -24 tage????? dann wäre keine korrektur nötig.
*)
IF debug THEN
	T_PLC_US := (SHL(T_PLC_US,N) OR SHL(DWORD#1,N)-1) + OFFSET;
END_IF;

(* revision history
hm	14.9.2007	rev 1.0
	original version

hm	12. nov 2007	rev 1.1
	added temporaray variable tx because some compilers could not handle time() as an argument

hm	16. nov. 2008	rev 1.2
	initialized constants with 0 for compatibility reasons

*)
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>4ea528bf-79aa-4a18-9f8c-e2b92d605f35</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="TC_MS" pouType="functionBlock">
        <interface>
          <outputVars>
            <variable name="TC">
              <type>
                <DWORD />
              </type>
            </variable>
          </outputVars>
          <localVars>
            <variable name="init">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="tx">
              <type>
                <DWORD />
              </type>
            </variable>
            <variable name="last">
              <type>
                <DWORD />
              </type>
            </variable>
          </localVars>
        </interface>
        <body>
          <ST>
            (* read system timer *)
tx := T_PLC_MS();

IF NOT init THEN
	init := TRUE;
	TC := 0;
ELSE
	tc := tx - last;
END_IF;
last := tx;

(* revision history
hm		13. mar. 2008	rev 1.0
	original version

*)

          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>b6bd0dd9-32b2-4daa-913c-aca25a0f7c91</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="TC_S" pouType="functionBlock">
        <interface>
          <outputVars>
            <variable name="TC">
              <type>
                <REAL />
              </type>
            </variable>
          </outputVars>
          <localVars>
            <variable name="init">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="tx">
              <type>
                <DWORD />
              </type>
            </variable>
            <variable name="last">
              <type>
                <DWORD />
              </type>
            </variable>
          </localVars>
        </interface>
        <body>
          <ST>
            (* read system timer *)
tx := T_PLC_US();

IF NOT init THEN
	init := TRUE;
	TC := 0.0;
ELSE
	tc := DWORD_TO_REAL(tx - last)*1.0E-6;
END_IF;
last := tx;

(* revision history
hm	13. mar. 2008	rev 1.0
	original version

hm	16. mar 2008	rev 1.1
	added type conversion to avoid warnings under codesys 3.0

hm	11. mar. 2009	rev 1.2
	changed real constants to use dot syntax

*)

          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>8bb991ca-f524-450a-87d0-dd24f024c77e</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="TC_US" pouType="functionBlock">
        <interface>
          <outputVars>
            <variable name="TC">
              <type>
                <DWORD />
              </type>
            </variable>
          </outputVars>
          <localVars>
            <variable name="init">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="tx">
              <type>
                <DWORD />
              </type>
            </variable>
            <variable name="last">
              <type>
                <DWORD />
              </type>
            </variable>
          </localVars>
        </interface>
        <body>
          <ST>
            (* read system timer *)
tx := T_PLC_US();

IF NOT init THEN
	init := TRUE;
	TC := 0;
ELSE
	tc := tx - last;
END_IF;
last := tx;

(* revision history
hm		13. mar. 2008	rev 1.0
	original version

*)

          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>dd50646e-33b7-4caf-9c68-48947d28df13</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="MULTI_IN" pouType="function">
        <interface>
          <returnType>
            <REAL />
          </returnType>
          <inputVars>
            <variable name="in_1">
              <type>
                <REAL />
              </type>
            </variable>
            <variable name="in_2">
              <type>
                <REAL />
              </type>
            </variable>
            <variable name="in_3">
              <type>
                <REAL />
              </type>
            </variable>
            <variable name="default">
              <type>
                <REAL />
              </type>
            </variable>
            <variable name="in_min">
              <type>
                <REAL />
              </type>
            </variable>
            <variable name="in_max">
              <type>
                <REAL />
              </type>
            </variable>
            <variable name="mode">
              <type>
                <BYTE />
              </type>
            </variable>
          </inputVars>
          <localVars>
            <variable name="count">
              <type>
                <INT />
              </type>
            </variable>
            <variable name="F1">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="F2">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="F3">
              <type>
                <BOOL />
              </type>
            </variable>
          </localVars>
        </interface>
        <body>
          <ST>
            F1 :=  in_1 &gt; in_min AND in_1 &lt; in_max;
F2 :=  in_2 &gt; in_min AND in_2 &lt; in_max;
F3 :=  in_3 &gt; in_min AND in_3 &lt; in_max;

CASE mode OF
0:	count := 0;
	IF F1 THEN
		count := count + 1;
		MULTI_IN := in_1;
	ELSE
		MULTI_IN := 0.0;
	END_IF;
	IF F2 THEN
		count := count + 1;
		MULTI_IN := MULTI_IN + in_2;
	END_IF;
	IF F3 THEN
		count := count + 1;
		MULTI_IN := MULTI_IN + in_3;
	END_IF;
	MULTI_IN := SEL(count = 0, MULTI_IN / INT_TO_REAL(count), default);

1:	MULTI_IN := SEL(F1, default, IN_1);

2:	MULTI_IN := SEL(F2, default, IN_2);

3:	MULTI_IN := SEL(F3, default, IN_3);

4:	MULTI_IN := default;

5:	MULTI_IN := SEL(F1, in_max, IN_1);
	IF F2 AND in_2 &lt; MULTI_IN THEN MULTI_IN := in_2; END_IF;
	IF F3 AND in_3 &lt; MULTI_IN THEN MULTI_IN := in_3; END_IF;
	IF MULTI_IN = in_max THEN MULTI_IN := default; END_IF;

6:	MULTI_IN := SEL(F1, in_min, IN_1);
	IF F2 AND in_2 &gt; MULTI_IN THEN MULTI_IN := in_2; END_IF;
	IF F3 AND in_3 &gt; MULTI_IN THEN MULTI_IN := in_3; END_IF;
	IF MULTI_IN = in_min THEN MULTI_IN := default; END_IF;

7:	IF F1 AND F2 AND F3 THEN MULTI_IN := MID3(in_1, in_2, in_3);
	ELSIF F1 AND F2 THEN MULTI_IN := MIN(in_1, in_2);
	ELSIF F1 AND F3 THEN MULTI_IN := MIN(in_1, in_3);
	ELSIF F2 AND F3 THEN MULTI_IN := MIN(in_2, in_3);
	ELSIF F1 THEN MULTI_IN := in_1;
	ELSIF F2 THEN MULTI_IN := in_2;
	ELSIF F3 THEN MULTI_IN := in_3;
	ELSE MULTI_IN := default;
	END_IF;

END_CASE;

(*
hm 1.1.2007		rev 1.1
	changed midr to mid3 function

hm	14. 10. 2008	rev 1.2
	corrected an error for in_3 overrange detection
	improved performance

hm	11. mar. 2009	rev 1.3
	changed real constants to use dot syntax

hm	18. jul. 2009	rev 1.4
	improved performance
*)
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>87883731-b2df-43e8-a954-780d3a55aabb</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="RES_NI" pouType="function">
        <interface>
          <returnType>
            <REAL />
          </returnType>
          <inputVars>
            <variable name="T">
              <type>
                <REAL />
              </type>
            </variable>
            <variable name="R0">
              <type>
                <REAL />
              </type>
            </variable>
          </inputVars>
          <localVars constant="true">
            <variable name="A">
              <type>
                <REAL />
              </type>
              <initialValue>
                <simpleValue value="0.5485" />
              </initialValue>
            </variable>
            <variable name="B">
              <type>
                <REAL />
              </type>
              <initialValue>
                <simpleValue value="0.000665" />
              </initialValue>
            </variable>
            <variable name="C">
              <type>
                <REAL />
              </type>
              <initialValue>
                <simpleValue value="2.805E-09" />
              </initialValue>
            </variable>
          </localVars>
          <localVars>
            <variable name="T2">
              <type>
                <REAL />
              </type>
            </variable>
          </localVars>
        </interface>
        <body>
          <ST>
            T2 := T * T;
RES_NI := R0 + A * T + B * T2 + C * T2 * T2;

(* revision history

hm	4.8.2006		rev 1.0
	original version

hm	13.9.2007		rev 1.1
	changed coding for better performance

hm	2. dec. 2007	rev 1.2
	changed code for better performance
*)

(*

 Auszug aus DIN 43760 für Ni100

°C		R		°C		R		°C	R		°C		R		°C		R

-60 	69,5 	-10 	94,6 	40 	123,0 	90 		154,9 	140 	190,9
-55 	71,9 	-5 		97,3 	45 	126,0 	95 		158,3 	145 	194,8
-50 	74,3 	0 		100,0 	50 	129,1 	100 	161,8 	150 	198,7
-45 	76,7 	5 		102,8 	55 	132,2 	105 	165,3 	155 	202,6
-40 	79,1 	10 		105,6 	60 	135,3 	110 	168,8 	160 	206,6
-35 	81,6 	15 		108,4 	65 	138,5 	115 	172,4 	165 	210,7
-30 	84,2 	20 		111,2 	70 	141,7 	120 	176,0 	170 	214,8
-25 	86,7 	25 		114,1 	75 	145,0 	125 	179,6 	175 	219,0
-20 	89,3 	30 		117,1 	80 	148,3 	130 	183,3 	180 	223,2
-15 	91,9 	35 		120,0 	85 	151,6 	135 	187,1 	  	 

*)
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>c55a8bc0-0121-4043-86cb-df81c6f7fde9</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="RES_NTC" pouType="function">
        <interface>
          <returnType>
            <REAL />
          </returnType>
          <inputVars>
            <variable name="T">
              <type>
                <REAL />
              </type>
            </variable>
            <variable name="RN">
              <type>
                <REAL />
              </type>
            </variable>
            <variable name="B">
              <type>
                <REAL />
              </type>
            </variable>
          </inputVars>
        </interface>
        <body>
          <ST>
            RES_NTC := RN * EXP(B * (1.0 / (T+273.15) - 0.00335401643468053));



(* revision history

hm 30. dec. 2008	rev 1.0
	original version

hm	11. mar. 2009	rev 1.1
	changed real constants to use dot syntax

*)
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>18c31b81-7489-45a5-922e-963c3af79a67</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="RES_PT" pouType="function">
        <interface>
          <returnType>
            <REAL />
          </returnType>
          <inputVars>
            <variable name="T">
              <type>
                <REAL />
              </type>
            </variable>
            <variable name="R0">
              <type>
                <REAL />
              </type>
            </variable>
          </inputVars>
          <localVars constant="true">
            <variable name="A">
              <type>
                <REAL />
              </type>
              <initialValue>
                <simpleValue value="0.00390802" />
              </initialValue>
            </variable>
            <variable name="B">
              <type>
                <REAL />
              </type>
              <initialValue>
                <simpleValue value="-5.802E-07" />
              </initialValue>
            </variable>
            <variable name="C">
              <type>
                <REAL />
              </type>
              <initialValue>
                <simpleValue value="-4.2735E-12" />
              </initialValue>
            </variable>
          </localVars>
          <localVars>
            <variable name="T2">
              <type>
                <REAL />
              </type>
            </variable>
          </localVars>
        </interface>
        <body>
          <ST>
            T2 := T * T;

IF T &gt;= 0.0 THEN
	RES_PT := R0 * ( 1.0 + A * T + B * T2);
ELSE
	RES_PT := R0 * ( 1.0 + A * T + B * T2 + C * (T - 100.0) * T2 * T);
END_IF;



(* revision history
hm	4. aug. 2006	rev 1.1
	original version

hm	2. dec 2007	rev 1.2
	changed code for better performance

hm	11. mar. 2009	rev 1.3
	changed real constants to use dot syntax

*)


(*
 Auszug aus DIN 43760 für Pt100

°C		R		°C		R		°C	R			°C		R			°C		R			°C		R

-200 	18,49 	-100 	60,25 	0 	100,00 	100 	138,50 	200 	175,84 	300 	212,02
-195 	20,65 	-95 	62,28 	5 	101,95 	105 	140,39 	205 	177,68 	305 	213,80
-190 	22,80 	-90 	64,30 	10 	103,90 	110 	142,29 	210 	179,51 	310 	215,57
-185 	24,94 	-85 	66,31 	15 	105,85 	115 	144,17 	215 	181,34 	315 	217,35
-180 	27,08 	-80 	68,33 	20 	107,79 	120 	146,06 	220 	183,17 	320 	219,12
-175 	29,20 	-75 	70,33 	25 	109,73 	125 	147,94 	225 	184,99 	325 	220,88
-170 	31,32 	-70 	72,33 	30 	111,67 	130 	149,82 	230 	186,82 	330 	222,65
-165 	33,43 	-65 	74,33 	35 	113,61 	135 	151,70 	235 	188,63 	335 	224,41
-160 	35,33 	-60 	76,33 	40 	115,54 	140 	153,58 	240 	190,45 	340 	226,17
-155 	37,63 	-55 	78,32 	45 	117,47 	145 	155,45 	245 	192,26 	345 	227,92
-150 	39,71 	-50 	80,31 	50 	119,40 	150 	157,31 	250 	194,07 	350 	229,67
-145 	41,79 	-45 	82,29 	55 	121,32 	155 	159,18 	255 	195,88 	355 	231,42
-140 	43,87 	-40 	84,27 	60 	123,24 	160 	161,04 	260 	197,69 	360 	233,17
-135 	45,94 	-35 	86,25 	65 	125,16 	165 	162,90 	265 	199,49 	365 	234,91
-130 	48,00 	-30 	88,22 	70 	127,07 	170 	164,76 	270 	201,29 	370 	236,65
-125 	50,06 	-25 	90,19 	75 	128,98 	175 	166,61 	275 	203,08 	375 	238,39
-120 	52,11 	-20 	92,16 	80 	130,89 	180 	168,46 	280 	204,88 	380 	240,13
-115 	54,15 	-15 	94,12 	85 	132,80 	185 	170,31 	285 	206,67 	385 	241,86
-110 	56,19 	-10 	96,09 	90 	134,70 	190 	172,16 	290 	208,45 	390 	243,59
-105 	58,22 	-5 		98,04 	95 	136,60 	195 	174,00 	295 	210,24 	395 	245,31

*)
(*
revision history


*)
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>5a026c3b-6562-4288-a831-91e77e1d7aca</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="RES_SI" pouType="function">
        <interface>
          <returnType>
            <REAL />
          </returnType>
          <inputVars>
            <variable name="T">
              <type>
                <REAL />
              </type>
            </variable>
            <variable name="RS">
              <type>
                <REAL />
              </type>
            </variable>
            <variable name="TS">
              <type>
                <REAL />
              </type>
            </variable>
          </inputVars>
          <localVars constant="true">
            <variable name="A">
              <type>
                <REAL />
              </type>
              <initialValue>
                <simpleValue value="0.00764" />
              </initialValue>
            </variable>
            <variable name="B">
              <type>
                <REAL />
              </type>
              <initialValue>
                <simpleValue value="1.66E-05" />
              </initialValue>
            </variable>
          </localVars>
          <localVars>
            <variable name="TX">
              <type>
                <REAL />
              </type>
            </variable>
          </localVars>
        </interface>
        <body>
          <ST>
            TX := T - TS;
RES_SI := RS * ( 1.0 + A * TX + B * TX * TX);

(* revision history
hm	4. aug 2006	rev 1.0
	original version

hm	2. dec 2007	rev 1.1
	changed code for better performance

hm	11. mar. 2009	rev 1.2
	changed real constants to use dot syntax

*)
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>fabace3d-cf1b-436d-a01c-c51d870c2509</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="SENSOR_INT" pouType="function">
        <interface>
          <returnType>
            <REAL />
          </returnType>
          <inputVars>
            <variable name="Voltage">
              <type>
                <REAL />
              </type>
            </variable>
            <variable name="Current">
              <type>
                <REAL />
              </type>
            </variable>
            <variable name="RP">
              <type>
                <REAL />
              </type>
            </variable>
            <variable name="RS">
              <type>
                <REAL />
              </type>
            </variable>
          </inputVars>
          <localVars>
            <variable name="RG">
              <type>
                <REAL />
              </type>
            </variable>
          </localVars>
        </interface>
        <body>
          <ST>
            IF current &lt;&gt; 0.0 THEN
	RG := voltage / current;
	SENSOR_INT := RP * ( RG - RS) / ( RP + RS - RG);
END_IF;

(* revisaion history

hm 20.1.2007		rev 1.1
	deleted input R0 which was not needed.

hm	2. dec 2007	rev 1.2
	corrected an error in formula and improoved speed

hm	11. mar. 2009	rev 1.3
	changed real constants to use dot syntax

*)
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>550175f3-6198-4ac3-a7ed-87f9b9903ea6</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="TEMP_NI" pouType="function">
        <interface>
          <returnType>
            <REAL />
          </returnType>
          <inputVars>
            <variable name="Res">
              <type>
                <REAL />
              </type>
            </variable>
            <variable name="R0">
              <type>
                <REAL />
              </type>
            </variable>
          </inputVars>
        </interface>
        <body>
          <ST>
            TEMP_NI := (SQRT(0.30085225 - 2.66E-3 * (R0 - Res)) - 0.5485) * 751.8796992;


(* revision history

hm 24.1.2007		rev 1.1
	deleted unused variable A, B, C

hm 10.9.2007		rev 1.2
	changed accuracy to 0.02 degrees to improove performace

hm 17. 12 2007	rev 1.3
	improovements for better performance and higher accuracy

hm	6. jan 2008	rev 1.4
	further performance improvement

hm	10. mar. 2009	rev 1.5
	removed nested comments

*)


          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>388f073d-c69d-4f15-8893-ad7bb97aaf4a</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="TEMP_NTC" pouType="function">
        <interface>
          <returnType>
            <REAL />
          </returnType>
          <inputVars>
            <variable name="RES">
              <type>
                <REAL />
              </type>
            </variable>
            <variable name="RN">
              <type>
                <REAL />
              </type>
            </variable>
            <variable name="B">
              <type>
                <REAL />
              </type>
            </variable>
          </inputVars>
        </interface>
        <body>
          <ST>
            IF res &gt; 0.0 THEN
	TEMP_NTC := B * 298.15 / (B + LN(RES / RN) * 298.15) -273.15;
END_IF;


(* revision history

hm 30. dec. 2008	rev 1.0
	original version

hm	11. mar. 2009	rev 1.1
	changed real constants to use dot syntax

*)
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>c78986d8-f077-4ae7-835f-fc741d07844f</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="TEMP_PT" pouType="function">
        <interface>
          <returnType>
            <REAL />
          </returnType>
          <inputVars>
            <variable name="Res">
              <type>
                <REAL />
              </type>
            </variable>
            <variable name="R0">
              <type>
                <REAL />
              </type>
            </variable>
          </inputVars>
          <localVars constant="true">
            <variable name="A">
              <type>
                <REAL />
              </type>
              <initialValue>
                <simpleValue value="0.0039083" />
              </initialValue>
            </variable>
            <variable name="B">
              <type>
                <REAL />
              </type>
              <initialValue>
                <simpleValue value="-5.775E-07" />
              </initialValue>
            </variable>
            <variable name="accuracy">
              <type>
                <REAL />
              </type>
              <initialValue>
                <simpleValue value="0.01" />
              </initialValue>
            </variable>
          </localVars>
          <localVars>
            <variable name="step">
              <type>
                <REAL />
              </type>
              <initialValue>
                <simpleValue value="50.0" />
              </initialValue>
            </variable>
            <variable name="X">
              <type>
                <REAL />
              </type>
            </variable>
            <variable name="Y">
              <type>
                <REAL />
              </type>
            </variable>
            <variable name="t1">
              <type>
                <REAL />
              </type>
            </variable>
            <variable name="pt">
              <type>
                <pointer>
                  <baseType>
                    <DWORD />
                  </baseType>
                </pointer>
              </type>
            </variable>
          </localVars>
        </interface>
        <body>
          <ST>
            X := A * R0;
Y := B * R0;
IF Res &gt;= R0 THEN
	t1 := X * X - 4.0 * Y * (R0 - Res);
	IF t1 &lt; 0.0 THEN
		TEMP_PT := 10000.0;
	ELSE
		TEMP_PT := (-X + SQRT(t1)) / (2.0 * Y);
	END_IF;
ELSE
	pt := ADR(step);
	(* since the formula cannot be solved this is a successive approximation *)
	TEMP_PT := -100.0;
	WHILE step &gt; accuracy DO
		(* test if result greater or less *)
		IF RES_PT(TEMP_PT, R0) &lt; res THEN TEMP_PT := TEMP_PT + step; ELSE TEMP_PT := TEMP_PT - step; END_IF;
		pt^ := pt^ - 8388608;  (* this is a super fast divide by 2 method for non floating point CPUs *)
		(* the alternative code: step := step * 0.5; *)
	END_WHILE;
END_IF;

(* revision history

rev 1.1 hm 24.1.2007	
	deleted unused variable C

rev 1.2 hm 10.9.2007
	reduced accuracy to 0.02 to shorten execution time

rev 1.3	hm	2. dec 2007
	changed code for better performance

rev	1.4	hm	23. dec 2007
	avoid a negative square root if input values are wrong

rev 1.5 hm	5. jan 2008
	replaced / 2 with * 0.5 for better performance

hm	31. oct. 2008	rev 1.6
	improved performance

hm	11. mar. 2009	rev 1.7
	changed real constants to use dot syntax

*)

          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>e92ab5a6-338e-4e20-ace4-7436c7d58a1e</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="TEMP_SI" pouType="function">
        <interface>
          <returnType>
            <REAL />
          </returnType>
          <inputVars>
            <variable name="Res">
              <type>
                <REAL />
              </type>
            </variable>
            <variable name="RS">
              <type>
                <REAL />
              </type>
            </variable>
            <variable name="TS">
              <type>
                <REAL />
              </type>
            </variable>
          </inputVars>
        </interface>
        <body>
          <ST>
            TEMP_SI := (-7.64E-3 + SQRT(Res / RS * 6.64E-5 - 0.803E-5)) * 30120.48193 + TS;



(* revision history

hm 24.1.2007		rev 1.1
	the function would only work for TS = 25, now it works for other values of ts.

hm 10.9.2007		rev 1.2
	changed the function to use successive approcimation to avoid an error generated by a sqrt from a negative result.
	changed accuracy to 0.02 degrees to shorten execution time

hm 17. 12 2007	rev 1.3
	improovements for better performance

hm	6. jan 2008	rev 1.4
	further performance improvement

hm	10. mar. 2009	rev 1.5
	removed nested comments

*)
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>f55f1364-792a-4265-856e-89ed09e6b2a9</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="_RMP_B" pouType="functionBlock">
        <interface>
          <inputVars>
            <variable name="DIR">
              <type>
                <BOOL />
              </type>
              <documentation>
                 true = up 
              </documentation>
            </variable>
            <variable name="E">
              <type>
                <BOOL />
              </type>
              <initialValue>
                <simpleValue value="TRUE" />
              </initialValue>
            </variable>
            <variable name="TR">
              <type>
                <TIME />
              </type>
            </variable>
          </inputVars>
          <inOutVars>
            <variable name="RMP">
              <type>
                <BYTE />
              </type>
            </variable>
          </inOutVars>
          <localVars>
            <variable name="tx">
              <type>
                <TIME />
              </type>
            </variable>
            <variable name="tl">
              <type>
                <TIME />
              </type>
            </variable>
            <variable name="tn">
              <type>
                <TIME />
              </type>
            </variable>
            <variable name="init">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="last_dir">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="start">
              <type>
                <BYTE />
              </type>
            </variable>
          </localVars>
        </interface>
        <body>
          <ST>
            (* read system timer *)
tx := DWORD_TO_TIME(T_PLC_MS());

IF E AND init AND (dir = last_dir) AND (RMP &lt;&gt; SEL(DIR, 0, 255)) AND TR = tn THEN
	RMP := FRMP_B(start, DIR, tx - tl, TR);
ELSE
	init := TRUE;
	tl := tx;
	tn := tr;
	start := RMP;
END_IF;
last_dir := dir;



(* revison history
hm	22. oct. 2008	rev 1.0
	original version

hm	20. nov. 2008	rev 1.1
	set default for E to be TRUE
	added init

hm	19. nov. 2011	rev 1.2
	new code
*)
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>95fdb066-abf6-4334-ba7a-4a2ec4182d3d</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="_RMP_NEXT" pouType="functionBlock">
        <interface>
          <inputVars>
            <variable name="E">
              <type>
                <BOOL />
              </type>
              <initialValue>
                <simpleValue value="TRUE" />
              </initialValue>
            </variable>
            <variable name="IN">
              <type>
                <BYTE />
              </type>
            </variable>
            <variable name="TR">
              <type>
                <TIME />
              </type>
            </variable>
            <variable name="TF">
              <type>
                <TIME />
              </type>
            </variable>
            <variable name="TL">
              <type>
                <TIME />
              </type>
            </variable>
          </inputVars>
          <outputVars>
            <variable name="DIR">
              <type>
                <BOOL />
              </type>
              <documentation>
                 upwards = TRUE 
              </documentation>
            </variable>
            <variable name="UP">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="DN">
              <type>
                <BOOL />
              </type>
            </variable>
          </outputVars>
          <inOutVars>
            <variable name="OUT">
              <type>
                <BYTE />
              </type>
            </variable>
          </inOutVars>
          <localVars>
            <variable name="rmx">
              <type>
                <derived name="_RMP_B" />
              </type>
            </variable>
            <variable name="dirx">
              <type>
                <derived name="TREND_DW" />
              </type>
            </variable>
            <variable name="t_lock">
              <type>
                <derived name="TP" />
              </type>
            </variable>
            <variable name="xen">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="xdir">
              <type>
                <BOOL />
              </type>
            </variable>
          </localVars>
        </interface>
        <body>
          <ST>
            dirx(X := in);

t_lock(in := FALSE, pt := TL);

IF dirx.TU AND (OUT &lt; IN) THEN
	IF NOT xdir AND xen THEN t_lock(in := TRUE); END_IF;
	xen := TRUE;
	xdir := TRUE;
ELSIF dirx.TD AND (OUT &gt; IN) THEN
	IF xdir AND xen THEN t_lock(in := TRUE); END_IF;
	xen := TRUE;
	xdir := FALSE;
ELSIF xen THEN
	IF (xdir AND (out &gt;= in)) OR (NOT xdir AND (out &lt;= in)) THEN
		xen := FALSE;
		IF tl &gt; t#0s THEN t_lock(IN := TRUE); END_IF;
	END_IF;
END_IF;

IF NOT t_lock.Q AND xen THEN
		UP := XDIR;
		DIR := XDIR;
		DN := NOT XDIR;
ELSE
	UP := FALSE;
	DN := FALSE;
END_IF;

rmx(rmp := OUT, E := E AND (UP OR DN) , dir := DIR, tr := SEL(dir, TF, TR));


(* revison history
hm	23. nov. 2008	rev 1.0
	original version

hm	24. jan. 2009	rev 1.1
	deleted unused vars tmp1, tmp2

hm	20. feb. 2009	rev 1.2
	improved algorithm
	added TL

hm	9. mar. 2009	rev 1.3
	input E was ignored
	removed double assignments

hm	18. jul. 2009	rev 1.4
	improved performance

*)
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>dd426063-eed2-448c-8e80-829b0e7a05d6</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="_RMP_W" pouType="functionBlock">
        <interface>
          <inputVars>
            <variable name="DIR">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="E">
              <type>
                <BOOL />
              </type>
              <initialValue>
                <simpleValue value="TRUE" />
              </initialValue>
            </variable>
            <variable name="TR">
              <type>
                <TIME />
              </type>
            </variable>
          </inputVars>
          <inOutVars>
            <variable name="RMP">
              <type>
                <WORD />
              </type>
            </variable>
          </inOutVars>
          <localVars>
            <variable name="tx">
              <type>
                <DWORD />
              </type>
            </variable>
            <variable name="tl">
              <type>
                <DWORD />
              </type>
            </variable>
            <variable name="step">
              <type>
                <DINT />
              </type>
            </variable>
            <variable name="init">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="last_dir">
              <type>
                <BOOL />
              </type>
            </variable>
          </localVars>
        </interface>
        <body>
          <ST>
            tx := T_PLC_MS();
IF E AND init THEN
	(* we need to set tl = tx when direction changes *)
	IF dir XOR last_dir THEN
	 tl := tx;
	 last_dir := dir;
	END_IF;
	(* check_elapsed time and calculate only if necessary *)
	IF tr &gt; t#0s THEN
		step := DWORD_TO_DINT(SHL(tx-tl, 16) / TIME_TO_DWORD(TR));
	ELSE
		step := 65535;
	END_IF;
	IF step &gt; 0 THEN
		(* perform the step on the ramp *)
		tl := tx;
		(* calculate the step response *)
		IF NOT dir THEN step := - step; END_IF;
		rmp := DINT_TO_WORD(LIMIT(0, WORD_TO_DINT(rmp) + step, 65535));
	END_IF;
ELSE
	tl := tx;
	init := TRUE;
END_IF;


(* revison history
hm	22. oct. 2008	rev 1.0
	original version

hm	20. nov. 2008	rev 1.1
	set default for E to be TRUE
	added init

*)
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>2a2bb920-b985-4133-a3d9-9bbcde681f82</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="GEN_PULSE" pouType="functionBlock">
        <interface>
          <inputVars>
            <variable name="ENQ">
              <type>
                <BOOL />
              </type>
              <initialValue>
                <simpleValue value="TRUE" />
              </initialValue>
            </variable>
            <variable name="PTH">
              <type>
                <TIME />
              </type>
            </variable>
            <variable name="PTL">
              <type>
                <TIME />
              </type>
            </variable>
          </inputVars>
          <outputVars>
            <variable name="Q">
              <type>
                <BOOL />
              </type>
            </variable>
          </outputVars>
          <localVars>
            <variable name="tx">
              <type>
                <TIME />
              </type>
            </variable>
            <variable name="tn">
              <type>
                <TIME />
              </type>
            </variable>
            <variable name="init">
              <type>
                <BOOL />
              </type>
            </variable>
          </localVars>
        </interface>
        <body>
          <ST>
            IF enq THEN
	tx := DWORD_TO_TIME(T_PLC_MS());
	IF NOT init THEN init := TRUE; tn := tx; END_IF;
	IF tx - tn &gt;= SEL(Q, PTL, PTH) THEN
		tn := tn + SEL(Q, PTL, PTH);
		Q := NOT Q;
	END_IF;
ELSE
	Q := FALSE;
	init := FALSE;
END_IF;



(* revision history
hm	29. jun. 2008	rev 1.0
	original version

hm	23. nov. 2008	rev 1.1
	set default for enq to be true

hm	18. jul. 2009	rev 1.2
	improved performance

hm	13. nov. 2009	rev 1.3
	corrected error

hm	16. feb. 2011	rev 1.4
	corrected an error when timer overflows

hm	8. apr. 2011	rev 1.5
	ptl and pth was exchanged
*)
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>011bbcad-e0c8-4867-8978-705090558c84</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="GEN_PW2" pouType="functionBlock">
        <interface>
          <inputVars>
            <variable name="ENQ">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="TH1">
              <type>
                <TIME />
              </type>
            </variable>
            <variable name="TL1">
              <type>
                <TIME />
              </type>
            </variable>
            <variable name="TH2">
              <type>
                <TIME />
              </type>
            </variable>
            <variable name="TL2">
              <type>
                <TIME />
              </type>
            </variable>
            <variable name="TS">
              <type>
                <BOOL />
              </type>
            </variable>
          </inputVars>
          <outputVars>
            <variable name="Q">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="TH">
              <type>
                <TIME />
              </type>
            </variable>
            <variable name="TL">
              <type>
                <TIME />
              </type>
            </variable>
          </outputVars>
          <localVars>
            <variable name="t_high">
              <type>
                <TIME />
              </type>
            </variable>
            <variable name="t_low">
              <type>
                <TIME />
              </type>
            </variable>
            <variable name="tx">
              <type>
                <TIME />
              </type>
            </variable>
            <variable name="start">
              <type>
                <TIME />
              </type>
            </variable>
            <variable name="init">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="et">
              <type>
                <TIME />
              </type>
            </variable>
          </localVars>
        </interface>
        <body>
          <ST>
            (* read system timer *)
tx := DWORD_TO_TIME(T_PLC_MS());

(* startup initialization *)
IF NOT init THEN
	start := tx;
	init := TRUE;
	TH := T#0s;
	TL := T#0s;
END_IF;

(* timing selection *)
IF TS THEN
	t_high := TH2;
	t_low := TL2;
ELSE
	t_high := TH1;
	t_low := TL1;
END_IF;

(* normal operation *)
IF ENQ THEN
	et := tx - start;
	IF NOT Q THEN
		IF et &gt;= t_low THEN
			Q := TRUE;
			start := tx;
			TL := T#0s;
		ELSE
			TL := et;
		END_IF;
	ELSE
		IF et &gt;= t_high THEN
			Q := FALSE;
			start := tx;
			TH := T#0s;
		ELSE
			TH := et;
		END_IF;
	END_IF;
ELSE
	Q := FALSE;
	TH := T#0s;
	TL := T#0s;
	start := tx;
END_IF;



(* revision history
hm	26. sep. 2008	rev 1.0
	original version

hm	14. mar. 2009	rev 1.1
	removed double assignments

*)
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>3331bc29-d285-448e-a878-6811964d5785</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="GEN_RDM" pouType="functionBlock">
        <interface>
          <inputVars>
            <variable name="PT">
              <type>
                <TIME />
              </type>
            </variable>
            <variable name="AM">
              <type>
                <REAL />
              </type>
              <initialValue>
                <simpleValue value="1" />
              </initialValue>
            </variable>
            <variable name="OS">
              <type>
                <REAL />
              </type>
            </variable>
          </inputVars>
          <outputVars>
            <variable name="Q">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="Out">
              <type>
                <REAL />
              </type>
            </variable>
          </outputVars>
          <localVars>
            <variable name="tx">
              <type>
                <TIME />
              </type>
            </variable>
            <variable name="last">
              <type>
                <TIME />
              </type>
            </variable>
            <variable name="init">
              <type>
                <BOOL />
              </type>
            </variable>
          </localVars>
        </interface>
        <body>
          <ST>
            (* read system time and prepare input data *)
tx := DWORD_TO_TIME(T_PLC_MS()) - last;

(* init section *)
IF NOT init THEN
	init := TRUE;
	last := tx;
	tx := t#0s;
END_IF;

(* add last if one cycle is finished *)
IF tx &gt;= pt THEN
	last := last + pt;
	tx := tx - pt;

	(* generate output signal *)
	out := am * (RDM(0) - 0.5) + os;
	q := TRUE;
ELSE
	q := FALSE;
END_IF;

(* revision history

hm	7.2.2007		rev 1.0
	original version

hm	16.9.2007		rev 1.1
	changes time() to T_plc_ms() for compatibility reasons

*)

          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>30d880bf-57c7-479a-948c-344f01190f0a</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="GEN_RDT" pouType="functionBlock">
        <interface>
          <inputVars>
            <variable name="Enable">
              <type>
                <BOOL />
              </type>
              <initialValue>
                <simpleValue value="TRUE" />
              </initialValue>
            </variable>
            <variable name="Min_Time_ms">
              <type>
                <TIME />
              </type>
              <initialValue>
                <simpleValue value="TIME#1s0ms" />
              </initialValue>
              <documentation>
                 min Taktzeit 
              </documentation>
            </variable>
            <variable name="Max_Time_ms">
              <type>
                <TIME />
              </type>
              <initialValue>
                <simpleValue value="TIME#1s200ms" />
              </initialValue>
              <documentation>
                 Max Taktzeit 
              </documentation>
            </variable>
            <variable name="TP_Q">
              <type>
                <TIME />
              </type>
              <initialValue>
                <simpleValue value="TIME#100ms" />
              </initialValue>
              <documentation>
                 Zeit Ausgang auf TRUE 
              </documentation>
            </variable>
          </inputVars>
          <outputVars>
            <variable name="xQ">
              <type>
                <BOOL />
              </type>
            </variable>
          </outputVars>
          <localVars>
            <variable name="tonRDMTimer">
              <type>
                <derived name="TON" />
              </type>
              <documentation>
                 Zeitbaustein Taktgenerator 
              </documentation>
            </variable>
            <variable name="tof_xQ">
              <type>
                <derived name="TOF" />
              </type>
              <documentation>
                 Ausschaltverzögerung Taktgenerator 
              </documentation>
            </variable>
            <variable name="tRDMTime">
              <type>
                <TIME />
              </type>
              <documentation>
                 Sollzeit 
              </documentation>
            </variable>
            <variable name="rRDMTime">
              <type>
                <REAL />
              </type>
              <documentation>
                 Zufalswert Timer 
              </documentation>
            </variable>
          </localVars>
        </interface>
        <body>
          <ST>
            tonRDMTimer ( IN:= Enable , PT:= tRDMTime );
tof_xQ ( IN:= tonRDMTimer.Q , PT:= TP_Q );
XQ := tof_xq.Q;
IF tonRDMTimer.Q THEN
		 xQ := TRUE ;
		 rRDMTime := RDM ( last:= rRDMTime ) ;
		 tRDMTime := REAL_TO_TIME ( rRDMTime * DINT_TO_REAL(TIME_TO_DINT( Max_Time_ms - Min_Time_ms ) + TIME_TO_DINT(Min_Time_ms ))) ;
		 tonRDMTimer ( IN:= FALSE );
END_IF;

(* revision history
J. Schohaus	19. nov 2007	rev 1.0
	origial version

hm	16. mar. 2008			rev 1.1
	added type conversion to avoid warnings under codesys 3.0
*)
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>8d5915a1-0496-430c-b935-e60c2c4cc59e</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="GEN_RMP" pouType="functionBlock">
        <interface>
          <inputVars>
            <variable name="PT">
              <type>
                <TIME />
              </type>
              <initialValue>
                <simpleValue value="TIME#1s0ms" />
              </initialValue>
            </variable>
            <variable name="AM">
              <type>
                <REAL />
              </type>
              <initialValue>
                <simpleValue value="1.0" />
              </initialValue>
            </variable>
            <variable name="OS">
              <type>
                <REAL />
              </type>
            </variable>
            <variable name="DL">
              <type>
                <REAL />
              </type>
            </variable>
          </inputVars>
          <outputVars>
            <variable name="Q">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="OUT">
              <type>
                <REAL />
              </type>
            </variable>
          </outputVars>
          <localVars>
            <variable name="tx">
              <type>
                <TIME />
              </type>
            </variable>
            <variable name="last">
              <type>
                <TIME />
              </type>
            </variable>
            <variable name="init">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="temp">
              <type>
                <REAL />
              </type>
            </variable>
            <variable name="ltemp">
              <type>
                <REAL />
              </type>
            </variable>
          </localVars>
        </interface>
        <body>
          <ST>
            (* read system time and prepare input data *)
tx := DWORD_TO_TIME(T_PLC_MS()) - last;
DL := MODR(dl,1.0);
IF dl &lt; 0.0 THEN dl := 1.0 - dl; END_IF;

(* init section *)
IF NOT init THEN
	init := TRUE;
	last := tx;
	tx := t#0s;
END_IF;

(* add last if one cycle is finished *)
IF tx &gt;= pt THEN
	last := last + pt;
	tx := tx - pt;
END_IF;

(* generate sine wave *)
ltemp := temp;
IF pt &gt; t#0s THEN temp := FRACT(TIME_TO_REAL(tx + MULTIME(pt, dl)) / TIME_TO_REAL(pt)); END_IF;
out := am * temp + os;

(* boolean output Q *)
Q := temp &lt; ltemp;

(* revision history
hm	3. mar 2007		rev 1.0
	original version

hm	17 sep 2007		rev 1.1
	replaced time() with t_plc_ms for compatibilitx reasons

hm	27. nov 2007	rev 1.2
	avoid divide by 0 when pt = 0

ks	26. oct. 2008	rev 1.3
	code optimization

hm	10. mar. 2009	rev 1.4
	changed real constants to use dot syntax
*)
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>48855b43-3cd4-4a41-ac81-61e9a65b2608</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="GEN_SIN" pouType="functionBlock">
        <interface>
          <inputVars>
            <variable name="PT">
              <type>
                <TIME />
              </type>
            </variable>
            <variable name="AM">
              <type>
                <REAL />
              </type>
              <initialValue>
                <simpleValue value="1.0" />
              </initialValue>
            </variable>
            <variable name="OS">
              <type>
                <REAL />
              </type>
            </variable>
            <variable name="DL">
              <type>
                <REAL />
              </type>
            </variable>
          </inputVars>
          <outputVars>
            <variable name="Q">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="Out">
              <type>
                <REAL />
              </type>
            </variable>
          </outputVars>
          <localVars>
            <variable name="tx">
              <type>
                <TIME />
              </type>
            </variable>
            <variable name="last">
              <type>
                <TIME />
              </type>
            </variable>
            <variable name="init">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="temp">
              <type>
                <REAL />
              </type>
            </variable>
          </localVars>
        </interface>
        <body>
          <ST>
            (* read system time and prepare input data *)
tx := DWORD_TO_TIME(T_PLC_MS()) - last;
DL := MODR(dl,1.0);
IF dl &lt; 0.0 THEN dl := 1.0 - dl; END_IF;

(* init section *)
IF NOT init THEN
	init := TRUE;
	last := tx;
	tx := t#0s;
END_IF;

(* add last if one cycle is finished *)
IF tx &gt;= pt THEN
	last := last + pt;
	tx := tx - pt;
END_IF;

(* generate sine wave *)
IF pt &gt; t#0s THEN temp := SIN(math.PI2 * DWORD_TO_REAL(TIME_TO_DWORD(tx + MULTIME(pt, dl))) / DWORD_TO_REAL(TIME_TO_DWORD(pt))); END_IF;
out := am * 0.5 *  temp + os;

(* boolean output Q *)
q := NOT SIGN_R(temp);

(* revision history
hm	22. jan 2007	rev 1.0
	original version

hm	17 sep 2007	rev 1.1
	replaced time() with t_plc_ms for compatibilitx reasons

hm	27. nov 2007	rev 1.2
	avoid divide by 0 when pt = 0

hm	6. jan 2008		rev 1.3
	improved performance

hm	16. mar. 2008	rev 1.4
	added type conversion to avoid warnings under codesys 3.0

hm	18. oct. 2008	rev 1.5
	using math constants

hm	11. mar. 2009	rev 1.6
	changed real constants to use dot syntax

*)
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>a50fd867-b327-4ffb-8452-75b7d81976f6</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="GEN_SQR" pouType="functionBlock">
        <interface>
          <inputVars>
            <variable name="PT">
              <type>
                <TIME />
              </type>
            </variable>
            <variable name="AM">
              <type>
                <REAL />
              </type>
              <initialValue>
                <simpleValue value="1.0" />
              </initialValue>
            </variable>
            <variable name="OS">
              <type>
                <REAL />
              </type>
            </variable>
            <variable name="DC">
              <type>
                <REAL />
              </type>
              <initialValue>
                <simpleValue value="0.5" />
              </initialValue>
            </variable>
            <variable name="DL">
              <type>
                <REAL />
              </type>
            </variable>
          </inputVars>
          <outputVars>
            <variable name="Q">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="Out">
              <type>
                <REAL />
              </type>
            </variable>
          </outputVars>
          <localVars>
            <variable name="tx">
              <type>
                <TIME />
              </type>
            </variable>
            <variable name="last">
              <type>
                <TIME />
              </type>
            </variable>
            <variable name="init">
              <type>
                <BOOL />
              </type>
            </variable>
          </localVars>
        </interface>
        <body>
          <ST>
            (* check dc = 1 or 0 *)
IF dc = 0.0 THEN
	out := -am * 0.5 + os;
	Q := FALSE;
	RETURN;
ELSIF dc = 1.0 THEN
	out := am * 0.5 + os;
	Q := TRUE;
	RETURN;
END_IF;

(* read system time and prepare input data *)
tx := DWORD_TO_TIME(T_PLC_MS()) - last;
DL := MODR(dl,1.0);
IF dl &lt; 0.0 THEN dl := 1.0 - dl; END_IF;
dc := MODR(dc,1.0);
IF dc &lt; 0.0 THEN dc := 1.0 - dc; END_IF;

(* init section *)
IF NOT init THEN
	init := TRUE;
	last := tx;
	tx := t#0s;
END_IF;

(* add last if one cycle is finished *)
IF tx &gt;= pt THEN
	last := last + pt;
	tx := tx - pt;
END_IF;

(* check if falling or rising edge first *)
IF MULTIME(pt, dl + dc) &gt;= pt THEN
	(* generate falling edge *)
	IF tx &gt;= MULTIME(pt, dl + dc - 1) THEN
		out := -am * 0.5 + os;
		Q := FALSE;
	END_IF;
	(* generate rising edge *)
	IF tx &gt;= MULTIME(pt, dl) THEN
		out := am * 0.5 + os;
		Q := TRUE;
	END_IF;
ELSE
	(* generate rising edge first *)
	IF tx &gt;= MULTIME(pt, dl) THEN
		out := am * 0.5 + os;
		Q := TRUE;
	END_IF;
	(* generate falling edge *)
	IF tx &gt;= MULTIME(pt, dl + dc) THEN
		out := -am * 0.5 +os;
		Q := FALSE;
	END_IF;
END_IF;

(* revision history

hm	12. feb 2007	rev 1.1
	added default value for dc = 0.5

hm	17 sep 2007	rev 1.2
	replaced time() with t_plc_ms for compatibilitx reasons

hm	6. jan 2008	rev 1.3
	improved performance

hm	11. mar. 2009	rev 1.4
	changed real constants to use dot syntax
	set default amplitude to 1.0

*)

          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>5902e8a2-a4a9-41ed-b260-5ebfb2a26829</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="PWM_DC" pouType="functionBlock">
        <interface>
          <inputVars>
            <variable name="F">
              <type>
                <REAL />
              </type>
            </variable>
            <variable name="DC">
              <type>
                <REAL />
              </type>
            </variable>
          </inputVars>
          <outputVars>
            <variable name="Q">
              <type>
                <BOOL />
              </type>
            </variable>
          </outputVars>
          <localVars>
            <variable name="clk">
              <type>
                <derived name="CLK_PRG" />
              </type>
            </variable>
            <variable name="pulse">
              <type>
                <derived name="TP_X" />
              </type>
            </variable>
            <variable name="tmp">
              <type>
                <REAL />
              </type>
            </variable>
          </localVars>
        </interface>
        <body>
          <ST>
            IF F &gt; 0.0 THEN
	tmp := 1000.0 / F;
	CLK(PT := REAL_TO_TIME(tmp));
	Pulse(in := clk.Q, pt := REAL_TO_TIME(tmp * DC));
	Q := pulse.Q;
END_IF;

(* revision history

hm	25. feb 2007	rev 1.1
	recoded in st for better performance and better portability

hm	27. nov 2007	rev 1.2
	avoid divide by 0 when F = 0

hm	19. oct. 2008	rev 1.3
	changed type TP_R to TP_X because of name change
	improved performance

hm	11. mar. 2009	rev 1.4
	changed real constants to use dot syntax

*)
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>38e956e7-7d49-481d-9fdb-6336901238f0</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="PWM_PW" pouType="functionBlock">
        <interface>
          <inputVars>
            <variable name="F">
              <type>
                <REAL />
              </type>
            </variable>
            <variable name="PW">
              <type>
                <TIME />
              </type>
            </variable>
          </inputVars>
          <outputVars>
            <variable name="Q">
              <type>
                <BOOL />
              </type>
            </variable>
          </outputVars>
          <localVars>
            <variable name="clk">
              <type>
                <derived name="CLK_PRG" />
              </type>
            </variable>
            <variable name="pulse">
              <type>
                <derived name="TP_X" />
              </type>
            </variable>
          </localVars>
        </interface>
        <body>
          <ST>
            IF F &gt; 0.0 THEN
	CLK(PT := REAL_TO_TIME(1000.0 / F));
	Pulse(in := clk.Q, pt := pw);
	Q := pulse.Q;
END_IF;

(* revision history

hm	25. feb 2007	rev 1.1
	recoded in st for better performance and better portability

hm	27. nov 2007	rev 1.2
	avoid divide by 0 when F = 0

hm	9. dec 2007		rev 1.3
	corrected an error with F = 0

hm	19. oct. 2008	rev 1.4
	changed type tp_r to TP_x brecause of name change

hm	11. mar. 2009	rev 1.5
	changed real constants to use dot syntax

*)
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>30b2b67b-8f81-4273-a051-93ce36324386</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="RMP_B" pouType="functionBlock">
        <interface>
          <inputVars>
            <variable name="SET">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="PT">
              <type>
                <TIME />
              </type>
            </variable>
            <variable name="E">
              <type>
                <BOOL />
              </type>
              <initialValue>
                <simpleValue value="TRUE" />
              </initialValue>
            </variable>
            <variable name="UP">
              <type>
                <BOOL />
              </type>
              <initialValue>
                <simpleValue value="TRUE" />
              </initialValue>
            </variable>
            <variable name="RST">
              <type>
                <BOOL />
              </type>
            </variable>
          </inputVars>
          <outputVars>
            <variable name="OUT">
              <type>
                <BYTE />
              </type>
            </variable>
            <variable name="BUSY">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="HIGH">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="LOW">
              <type>
                <BOOL />
              </type>
            </variable>
          </outputVars>
          <localVars>
            <variable name="rmp">
              <type>
                <derived name="_RMP_B" />
              </type>
            </variable>
          </localVars>
        </interface>
        <body>
          <ST>
            (* generate ramp *)
rmp(dir := UP, E := E, TR := PT, rmp := out);

(* set or reset operation *)
IF RST THEN
	out := 0;
ELSIF SET THEN
	out := 255;
END_IF;

(* checks for outputs stable and reset or set busy flag *)
low := out = 0;
high := out = 255;
busy := NOT (low OR high) AND E;


(* revision history

hm 5.10.2006	rev 1.1
	added busy output
hm 17.1.2007	rev 1.2
	renamed input ud to up for better usability
	deleted unused variable step

hm	17.9.2007		rev 1.3
	replaced time() with t_plc_ms() for compatibility reasons

hm	28. sep 2007	rev 1.4
	added outputs on and off
	busy is now disabled while en is false
	new coding for higher accuracy and performance

hm	5. oct 2007	rev 1.5
	added statements to allow for PT to be t#0s output jumps to max or min immediately

hm	25. dec 2007	rev 1.6
	improved code for better performance

hm	16. oct. 2008	rev 1.7
	improved code for better performance

hm	18. oct. 2008	rev 1.8
	added type conversion to avoid warnings
	changed input en to e for compatibility reasons

hm	23. oct. 2008	REV 	2.0
	new code using _RMP_B

*)
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>59437d51-0144-4ce1-99d7-29eddacb89d3</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="RMP_SOFT" pouType="functionBlock">
        <interface>
          <inputVars>
            <variable name="IN">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="VAL">
              <type>
                <BYTE />
              </type>
            </variable>
            <variable name="PT_ON">
              <type>
                <TIME />
              </type>
              <addData>
                <data name="http://www.3s-software.com/plcopenxml/attributes" handleUnknown="implementation">
                  <Attributes>
                    <Attribute Name="input_constant" Value="" />
                  </Attributes>
                </data>
              </addData>
            </variable>
            <variable name="PT_OFF">
              <type>
                <TIME />
              </type>
              <addData>
                <data name="http://www.3s-software.com/plcopenxml/attributes" handleUnknown="implementation">
                  <Attributes>
                    <Attribute Name="input_constant" Value="" />
                  </Attributes>
                </data>
              </addData>
            </variable>
          </inputVars>
          <outputVars>
            <variable name="OUT">
              <type>
                <BYTE />
              </type>
            </variable>
          </outputVars>
          <localVars>
            <variable name="rmp">
              <type>
                <derived name="_RMP_B" />
              </type>
            </variable>
            <variable name="tmp">
              <type>
                <BYTE />
              </type>
            </variable>
          </localVars>
        </interface>
        <body>
          <ST>
            tmp := SEL(in, 0, val);
IF tmp &gt; out THEN
	(* we need to ramp down *)
	rmp(dir := TRUE, E := TRUE, TR := PT_ON, rmp := out);
	(* make sure out does not surpass tmp *)
	out := MIN(out, tmp);
ELSIF tmp &lt; out THEN
	(* we need to ramp up *)
	rmp(dir := FALSE, E := TRUE, TR := PT_OFF, rmp := out);
	(* make sure out does not surpass tmp *)
	out := MAX(out, tmp);
ELSE
	(* no ramp necessary *)
	rmp(E := FALSE, rmp := out);
END_IF;


(* revision history

hm 22.1.2007	rev 1.1
	deleted unused variables X1 and I, X2 and X3

hm	17.9.2007	rev 1.2
	replaced time() with t_plc_ms() for compatibility reasons

hm	26. oct. 2008	2.0
	new code using _rmp_b
*)

          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>807a35a4-c67a-47c7-b690-0918c846b921</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="RMP_W" pouType="functionBlock">
        <interface>
          <inputVars>
            <variable name="SET">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="PT">
              <type>
                <TIME />
              </type>
            </variable>
            <variable name="E">
              <type>
                <BOOL />
              </type>
              <initialValue>
                <simpleValue value="TRUE" />
              </initialValue>
            </variable>
            <variable name="UP">
              <type>
                <BOOL />
              </type>
              <initialValue>
                <simpleValue value="TRUE" />
              </initialValue>
            </variable>
            <variable name="RST">
              <type>
                <BOOL />
              </type>
            </variable>
          </inputVars>
          <outputVars>
            <variable name="out">
              <type>
                <WORD />
              </type>
            </variable>
            <variable name="busy">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="high">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="low">
              <type>
                <BOOL />
              </type>
            </variable>
          </outputVars>
          <localVars>
            <variable name="rmp">
              <type>
                <derived name="_RMP_W" />
              </type>
            </variable>
          </localVars>
        </interface>
        <body>
          <ST>
            (* generate ramp *)
rmp(dir := UP, E := E, TR := PT, rmp := out);

(* set or reset operation *)
IF RST THEN
	out := 0;
ELSIF SET THEN
	out := 65535;
END_IF;

(* checks for outputs stable and reset or set busy flag *)
low := out = 0;
high := out = 65535;
busy := NOT (low OR high) AND E;


(* revision history:

hm 4.10.2006		rev 1.1
	added the busy output which signals that the ramp is running.

hm 22.1.2007		rev 1.2
	deleted unused variable step

hm	17.9.2007		rev 1.3
	replaced time() with t_plc_ms() for compatibility reasons

hm	28. sep 2007	rev 1.4
	added outputs on and off
	busy is now disabled while en is false
	new coding for higher accuracy and performance

hm	5. oct 2007	rev 1.5
	added statements to allow for PT to be t#0s output jumps to max or min immediately

hm	2. dec 2007	rev 1.6
	corrected an error in calculation of step response

hm	25. dec 2007	rev 1.7
	corrected an error while step response was too slow for fast rise times

hm	16. oct. 2008	rev 1.8
	improved performance

hm	18. oct. 2008	rev 1.9
	renamed inout EN to E for compatibility reasons

hm	23. oct. 2008	rev 2.0
	new code using _RMP_W
*)

          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>a102f575-1a1f-475a-956d-4dd588de5ca8</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="AIN" pouType="function">
        <interface>
          <returnType>
            <REAL />
          </returnType>
          <inputVars>
            <variable name="in">
              <type>
                <DWORD />
              </type>
            </variable>
            <variable name="Bits">
              <type>
                <BYTE />
              </type>
              <addData>
                <data name="http://www.3s-software.com/plcopenxml/attributes" handleUnknown="implementation">
                  <Attributes>
                    <Attribute Name="input_constant" Value="" />
                  </Attributes>
                </data>
              </addData>
            </variable>
            <variable name="sign">
              <type>
                <BYTE />
              </type>
              <initialValue>
                <simpleValue value="255" />
              </initialValue>
              <addData>
                <data name="http://www.3s-software.com/plcopenxml/attributes" handleUnknown="implementation">
                  <Attributes>
                    <Attribute Name="input_constant" Value="" />
                  </Attributes>
                </data>
              </addData>
            </variable>
            <variable name="low">
              <type>
                <REAL />
              </type>
              <addData>
                <data name="http://www.3s-software.com/plcopenxml/attributes" handleUnknown="implementation">
                  <Attributes>
                    <Attribute Name="input_constant" Value="" />
                  </Attributes>
                </data>
              </addData>
            </variable>
            <variable name="high">
              <type>
                <REAL />
              </type>
              <initialValue>
                <simpleValue value="10.0" />
              </initialValue>
              <addData>
                <data name="http://www.3s-software.com/plcopenxml/attributes" handleUnknown="implementation">
                  <Attributes>
                    <Attribute Name="input_constant" Value="" />
                  </Attributes>
                </data>
              </addData>
            </variable>
          </inputVars>
          <localVars constant="true">
            <variable name="ff">
              <type>
                <DWORD />
              </type>
              <initialValue>
                <simpleValue value="16#FFFFFFFF" />
              </initialValue>
            </variable>
          </localVars>
          <localVars>
            <variable name="temp1">
              <type>
                <DWORD />
              </type>
            </variable>
            <variable name="temp2">
              <type>
                <DWORD />
              </type>
            </variable>
            <variable name="sx">
              <type>
                <BOOL />
              </type>
            </variable>
          </localVars>
        </interface>
        <body>
          <ST>
            (* extract the sign bit *)
IF sign &lt; 32 THEN
	temp1 := SHR(in,sign);
	sx := temp1.0;
ELSE
	sx := FALSE;
END_IF;
temp1 := SHR(ff, 32-bits);
temp2 := in AND temp1;
AIN := (high - low) * DWORD_TO_REAL(temp2) / DWORD_TO_REAL(temp1) + low;
IF sx THEN AIN := -AIN; END_IF;

(* revision history
hm 18.8.2006	rev 1.1
	fixed an error with low value negative and high value 0.

hm 19.1.2007	rev 1.2
	fixed an error with sign bit.

hm	13.9.2007	rev 1.3
	changed code to avoid warning under codesys 2.8.1

hm	2. dec 2007	rev 1.4
	changed code for better performance

hm	16. mar 2008	rev 1.5
	added type conversions to avoid warnings under codesys 30
*)
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>1af2e7f1-5604-4c62-9d74-acbac61773b4</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="AIN1" pouType="functionBlock">
        <interface>
          <inputVars>
            <variable name="in">
              <type>
                <DWORD />
              </type>
            </variable>
            <variable name="sign_bit">
              <type>
                <INT />
              </type>
              <initialValue>
                <simpleValue value="255" />
              </initialValue>
              <addData>
                <data name="http://www.3s-software.com/plcopenxml/attributes" handleUnknown="implementation">
                  <Attributes>
                    <Attribute Name="input_constant" Value="" />
                  </Attributes>
                </data>
              </addData>
            </variable>
            <variable name="error_bit">
              <type>
                <INT />
              </type>
              <initialValue>
                <simpleValue value="255" />
              </initialValue>
              <addData>
                <data name="http://www.3s-software.com/plcopenxml/attributes" handleUnknown="implementation">
                  <Attributes>
                    <Attribute Name="input_constant" Value="" />
                  </Attributes>
                </data>
              </addData>
            </variable>
            <variable name="error_code_en">
              <type>
                <BOOL />
              </type>
              <addData>
                <data name="http://www.3s-software.com/plcopenxml/attributes" handleUnknown="implementation">
                  <Attributes>
                    <Attribute Name="input_constant" Value="" />
                  </Attributes>
                </data>
              </addData>
            </variable>
            <variable name="error_code">
              <type>
                <DWORD />
              </type>
              <addData>
                <data name="http://www.3s-software.com/plcopenxml/attributes" handleUnknown="implementation">
                  <Attributes>
                    <Attribute Name="input_constant" Value="" />
                  </Attributes>
                </data>
              </addData>
            </variable>
            <variable name="overflow_bit">
              <type>
                <INT />
              </type>
              <initialValue>
                <simpleValue value="255" />
              </initialValue>
              <addData>
                <data name="http://www.3s-software.com/plcopenxml/attributes" handleUnknown="implementation">
                  <Attributes>
                    <Attribute Name="input_constant" Value="" />
                  </Attributes>
                </data>
              </addData>
            </variable>
            <variable name="overflow_code_en">
              <type>
                <BOOL />
              </type>
              <addData>
                <data name="http://www.3s-software.com/plcopenxml/attributes" handleUnknown="implementation">
                  <Attributes>
                    <Attribute Name="input_constant" Value="" />
                  </Attributes>
                </data>
              </addData>
            </variable>
            <variable name="overflow_code">
              <type>
                <DWORD />
              </type>
              <addData>
                <data name="http://www.3s-software.com/plcopenxml/attributes" handleUnknown="implementation">
                  <Attributes>
                    <Attribute Name="input_constant" Value="" />
                  </Attributes>
                </data>
              </addData>
            </variable>
            <variable name="Bit_0">
              <type>
                <INT />
              </type>
              <addData>
                <data name="http://www.3s-software.com/plcopenxml/attributes" handleUnknown="implementation">
                  <Attributes>
                    <Attribute Name="input_constant" Value="" />
                  </Attributes>
                </data>
              </addData>
            </variable>
            <variable name="Bit_N">
              <type>
                <INT />
              </type>
              <initialValue>
                <simpleValue value="31" />
              </initialValue>
              <addData>
                <data name="http://www.3s-software.com/plcopenxml/attributes" handleUnknown="implementation">
                  <Attributes>
                    <Attribute Name="input_constant" Value="" />
                  </Attributes>
                </data>
              </addData>
            </variable>
            <variable name="out_min">
              <type>
                <REAL />
              </type>
              <addData>
                <data name="http://www.3s-software.com/plcopenxml/attributes" handleUnknown="implementation">
                  <Attributes>
                    <Attribute Name="input_constant" Value="" />
                  </Attributes>
                </data>
              </addData>
            </variable>
            <variable name="out_max">
              <type>
                <REAL />
              </type>
              <initialValue>
                <simpleValue value="10.0" />
              </initialValue>
              <addData>
                <data name="http://www.3s-software.com/plcopenxml/attributes" handleUnknown="implementation">
                  <Attributes>
                    <Attribute Name="input_constant" Value="" />
                  </Attributes>
                </data>
              </addData>
            </variable>
            <variable name="code_min">
              <type>
                <DWORD />
              </type>
              <addData>
                <data name="http://www.3s-software.com/plcopenxml/attributes" handleUnknown="implementation">
                  <Attributes>
                    <Attribute Name="input_constant" Value="" />
                  </Attributes>
                </data>
              </addData>
            </variable>
            <variable name="code_max">
              <type>
                <DWORD />
              </type>
              <initialValue>
                <simpleValue value="16#FFFFFFFF" />
              </initialValue>
              <addData>
                <data name="http://www.3s-software.com/plcopenxml/attributes" handleUnknown="implementation">
                  <Attributes>
                    <Attribute Name="input_constant" Value="" />
                  </Attributes>
                </data>
              </addData>
            </variable>
            <variable name="error_output">
              <type>
                <REAL />
              </type>
              <addData>
                <data name="http://www.3s-software.com/plcopenxml/attributes" handleUnknown="implementation">
                  <Attributes>
                    <Attribute Name="input_constant" Value="" />
                  </Attributes>
                </data>
              </addData>
            </variable>
            <variable name="overflow_output">
              <type>
                <REAL />
              </type>
              <initialValue>
                <simpleValue value="10.0" />
              </initialValue>
              <addData>
                <data name="http://www.3s-software.com/plcopenxml/attributes" handleUnknown="implementation">
                  <Attributes>
                    <Attribute Name="input_constant" Value="" />
                  </Attributes>
                </data>
              </addData>
            </variable>
          </inputVars>
          <outputVars>
            <variable name="out">
              <type>
                <REAL />
              </type>
            </variable>
            <variable name="sign">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="error">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="overflow">
              <type>
                <BOOL />
              </type>
            </variable>
          </outputVars>
          <localVars>
            <variable name="tB">
              <type>
                <DWORD />
              </type>
            </variable>
          </localVars>
        </interface>
        <body>
          <ST>
            (* extract error bit *)
error := ((SHR(in,error_bit) AND 16#0000_0001) = 1) OR (error_code_en AND error_code = in);
IF error THEN
	out := error_output;
	RETURN;
END_IF;

(* strip off the data input *)
tb := SHR(SHL(in, 31 - bit_N), 31 - bit_N + Bit_0);

(* extract overflow bit *)
overflow := ((SHR(in,overflow_bit) AND 16#0000_0001) = 1) OR (overflow_code_en AND overflow_code = in) OR (tb &lt; code_min OR tb &gt; code_max);
IF overflow THEN
	out := overflow_output;
	RETURN;
END_IF;

(* extract sign bit *)
sign := (SHR(in,sign_bit) AND 16#0000_0001) = 1;

(* convert in to out *)
out := (DWORD_TO_REAL(tb - code_min) * (out_max - out_min) / DWORD_TO_REAL(code_max - code_min) + out_min);
IF sign THEN out := out * -1.0; END_IF;



(* revision history
hm	23. feb 2008	rev 1.0
	original version

hm	16. mar 2008	rev 1.1
	added type conversions to avoid warnngs under codesys 30

hm	22. apr. 2008	rev 1.2
	corrected error in formula when code_min was set
	corrected error when sign bit was used
	optimized code for better performance

hm	10. mar. 2009	rev 1.3
	real constants updated to new systax using dot

*)
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>facbfccd-43a5-48c8-a915-c013be6e002f</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="AOUT" pouType="function">
        <interface>
          <returnType>
            <DWORD />
          </returnType>
          <inputVars>
            <variable name="in">
              <type>
                <REAL />
              </type>
            </variable>
            <variable name="Bits">
              <type>
                <BYTE />
              </type>
              <addData>
                <data name="http://www.3s-software.com/plcopenxml/attributes" handleUnknown="implementation">
                  <Attributes>
                    <Attribute Name="input_constant" Value="" />
                  </Attributes>
                </data>
              </addData>
            </variable>
            <variable name="sign">
              <type>
                <BYTE />
              </type>
              <initialValue>
                <simpleValue value="255" />
              </initialValue>
              <addData>
                <data name="http://www.3s-software.com/plcopenxml/attributes" handleUnknown="implementation">
                  <Attributes>
                    <Attribute Name="input_constant" Value="" />
                  </Attributes>
                </data>
              </addData>
            </variable>
            <variable name="low">
              <type>
                <REAL />
              </type>
              <addData>
                <data name="http://www.3s-software.com/plcopenxml/attributes" handleUnknown="implementation">
                  <Attributes>
                    <Attribute Name="input_constant" Value="" />
                  </Attributes>
                </data>
              </addData>
            </variable>
            <variable name="high">
              <type>
                <REAL />
              </type>
              <initialValue>
                <simpleValue value="10.0" />
              </initialValue>
              <addData>
                <data name="http://www.3s-software.com/plcopenxml/attributes" handleUnknown="implementation">
                  <Attributes>
                    <Attribute Name="input_constant" Value="" />
                  </Attributes>
                </data>
              </addData>
            </variable>
          </inputVars>
          <localVars constant="true">
            <variable name="ff">
              <type>
                <DWORD />
              </type>
              <initialValue>
                <simpleValue value="2#1" />
              </initialValue>
            </variable>
          </localVars>
          <localVars>
            <variable name="in2">
              <type>
                <REAL />
              </type>
            </variable>
            <variable name="sx">
              <type>
                <BOOL />
              </type>
            </variable>
          </localVars>
        </interface>
        <body>
          <ST>
            (* if sign bit is defined *)
IF sign &lt; 32 THEN
	sx := sign_R(in);
	in2 := ABS(in);
ELSE
	in2 := in;
END_IF;

(* begrenze in auf die zulässigen werte *)
in2 := LIMIT(low, in2, high);

(* Berechne den Ausgangswert *)
Aout := REAL_TO_DWORD((in2 - low) / (high - low) * DWORD_TO_REAL(SHL(ff,bits) -1));
IF sx THEN Aout := SHL(ff,sign) OR Aout; END_IF;

(*
revision history

hm 18.1.2007		rev 1.1
	renamed Modul to aout.
	changed Output to 32 Bit max.
	corrected error with sign bit.

hm	13.9.2007		rev 1.2
	changed code to avoid warning under codesys 2.8.1

hm	2. dec 2007		rev 1.3
	changed code for better performance

hm	23. feb 2008	rev 1.4
	changed code for better performance
*)
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>82b34952-f1d9-43ca-bbe8-243319457b8f</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="AOUT1" pouType="function">
        <interface>
          <returnType>
            <DWORD />
          </returnType>
          <inputVars>
            <variable name="in">
              <type>
                <REAL />
              </type>
            </variable>
            <variable name="Bit_0">
              <type>
                <INT />
              </type>
              <addData>
                <data name="http://www.3s-software.com/plcopenxml/attributes" handleUnknown="implementation">
                  <Attributes>
                    <Attribute Name="input_constant" Value="" />
                  </Attributes>
                </data>
              </addData>
            </variable>
            <variable name="Bit_N">
              <type>
                <INT />
              </type>
              <initialValue>
                <simpleValue value="31" />
              </initialValue>
              <addData>
                <data name="http://www.3s-software.com/plcopenxml/attributes" handleUnknown="implementation">
                  <Attributes>
                    <Attribute Name="input_constant" Value="" />
                  </Attributes>
                </data>
              </addData>
            </variable>
            <variable name="sign">
              <type>
                <INT />
              </type>
              <initialValue>
                <simpleValue value="255" />
              </initialValue>
              <addData>
                <data name="http://www.3s-software.com/plcopenxml/attributes" handleUnknown="implementation">
                  <Attributes>
                    <Attribute Name="input_constant" Value="" />
                  </Attributes>
                </data>
              </addData>
            </variable>
            <variable name="low">
              <type>
                <REAL />
              </type>
              <addData>
                <data name="http://www.3s-software.com/plcopenxml/attributes" handleUnknown="implementation">
                  <Attributes>
                    <Attribute Name="input_constant" Value="" />
                  </Attributes>
                </data>
              </addData>
            </variable>
            <variable name="high">
              <type>
                <REAL />
              </type>
              <initialValue>
                <simpleValue value="10.0" />
              </initialValue>
              <addData>
                <data name="http://www.3s-software.com/plcopenxml/attributes" handleUnknown="implementation">
                  <Attributes>
                    <Attribute Name="input_constant" Value="" />
                  </Attributes>
                </data>
              </addData>
            </variable>
          </inputVars>
          <localVars constant="true">
            <variable name="ff">
              <type>
                <DWORD />
              </type>
              <initialValue>
                <simpleValue value="2#1" />
              </initialValue>
            </variable>
          </localVars>
          <localVars>
            <variable name="sx">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="in2">
              <type>
                <REAL />
              </type>
            </variable>
          </localVars>
        </interface>
        <body>
          <ST>
            (* if sign bit is defined *)
IF sign &lt; 32 THEN
	sx := SIGN_R(in);
	in2 := ABS(in);
ELSE
	in2 := in;
END_IF;

(* begrenze in auf die zulässigen werte *)
in2 := LIMIT(low, in2, high);

(* Berechne den Ausgangswert *)
AOUT1 := SHL(REAL_TO_DWORD((in2 - low) / (high - low) * DWORD_TO_REAL(SHL(ff,bit_n - Bit_0 + 1) -1)),Bit_0);
IF sx THEN AOUT1 := SHL(ff,sign) OR AOUT1; END_IF;


(* revision history
hm	23. feb 2008	rev 1.0
	original version

*)
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>961ad391-164b-401e-8887-26a7de9fbef4</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="BYTE_TO_RANGE" pouType="function">
        <interface>
          <returnType>
            <REAL />
          </returnType>
          <inputVars>
            <variable name="X">
              <type>
                <BYTE />
              </type>
            </variable>
            <variable name="low">
              <type>
                <REAL />
              </type>
            </variable>
            <variable name="high">
              <type>
                <REAL />
              </type>
            </variable>
          </inputVars>
        </interface>
        <body>
          <ST>
            BYTE_TO_RANGE := (high - low) * X / 255.0 + low;


(* revision history
hm	9. jan 2008		rev 1.0
	original version

*)

          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>a01389e1-cbf6-4502-b4de-83a652e66dcc</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="DELAY" pouType="functionBlock">
        <interface>
          <inputVars>
            <variable name="IN">
              <type>
                <REAL />
              </type>
            </variable>
            <variable name="N">
              <type>
                <INT />
              </type>
            </variable>
            <variable name="RST">
              <type>
                <BOOL />
              </type>
            </variable>
          </inputVars>
          <outputVars>
            <variable name="OUT">
              <type>
                <REAL />
              </type>
            </variable>
          </outputVars>
          <localVars>
            <variable name="buf">
              <type>
                <array>
                  <dimension lower="0" upper="31" />
                  <baseType>
                    <REAL />
                  </baseType>
                </array>
              </type>
            </variable>
            <variable name="i">
              <type>
                <INT />
              </type>
            </variable>
            <variable name="init">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="stop">
              <type>
                <INT />
              </type>
            </variable>
          </localVars>
        </interface>
        <body>
          <ST>
            stop := LIMIT(0,N,32) - 1;
IF rst OR NOT init THEN
	init := TRUE;
	FOR i := 0 TO stop DO buf[i] := in; END_FOR;
	out := in;
	i := 0;
ELSIF stop &lt; 0 THEN
	out := in;
ELSE
	out := buf[i];
	buf[i] := in;
	i := INC1(i, N);
END_IF;



(* revision history
hm 1.10.2006		rev 1.1
	corrected error in buffer management

hm 19.1.2007		rev 1.2
	changed reset to load the value of in instead of 0

hm	27. oct. 2008	rev 1.3
	improved performance

hm	23. feb.2009	rev 1.4
	corrected an index problem

hm	23. mar. 2009	rev 1.5
	corrected non standard write to input N

*)
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>88ec695b-0186-4237-8cc2-078f997e1678</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="DELAY_4" pouType="functionBlock">
        <interface>
          <inputVars>
            <variable name="in">
              <type>
                <REAL />
              </type>
            </variable>
          </inputVars>
          <outputVars>
            <variable name="out1">
              <type>
                <REAL />
              </type>
            </variable>
            <variable name="out2">
              <type>
                <REAL />
              </type>
            </variable>
            <variable name="out3">
              <type>
                <REAL />
              </type>
            </variable>
            <variable name="out4">
              <type>
                <REAL />
              </type>
            </variable>
          </outputVars>
          <localVars>
            <variable name="temp">
              <type>
                <REAL />
              </type>
            </variable>
          </localVars>
        </interface>
        <body>
          <ST>
            out4 := out3;
out3 := out2;
out2 := out1;
out1 := temp;
temp := in;

(* revision history

hm 19.1.2007	rev 1.1
	added variable temp to add 1 delay  for q1

*)
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>ed327841-b07c-45da-97b7-229a4d24136b</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="FADE" pouType="functionBlock">
        <interface>
          <inputVars>
            <variable name="IN1">
              <type>
                <REAL />
              </type>
            </variable>
            <variable name="IN2">
              <type>
                <REAL />
              </type>
            </variable>
            <variable name="F">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="TF">
              <type>
                <TIME />
              </type>
            </variable>
            <variable name="rst">
              <type>
                <BOOL />
              </type>
            </variable>
          </inputVars>
          <outputVars>
            <variable name="Y">
              <type>
                <REAL />
              </type>
            </variable>
          </outputVars>
          <localVars>
            <variable name="rmx">
              <type>
                <derived name="RMP_W" />
              </type>
            </variable>
          </localVars>
        </interface>
        <body>
          <ST>
            rmx(rst := rst AND NOT F, set := rst AND F, pt := TF, up := F);
Y := (in2 - In1) / 65535.0 * WORD_TO_REAL(rmx.out) + in1;


(* code for rev 1.1
IF rst THEN
	rmx(set := F, rst := NOT F);
ELSIF F AND (NOT rmx.high) THEN
	rmx(PT := TF, UP := TRUE, e := TRUE, rst := FALSE, set := FALSE);
ELSIF (NOT F) AND (NOT rmx.low) THEN
	rmx(PT := TF, UP := FALSE, e := TRUE, rst := FALSE, set := FALSE);
ELSE
	rmx(e := FALSE, rst := FALSE, set := FALSE);
END_IF;
Y := (WORD_TO_REAL(rmx.out) * in1 + WORD_TO_REAL(FF - rmx.out) * IN2) / FF;
*)


(* revision history
hm	26. dec 2007	rev 1.0
	original version

hm	18. oct. 2008	rev 1.1
	improved performance
	changed calls for rmp_w because rmp_w has chaged

hm	17. dec. 2008	rev 1.2
	function of input f was inverted

hm	24. jan. 2009	rev 1.3
	delted unused var FF
*)
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>88248092-b784-491b-956b-b1c5e5fbb9d0</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="FILTER_DW" pouType="functionBlock">
        <interface>
          <inputVars>
            <variable name="X">
              <type>
                <DWORD />
              </type>
            </variable>
            <variable name="T">
              <type>
                <TIME />
              </type>
            </variable>
          </inputVars>
          <outputVars>
            <variable name="Y">
              <type>
                <DWORD />
              </type>
            </variable>
          </outputVars>
          <localVars>
            <variable name="last">
              <type>
                <DWORD />
              </type>
            </variable>
            <variable name="tx">
              <type>
                <DWORD />
              </type>
            </variable>
            <variable name="init">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="Yi">
              <type>
                <REAL />
              </type>
            </variable>
          </localVars>
        </interface>
        <body>
          <ST>
            (* read system time *)
tx := T_PLC_MS();

(* startup initialisation *)
IF NOT init OR T = t#0s THEN
	init := TRUE;
	Yi := DWORD_TO_REAL(X);
ELSE
	Yi := Yi + (DWORD_TO_REAL(X) - DWORD_TO_REAL(Y)) * DWORD_TO_REAL(tx - last) / TIME_TO_REAL(T);
END_IF;
last := tx;

Y := REAL_TO_DWORD(Yi);



(*
hm 10. oct. 2008	rev 1.0
	original version

hm	3. nov. 2008	REV 1.1
	corrected an overflow problem
*)
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>86ccc837-1801-4e82-8ac6-0e1bd81012da</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="FILTER_I" pouType="functionBlock">
        <interface>
          <inputVars>
            <variable name="X">
              <type>
                <INT />
              </type>
            </variable>
            <variable name="T">
              <type>
                <TIME />
              </type>
            </variable>
          </inputVars>
          <outputVars>
            <variable name="Y">
              <type>
                <INT />
              </type>
            </variable>
          </outputVars>
          <localVars>
            <variable name="Yi">
              <type>
                <DINT />
              </type>
            </variable>
            <variable name="last">
              <type>
                <DWORD />
              </type>
            </variable>
            <variable name="tx">
              <type>
                <DWORD />
              </type>
            </variable>
            <variable name="init">
              <type>
                <BOOL />
              </type>
            </variable>
          </localVars>
        </interface>
        <body>
          <ST>
            (* read system time *)
tx := T_PLC_MS();

(* startup initialisation *)
IF NOT init OR T = t#0s THEN
	init := TRUE;
	Yi := INT_TO_DINT(X) * 1000;
ELSE
	(* to increase accuracy of the filter we calculate internal Yi wich is Y * 1000 *)
	Yi := Yi + INT_TO_DINT(X - Y) * DWORD_TO_DINT(tx - last) * 1000 / TIME_TO_DINT(T);
END_IF;
last := tx;
Y := DINT_TO_INT(yi / 1000);



(*
hm 8. nov. 2008	rev 1.0
	original version

*)
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>fe23fb4f-8761-48f4-8d74-17bd307dc8b0</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="FILTER_MAV_DW" pouType="functionBlock">
        <interface>
          <inputVars>
            <variable name="X">
              <type>
                <DWORD />
              </type>
            </variable>
            <variable name="N">
              <type>
                <UINT />
              </type>
            </variable>
            <variable name="RST">
              <type>
                <BOOL />
              </type>
            </variable>
          </inputVars>
          <outputVars>
            <variable name="Y">
              <type>
                <DWORD />
              </type>
            </variable>
          </outputVars>
          <localVars>
            <variable name="init">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="buffer">
              <type>
                <array>
                  <dimension lower="0" upper="31" />
                  <baseType>
                    <DWORD />
                  </baseType>
                </array>
              </type>
            </variable>
            <variable name="i">
              <type>
                <INT />
              </type>
            </variable>
          </localVars>
          <tempVars>
            <variable name="tmp">
              <type>
                <INT />
              </type>
            </variable>
          </tempVars>
        </interface>
        <body>
          <ST>
            (* limit N to size of buffer *)
N := MIN(N, 32);

(* startup initialisation *)
IF NOT init OR rst OR N = 0 THEN
	init := TRUE;
	tmp := UINT_TO_INT(N)-1;
	FOR i := 0 TO tmp DO
		buffer[i] := X;
	END_FOR;
	Y := X;
ELSE
	tmp := UINT_TO_INT(N);
	i := INC1(i, tmp);
	Y := Y + (X - buffer[i]) / N;
	buffer[i] := X;
END_IF;




(*
hm 13. oct. 2008	rev 1.0
	original version

hm	27. oct. 2008	rev 1.1
	added typecast to avoid warnings

hm	24. nov. 2008	rev 1.2
	added typecasts to avoid warnings
	avoid divide by 0 if N = 0

hm	23. feb. 2009	rev 1.3
	limit N to max array size

*)
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>879cafa8-36b8-40ee-8ee0-1ae6d0e60d92</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="FILTER_MAV_W" pouType="functionBlock">
        <interface>
          <inputVars>
            <variable name="X">
              <type>
                <WORD />
              </type>
            </variable>
            <variable name="N">
              <type>
                <UINT />
              </type>
            </variable>
            <variable name="RST">
              <type>
                <BOOL />
              </type>
            </variable>
          </inputVars>
          <outputVars>
            <variable name="Y">
              <type>
                <WORD />
              </type>
            </variable>
          </outputVars>
          <localVars>
            <variable name="init">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="buffer">
              <type>
                <array>
                  <dimension lower="1" upper="32" />
                  <baseType>
                    <WORD />
                  </baseType>
                </array>
              </type>
            </variable>
            <variable name="i">
              <type>
                <INT />
              </type>
            </variable>
            <variable name="sum">
              <type>
                <DWORD />
              </type>
            </variable>
          </localVars>
          <tempVars>
            <variable name="tmp">
              <type>
                <INT />
              </type>
            </variable>
          </tempVars>
        </interface>
        <body>
          <ST>
            (* limit N to size of buffer *)
N := MIN(N, 32);

(* startup initialisation *)
IF NOT init OR rst OR N = 0 THEN
	init := TRUE;
	tmp := UINT_TO_INT(N) - 1;
	FOR i := 1 TO tmp DO
		buffer[i] := X;
	END_FOR;
	sum := Y * N;
	Y := X;
ELSE
	tmp := UINT_TO_INT(N);
	i := INC1(i, tmp);
	sum := sum + X - buffer[i];
	Y := DWORD_TO_WORD(sum / N);
	buffer[i] := X;
END_IF;



(*
hm 13. oct. 2008	rev 1.0
	original version

hm	18. oct. 2008	rev 1.1
	added typecast to avoid warnings

hm	24. nov. 2008	rev 1.2
	added typecasts to avoid warnings
	avoid devide by 0 if N = 0

hm	23. feb. 2009	rev 1.3
	limit N to max array size

hm	26. mar. 2011	rev 1.4
	corrected error in calculation
*)
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>3621cafa-8653-41f9-adba-7276b341b541</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="FILTER_W" pouType="functionBlock">
        <interface>
          <inputVars>
            <variable name="X">
              <type>
                <WORD />
              </type>
            </variable>
            <variable name="T">
              <type>
                <TIME />
              </type>
            </variable>
          </inputVars>
          <outputVars>
            <variable name="Y">
              <type>
                <WORD />
              </type>
            </variable>
          </outputVars>
          <localVars>
            <variable name="last">
              <type>
                <DWORD />
              </type>
            </variable>
            <variable name="tx">
              <type>
                <DWORD />
              </type>
            </variable>
            <variable name="init">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="tmp">
              <type>
                <DWORD />
              </type>
            </variable>
          </localVars>
        </interface>
        <body>
          <ST>
            (* read system time *)
tx := T_PLC_MS();

(* startup initialisation *)
IF NOT init OR T = T#0s THEN
	init := TRUE;
	last := tx;
	Y := X;
ELSIF Y = X THEN
	last := tx;
ELSE
	tmp :=  WORD_TO_DWORD(X - Y) * (tx - last) / TIME_TO_DWORD(T);
	IF tmp &lt;&gt; 0 THEN
		Y := DINT_TO_WORD(WORD_TO_DINT(Y) + DWORD_TO_DINT(tmp));
		last := tx;
	END_IF;
END_IF;

(*
hm 10. oct. 2008	rev 1.0
	original version

hm	3. nov. 2008	rev 1.1
	fixed overflow problem in formula

hm	25. jan. 2011	rev 1.2
	fixed error in formula
*)
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>70876b4c-3000-4912-ad63-6c6117176a34</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="FILTER_WAV" pouType="functionBlock">
        <interface>
          <inputVars>
            <variable name="X">
              <type>
                <REAL />
              </type>
            </variable>
            <variable name="W">
              <type>
                <array>
                  <dimension lower="0" upper="15" />
                  <baseType>
                    <REAL />
                  </baseType>
                </array>
              </type>
            </variable>
            <variable name="RST">
              <type>
                <BOOL />
              </type>
            </variable>
          </inputVars>
          <outputVars>
            <variable name="Y">
              <type>
                <REAL />
              </type>
            </variable>
          </outputVars>
          <localVars>
            <variable name="init">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="buffer">
              <type>
                <array>
                  <dimension lower="0" upper="15" />
                  <baseType>
                    <REAL />
                  </baseType>
                </array>
              </type>
            </variable>
            <variable name="i">
              <type>
                <INT />
              </type>
            </variable>
            <variable name="n">
              <type>
                <INT />
              </type>
            </variable>
          </localVars>
        </interface>
        <body>
          <ST>
            (* startup initialisation *)
IF NOT init OR rst THEN
	init := TRUE;
	FOR i := 0 TO 15 DO
		buffer[i] := X;
	END_FOR;
	i := 15;
	Y := X;
ELSE
	i := INC1(i, 16);
	buffer[i] := X;
END_IF;

(* calculate the weighted average *)
Y := 0.0;
FOR n := 0 TO 15 DO
	Y := buffer[i] * W[n] + Y;
	i := DEC1(i, 16);
END_FOR;


(*
hm 	14. oct. 2008	rev 1.0
	original version

hm	27. oct. 2008	rev 1.1
	changed _DEC and _INC to DEC1 and INC1

hm	10. mar. 2009	rev 1.2
	real constants updated to new systax using dot

*)

          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>1d612143-fe65-4dcd-8639-00ec538b5e0d</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="MIX" pouType="function">
        <interface>
          <returnType>
            <REAL />
          </returnType>
          <inputVars>
            <variable name="A">
              <type>
                <REAL />
              </type>
            </variable>
            <variable name="B">
              <type>
                <REAL />
              </type>
            </variable>
            <variable name="M">
              <type>
                <REAL />
              </type>
            </variable>
          </inputVars>
        </interface>
        <body>
          <ST>
            MIX := (1.0 - M) * A + M * B;

(* revision history
hm	19. Nov 2007	rev 1.0
	original version

hm	10. mar 2009	rev 1.1
	real constants updated to new systax using dot

*)
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>aeef9a49-69eb-4040-9528-01f1eb8f1a76</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="MUX_R2" pouType="function">
        <interface>
          <returnType>
            <REAL />
          </returnType>
          <inputVars>
            <variable name="IN0">
              <type>
                <REAL />
              </type>
            </variable>
            <variable name="IN1">
              <type>
                <REAL />
              </type>
            </variable>
            <variable name="A">
              <type>
                <BOOL />
              </type>
            </variable>
          </inputVars>
        </interface>
        <body>
          <ST>
            MUX_R2 := SEL(A, IN0, IN1);


(* revision history
hm	19. jan. 2007	rev 1.0
	original version

hm	16. oct. 2008	rev 1.1
	improved performance


*)
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>e7f3aac2-a455-49ba-b497-b6953b1d2c64</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="MUX_R4" pouType="function">
        <interface>
          <returnType>
            <REAL />
          </returnType>
          <inputVars>
            <variable name="IN0">
              <type>
                <REAL />
              </type>
            </variable>
            <variable name="IN1">
              <type>
                <REAL />
              </type>
            </variable>
            <variable name="IN2">
              <type>
                <REAL />
              </type>
            </variable>
            <variable name="IN3">
              <type>
                <REAL />
              </type>
            </variable>
            <variable name="A0">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="A1">
              <type>
                <BOOL />
              </type>
            </variable>
          </inputVars>
        </interface>
        <body>
          <ST>
            IF A1 THEN
	MUX_R4 := SEL(A0, IN2, IN3);
ELSE
	MUX_R4 := SEL(A0, IN0, IN1);
END_IF;



(* revision history
hm	19. jan 2007	rev 1.0
	original version

hm	16. oct. 2008	rev 1.1
	improved performance
*)
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>dafcebcd-a10b-4a05-92a5-47377f379490</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="OFFSET" pouType="function">
        <interface>
          <returnType>
            <REAL />
          </returnType>
          <inputVars>
            <variable name="X">
              <type>
                <REAL />
              </type>
            </variable>
            <variable name="O1">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="O2">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="O3">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="O4">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="D">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="Offset_1">
              <type>
                <REAL />
              </type>
              <addData>
                <data name="http://www.3s-software.com/plcopenxml/attributes" handleUnknown="implementation">
                  <Attributes>
                    <Attribute Name="input_constant" Value="" />
                  </Attributes>
                </data>
              </addData>
            </variable>
            <variable name="Offset_2">
              <type>
                <REAL />
              </type>
              <addData>
                <data name="http://www.3s-software.com/plcopenxml/attributes" handleUnknown="implementation">
                  <Attributes>
                    <Attribute Name="input_constant" Value="" />
                  </Attributes>
                </data>
              </addData>
            </variable>
            <variable name="Offset_3">
              <type>
                <REAL />
              </type>
              <addData>
                <data name="http://www.3s-software.com/plcopenxml/attributes" handleUnknown="implementation">
                  <Attributes>
                    <Attribute Name="input_constant" Value="" />
                  </Attributes>
                </data>
              </addData>
            </variable>
            <variable name="Offset_4">
              <type>
                <REAL />
              </type>
              <addData>
                <data name="http://www.3s-software.com/plcopenxml/attributes" handleUnknown="implementation">
                  <Attributes>
                    <Attribute Name="input_constant" Value="" />
                  </Attributes>
                </data>
              </addData>
            </variable>
            <variable name="default">
              <type>
                <REAL />
              </type>
              <addData>
                <data name="http://www.3s-software.com/plcopenxml/attributes" handleUnknown="implementation">
                  <Attributes>
                    <Attribute Name="input_constant" Value="" />
                  </Attributes>
                </data>
              </addData>
            </variable>
          </inputVars>
        </interface>
        <body>
          <ST>
            IF D THEN OFFSET := default; ELSE OFFSET := X; END_IF;
IF O1 THEN OFFSET := OFFSET + offset_1; END_IF;
IF O2 THEN OFFSET := OFFSET + offset_2; END_IF;
IF O3 THEN OFFSET := OFFSET + offset_3; END_IF;
IF O4 THEN OFFSET := OFFSET + offset_4; END_IF;



(* revision history
hm	12. jan 2007
	original version


*)
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>0c9917f5-6fd4-436f-838a-b8f618d96322</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="OFFSET2" pouType="function">
        <interface>
          <returnType>
            <REAL />
          </returnType>
          <inputVars>
            <variable name="X">
              <type>
                <REAL />
              </type>
            </variable>
            <variable name="O1">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="O2">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="O3">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="O4">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="D">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="Offset_1">
              <type>
                <REAL />
              </type>
              <addData>
                <data name="http://www.3s-software.com/plcopenxml/attributes" handleUnknown="implementation">
                  <Attributes>
                    <Attribute Name="input_constant" Value="" />
                  </Attributes>
                </data>
              </addData>
            </variable>
            <variable name="Offset_2">
              <type>
                <REAL />
              </type>
              <addData>
                <data name="http://www.3s-software.com/plcopenxml/attributes" handleUnknown="implementation">
                  <Attributes>
                    <Attribute Name="input_constant" Value="" />
                  </Attributes>
                </data>
              </addData>
            </variable>
            <variable name="Offset_3">
              <type>
                <REAL />
              </type>
              <addData>
                <data name="http://www.3s-software.com/plcopenxml/attributes" handleUnknown="implementation">
                  <Attributes>
                    <Attribute Name="input_constant" Value="" />
                  </Attributes>
                </data>
              </addData>
            </variable>
            <variable name="Offset_4">
              <type>
                <REAL />
              </type>
              <addData>
                <data name="http://www.3s-software.com/plcopenxml/attributes" handleUnknown="implementation">
                  <Attributes>
                    <Attribute Name="input_constant" Value="" />
                  </Attributes>
                </data>
              </addData>
            </variable>
            <variable name="default">
              <type>
                <REAL />
              </type>
              <addData>
                <data name="http://www.3s-software.com/plcopenxml/attributes" handleUnknown="implementation">
                  <Attributes>
                    <Attribute Name="input_constant" Value="" />
                  </Attributes>
                </data>
              </addData>
            </variable>
          </inputVars>
        </interface>
        <body>
          <ST>
            IF D THEN OFFSET2 := default; ELSE OFFSET2 := X; END_IF;
IF O4 THEN OFFSET2 := OFFSET2 + offset_4;
ELSIF O3 THEN OFFSET2 := OFFSET2 + offset_3;
ELSIF O2 THEN OFFSET2 := OFFSET2 + offset_2;
ELSIF O1 THEN OFFSET2 := OFFSET2 + offset_1;
END_IF;
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>b1b14946-b5f7-4dd4-83dd-0f600eecb24f</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="OVERRIDE" pouType="function">
        <interface>
          <returnType>
            <REAL />
          </returnType>
          <inputVars>
            <variable name="X1">
              <type>
                <REAL />
              </type>
            </variable>
            <variable name="X2">
              <type>
                <REAL />
              </type>
            </variable>
            <variable name="X3">
              <type>
                <REAL />
              </type>
            </variable>
            <variable name="E1">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="E2">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="E3">
              <type>
                <BOOL />
              </type>
            </variable>
          </inputVars>
        </interface>
        <body>
          <ST>
            IF E1 THEN OVERRIDE := X1; END_IF;
IF E2 AND ABS(x2) &gt; ABS(OVERRIDE) THEN OVERRIDE := X2; END_IF;
IF E3 AND ABS(x3) &gt; ABS(OVERRIDE) THEN OVERRIDE := X3; END_IF;

(* revision history
hm	4.11.2007		rev 1.0
	original version

*)

          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>cb57fbde-c763-4849-ab49-8d070b2c8763</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="RANGE_TO_BYTE" pouType="function">
        <interface>
          <returnType>
            <BYTE />
          </returnType>
          <inputVars>
            <variable name="X">
              <type>
                <REAL />
              </type>
            </variable>
            <variable name="low">
              <type>
                <REAL />
              </type>
            </variable>
            <variable name="high">
              <type>
                <REAL />
              </type>
            </variable>
          </inputVars>
        </interface>
        <body>
          <ST>
            RANGE_TO_BYTE := INT_TO_BYTE(DINT_TO_INT(TRUNC((LIMIT(low, X, high) - low) * 255.0 / (high - low))));


(* revision history
hm	9. jan 2008		rev 1.0
	original version

*)

          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>eb9bca89-e91c-46b7-8103-e1c61aa89d4c</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="RANGE_TO_WORD" pouType="function">
        <interface>
          <returnType>
            <WORD />
          </returnType>
          <inputVars>
            <variable name="X">
              <type>
                <REAL />
              </type>
            </variable>
            <variable name="low">
              <type>
                <REAL />
              </type>
            </variable>
            <variable name="high">
              <type>
                <REAL />
              </type>
            </variable>
          </inputVars>
        </interface>
        <body>
          <ST>
            RANGE_TO_WORD := DINT_TO_WORD(TRUNC((LIMIT(low,X,high)-low) * 65535.0 / (high - low)));


(* revision history
hm	9. jan 2008		rev 1.0
	original version

*)

          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>8c3d2e6d-8234-41ed-9a60-ef3d0d7f2ca3</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="SCALE" pouType="function">
        <interface>
          <returnType>
            <REAL />
          </returnType>
          <inputVars>
            <variable name="X">
              <type>
                <REAL />
              </type>
            </variable>
            <variable name="K">
              <type>
                <REAL />
              </type>
            </variable>
            <variable name="O">
              <type>
                <REAL />
              </type>
            </variable>
            <variable name="MX">
              <type>
                <REAL />
              </type>
            </variable>
            <variable name="MN">
              <type>
                <REAL />
              </type>
            </variable>
          </inputVars>
        </interface>
        <body>
          <ST>
            SCALE := LIMIT(MN, X * K + O, MX);


(* revision history
hm	16. may. 2008		rev 1.0
	original version
*)
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>108a47be-f09d-4fa4-887e-bcaad3230eef</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="SCALE_B" pouType="function">
        <interface>
          <returnType>
            <REAL />
          </returnType>
          <inputVars>
            <variable name="X">
              <type>
                <BYTE />
              </type>
            </variable>
            <variable name="I_LO">
              <type>
                <BYTE />
              </type>
            </variable>
            <variable name="I_HI">
              <type>
                <BYTE />
              </type>
            </variable>
            <variable name="O_LO">
              <type>
                <REAL />
              </type>
            </variable>
            <variable name="O_HI">
              <type>
                <REAL />
              </type>
            </variable>
          </inputVars>
        </interface>
        <body>
          <ST>
            IF I_HI = I_LO THEN
	SCALE_B := O_LO;
ELSE
	SCALE_B := (O_HI - O_LO) / BYTE_TO_REAL(I_HI - I_LO) * BYTE_TO_REAL(LIMIT(I_LO, X, I_HI));
END_IF

(* revision history
hm	18. may. 2008		rev 1.0
	original version

hm	18. jan 2011		rev 1.1
	avoid division by 0

*)
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>920dd950-9d51-4902-a24a-64ff68a688f4</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="SCALE_B2" pouType="function">
        <interface>
          <returnType>
            <REAL />
          </returnType>
          <inputVars>
            <variable name="in1">
              <type>
                <BYTE />
              </type>
            </variable>
            <variable name="in2">
              <type>
                <BYTE />
              </type>
            </variable>
            <variable name="K">
              <type>
                <REAL />
              </type>
            </variable>
            <variable name="O">
              <type>
                <REAL />
              </type>
            </variable>
            <variable name="in1_min">
              <type>
                <REAL />
              </type>
              <addData>
                <data name="http://www.3s-software.com/plcopenxml/attributes" handleUnknown="implementation">
                  <Attributes>
                    <Attribute Name="input_constant" Value="" />
                  </Attributes>
                </data>
              </addData>
            </variable>
            <variable name="in1_max">
              <type>
                <REAL />
              </type>
              <initialValue>
                <simpleValue value="1000.0" />
              </initialValue>
              <addData>
                <data name="http://www.3s-software.com/plcopenxml/attributes" handleUnknown="implementation">
                  <Attributes>
                    <Attribute Name="input_constant" Value="" />
                  </Attributes>
                </data>
              </addData>
            </variable>
            <variable name="in2_min">
              <type>
                <REAL />
              </type>
              <addData>
                <data name="http://www.3s-software.com/plcopenxml/attributes" handleUnknown="implementation">
                  <Attributes>
                    <Attribute Name="input_constant" Value="" />
                  </Attributes>
                </data>
              </addData>
            </variable>
            <variable name="in2_max">
              <type>
                <REAL />
              </type>
              <initialValue>
                <simpleValue value="1000.0" />
              </initialValue>
              <addData>
                <data name="http://www.3s-software.com/plcopenxml/attributes" handleUnknown="implementation">
                  <Attributes>
                    <Attribute Name="input_constant" Value="" />
                  </Attributes>
                </data>
              </addData>
            </variable>
          </inputVars>
        </interface>
        <body>
          <ST>
            SCALE_B2 := 	(((in1_max - in1_min)* in1 + (in2_max - in2_min)* in2) * 0.003921569 + in1_min + in2_min) * K + O;


(* revision History
hm 19.1.2007		rev 1.1
	changed outputs to real to avoid overflow of integer
	added offset for better cascading of scale functions
	changed from FB to function

hm	6. jan 2008		rev 1.2
	improved performance

hm	26. oct. 2008	rev 1.3
	code optimization

hm	3. nov. 2008	rev 1.4
	used wrong factor in formula

*)
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>48e1dc36-66b1-497c-8fe9-38ebf652b6c2</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="SCALE_B4" pouType="function">
        <interface>
          <returnType>
            <REAL />
          </returnType>
          <inputVars>
            <variable name="in1">
              <type>
                <BYTE />
              </type>
            </variable>
            <variable name="in2">
              <type>
                <BYTE />
              </type>
            </variable>
            <variable name="in3">
              <type>
                <BYTE />
              </type>
            </variable>
            <variable name="in4">
              <type>
                <BYTE />
              </type>
            </variable>
            <variable name="K">
              <type>
                <REAL />
              </type>
            </variable>
            <variable name="O">
              <type>
                <REAL />
              </type>
            </variable>
            <variable name="in1_min">
              <type>
                <REAL />
              </type>
              <addData>
                <data name="http://www.3s-software.com/plcopenxml/attributes" handleUnknown="implementation">
                  <Attributes>
                    <Attribute Name="input_constant" Value="" />
                  </Attributes>
                </data>
              </addData>
            </variable>
            <variable name="in1_max">
              <type>
                <REAL />
              </type>
              <initialValue>
                <simpleValue value="1000.0" />
              </initialValue>
              <addData>
                <data name="http://www.3s-software.com/plcopenxml/attributes" handleUnknown="implementation">
                  <Attributes>
                    <Attribute Name="input_constant" Value="" />
                  </Attributes>
                </data>
              </addData>
            </variable>
            <variable name="in2_min">
              <type>
                <REAL />
              </type>
              <addData>
                <data name="http://www.3s-software.com/plcopenxml/attributes" handleUnknown="implementation">
                  <Attributes>
                    <Attribute Name="input_constant" Value="" />
                  </Attributes>
                </data>
              </addData>
            </variable>
            <variable name="in2_max">
              <type>
                <REAL />
              </type>
              <initialValue>
                <simpleValue value="1000.0" />
              </initialValue>
              <addData>
                <data name="http://www.3s-software.com/plcopenxml/attributes" handleUnknown="implementation">
                  <Attributes>
                    <Attribute Name="input_constant" Value="" />
                  </Attributes>
                </data>
              </addData>
            </variable>
            <variable name="in3_min">
              <type>
                <REAL />
              </type>
              <addData>
                <data name="http://www.3s-software.com/plcopenxml/attributes" handleUnknown="implementation">
                  <Attributes>
                    <Attribute Name="input_constant" Value="" />
                  </Attributes>
                </data>
              </addData>
            </variable>
            <variable name="in3_max">
              <type>
                <REAL />
              </type>
              <initialValue>
                <simpleValue value="1000.0" />
              </initialValue>
              <addData>
                <data name="http://www.3s-software.com/plcopenxml/attributes" handleUnknown="implementation">
                  <Attributes>
                    <Attribute Name="input_constant" Value="" />
                  </Attributes>
                </data>
              </addData>
            </variable>
            <variable name="in4_min">
              <type>
                <REAL />
              </type>
              <addData>
                <data name="http://www.3s-software.com/plcopenxml/attributes" handleUnknown="implementation">
                  <Attributes>
                    <Attribute Name="input_constant" Value="" />
                  </Attributes>
                </data>
              </addData>
            </variable>
            <variable name="in4_max">
              <type>
                <REAL />
              </type>
              <initialValue>
                <simpleValue value="1000.0" />
              </initialValue>
              <addData>
                <data name="http://www.3s-software.com/plcopenxml/attributes" handleUnknown="implementation">
                  <Attributes>
                    <Attribute Name="input_constant" Value="" />
                  </Attributes>
                </data>
              </addData>
            </variable>
          </inputVars>
        </interface>
        <body>
          <ST>
            SCALE_B4 := 	(((in1_max - in1_min)* in1 + (in2_max - in2_min)* in2 + (in3_max - in3_min)* in3 + (in4_max - in4_min)* in4)* 0.003921569 + in1_min + in2_min + in3_min + in4_min) * K + O;


(* revision History
hm 19.1.2007		rev 1.1
	changed outputs to real to avoid overflow of integer
	added offset for better cascading of scale functions
	changed from fb to function

hm	6. jan 2008		rev 1.2
	improved performance

hm	26. oct. 2008	rev 1.3
	optimized code

hm	3. nov. 2008	rev 1.4
	used wrong factor in formula

*)
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>76376fdb-602d-4a96-bc55-8dab2e499019</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="SCALE_B8" pouType="function">
        <interface>
          <returnType>
            <REAL />
          </returnType>
          <inputVars>
            <variable name="in1">
              <type>
                <BYTE />
              </type>
            </variable>
            <variable name="in2">
              <type>
                <BYTE />
              </type>
            </variable>
            <variable name="in3">
              <type>
                <BYTE />
              </type>
            </variable>
            <variable name="in4">
              <type>
                <BYTE />
              </type>
            </variable>
            <variable name="in5">
              <type>
                <BYTE />
              </type>
            </variable>
            <variable name="in6">
              <type>
                <BYTE />
              </type>
            </variable>
            <variable name="in7">
              <type>
                <BYTE />
              </type>
            </variable>
            <variable name="in8">
              <type>
                <BYTE />
              </type>
            </variable>
            <variable name="K">
              <type>
                <REAL />
              </type>
            </variable>
            <variable name="O">
              <type>
                <REAL />
              </type>
            </variable>
            <variable name="in1_min">
              <type>
                <REAL />
              </type>
              <addData>
                <data name="http://www.3s-software.com/plcopenxml/attributes" handleUnknown="implementation">
                  <Attributes>
                    <Attribute Name="input_constant" Value="" />
                  </Attributes>
                </data>
              </addData>
            </variable>
            <variable name="in1_max">
              <type>
                <REAL />
              </type>
              <initialValue>
                <simpleValue value="1000.0" />
              </initialValue>
              <addData>
                <data name="http://www.3s-software.com/plcopenxml/attributes" handleUnknown="implementation">
                  <Attributes>
                    <Attribute Name="input_constant" Value="" />
                  </Attributes>
                </data>
              </addData>
            </variable>
            <variable name="in2_min">
              <type>
                <REAL />
              </type>
              <addData>
                <data name="http://www.3s-software.com/plcopenxml/attributes" handleUnknown="implementation">
                  <Attributes>
                    <Attribute Name="input_constant" Value="" />
                  </Attributes>
                </data>
              </addData>
            </variable>
            <variable name="in2_max">
              <type>
                <REAL />
              </type>
              <initialValue>
                <simpleValue value="1000.0" />
              </initialValue>
              <addData>
                <data name="http://www.3s-software.com/plcopenxml/attributes" handleUnknown="implementation">
                  <Attributes>
                    <Attribute Name="input_constant" Value="" />
                  </Attributes>
                </data>
              </addData>
            </variable>
            <variable name="in3_min">
              <type>
                <REAL />
              </type>
              <addData>
                <data name="http://www.3s-software.com/plcopenxml/attributes" handleUnknown="implementation">
                  <Attributes>
                    <Attribute Name="input_constant" Value="" />
                  </Attributes>
                </data>
              </addData>
            </variable>
            <variable name="in3_max">
              <type>
                <REAL />
              </type>
              <initialValue>
                <simpleValue value="1000.0" />
              </initialValue>
              <addData>
                <data name="http://www.3s-software.com/plcopenxml/attributes" handleUnknown="implementation">
                  <Attributes>
                    <Attribute Name="input_constant" Value="" />
                  </Attributes>
                </data>
              </addData>
            </variable>
            <variable name="in4_min">
              <type>
                <REAL />
              </type>
              <addData>
                <data name="http://www.3s-software.com/plcopenxml/attributes" handleUnknown="implementation">
                  <Attributes>
                    <Attribute Name="input_constant" Value="" />
                  </Attributes>
                </data>
              </addData>
            </variable>
            <variable name="in4_max">
              <type>
                <REAL />
              </type>
              <initialValue>
                <simpleValue value="1000.0" />
              </initialValue>
              <addData>
                <data name="http://www.3s-software.com/plcopenxml/attributes" handleUnknown="implementation">
                  <Attributes>
                    <Attribute Name="input_constant" Value="" />
                  </Attributes>
                </data>
              </addData>
            </variable>
            <variable name="in5_min">
              <type>
                <REAL />
              </type>
              <addData>
                <data name="http://www.3s-software.com/plcopenxml/attributes" handleUnknown="implementation">
                  <Attributes>
                    <Attribute Name="input_constant" Value="" />
                  </Attributes>
                </data>
              </addData>
            </variable>
            <variable name="in5_max">
              <type>
                <REAL />
              </type>
              <initialValue>
                <simpleValue value="1000.0" />
              </initialValue>
              <addData>
                <data name="http://www.3s-software.com/plcopenxml/attributes" handleUnknown="implementation">
                  <Attributes>
                    <Attribute Name="input_constant" Value="" />
                  </Attributes>
                </data>
              </addData>
            </variable>
            <variable name="in6_min">
              <type>
                <REAL />
              </type>
              <addData>
                <data name="http://www.3s-software.com/plcopenxml/attributes" handleUnknown="implementation">
                  <Attributes>
                    <Attribute Name="input_constant" Value="" />
                  </Attributes>
                </data>
              </addData>
            </variable>
            <variable name="in6_max">
              <type>
                <REAL />
              </type>
              <initialValue>
                <simpleValue value="1000.0" />
              </initialValue>
              <addData>
                <data name="http://www.3s-software.com/plcopenxml/attributes" handleUnknown="implementation">
                  <Attributes>
                    <Attribute Name="input_constant" Value="" />
                  </Attributes>
                </data>
              </addData>
            </variable>
            <variable name="in7_min">
              <type>
                <REAL />
              </type>
              <addData>
                <data name="http://www.3s-software.com/plcopenxml/attributes" handleUnknown="implementation">
                  <Attributes>
                    <Attribute Name="input_constant" Value="" />
                  </Attributes>
                </data>
              </addData>
            </variable>
            <variable name="in7_max">
              <type>
                <REAL />
              </type>
              <initialValue>
                <simpleValue value="1000.0" />
              </initialValue>
              <addData>
                <data name="http://www.3s-software.com/plcopenxml/attributes" handleUnknown="implementation">
                  <Attributes>
                    <Attribute Name="input_constant" Value="" />
                  </Attributes>
                </data>
              </addData>
            </variable>
            <variable name="in8_min">
              <type>
                <REAL />
              </type>
              <addData>
                <data name="http://www.3s-software.com/plcopenxml/attributes" handleUnknown="implementation">
                  <Attributes>
                    <Attribute Name="input_constant" Value="" />
                  </Attributes>
                </data>
              </addData>
            </variable>
            <variable name="in8_max">
              <type>
                <REAL />
              </type>
              <initialValue>
                <simpleValue value="1000.0" />
              </initialValue>
              <addData>
                <data name="http://www.3s-software.com/plcopenxml/attributes" handleUnknown="implementation">
                  <Attributes>
                    <Attribute Name="input_constant" Value="" />
                  </Attributes>
                </data>
              </addData>
            </variable>
          </inputVars>
        </interface>
        <body>
          <ST>
            SCALE_B8 := 	(((in1_max - in1_min)* in1 + (in2_max - in2_min)* in2 + (in3_max - in3_min)* in3 + (in4_max - in4_min)* in4 +
				(in5_max - in5_min)* in5 + (in6_max - in6_min)* in6 + (in7_max - in7_min)* in7 + (in8_max - in8_min)* in8) * 0.003921569
				 + in1_min + in2_min + in3_min + in4_min + in5_min + in6_min + in7_min + in8_min) * K + O;


(* revision History
hm	19. jan.2007	rev 1.1
	changed outputs to real to avoid overflow of integer
	added offset for better cascading of scale functions

hm	6. jan. 2008	rev 1.2
	improved performance

hm	26. oct. 2008	rev 1.3
	code optimization

hm	3. nov. 2008	rev 1.4
	used wrong factor in formula

*)
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>b13376c7-68c6-4171-848b-1f6b9cadf416</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="SCALE_D" pouType="function">
        <interface>
          <returnType>
            <REAL />
          </returnType>
          <inputVars>
            <variable name="X">
              <type>
                <DWORD />
              </type>
            </variable>
            <variable name="I_LO">
              <type>
                <DWORD />
              </type>
            </variable>
            <variable name="I_HI">
              <type>
                <DWORD />
              </type>
            </variable>
            <variable name="O_LO">
              <type>
                <REAL />
              </type>
            </variable>
            <variable name="O_HI">
              <type>
                <REAL />
              </type>
            </variable>
          </inputVars>
        </interface>
        <body>
          <ST>
            IF I_HI = I_LO THEN
	SCALE_D := O_LO;
ELSE
	SCALE_D := (O_HI - O_LO) / DWORD_TO_REAL(I_HI - I_LO) * DWORD_TO_REAL(LIMIT(I_LO, X, I_HI) - I_LO) + O_LO;
END_IF;

(* revision history
hm	18. may. 2008	rev 1.0
	original version

hm	13. nov. 2008	rev 1.1
	corrected formula for negative gradient

hm	11. jan 2011	rev 1.2
	avoid division by 0
*)
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>3d9abe28-027f-40e3-b8a4-a5bac7c55988</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="SCALE_R" pouType="function">
        <interface>
          <returnType>
            <REAL />
          </returnType>
          <inputVars>
            <variable name="X">
              <type>
                <REAL />
              </type>
            </variable>
            <variable name="I_LO">
              <type>
                <REAL />
              </type>
            </variable>
            <variable name="I_HI">
              <type>
                <REAL />
              </type>
            </variable>
            <variable name="O_LO">
              <type>
                <REAL />
              </type>
            </variable>
            <variable name="O_HI">
              <type>
                <REAL />
              </type>
            </variable>
          </inputVars>
        </interface>
        <body>
          <ST>
            IF I_LO = I_HI THEN
	SCALE_R := O_LO;
ELSE
	SCALE_R := (O_HI - O_LO) / (I_HI - I_LO) * (LIMIT(I_LO, X, I_HI) - I_LO) + O_LO;
END_IF;


(* revision history
hm	18. may. 2008	rev 1.0
	original version

hm	13. nov. 2008	rev 1.1
	corrected formula for negative gradient

hm	11. jan 2011	rev 1.2
	avoid division by 0

*)
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>3ac16c22-710a-43b8-971c-987668a59aba</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="SCALE_X2" pouType="function">
        <interface>
          <returnType>
            <REAL />
          </returnType>
          <inputVars>
            <variable name="IN1">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="IN2">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="K">
              <type>
                <REAL />
              </type>
            </variable>
            <variable name="O">
              <type>
                <REAL />
              </type>
            </variable>
            <variable name="IN1_MIN">
              <type>
                <REAL />
              </type>
              <addData>
                <data name="http://www.3s-software.com/plcopenxml/attributes" handleUnknown="implementation">
                  <Attributes>
                    <Attribute Name="input_constant" Value="" />
                  </Attributes>
                </data>
              </addData>
            </variable>
            <variable name="IN1_MAX">
              <type>
                <REAL />
              </type>
              <initialValue>
                <simpleValue value="1000.0" />
              </initialValue>
              <addData>
                <data name="http://www.3s-software.com/plcopenxml/attributes" handleUnknown="implementation">
                  <Attributes>
                    <Attribute Name="input_constant" Value="" />
                  </Attributes>
                </data>
              </addData>
            </variable>
            <variable name="IN2_MIN">
              <type>
                <REAL />
              </type>
              <addData>
                <data name="http://www.3s-software.com/plcopenxml/attributes" handleUnknown="implementation">
                  <Attributes>
                    <Attribute Name="input_constant" Value="" />
                  </Attributes>
                </data>
              </addData>
            </variable>
            <variable name="IN2_MAX">
              <type>
                <REAL />
              </type>
              <initialValue>
                <simpleValue value="1000.0" />
              </initialValue>
              <addData>
                <data name="http://www.3s-software.com/plcopenxml/attributes" handleUnknown="implementation">
                  <Attributes>
                    <Attribute Name="input_constant" Value="" />
                  </Attributes>
                </data>
              </addData>
            </variable>
          </inputVars>
        </interface>
        <body>
          <ST>
            SCALE_X2 := (SEL(IN1, IN1_MIN, IN1_MAX)+ SEL(IN2, IN2_MIN, IN2_MAX)) * k + o;


(* revision history
hm	19. jan, 2007	rev 1.0
	original version

hm	26. oct. 2008	rev 1.1
	code optimized

*)
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>627a92d7-d14a-497a-8fdc-efad9d5516a0</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="SCALE_X4" pouType="function">
        <interface>
          <returnType>
            <REAL />
          </returnType>
          <inputVars>
            <variable name="IN1">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="IN2">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="IN3">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="IN4">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="K">
              <type>
                <REAL />
              </type>
            </variable>
            <variable name="O">
              <type>
                <REAL />
              </type>
            </variable>
            <variable name="IN1_MIN">
              <type>
                <REAL />
              </type>
              <addData>
                <data name="http://www.3s-software.com/plcopenxml/attributes" handleUnknown="implementation">
                  <Attributes>
                    <Attribute Name="input_constant" Value="" />
                  </Attributes>
                </data>
              </addData>
            </variable>
            <variable name="IN1_MAX">
              <type>
                <REAL />
              </type>
              <initialValue>
                <simpleValue value="1000.0" />
              </initialValue>
              <addData>
                <data name="http://www.3s-software.com/plcopenxml/attributes" handleUnknown="implementation">
                  <Attributes>
                    <Attribute Name="input_constant" Value="" />
                  </Attributes>
                </data>
              </addData>
            </variable>
            <variable name="IN2_MIN">
              <type>
                <REAL />
              </type>
              <addData>
                <data name="http://www.3s-software.com/plcopenxml/attributes" handleUnknown="implementation">
                  <Attributes>
                    <Attribute Name="input_constant" Value="" />
                  </Attributes>
                </data>
              </addData>
            </variable>
            <variable name="IN2_MAX">
              <type>
                <REAL />
              </type>
              <initialValue>
                <simpleValue value="1000.0" />
              </initialValue>
              <addData>
                <data name="http://www.3s-software.com/plcopenxml/attributes" handleUnknown="implementation">
                  <Attributes>
                    <Attribute Name="input_constant" Value="" />
                  </Attributes>
                </data>
              </addData>
            </variable>
            <variable name="IN3_MIN">
              <type>
                <REAL />
              </type>
              <addData>
                <data name="http://www.3s-software.com/plcopenxml/attributes" handleUnknown="implementation">
                  <Attributes>
                    <Attribute Name="input_constant" Value="" />
                  </Attributes>
                </data>
              </addData>
            </variable>
            <variable name="IN3_MAX">
              <type>
                <REAL />
              </type>
              <initialValue>
                <simpleValue value="1000.0" />
              </initialValue>
              <addData>
                <data name="http://www.3s-software.com/plcopenxml/attributes" handleUnknown="implementation">
                  <Attributes>
                    <Attribute Name="input_constant" Value="" />
                  </Attributes>
                </data>
              </addData>
            </variable>
            <variable name="IN4_MIN">
              <type>
                <REAL />
              </type>
              <addData>
                <data name="http://www.3s-software.com/plcopenxml/attributes" handleUnknown="implementation">
                  <Attributes>
                    <Attribute Name="input_constant" Value="" />
                  </Attributes>
                </data>
              </addData>
            </variable>
            <variable name="IN4_MAX">
              <type>
                <REAL />
              </type>
              <initialValue>
                <simpleValue value="1000.0" />
              </initialValue>
              <addData>
                <data name="http://www.3s-software.com/plcopenxml/attributes" handleUnknown="implementation">
                  <Attributes>
                    <Attribute Name="input_constant" Value="" />
                  </Attributes>
                </data>
              </addData>
            </variable>
          </inputVars>
        </interface>
        <body>
          <ST>
            SCALE_X4 := (SEL(IN1,IN1_MIN, IN1_MAX) + SEL(IN2, IN2_MIN, IN2_MAX)+SEL(IN3, IN3_MIN, IN3_MAX)+ SEL(IN4, IN4_MIN, IN4_MAX)) * k + o;


(* revision history
hm	19. jan. 2008	rev 1.0
	original version

hm	26. oct. 2008	rev 1.1
	optimized code
*)
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>8d38a706-18e6-496a-be25-900f2db2a77f</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="SCALE_X8" pouType="function">
        <interface>
          <returnType>
            <REAL />
          </returnType>
          <inputVars>
            <variable name="in1">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="in2">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="in3">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="in4">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="in5">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="in6">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="in7">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="in8">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="K">
              <type>
                <REAL />
              </type>
            </variable>
            <variable name="O">
              <type>
                <REAL />
              </type>
            </variable>
            <variable name="in1_min">
              <type>
                <REAL />
              </type>
              <addData>
                <data name="http://www.3s-software.com/plcopenxml/attributes" handleUnknown="implementation">
                  <Attributes>
                    <Attribute Name="input_constant" Value="" />
                  </Attributes>
                </data>
              </addData>
            </variable>
            <variable name="in1_max">
              <type>
                <REAL />
              </type>
              <initialValue>
                <simpleValue value="1000.0" />
              </initialValue>
              <addData>
                <data name="http://www.3s-software.com/plcopenxml/attributes" handleUnknown="implementation">
                  <Attributes>
                    <Attribute Name="input_constant" Value="" />
                  </Attributes>
                </data>
              </addData>
            </variable>
            <variable name="in2_min">
              <type>
                <REAL />
              </type>
              <addData>
                <data name="http://www.3s-software.com/plcopenxml/attributes" handleUnknown="implementation">
                  <Attributes>
                    <Attribute Name="input_constant" Value="" />
                  </Attributes>
                </data>
              </addData>
            </variable>
            <variable name="in2_max">
              <type>
                <REAL />
              </type>
              <initialValue>
                <simpleValue value="1000.0" />
              </initialValue>
              <addData>
                <data name="http://www.3s-software.com/plcopenxml/attributes" handleUnknown="implementation">
                  <Attributes>
                    <Attribute Name="input_constant" Value="" />
                  </Attributes>
                </data>
              </addData>
            </variable>
            <variable name="in3_min">
              <type>
                <REAL />
              </type>
              <addData>
                <data name="http://www.3s-software.com/plcopenxml/attributes" handleUnknown="implementation">
                  <Attributes>
                    <Attribute Name="input_constant" Value="" />
                  </Attributes>
                </data>
              </addData>
            </variable>
            <variable name="in3_max">
              <type>
                <REAL />
              </type>
              <initialValue>
                <simpleValue value="1000.0" />
              </initialValue>
              <addData>
                <data name="http://www.3s-software.com/plcopenxml/attributes" handleUnknown="implementation">
                  <Attributes>
                    <Attribute Name="input_constant" Value="" />
                  </Attributes>
                </data>
              </addData>
            </variable>
            <variable name="in4_min">
              <type>
                <REAL />
              </type>
              <addData>
                <data name="http://www.3s-software.com/plcopenxml/attributes" handleUnknown="implementation">
                  <Attributes>
                    <Attribute Name="input_constant" Value="" />
                  </Attributes>
                </data>
              </addData>
            </variable>
            <variable name="in4_max">
              <type>
                <REAL />
              </type>
              <initialValue>
                <simpleValue value="1000.0" />
              </initialValue>
              <addData>
                <data name="http://www.3s-software.com/plcopenxml/attributes" handleUnknown="implementation">
                  <Attributes>
                    <Attribute Name="input_constant" Value="" />
                  </Attributes>
                </data>
              </addData>
            </variable>
            <variable name="in5_min">
              <type>
                <REAL />
              </type>
              <addData>
                <data name="http://www.3s-software.com/plcopenxml/attributes" handleUnknown="implementation">
                  <Attributes>
                    <Attribute Name="input_constant" Value="" />
                  </Attributes>
                </data>
              </addData>
            </variable>
            <variable name="in5_max">
              <type>
                <REAL />
              </type>
              <initialValue>
                <simpleValue value="1000.0" />
              </initialValue>
              <addData>
                <data name="http://www.3s-software.com/plcopenxml/attributes" handleUnknown="implementation">
                  <Attributes>
                    <Attribute Name="input_constant" Value="" />
                  </Attributes>
                </data>
              </addData>
            </variable>
            <variable name="in6_min">
              <type>
                <REAL />
              </type>
              <addData>
                <data name="http://www.3s-software.com/plcopenxml/attributes" handleUnknown="implementation">
                  <Attributes>
                    <Attribute Name="input_constant" Value="" />
                  </Attributes>
                </data>
              </addData>
            </variable>
            <variable name="in6_max">
              <type>
                <REAL />
              </type>
              <initialValue>
                <simpleValue value="1000.0" />
              </initialValue>
              <addData>
                <data name="http://www.3s-software.com/plcopenxml/attributes" handleUnknown="implementation">
                  <Attributes>
                    <Attribute Name="input_constant" Value="" />
                  </Attributes>
                </data>
              </addData>
            </variable>
            <variable name="in7_min">
              <type>
                <REAL />
              </type>
              <addData>
                <data name="http://www.3s-software.com/plcopenxml/attributes" handleUnknown="implementation">
                  <Attributes>
                    <Attribute Name="input_constant" Value="" />
                  </Attributes>
                </data>
              </addData>
            </variable>
            <variable name="in7_max">
              <type>
                <REAL />
              </type>
              <initialValue>
                <simpleValue value="1000.0" />
              </initialValue>
              <addData>
                <data name="http://www.3s-software.com/plcopenxml/attributes" handleUnknown="implementation">
                  <Attributes>
                    <Attribute Name="input_constant" Value="" />
                  </Attributes>
                </data>
              </addData>
            </variable>
            <variable name="in8_min">
              <type>
                <REAL />
              </type>
              <addData>
                <data name="http://www.3s-software.com/plcopenxml/attributes" handleUnknown="implementation">
                  <Attributes>
                    <Attribute Name="input_constant" Value="" />
                  </Attributes>
                </data>
              </addData>
            </variable>
            <variable name="in8_max">
              <type>
                <REAL />
              </type>
              <initialValue>
                <simpleValue value="1000.0" />
              </initialValue>
              <addData>
                <data name="http://www.3s-software.com/plcopenxml/attributes" handleUnknown="implementation">
                  <Attributes>
                    <Attribute Name="input_constant" Value="" />
                  </Attributes>
                </data>
              </addData>
            </variable>
          </inputVars>
        </interface>
        <body>
          <ST>
            SCALE_X8 := (SEL(IN1,IN1_MIN, IN1_MAX)+ SEL(IN2,IN2_MIN, IN2_MAX)+SEL(IN3,IN3_MIN, IN3_MAX)+ SEL(IN4,IN4_MIN, IN4_MAX)
				+SEL(IN5,IN5_MIN, IN5_MAX)+ SEL(IN6,IN6_MIN, IN6_MAX)+SEL(IN7,IN7_MIN, IN7_MAX)+ SEL(IN8,IN8_MIN, IN8_MAX)) * k + o;



(* revision history
hm	19. jan. 2008	rev 1.0
	original version

hm	26. oct. 2008	rev 1.1
	optimized code

hm	24. jan. 2008	rev 1.2
	corrected error in formula
*)
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>1eeef25d-1d72-45db-9410-39b0b58a3d5e</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="SEL2_OF_3" pouType="functionBlock">
        <interface>
          <inputVars>
            <variable name="IN1">
              <type>
                <REAL />
              </type>
            </variable>
            <variable name="IN2">
              <type>
                <REAL />
              </type>
            </variable>
            <variable name="IN3">
              <type>
                <REAL />
              </type>
            </variable>
            <variable name="D">
              <type>
                <REAL />
              </type>
            </variable>
          </inputVars>
          <outputVars>
            <variable name="Y">
              <type>
                <REAL />
              </type>
            </variable>
            <variable name="W">
              <type>
                <INT />
              </type>
            </variable>
            <variable name="E">
              <type>
                <BOOL />
              </type>
            </variable>
          </outputVars>
          <localVars>
            <variable name="D12">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="D23">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="D31">
              <type>
                <BOOL />
              </type>
            </variable>
          </localVars>
        </interface>
        <body>
          <ST>
            D12 := ABS(IN1-IN2) &lt;= D;
D23 := ABS(IN2-IN3) &lt;= D;
D31 := ABS(IN3-IN1) &lt;= D;

IF (D12 AND D23) OR (D12 AND D31) OR (D23 AND D31) THEN
	(* all 3 inputs are valid *)
	Y := (IN1 + IN2 + IN3) * 0.333333333333;
	E := FALSE;
	W := 0;
ELSIF D12 THEN
	(* only inut 1 and 2 are valid *)
	Y := (In1 + IN2) * 0.5;
	E := FALSE;
	W := 3;
ELSIF D23 THEN
	(* only inut 2 and 3 are valid *)
	Y := (In2 + IN3) * 0.5;
	E := FALSE;
	W := 1;
ELSIF D31 THEN
	(* only inut 3 and 1 are valid *)
	Y := (In3 + IN1) * 0.5;
	E := FALSE;
	W := 2;
ELSE
	(* no calculation possible *)
	E := TRUE;
	W := 4;
END_IF;


(* revision history
hm	18. may 2008	rev 1.0
	original version

hm	10. mar. 2009	rev 1.1
	improved code
*)
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>4a0f39b9-eb51-42db-9bd7-22e1068e76da</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="SEL2_OF_3B" pouType="functionBlock">
        <interface>
          <inputVars>
            <variable name="IN1">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="IN2">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="IN3">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="TD">
              <type>
                <TIME />
              </type>
            </variable>
          </inputVars>
          <outputVars>
            <variable name="Q">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="W">
              <type>
                <BOOL />
              </type>
            </variable>
          </outputVars>
          <localVars>
            <variable name="TDEL">
              <type>
                <derived name="TON" />
              </type>
            </variable>
          </localVars>
        </interface>
        <body>
          <ST>
            Q := (IN1 AND IN2) OR (IN1 AND IN3) OR (IN2 AND IN3);
TDEL(IN := (in1 XOR in2) OR (in1 XOR in3) OR (in2 XOR in3), PT := TD);
W := TDEL.Q;


(* revision history
hm		19. may 2008	rev 1.0
	original version

*)
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>79daf2db-b086-4118-8997-027981633876</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="SH" pouType="functionBlock">
        <interface>
          <inputVars>
            <variable name="in">
              <type>
                <REAL />
              </type>
            </variable>
            <variable name="CLK">
              <type>
                <BOOL />
              </type>
            </variable>
          </inputVars>
          <outputVars>
            <variable name="out">
              <type>
                <REAL />
              </type>
            </variable>
            <variable name="trig">
              <type>
                <BOOL />
              </type>
            </variable>
          </outputVars>
          <localVars>
            <variable name="edge">
              <type>
                <BOOL />
              </type>
            </variable>
          </localVars>
        </interface>
        <body>
          <ST>
            IF clk AND NOT edge THEN
	out := in;
	trig := TRUE;
ELSE;
	trig := FALSE;
END_IF;
edge := clk;

(* revision history

hm 16.1.2007	rev 1.1
	added trig output

*)
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>0bc27dd3-f3cc-4dfc-bdd5-8ce2bd9714b7</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="SH_1" pouType="functionBlock">
        <interface>
          <inputVars>
            <variable name="in">
              <type>
                <REAL />
              </type>
            </variable>
            <variable name="PT">
              <type>
                <TIME />
              </type>
            </variable>
          </inputVars>
          <outputVars>
            <variable name="out">
              <type>
                <REAL />
              </type>
            </variable>
            <variable name="Trig">
              <type>
                <BOOL />
              </type>
            </variable>
          </outputVars>
          <localVars>
            <variable name="last">
              <type>
                <TIME />
              </type>
            </variable>
            <variable name="tx">
              <type>
                <TIME />
              </type>
            </variable>
          </localVars>
        </interface>
        <body>
          <ST>
            (* read system time *)
tx := DWORD_TO_TIME(T_PLC_MS());

IF tx - last &gt;= PT THEN
	last := tx;
	out := in;
	trig := TRUE;
ELSE
	trig := FALSE;
END_IF;

(* revision history

HM	6.1.2007	rev 1.1
	added trig output

HM	17.9.2007	rev 1.2
	replaced time() with T_PLC_MS() for compatibility reasons
*)


          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>8b3de2b7-6e8f-4424-8cb7-e1f32ad4a765</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="SH_2" pouType="functionBlock">
        <interface>
          <inputVars>
            <variable name="in">
              <type>
                <REAL />
              </type>
            </variable>
            <variable name="PT">
              <type>
                <TIME />
              </type>
            </variable>
            <variable name="N">
              <type>
                <INT />
              </type>
              <initialValue>
                <simpleValue value="16" />
              </initialValue>
            </variable>
            <variable name="disc">
              <type>
                <INT />
              </type>
            </variable>
          </inputVars>
          <outputVars>
            <variable name="out">
              <type>
                <REAL />
              </type>
            </variable>
            <variable name="trig">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="avg">
              <type>
                <REAL />
              </type>
            </variable>
            <variable name="high">
              <type>
                <REAL />
              </type>
            </variable>
            <variable name="low">
              <type>
                <REAL />
              </type>
            </variable>
          </outputVars>
          <localVars>
            <variable name="M">
              <type>
                <INT />
              </type>
            </variable>
            <variable name="buf">
              <type>
                <array>
                  <dimension lower="0" upper="15" />
                  <baseType>
                    <REAL />
                  </baseType>
                </array>
              </type>
            </variable>
            <variable name="buf2">
              <type>
                <array>
                  <dimension lower="0" upper="15" />
                  <baseType>
                    <REAL />
                  </baseType>
                </array>
              </type>
            </variable>
            <variable name="last">
              <type>
                <TIME />
              </type>
            </variable>
            <variable name="i">
              <type>
                <INT />
              </type>
            </variable>
            <variable name="start">
              <type>
                <INT />
              </type>
            </variable>
            <variable name="temp">
              <type>
                <REAL />
              </type>
            </variable>
            <variable name="stop">
              <type>
                <INT />
              </type>
            </variable>
            <variable name="tx">
              <type>
                <TIME />
              </type>
            </variable>
            <variable name="d2">
              <type>
                <INT />
              </type>
            </variable>
          </localVars>
        </interface>
        <body>
          <ST>
            (* read system time *)
tx := DWORD_TO_TIME(T_PLC_MS());
d2 := SHR(disc,1);

IF tx - last &gt;= PT THEN
	last := tx;
	trig := TRUE;

	(* limit M to 0..16 *)
	M := LIMIT(1,N,16);

	(* edge detected lets take the sample *)
	FOR i := M - 1 TO 1 BY -1 DO buf2[i] := buf2[i-1]; END_FOR;
	buf2[0] := in;
	out := in;
	buf := buf2;

	(* sort the ARRAY lowest value AT 0 *)
	FOR start := 0 TO M - 2 DO
		FOR i := start+1 TO M - 1 DO
			IF buf[start] &gt; buf[i] THEN
				temp := buf[start];
				buf[start] := buf[i];
				buf[i] := temp;
			END_IF;
		END_FOR;
	END_FOR;

	(* any calculation with the samples is here *)
	stop := M - 1 - d2;
	start := d2;
	IF NOT even(disc) THEN start := start + 1; END_IF;
	avg := 0;
	FOR i := start TO stop DO avg := avg + buf[i]; END_FOR;
	avg := avg / INT_TO_REAL(stop - start +1);
	low := buf[start];
	high := buf[stop];
ELSE
	Trig := FALSE;
END_IF;

(* revision history
hm 20. jan. 2007	rev 1.1
	added input N to specify the amout of samples for average and high low calculations
	added trig output

hm 10. sep. 2007 	rev 1.2
	an error would be generated if N was set to 0, now n is forced to1 if set to 0.
	index was out of array.

hm	17. sep. 2007	rev 1.3
	replaced time() with t_plc_ms() for compatibility reasons

hm	6. jan. 2008	rev 1.4
	improved performance

hm	14. jun. 2008	rev 1.5
	set default for input N = 16

hm	10. mar. 2009	rev 1.6
	added type conversion for compatibility reasons

*)
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>2a545e7b-267e-4ae6-bde3-bc2c335ce9c2</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="SH_T" pouType="functionBlock">
        <interface>
          <inputVars>
            <variable name="IN">
              <type>
                <REAL />
              </type>
            </variable>
            <variable name="E">
              <type>
                <BOOL />
              </type>
            </variable>
          </inputVars>
          <outputVars>
            <variable name="OUT">
              <type>
                <REAL />
              </type>
            </variable>
          </outputVars>
        </interface>
        <body>
          <ST>
            IF E THEN out := in; END_IF;



(* revision history
hm	1. sep. 2006	rev 1.0
	original version

hm	18. oct. 2008	rev 1.1
	changed input en to e for compatibility reasons

*)
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>3c15ee4c-c88b-44be-b055-b8e710168b9b</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="STAIR" pouType="function">
        <interface>
          <returnType>
            <REAL />
          </returnType>
          <inputVars>
            <variable name="X">
              <type>
                <REAL />
              </type>
            </variable>
            <variable name="D">
              <type>
                <REAL />
              </type>
            </variable>
          </inputVars>
        </interface>
        <body>
          <ST>
            IF D &gt; 0.0 THEN
	STAIR := DINT_TO_REAL(REAL_TO_DINT(X / D)) * D;
ELSE
	STAIR := X;
END_IF;



(* revision history
hm	28 jan 2007		rev 1.0
	original version

hm	27 dec 2007		rev 1.1
	changed code for better performance

hm	6. jan 2008		rev 1.2
	further performance improvement

hm	26. oct. 2008		rev 1.3
	optimized code

hm	10. mar. 2009	rev 1.4
	real constants updated to new systax using dot

*)
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>1ea3bdca-33e5-4c0f-bffd-6dcf99df468a</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="STAIR2" pouType="functionBlock">
        <interface>
          <inputVars>
            <variable name="X">
              <type>
                <REAL />
              </type>
            </variable>
            <variable name="D">
              <type>
                <REAL />
              </type>
            </variable>
          </inputVars>
          <outputVars>
            <variable name="Y">
              <type>
                <REAL />
              </type>
            </variable>
          </outputVars>
        </interface>
        <body>
          <ST>
            IF D &gt; 0.0 THEN
	IF X &gt;= Y + D OR X &lt;= Y - D THEN Y := FLOOR(X/D) * D; END_IF;
ELSE
	Y := X;
END_IF;



(* revision history
hm	28 jan 2007		rev 1.0
	original version

hm	27. dec 2007	rev 1.1
	changed code for better performance

hm	30. jun. 2008	rev 1.2
	added type conversions to avoid warnings under codesys 3.0																																																																																																																																																																																																																																																											

ks	26. oct. 2008	rev 1.3
	improved code

hm	10. mar. 2009	rev 1.4
	real constants updated to new systax using dot

*)
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>82b0b287-e829-495a-9821-3bcd0e32be31</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="TREND" pouType="functionBlock">
        <interface>
          <inputVars>
            <variable name="X">
              <type>
                <REAL />
              </type>
            </variable>
          </inputVars>
          <outputVars>
            <variable name="Q">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="TU">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="TD">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="D">
              <type>
                <REAL />
              </type>
            </variable>
          </outputVars>
          <localVars>
            <variable name="last_X">
              <type>
                <REAL />
              </type>
            </variable>
          </localVars>
        </interface>
        <body>
          <ST>
            TU := X &gt; last_X;
TD := X &lt; last_X;
Q := TU OR TD;
D := X - LAST_X;

last_X := X;



(* revision history
hm	21. aug. 2009	rev 1.0
	original version

*)

          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>610556ec-ff0d-4ea4-b491-f1c581b2dc05</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="TREND_DW" pouType="functionBlock">
        <interface>
          <inputVars>
            <variable name="X">
              <type>
                <DWORD />
              </type>
            </variable>
          </inputVars>
          <outputVars>
            <variable name="Q">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="TU">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="TD">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="D">
              <type>
                <DWORD />
              </type>
            </variable>
          </outputVars>
          <localVars>
            <variable name="last_X">
              <type>
                <DWORD />
              </type>
            </variable>
          </localVars>
        </interface>
        <body>
          <ST>
            IF X &gt; last_X THEN
	TU := TRUE;
	TD := FALSE;
	D := X - last_X;
	Q := TRUE;
ELSIF X &lt; last_X THEN
	TD := TRUE;
	TU := FALSE;
	D := last_X - X;
	Q := FALSE;
ELSE
	TU := FALSE;
	TD := FALSE;
	D := 0;
END_IF;
last_X := X;



(* revision history
hm	21. nov. 2008	rev 1.0
	original version

hm	20. feb. 2009	rev 1.1
	added outputs TU, TD and D

hm	14. mar. 2009	rev 1.2
	removed double assignments

*)

          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>1dcd6604-27c1-4bb6-a5f3-fe14621ebfe4</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="WORD_TO_RANGE" pouType="function">
        <interface>
          <returnType>
            <REAL />
          </returnType>
          <inputVars>
            <variable name="X">
              <type>
                <WORD />
              </type>
            </variable>
            <variable name="low">
              <type>
                <REAL />
              </type>
            </variable>
            <variable name="high">
              <type>
                <REAL />
              </type>
            </variable>
          </inputVars>
        </interface>
        <body>
          <ST>
            WORD_TO_RANGE := (high - low) * WORD_TO_REAL(X) * 0.00001525902189669640 + low;


(* revision history
hm	9. jan 2008	rev 1.0
	original version

hm	10. mar. 2009	rev 1.1
	improved code
*)

          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>074eb890-2b31-4151-9d1b-6c4e7b56e123</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="LIST_ADD" pouType="function">
        <interface>
          <returnType>
            <BOOL />
          </returnType>
          <inputVars>
            <variable name="SEP">
              <type>
                <BYTE />
              </type>
            </variable>
            <variable name="INS">
              <type>
                <string length="LIST_LENGTH" />
              </type>
            </variable>
          </inputVars>
          <inOutVars>
            <variable name="LIST">
              <type>
                <string length="LIST_LENGTH" />
              </type>
            </variable>
          </inOutVars>
          <localVars>
            <variable name="sx">
              <type>
                <string length="1" />
              </type>
            </variable>
          </localVars>
        </interface>
        <body>
          <ST>
            sx := CHR_TO_STRING(SEP);			(* convert separation character to string *)
INS := CONCAT(sx, INS);					(* start element with separation character *)

IF LEN(LIST) + LEN(INS) &gt; LIST_LENGTH THEN
	LIST_ADD := FALSE;					(* return false if element does not fit *)
ELSE
	LIST := CONCAT(LIST, INS);
	LIST_ADD := TRUE;
END_IF;


(* revision histroy

hm	21. mar. 2011	rev 2.0
	original release
*)	

          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>3a195f14-6261-4bc1-a8bf-520e3a9ead27</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="LIST_CLEAN" pouType="function">
        <interface>
          <returnType>
            <BOOL />
          </returnType>
          <inputVars>
            <variable name="SEP">
              <type>
                <BYTE />
              </type>
            </variable>
          </inputVars>
          <inOutVars>
            <variable name="LIST">
              <type>
                <string length="LIST_LENGTH" />
              </type>
            </variable>
          </inOutVars>
          <localVars>
            <variable name="pt">
              <type>
                <pointer>
                  <baseType>
                    <array>
                      <dimension lower="1" upper="LIST_LENGTH" />
                      <baseType>
                        <BYTE />
                      </baseType>
                    </array>
                  </baseType>
                </pointer>
              </type>
            </variable>
            <variable name="read">
              <type>
                <INT />
              </type>
              <initialValue>
                <simpleValue value="1" />
              </initialValue>
            </variable>
            <variable name="write">
              <type>
                <INT />
              </type>
              <initialValue>
                <simpleValue value="1" />
              </initialValue>
            </variable>
            <variable name="last">
              <type>
                <BYTE />
              </type>
            </variable>
            <variable name="c">
              <type>
                <BYTE />
              </type>
            </variable>
          </localVars>
        </interface>
        <body>
          <ST>
            pt := ADR(LIST);

FOR read := 1 TO LIST_LENGTH DO
	c := pt^[read];								(* read character from list *)
	IF c = 0 THEN EXIT;						(* exit the loop if character definbes end of string *)
	ELSIF c &lt;&gt; SEP OR sep &lt;&gt; last THEN	(* copy element from read to write position unless a double sep character is present *)
		pt^[write] := c;
		write := write + 1;
	END_IF;
	last := c;									(* remember last character *)
END_FOR;

IF last = SEP THEN write := write - 1; END_IF;		(* if last character is sep then delete empty element at end *)
IF write &lt;= STRING_LENGTH THEN pt^[write] := 0;	 END_IF;		(* terminate string with 0 *)

LIST_CLEAN := TRUE;						(* retrun TRUE *)


(* revision histroy
hm	28. jun. 2008	rev 1.0
	original release

hm	19. jan. 2011	rev 1.1
	changed string(255) to string(LIST_LENGTH)

hm	21. mar. 2011	rev 2.0
	all elements start with SEP

*)	

          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>ba694ce7-b177-447d-8537-659f2d3531df</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="LIST_GET" pouType="function">
        <interface>
          <returnType>
            <string length="LIST_LENGTH" />
          </returnType>
          <inputVars>
            <variable name="SEP">
              <type>
                <BYTE />
              </type>
            </variable>
            <variable name="POS">
              <type>
                <INT />
              </type>
            </variable>
          </inputVars>
          <inOutVars>
            <variable name="LIST">
              <type>
                <string length="LIST_LENGTH" />
              </type>
            </variable>
          </inOutVars>
          <localVars>
            <variable name="i">
              <type>
                <INT />
              </type>
              <initialValue>
                <simpleValue value="1" />
              </initialValue>
            </variable>
            <variable name="o">
              <type>
                <INT />
              </type>
              <initialValue>
                <simpleValue value="1" />
              </initialValue>
            </variable>
            <variable name="pt">
              <type>
                <pointer>
                  <baseType>
                    <array>
                      <dimension lower="1" upper="LIST_LENGTH" />
                      <baseType>
                        <BYTE />
                      </baseType>
                    </array>
                  </baseType>
                </pointer>
              </type>
            </variable>
            <variable name="po">
              <type>
                <pointer>
                  <baseType>
                    <array>
                      <dimension lower="1" upper="LIST_LENGTH" />
                      <baseType>
                        <BYTE />
                      </baseType>
                    </array>
                  </baseType>
                </pointer>
              </type>
            </variable>
            <variable name="cnt">
              <type>
                <INT />
              </type>
              <initialValue>
                <simpleValue value="0" />
              </initialValue>
            </variable>
            <variable name="c">
              <type>
                <BYTE />
              </type>
            </variable>
          </localVars>
        </interface>
        <body>
          <ST>
            pt := ADR(LIST);							(* load pointers *)
po := ADR(LIST_GET);

REPEAT
	c := pt^[i];
	IF cnt = pos THEN						(* copy element to output string *)
		IF c = SEP  THEN EXIT; END_IF;		(* next element stop copy and finish *)
		po^[o] := c;
		o := o + 1;
	ELSIF c = SEP THEN
		cnt := cnt + 1;
	END_IF;
	i := i + 1;
UNTIL
	(i = LIST_LENGTH) OR (c = 0)
END_REPEAT;
po^[o] := 0;						(* close the output string *)



(* revision histroy
hm	20. jun. 2008	rev 1.0
	original release

hm	19. jan. 2011	rev 1.1
	changed string(255) to strring(LIST_LENGTH)

hm	21. mar. 2011	rev 2.0
	all list elements start with SEP
*)	

          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>a64401af-0c70-45ad-8e84-73eb4e4722a5</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="LIST_INSERT" pouType="function">
        <interface>
          <returnType>
            <BOOL />
          </returnType>
          <inputVars>
            <variable name="SEP">
              <type>
                <BYTE />
              </type>
            </variable>
            <variable name="POS">
              <type>
                <INT />
              </type>
            </variable>
            <variable name="INS">
              <type>
                <string length="LIST_LENGTH" />
              </type>
            </variable>
          </inputVars>
          <inOutVars>
            <variable name="LIST">
              <type>
                <string length="LIST_LENGTH" />
              </type>
            </variable>
          </inOutVars>
          <localVars>
            <variable name="pt">
              <type>
                <pointer>
                  <baseType>
                    <array>
                      <dimension lower="1" upper="LIST_LENGTH" />
                      <baseType>
                        <BYTE />
                      </baseType>
                    </array>
                  </baseType>
                </pointer>
              </type>
            </variable>
            <variable name="read">
              <type>
                <INT />
              </type>
              <initialValue>
                <simpleValue value="1" />
              </initialValue>
            </variable>
            <variable name="cnt">
              <type>
                <INT />
              </type>
              <initialValue>
                <simpleValue value="1" />
              </initialValue>
            </variable>
            <variable name="sx">
              <type>
                <string length="1" />
              </type>
            </variable>
          </localVars>
        </interface>
        <body>
          <ST>
            (* load pointers *)
pt := ADR(LIST);

IF LEN(ins) + 1 + LEN(LIST) &gt; LIST_LENGTH THEN
	LIST_INSERT := FALSE;
ELSE
	LIST_INSERT := TRUE;
	(* search for position *)
	WHILE read &lt; LIST_LENGTH DO
		IF cnt &gt;= POS THEN
			sx := CHR_TO_STRING(SEP);
			INS := CONCAT(sx, INS);
			LIST := INSERT(LIST, INS, read - 1);
			LIST_INSERT := TRUE;
			RETURN;
		END_IF;
		IF pt^[read]  = 0 THEN				(* list is too short add empty element *)
			pt^[read] := SEP;
			pt^[read + 1] := 0;
		END_IF;
		read := read + 1;
		IF pt^[read] = SEP OR pt^[read] = 0 THEN cnt := cnt + 1; END_IF;
	END_WHILE;
END_IF;



(* revision histroy
hm	28. jun. 2008	rev 1.0
	original release

hm	17. dec. 2008	rev 1.1
	changes name of function chr to chr_to_string

hm	19. jan. 2011	rev 1.2
	changed string(255) to string(LIST_LENGTH)

hm	21. mar. 2011	rev 2.0
	all list elements start with SEP
	
*)	

          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>cd5aea60-039c-4d2b-93db-5326f4eec480</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="LIST_LEN" pouType="function">
        <interface>
          <returnType>
            <INT />
          </returnType>
          <inputVars>
            <variable name="SEP">
              <type>
                <BYTE />
              </type>
            </variable>
          </inputVars>
          <inOutVars>
            <variable name="LIST">
              <type>
                <string length="LIST_LENGTH" />
              </type>
            </variable>
          </inOutVars>
          <localVars>
            <variable name="pt">
              <type>
                <pointer>
                  <baseType>
                    <array>
                      <dimension lower="1" upper="LIST_LENGTH" />
                      <baseType>
                        <BYTE />
                      </baseType>
                    </array>
                  </baseType>
                </pointer>
              </type>
            </variable>
            <variable name="pos">
              <type>
                <INT />
              </type>
              <initialValue>
                <simpleValue value="1" />
              </initialValue>
            </variable>
            <variable name="c">
              <type>
                <BYTE />
              </type>
            </variable>
          </localVars>
        </interface>
        <body>
          <ST>
            pt := ADR(LIST);
LIST_LEN := 0;
REPEAT
	c := pt^[pos];
	IF c = SEP THEN LIST_LEN := LIST_LEN + 1; END_IF;
	pos := pos + 1;
UNTIL
	c = 0 OR pos &gt; LIST_LENGTH
END_REPEAT;



(* revision histroy
hm	25. jun. 2008	rev 1.0
	original release

hm	16. oct. 2008	rev 1.1
	fixed a problem where list_len would only work up to LIST_LENGTH

hm	19. jan. 2001	rev 1.2
	changed string(255) to string(LIST_LENGTH)

hm	21. mar. 2011	rev 2.0
	all list elements start with SEP

*)	

          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>abc68bcb-40c0-4add-ab5a-15ebfad63cac</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="LIST_NEXT" pouType="functionBlock">
        <interface>
          <inputVars>
            <variable name="SEP">
              <type>
                <BYTE />
              </type>
            </variable>
            <variable name="RST">
              <type>
                <BOOL />
              </type>
            </variable>
          </inputVars>
          <inOutVars>
            <variable name="LIST">
              <type>
                <string length="LIST_LENGTH" />
              </type>
            </variable>
          </inOutVars>
          <outputVars>
            <variable name="LEL">
              <type>
                <string length="LIST_LENGTH" />
              </type>
            </variable>
            <variable name="NUL">
              <type>
                <BOOL />
              </type>
            </variable>
          </outputVars>
          <localVars>
            <variable name="pos">
              <type>
                <INT />
              </type>
              <initialValue>
                <simpleValue value="1" />
              </initialValue>
            </variable>
            <variable name="pt">
              <type>
                <pointer>
                  <baseType>
                    <array>
                      <dimension lower="1" upper="LIST_LENGTH" />
                      <baseType>
                        <BYTE />
                      </baseType>
                    </array>
                  </baseType>
                </pointer>
              </type>
            </variable>
            <variable name="po">
              <type>
                <pointer>
                  <baseType>
                    <array>
                      <dimension lower="1" upper="LIST_LENGTH" />
                      <baseType>
                        <BYTE />
                      </baseType>
                    </array>
                  </baseType>
                </pointer>
              </type>
            </variable>
            <variable name="c">
              <type>
                <BYTE />
              </type>
            </variable>
            <variable name="write">
              <type>
                <INT />
              </type>
            </variable>
          </localVars>
        </interface>
        <body>
          <ST>
            pt := ADR(LIST);
po := ADR(LEL);

IF rst THEN
	pos := 1;
END_IF;

IF pt^[pos] = 0 OR pos = LIST_LENGTH THEN
	LEL := '';
	NUL := TRUE;
ELSE
	NUL := FALSE;
	write := 1;
	FOR pos := pos + 1 TO LIST_LENGTH DO
		c := pt^[pos];
		IF c = 0 OR c = SEP THEN
			po^[write] := 0;
			RETURN;
		ELSE
			po^[write] := pt^[pos];
			write := write + 1;
		END_IF;
	END_FOR;
END_IF;




(* revision histroy
hm	25. jun. 2008	rev 1.0
	original release

hm	19. jan. 2011	rev 1.1
	changed string(255) to string(LIST_LENGTH)	

hm	21. mar. 2011	rev 2.0
	all elements start with SEP

*)	

          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>777bd2ec-3e34-4d37-9e62-ff2eb43fca32</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="LIST_RETRIEVE" pouType="function">
        <interface>
          <returnType>
            <string length="LIST_LENGTH" />
          </returnType>
          <inputVars>
            <variable name="SEP">
              <type>
                <BYTE />
              </type>
            </variable>
            <variable name="POS">
              <type>
                <INT />
              </type>
            </variable>
          </inputVars>
          <inOutVars>
            <variable name="LIST">
              <type>
                <string length="LIST_LENGTH" />
              </type>
            </variable>
          </inOutVars>
          <localVars>
            <variable name="i">
              <type>
                <INT />
              </type>
            </variable>
            <variable name="o">
              <type>
                <INT />
              </type>
              <initialValue>
                <simpleValue value="1" />
              </initialValue>
            </variable>
            <variable name="w">
              <type>
                <INT />
              </type>
              <initialValue>
                <simpleValue value="1" />
              </initialValue>
            </variable>
            <variable name="pt">
              <type>
                <pointer>
                  <baseType>
                    <array>
                      <dimension lower="1" upper="LIST_LENGTH" />
                      <baseType>
                        <BYTE />
                      </baseType>
                    </array>
                  </baseType>
                </pointer>
              </type>
            </variable>
            <variable name="po">
              <type>
                <pointer>
                  <baseType>
                    <array>
                      <dimension lower="1" upper="LIST_LENGTH" />
                      <baseType>
                        <BYTE />
                      </baseType>
                    </array>
                  </baseType>
                </pointer>
              </type>
            </variable>
            <variable name="cnt">
              <type>
                <INT />
              </type>
              <initialValue>
                <simpleValue value="0" />
              </initialValue>
            </variable>
            <variable name="c">
              <type>
                <BYTE />
              </type>
            </variable>
          </localVars>
        </interface>
        <body>
          <ST>
            (* load pointers *)
pt := ADR(LIST);
po := ADR(LIST_RETRIEVE);

IF pos &gt; 0 THEN
	FOR i := 1 TO LIST_LENGTH DO
		c := pt^[i];
		IF c = 0 THEN
			po^[o] := 0;
			IF cnt &lt; pos THEN pt^[w + 1] := 0; ELSE pt^[w] := 0; END_IF;
			RETURN;
		ELSIF cnt = pos AND c &lt;&gt; SEP THEN				(* we have found the element *)
			po^[o] := pt^[i];
			o := o + 1;
		ELSIF cnt &gt;= pos THEN
			pt^[w] := c;
			w := w + 1;
		ELSE
			w := i;
		END_IF;
		IF c = sep THEN cnt := cnt + 1; END_IF;
	END_FOR;
ELSE
	LIST_RETRIEVE := '';
END_IF;


(* revision histroy
hm	28. jun. 2008	rev 1.0
	original release

hm	19. jan. 2011	rev 1.1
	changed string(255) to string(LIST_LENGTH)

hm	21. mar. 2011	rev 2.0
	all elements start with SEP
*)	

          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>8313d379-8136-4592-8d5a-41d4ebca306f</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="LIST_RETRIEVE_LAST" pouType="function">
        <interface>
          <returnType>
            <string length="LIST_LENGTH" />
          </returnType>
          <inputVars>
            <variable name="SEP">
              <type>
                <BYTE />
              </type>
            </variable>
          </inputVars>
          <inOutVars>
            <variable name="LIST">
              <type>
                <string length="LIST_LENGTH" />
              </type>
            </variable>
          </inOutVars>
          <localVars>
            <variable name="i">
              <type>
                <INT />
              </type>
            </variable>
            <variable name="last">
              <type>
                <INT />
              </type>
              <initialValue>
                <simpleValue value="1" />
              </initialValue>
            </variable>
            <variable name="pt">
              <type>
                <pointer>
                  <baseType>
                    <array>
                      <dimension lower="1" upper="LIST_LENGTH" />
                      <baseType>
                        <BYTE />
                      </baseType>
                    </array>
                  </baseType>
                </pointer>
              </type>
            </variable>
            <variable name="c">
              <type>
                <BYTE />
              </type>
            </variable>
          </localVars>
        </interface>
        <body>
          <ST>
            (* load pointers *)
pt := ADR(LIST);

(* search position of last element *)
FOR i := 1 TO LIST_LENGTH DO
	c := pt^[i];
	IF c = 0 THEN
		EXIT;
	ELSIF C = SEP THEN
		last := i;
	END_IF;
END_FOR;
(* return last element of list *)
LIST_RETRIEVE_LAST := MID(LIST, LIST_LENGTH, last + 1);
(* terminate list at i *)
pt^[last] := 0;



(* revision histroy
hm	21. mar. 2011	rev 2.0
	new module
*)	
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>97920f78-e126-4bf9-80b9-c8ab839a665a</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="COUNT_BR" pouType="functionBlock">
        <interface>
          <inputVars>
            <variable name="SET">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="IN">
              <type>
                <BYTE />
              </type>
            </variable>
            <variable name="UP">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="DN">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="STEP">
              <type>
                <BYTE />
              </type>
              <initialValue>
                <simpleValue value="1" />
              </initialValue>
            </variable>
            <variable name="MX">
              <type>
                <BYTE />
              </type>
              <initialValue>
                <simpleValue value="255" />
              </initialValue>
            </variable>
            <variable name="RST">
              <type>
                <BOOL />
              </type>
            </variable>
          </inputVars>
          <outputVars>
            <variable name="CNT">
              <type>
                <BYTE />
              </type>
            </variable>
          </outputVars>
          <localVars>
            <variable name="last_up">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="last_dn">
              <type>
                <BOOL />
              </type>
            </variable>
          </localVars>
        </interface>
        <body>
          <ST>
            IF rst THEN
	cnt := 0;
ELSIF set THEN
	cnt := LIMIT(0,in,mx);
ELSIF up AND NOT last_up THEN
	cnt := INT_TO_BYTE(INC(cnt,step,mx));
ELSIF dn AND NOT last_dn THEN
	cnt := INT_TO_BYTE(inc(cnt,-step,mx));
END_IF;
last_up := up;
last_dn := dn;

(* revision history
hm	16. jan 2008	rev 1.0
	original version

*)
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>2eb18d0f-4b84-475c-9575-bcf8ec36acbf</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="COUNT_DR" pouType="functionBlock">
        <interface>
          <inputVars>
            <variable name="SET">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="IN">
              <type>
                <DWORD />
              </type>
            </variable>
            <variable name="UP">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="DN">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="STEP">
              <type>
                <DWORD />
              </type>
              <initialValue>
                <simpleValue value="1" />
              </initialValue>
            </variable>
            <variable name="MX">
              <type>
                <DWORD />
              </type>
              <initialValue>
                <simpleValue value="16#FFFFFFFF" />
              </initialValue>
            </variable>
            <variable name="RST">
              <type>
                <BOOL />
              </type>
            </variable>
          </inputVars>
          <outputVars>
            <variable name="CNT">
              <type>
                <DWORD />
              </type>
            </variable>
          </outputVars>
          <localVars>
            <variable name="last_up">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="last_dn">
              <type>
                <BOOL />
              </type>
            </variable>
          </localVars>
        </interface>
        <body>
          <ST>
            IF rst THEN
	cnt := 0;
ELSIF set THEN
	cnt := LIMIT(0,in,mx);
ELSIF up AND NOT last_up THEN
	IF STEP &gt; MX - CNT THEN
		CNT := CNT - MX + STEP - 1;
	ELSE
		CNT := CNT + STEP;
	END_IF;
ELSIF dn AND NOT last_dn THEN
	IF STEP &gt; CNT THEN
		CNT := CNT - STEP + MX + 1;
	ELSE
		CNT := CNT - STEP;
	END_IF;
END_IF;
last_up := up;
last_dn := dn;

(* revision history
hm	12. jun 2008	rev 1.0
	original version

hm	20. jan. 2011	rev 1.1
	corrected init value of MX to 16#FFFFFFFF

*)
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>f6b237b9-1240-4ddf-9bd0-2b61bc27f61e</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="FF_D2E" pouType="functionBlock">
        <interface>
          <inputVars>
            <variable name="D0">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="D1">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="CLK">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="RST">
              <type>
                <BOOL />
              </type>
            </variable>
          </inputVars>
          <outputVars>
            <variable name="Q0">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="Q1">
              <type>
                <BOOL />
              </type>
            </variable>
          </outputVars>
          <localVars>
            <variable name="edge">
              <type>
                <BOOL />
              </type>
            </variable>
          </localVars>
        </interface>
        <body>
          <ST>
            IF rst THEN
	Q0 := FALSE;
	Q1 := FALSE;
ELSIF clk AND NOT edge THEN
	Q0 := D0;
	Q1 := D1;
END_IF;
edge := CLK;

(* revision history
hm	25. dec 2007	rev 1.0
	original version

hm	27. dec 2007	rev 1.1
	changed code for better performance

hm	30. oct. 200	rev 1.2
	deleted unnecessary init with 0

hm	14. mar. 2009	rev 1.3
	removed double assignments

*)

          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>c5cd2c86-8949-414e-8618-d5fde4eecc1d</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="FF_D4E" pouType="functionBlock">
        <interface>
          <inputVars>
            <variable name="D0">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="D1">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="D2">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="D3">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="CLK">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="RST">
              <type>
                <BOOL />
              </type>
            </variable>
          </inputVars>
          <outputVars>
            <variable name="Q0">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="Q1">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="Q2">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="Q3">
              <type>
                <BOOL />
              </type>
            </variable>
          </outputVars>
          <localVars>
            <variable name="edge">
              <type>
                <BOOL />
              </type>
            </variable>
          </localVars>
        </interface>
        <body>
          <ST>
            IF rst THEN
	Q0 := FALSE;
	Q1 := FALSE;
	Q2 := FALSE;
	Q3 := FALSE;
ELSIF clk AND NOT edge THEN
	Q0 := D0;
	Q1 := D1;
	Q2 := D2;
	Q3 := D3;
END_IF;
edge := CLK;

(* revision history
hm	4. aug 2006	rev 1.0
	original version

hm	27. dec 2007	rev 1.1
	changed code for better performance

hm	30. oct. 200	rev 1.2
	deleted unnecessary init with 0

hm	14. mar. 2009	rev 1.3
	removed double assignments

*)

          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>3003724d-55e5-44c3-bd72-e8c9ea919bd1</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="FF_DRE" pouType="functionBlock">
        <interface>
          <inputVars>
            <variable name="SET">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="D">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="CLK">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="RST">
              <type>
                <BOOL />
              </type>
            </variable>
          </inputVars>
          <outputVars>
            <variable name="Q">
              <type>
                <BOOL />
              </type>
            </variable>
          </outputVars>
          <localVars>
            <variable name="edge">
              <type>
                <BOOL />
              </type>
            </variable>
          </localVars>
        </interface>
        <body>
          <ST>
            IF rst OR set THEN
	Q := NOT rst;
ELSIF clk AND NOT edge THEN
	Q := D;
END_IF;
edge := CLK;

(* revision history
hm	4. aug 2006		rev 1.0
	original version

hm	27. dec 2007	rev 1.1
	changed code for better performance

hm	30. oct. 2008	rev 1.2
	optimized performance
*)
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>4b7be38c-0e8e-4ed6-9162-4408c16fd77c</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="FF_JKE" pouType="functionBlock">
        <interface>
          <inputVars>
            <variable name="SET">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="J">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="CLK">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="K">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="RST">
              <type>
                <BOOL />
              </type>
            </variable>
          </inputVars>
          <outputVars>
            <variable name="Q">
              <type>
                <BOOL />
              </type>
            </variable>
          </outputVars>
          <localVars>
            <variable name="edge">
              <type>
                <BOOL />
              </type>
            </variable>
          </localVars>
        </interface>
        <body>
          <ST>
            IF rst OR set THEN
	Q := NOT rst;
ELSIF clk AND NOT edge THEN
	IF J XOR K THEN Q := J;
	ELSE Q := K XOR Q;
	END_IF;
END_IF;
edge := CLK;

(* revision history
hm	4. aug 2006		rev 1.0
	original version

hm	27. dec 2007	rev 1.1
	changed code for better performance

hm	30. oct. 2008	rev 1.2
	optimized performance
*)
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>cf3dac86-e5ef-4fb2-8af4-4e723c7163de</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="FF_RSE" pouType="functionBlock">
        <interface>
          <inputVars>
            <variable name="CS">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="CR">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="RST">
              <type>
                <BOOL />
              </type>
            </variable>
          </inputVars>
          <outputVars>
            <variable name="Q">
              <type>
                <BOOL />
              </type>
            </variable>
          </outputVars>
          <localVars>
            <variable name="es">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="er">
              <type>
                <BOOL />
              </type>
            </variable>
          </localVars>
        </interface>
        <body>
          <ST>
            IF rst THEN
	(* asynchronous reset *)
	Q := FALSE;
ELSIF CR AND NOT er THEN
	(* rising edge on CR *)
	Q := FALSE;
ELSIF CS AND NOT es THEN
	(* rising edge on CS *)
	Q := TRUE;
END_IF;

es := CS;
er := CR;

(* revision history

hm	16. jul. 2008	rev 1.0
	original version

*)




          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>928c03da-77e0-431a-84b6-7164e1fd7091</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="SELECT_8" pouType="functionBlock">
        <interface>
          <inputVars>
            <variable name="E">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="SET">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="IN">
              <type>
                <BYTE />
              </type>
            </variable>
            <variable name="UP">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="DN">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="RST">
              <type>
                <BOOL />
              </type>
            </variable>
          </inputVars>
          <outputVars>
            <variable name="Q0">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="Q1">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="Q2">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="Q3">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="Q4">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="Q5">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="Q6">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="Q7">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="STATE">
              <type>
                <INT />
              </type>
            </variable>
          </outputVars>
          <localVars>
            <variable name="last_up">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="last_dn">
              <type>
                <BOOL />
              </type>
            </variable>
          </localVars>
        </interface>
        <body>
          <ST>
            IF rst THEN
	state := 0;
ELSIF set THEN
	state := IN;
ELSIF up AND NOT last_up THEN
	state := inc(state,1,7);
ELSIF dn AND NOT last_dn THEN
	state := inc(state,-1,7);
END_IF;
last_UP := UP;
last_DN := DN;

Q0 := FALSE;
Q1 := FALSE;
Q2 := FALSE;
Q3 := FALSE;
Q4 := FALSE;
Q5 := FALSE;
Q6 := FALSE;
Q7 := FALSE;

IF E THEN
	CASE state OF
		0: Q0 := TRUE;
		1: Q1 := TRUE;
		2: Q2 := TRUE;
		3: Q3 := TRUE;
		4: Q4 := TRUE;
		5: Q5 := TRUE;
		6: Q6 := TRUE;
		7: Q7 := TRUE;
	END_CASE;
END_IF;

(* revision history
hm	16. jan 2008	rev 1.0
	original version

hm	27. feb. 2009	rev 1.1
	renamed input en to e
*)
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>42dd8f10-61b7-4973-b8c6-7a9e8f17ac45</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="SHR_4E" pouType="functionBlock">
        <interface>
          <inputVars>
            <variable name="SET">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="D0">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="CLK">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="RST">
              <type>
                <BOOL />
              </type>
            </variable>
          </inputVars>
          <outputVars>
            <variable name="Q0">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="Q1">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="Q2">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="Q3">
              <type>
                <BOOL />
              </type>
            </variable>
          </outputVars>
          <localVars>
            <variable name="trig">
              <type>
                <derived name="R_TRIG" />
              </type>
            </variable>
          </localVars>
        </interface>
        <body>
          <ST>
            (* trig.Q signals a rising edge on clk *)
trig(clk := clk);

IF set OR rst THEN
	Q0 := NOT rst;
	Q1 := Q0;
	Q2 := Q0;
	Q3 := Q0;
ELSIF trig.Q THEN
	Q3 := Q2;
	Q2 := Q1;
	Q1 := Q0;
	Q0 := D0;
END_IF;



(* revision history
hm	4. aug. 2006	rev 1.0
	original version

hm	25. oct. 2008	rev 1.1
	optimized code

*)
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>fc1185b8-a8f6-4a86-9331-7e8ed2e148b9</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="SHR_4UDE" pouType="functionBlock">
        <interface>
          <inputVars>
            <variable name="SET">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="D0">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="D3">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="CLK">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="DN">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="RST">
              <type>
                <BOOL />
              </type>
            </variable>
          </inputVars>
          <outputVars>
            <variable name="Q0">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="Q1">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="Q2">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="Q3">
              <type>
                <BOOL />
              </type>
            </variable>
          </outputVars>
          <localVars>
            <variable name="trig">
              <type>
                <derived name="R_TRIG" />
              </type>
            </variable>
          </localVars>
        </interface>
        <body>
          <ST>
            (* trig.Q signals a rising edge on clk *)
trig(clk := clk);

IF set OR rst THEN
	Q0 := NOT RST;
	Q1 := Q0;
	Q2 := Q0;
	Q3 := Q0;
ELSIF trig.Q THEN
	IF dn THEN
		Q0 := Q1;
		Q1 := Q2;
		Q2 := Q3;
		Q3 := D3;
	ELSE
		Q3 := Q2;
		Q2 := Q1;
		Q1 := Q0;
		Q0 := D0;
	END_IF;
END_IF;



(* revision history
hm	4. aug. 2006	rev 1.0
	original version

hm	25. oct. 2008	rev 1.1
	optimized code

hm	14. mar. 2009	rev 1.2
	removed double assignments

*)
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>3bab1a53-573e-407d-a9cc-f18bc9b2401e</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="SHR_8PLE" pouType="functionBlock">
        <interface>
          <inputVars>
            <variable name="Din">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="Dload">
              <type>
                <BYTE />
              </type>
            </variable>
            <variable name="CLK">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="UP">
              <type>
                <BOOL />
              </type>
              <initialValue>
                <simpleValue value="1" />
              </initialValue>
            </variable>
            <variable name="load">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="RST">
              <type>
                <BOOL />
              </type>
            </variable>
          </inputVars>
          <outputVars>
            <variable name="DOut">
              <type>
                <BOOL />
              </type>
            </variable>
          </outputVars>
          <localVars>
            <variable name="edge">
              <type>
                <BOOL />
              </type>
              <initialValue>
                <simpleValue value="1" />
              </initialValue>
            </variable>
            <variable name="register">
              <type>
                <BYTE />
              </type>
            </variable>
          </localVars>
        </interface>
        <body>
          <ST>
            (* flankenerkennung clk wird high und edge war high reset ist nicht aktiv und set ist nicht aktiv *)
IF CLK AND edge AND NOT rst THEN
	edge := FALSE;	(* flanke wurde erkannt und weitere flankenerkennung wird verhindert bis edge wieder true ist *)
	(* hier ist der code für das flankenevent *)
	IF UP THEN						(*shift up *)
		register := SHL(register,1);
		register.0 := Din;
		Dout := register.7;
	ELSE								(* shift down *);
		register := SHR(register,1);
		register.7 := Din;
		Dout := register.0;
	END_IF;
	IF load THEN							(* the byte on Din will be loaded if load = true *)
		register := Dload;
		IF up THEN Dout := register.7; ELSE Dout := register.0; END_IF;
	END_IF;
END_IF;
IF NOT clk THEN edge := TRUE; END_IF;	(* sobald clk wieder low wird warten auf nächste flanke *)
IF rst THEN									(* wenn reset aktiv dann ausgang rücksetzen *)
	register := 0;
	Dout := FALSE;
END_IF;

          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>f75e6d78-6410-4143-b5f4-86bb8cc31ceb</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="SHR_8UDE" pouType="functionBlock">
        <interface>
          <inputVars>
            <variable name="SET">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="D0">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="D7">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="CLK">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="DN">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="RST">
              <type>
                <BOOL />
              </type>
            </variable>
          </inputVars>
          <outputVars>
            <variable name="Q0">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="Q1">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="Q2">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="Q3">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="Q4">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="Q5">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="Q6">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="Q7">
              <type>
                <BOOL />
              </type>
            </variable>
          </outputVars>
          <localVars>
            <variable name="trig">
              <type>
                <derived name="R_TRIG" />
              </type>
            </variable>
          </localVars>
        </interface>
        <body>
          <ST>
            (* trig.Q signals a rising edge on clk *)
trig(clk := clk);

IF set OR rst THEN
	Q0 := NOT RST;
	Q1 := Q0;
	Q2 := Q0;
	Q3 := Q0;
	Q4 := Q0;
	Q5 := Q0;
	Q6 := Q0;
	Q7 := Q0;
ELSIF trig.Q THEN
	IF dn THEN
		Q0 := Q1;
		Q1 := Q2;
		Q2 := Q3;
		Q3 := Q4;
		Q4 := Q5;
		Q5 := Q6;
		Q6 := Q7;
		Q7 := D7;
	ELSE
		Q7 := Q6;
		Q6 := Q5;
		Q5 := Q4;
		Q4 := Q3;
		Q3 := Q2;
		Q2 := Q1;
		Q1 := Q0;
		Q0 := D0;
	END_IF;
END_IF;



(* revision history
hm	4. aug. 2006	rev 1.0
	original version

hm	25. oct. 2008	rev 1.1
	optimized code

hm	14. mar. 2009	rev 1.2
	removed double assignments

*)
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>11466230-d2bd-466e-a508-0faad5b023fa</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="TOGGLE" pouType="functionBlock">
        <interface>
          <inputVars>
            <variable name="CLK">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="rst">
              <type>
                <BOOL />
              </type>
            </variable>
          </inputVars>
          <outputVars>
            <variable name="Q">
              <type>
                <BOOL />
              </type>
            </variable>
          </outputVars>
          <localVars>
            <variable name="edge">
              <type>
                <BOOL />
              </type>
            </variable>
          </localVars>
        </interface>
        <body>
          <ST>
            IF rst THEN
	q := 0;
ELSIF clk AND NOT edge THEN
	Q := NOT Q;
END_IF;
edge := clk;

(* revision history

hm	13.9.2007		rev 1.0
	original version

hm	30. oct. 2008	rev 1.1
	deleted unnecessary init

*)




          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>0b0d9bb4-7976-4fd3-8ee8-37d2e4d3dc93</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="LTCH" pouType="functionBlock">
        <interface>
          <inputVars>
            <variable name="D">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="L">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="RST">
              <type>
                <BOOL />
              </type>
            </variable>
          </inputVars>
          <outputVars>
            <variable name="Q">
              <type>
                <BOOL />
              </type>
            </variable>
          </outputVars>
        </interface>
        <body>
          <ST>
            (* as long as L is true, the latch is transparent and and change of D is transferred to Q *)
(* of course only when there is no asynchronous reset *)
IF rst THEN				(* if asynchronous reset then Q=0 *)
	Q := FALSE;
ELSIF L THEN			(* latch is transparent *)
	Q := D;
END_IF;


(* revision history
hm	4. aug 2006		rev 1.0
	original version

hm	27. dec 2007	rev 1.1
	changed code for better performance

hm	30. oct. 2008	rev 1.2
	deleted unnecessary init with 0

*)
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>c86a8128-4e05-4536-8ffe-6190d4019eda</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="LTCH_4" pouType="functionBlock">
        <interface>
          <inputVars>
            <variable name="D0">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="D1">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="D2">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="D3">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="L">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="RST">
              <type>
                <BOOL />
              </type>
            </variable>
          </inputVars>
          <outputVars>
            <variable name="Q0">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="Q1">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="Q2">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="Q3">
              <type>
                <BOOL />
              </type>
            </variable>
          </outputVars>
        </interface>
        <body>
          <ST>
            (* as long as L is true, the latch is transparent and and change of D is transferred to Q *)
(* of course only when there is no asynchronous reset *)
IF rst THEN			(* if asynchronous reset then Q=0 *)
	Q0 := FALSE;
	Q1 := FALSE;
	Q2 := FALSE;
	Q3 := FALSE;
ELSIF L THEN			(* latch is transparent *)
	Q0 := D0;
	Q1 := D1;
	Q2 := D2;
	Q3 := D3;
END_IF;

(* revision history
hm	4. aug 2006	rev 1.0
	original version

hm	27. dec 2007	rev 1.1
	changed code for better performance

hm	30. oct. 2008	rev 1.2
	deleted unnecessary init with 0

hm	14. mar. 2009	rev 1.3
	removed double assignments

*)
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>648a82d8-4bb6-41f3-ae32-d70f86f3d3a1</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="STORE_8" pouType="functionBlock">
        <interface>
          <inputVars>
            <variable name="Set">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="D0">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="D1">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="D2">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="D3">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="D4">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="D5">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="D6">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="D7">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="Clr">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="Rst">
              <type>
                <BOOL />
              </type>
            </variable>
          </inputVars>
          <outputVars>
            <variable name="Q0">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="Q1">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="Q2">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="Q3">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="Q4">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="Q5">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="Q6">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="Q7">
              <type>
                <BOOL />
              </type>
            </variable>
          </outputVars>
          <localVars>
            <variable name="edge">
              <type>
                <BOOL />
              </type>
            </variable>
          </localVars>
        </interface>
        <body>
          <ST>
            IF rst OR set THEN
	q0 := NOT rst;
	q1 := q0;
	q2 := q0;
	q3 := q0;
	q4 := q0;
	q5 := q0;
	q6 := q0;
	q7 := q0;
ELSE
	IF D0 THEN Q0 := TRUE; END_IF;
	IF D1 THEN Q1 := TRUE; END_IF;
	IF D2 THEN Q2 := TRUE; END_IF;
	IF D3 THEN Q3 := TRUE; END_IF;
	IF D4 THEN Q4 := TRUE; END_IF;
	IF D5 THEN Q5 := TRUE; END_IF;
	IF D6 THEN Q6 := TRUE; END_IF;
	IF D7 THEN Q7 := TRUE; END_IF;

	IF clr AND NOT edge THEN
		IF q0 THEN q0 := FALSE;
		ELSIF q1 THEN q1 := FALSE;
		ELSIF q2 THEN q2 := FALSE;
		ELSIF q3 THEN q3 := FALSE;
		ELSIF q4 THEN q4 := FALSE;
		ELSIF q5 THEN q5 := FALSE;
		ELSIF q6 THEN q6 := FALSE;
		ELSE q7 := FALSE;
		END_IF;
	END_IF;
	edge := clr;
END_IF;


(* revision history
hm	25.12.2007	rev 1.0
	original version

hm	30. oct. 2008	rev 1.1
	optimized performance

hm	14. mar. 2009	rev 1.2
	removed double assignments

*)


          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>1ca98136-ced5-424a-9196-bc3c62b18edb</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="BCDC_TO_INT" pouType="function">
        <interface>
          <returnType>
            <INT />
          </returnType>
          <inputVars>
            <variable name="IN">
              <type>
                <BYTE />
              </type>
            </variable>
          </inputVars>
        </interface>
        <body>
          <ST>
            BCDC_TO_INT := (in AND 16#0F) + (SHR(in,4) * 10);

(* revision history
hm	13.12.2007	rev 1.0
	original version

hm	30.6.2008	rev 1.1
	changed name BCD_TO_INT to BCDC_TO_INT to avoid collision with util.lib

*)
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>77e81c5d-2976-410b-85ec-e353047abaf2</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="BIT_COUNT" pouType="function">
        <interface>
          <returnType>
            <INT />
          </returnType>
          <inputVars>
            <variable name="IN">
              <type>
                <DWORD />
              </type>
            </variable>
          </inputVars>
        </interface>
        <body>
          <ST>
            WHILE in &gt; 0 DO
	IF in.0 THEN Bit_Count := Bit_Count + 1; END_IF;
	in := SHR(in,1);
END_WHILE;



(* revision history
5.7.2007	rev 1.0		original version

10.9.2007	rev 1.1		hm
	changed algorithm for better performace
	the execution time has reduced by a factor of 5
	deleted unused variable temp
*)
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>eb31626d-d155-4916-9f99-f0ddb01ea318</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="BIT_LOAD_B" pouType="function">
        <interface>
          <returnType>
            <BYTE />
          </returnType>
          <inputVars>
            <variable name="IN">
              <type>
                <BYTE />
              </type>
            </variable>
            <variable name="VAL">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="POS">
              <type>
                <INT />
              </type>
            </variable>
          </inputVars>
          <localVars constant="true">
            <variable name="dat">
              <type>
                <BYTE />
              </type>
              <initialValue>
                <simpleValue value="1" />
              </initialValue>
            </variable>
          </localVars>
        </interface>
        <body>
          <ST>
            IF VAL THEN
	BIT_LOAD_B := in OR SHL(dat,pos);
ELSE
	BIT_LOAD_B := in AND (NOT SHL(dat,pos));
END_IF;


(* revision history
hm	29. feb 2008	rev 1.0
	original version

hm	16. mar 2008	rev 1.1
	change input bit to val for compatibility reasons
*)

          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>2f4a0cde-a6d2-4216-a27e-8064103bf992</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="BIT_LOAD_B2" pouType="function">
        <interface>
          <returnType>
            <BYTE />
          </returnType>
          <inputVars>
            <variable name="I">
              <type>
                <BYTE />
              </type>
            </variable>
            <variable name="D">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="P">
              <type>
                <INT />
              </type>
            </variable>
            <variable name="N">
              <type>
                <INT />
              </type>
            </variable>
          </inputVars>
        </interface>
        <body>
          <ST>
            IF D THEN
	BIT_LOAD_B2 := ROL(SHR(BYTE#255, 8 - N) OR ROR(i, P), P);
ELSE
	BIT_LOAD_B2 := ROL(SHL(BYTE#255, N) AND ROR(I, P), P);
END_IF;



(* revision history
hm	18. oct. 2008	rev 1.0
	original version


*)

          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>db7b475d-6f8c-4adf-9a69-a2563a8a2c29</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="BIT_LOAD_DW" pouType="function">
        <interface>
          <returnType>
            <DWORD />
          </returnType>
          <inputVars>
            <variable name="IN">
              <type>
                <DWORD />
              </type>
            </variable>
            <variable name="VAL">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="POS">
              <type>
                <INT />
              </type>
            </variable>
          </inputVars>
          <localVars constant="true">
            <variable name="dat">
              <type>
                <DWORD />
              </type>
              <initialValue>
                <simpleValue value="1" />
              </initialValue>
            </variable>
          </localVars>
        </interface>
        <body>
          <ST>
            IF val THEN
	BIT_LOAD_DW := in OR SHL(dat,pos);
ELSE
	BIT_LOAD_DW := in AND (NOT SHL(dat,pos));
END_IF;


(* revision history
hm	29. feb 2008	rev 1.0
	original version

hm	16. mar 2008	rev 1.1
	change input bit to val for compatibility reasons
*)


          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>e2099b24-35eb-41e3-8725-23ceced10029</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="BIT_LOAD_DW2" pouType="function">
        <interface>
          <returnType>
            <DWORD />
          </returnType>
          <inputVars>
            <variable name="I">
              <type>
                <DWORD />
              </type>
            </variable>
            <variable name="D">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="P">
              <type>
                <INT />
              </type>
            </variable>
            <variable name="N">
              <type>
                <INT />
              </type>
            </variable>
          </inputVars>
        </interface>
        <body>
          <ST>
            IF D THEN
	BIT_LOAD_DW2 := ROL(SHR(DWORD#4294967295, 32 - N) OR ROR(i, P), P);
ELSE
	BIT_LOAD_DW2 := ROL(SHL(DWORD#4294967295, N) AND ROR(I, P), P);
END_IF;



(* revision history
hm	18. oct. 2008	rev 1.0
	original version


*)

          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>68795e66-a55a-489d-864c-a94ca45f7188</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="BIT_LOAD_W" pouType="function">
        <interface>
          <returnType>
            <WORD />
          </returnType>
          <inputVars>
            <variable name="IN">
              <type>
                <WORD />
              </type>
            </variable>
            <variable name="VAL">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="POS">
              <type>
                <INT />
              </type>
            </variable>
          </inputVars>
          <localVars constant="true">
            <variable name="dat">
              <type>
                <WORD />
              </type>
              <initialValue>
                <simpleValue value="1" />
              </initialValue>
            </variable>
          </localVars>
        </interface>
        <body>
          <ST>
            IF val THEN
	BIT_LOAD_W := in OR SHL(dat,pos);
ELSE
	BIT_LOAD_W := in AND (NOT SHL(dat,pos));
END_IF;


(* revision history
hm	29. feb 2008	rev 1.0
	original version

hm	16. mar 2008	rev 1.1
	change input bit to val for compatibility reasons
*)

          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>3fdecd4f-4e5b-4a5f-8077-c759f1640d5c</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="BIT_LOAD_W2" pouType="function">
        <interface>
          <returnType>
            <WORD />
          </returnType>
          <inputVars>
            <variable name="I">
              <type>
                <WORD />
              </type>
            </variable>
            <variable name="D">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="P">
              <type>
                <INT />
              </type>
            </variable>
            <variable name="N">
              <type>
                <INT />
              </type>
            </variable>
          </inputVars>
        </interface>
        <body>
          <ST>
            IF D THEN
	BIT_LOAD_W2 := ROL(SHR(WORD#65535, 16 - N) OR ROR(i, P), P);
ELSE
	BIT_LOAD_W2 := ROL(SHL(WORD#65535, N) AND ROR(I, P), P);
END_IF;



(* revision history
hm	18. oct. 2008	rev 1.0
	original version


*)

          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>8d8417bf-8300-4f7d-94d2-c71b7fe41be6</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="BIT_OF_DWORD" pouType="function">
        <interface>
          <returnType>
            <BOOL />
          </returnType>
          <inputVars>
            <variable name="in">
              <type>
                <DWORD />
              </type>
            </variable>
            <variable name="N">
              <type>
                <INT />
              </type>
            </variable>
          </inputVars>
        </interface>
        <body>
          <ST>
            BIT_OF_DWORD := (SHR(in,N) AND 16#00000001) &gt; 0;


(* old code used before rev 1.1
temp := SHR(in,n);
Bit_of_Dword := temp.0;
*)


(* revision history
hm	4. aug. 2006	rev 1.0
	original version

hm	29. feb 2008	rev 1.1
	improved performance

hm	6. jun. 2008	rev 1.2
	changes type of input N from byte to int
*)

          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>550b633e-f461-449b-a7ab-b7faa9e42ded</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="BIT_TOGGLE_B" pouType="function">
        <interface>
          <returnType>
            <BYTE />
          </returnType>
          <inputVars>
            <variable name="IN">
              <type>
                <BYTE />
              </type>
            </variable>
            <variable name="POS">
              <type>
                <INT />
              </type>
            </variable>
          </inputVars>
        </interface>
        <body>
          <ST>
            BIT_TOGGLE_B := SHL(BYTE#1, POS) XOR IN;




(* revision history
hm	18. oct. 2008	rev 1.0
	original version


*)

          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>6e293a3b-c8bb-462d-bc7a-53c0eda127fa</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="BIT_TOGGLE_DW" pouType="function">
        <interface>
          <returnType>
            <DWORD />
          </returnType>
          <inputVars>
            <variable name="IN">
              <type>
                <DWORD />
              </type>
            </variable>
            <variable name="POS">
              <type>
                <INT />
              </type>
            </variable>
          </inputVars>
        </interface>
        <body>
          <ST>
            BIT_TOGGLE_DW := SHL(DWORD#1, POS) XOR IN;



(* revision history
hm	18. oct. 2008	rev 1.0
	original version


*)

          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>f0b47140-e760-4fc1-8b57-ea0dbc550782</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="BIT_TOGGLE_W" pouType="function">
        <interface>
          <returnType>
            <WORD />
          </returnType>
          <inputVars>
            <variable name="IN">
              <type>
                <WORD />
              </type>
            </variable>
            <variable name="POS">
              <type>
                <INT />
              </type>
            </variable>
          </inputVars>
        </interface>
        <body>
          <ST>
            BIT_TOGGLE_W := SHL(WORD#1, POS) XOR IN;



(* revision history
hm	18. oct. 2008	rev 1.0
	original version


*)

          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>59cab74d-e4fc-4774-9ca4-2030e0a40b08</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="BYTE_OF_BIT" pouType="function">
        <interface>
          <returnType>
            <BYTE />
          </returnType>
          <inputVars>
            <variable name="B0">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="B1">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="B2">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="B3">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="B4">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="B5">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="B6">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="B7">
              <type>
                <BOOL />
              </type>
            </variable>
          </inputVars>
        </interface>
        <body>
          <ST>
            Byte_of_bit := SHL(SHL(SHL(SHL(SHL(SHL(SHL(BOOL_TO_BYTE(B7),1) OR BOOL_TO_BYTE(B6),1) OR BOOL_TO_BYTE(B5),1) OR BOOL_TO_BYTE(B4),1)
	OR BOOL_TO_BYTE(B3),1) OR BOOL_TO_BYTE(B2),1) OR BOOL_TO_BYTE(B1),1) OR BOOL_TO_BYTE(B0);


(* revision history

hm	4. aug 2006		rev 1.0
	original version

hm	18. feb. 2008	rev 1.1
	improved performance

*)
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>8ce10eed-7022-4bdb-b6c9-e0e6b88a1730</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="BYTE_OF_DWORD" pouType="function">
        <interface>
          <returnType>
            <BYTE />
          </returnType>
          <inputVars>
            <variable name="in">
              <type>
                <DWORD />
              </type>
            </variable>
            <variable name="N">
              <type>
                <BYTE />
              </type>
            </variable>
          </inputVars>
        </interface>
        <body>
          <ST>
            BYTE_OF_DWORD := DWORD_TO_BYTE(SHR(in,SHL(n,3)));

(* revision history
hm	17. jan 2007	rev 1.0
	original version

hm	2. jan 2008		rev 1.1
	improved performance

hm	30. oct. 2008	rev 1.2
	improved performance
*)


          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>ae829d79-20e4-4564-a61c-9e5c0e87298b</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="BYTE_TO_BITS" pouType="functionBlock">
        <interface>
          <inputVars>
            <variable name="IN">
              <type>
                <BYTE />
              </type>
            </variable>
          </inputVars>
          <outputVars>
            <variable name="B0">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="B1">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="B2">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="B3">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="B4">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="B5">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="B6">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="B7">
              <type>
                <BOOL />
              </type>
            </variable>
          </outputVars>
        </interface>
        <body>
          <ST>
            B0 := IN.0;
B1 := IN.1;
B2 := IN.2;
B3 := IN.3;
B4 := IN.4;
B5 := IN.5;
B6 := IN.6;
B7 := IN.7;

(* revision history
hm		4. aug 2006	rev 1.0
	original version

hm		16. mar 2008	rev 1.1
	renamed from byte_to_bit to byte_to_bits for compatibility reasons

*)
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>031fbf88-0ffb-44b3-acc5-f5c6b2755a3b</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="BYTE_TO_GRAY" pouType="function">
        <interface>
          <returnType>
            <BYTE />
          </returnType>
          <inputVars>
            <variable name="IN">
              <type>
                <BYTE />
              </type>
            </variable>
          </inputVars>
        </interface>
        <body>
          <ST>
            BYTE_TO_GRAY := IN XOR SHR(IN,1);

(* revision history
hm	9. nov. 2009	rev 1.0
	original version

*)
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>107928b0-974b-4339-86cc-b3102f82dfbe</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="CHECK_PARITY" pouType="function">
        <interface>
          <returnType>
            <BOOL />
          </returnType>
          <inputVars>
            <variable name="in">
              <type>
                <DWORD />
              </type>
            </variable>
            <variable name="p">
              <type>
                <BOOL />
              </type>
            </variable>
          </inputVars>
        </interface>
        <body>
          <ST>
            CHECK_PARITY := NOT p;
WHILE in &gt; 0 DO
	CHECK_PARITY := CHECK_PARITY XOR in.0 XOR in.1 XOR in.2 XOR in.3;
	in := SHR(in,4);
END_WHILE;

(* code before rev 1.2
WHILE in &gt; 0 DO
	IF in.0 THEN cnt := cnt + 1; END_IF;
	in := SHR(in,1);
END_WHILE;
check_parity := even(cnt) XOR P;
*)


(* revision history

rev 1.0 HM  1.oct.2006

rev 1.1 hm	10.sep.2007
	changed algorithm to improove performance

rev 1.2	hm	8 dec 2007
	changed algorithm to improove performance

rev 1.3 hm	18. feb 2008
	changed algorithm to improove performance
*)
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>990a8875-29bf-45d6-a9fc-e1360e457b38</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="CHK_REAL" pouType="function">
        <interface>
          <returnType>
            <BYTE />
          </returnType>
          <inputVars>
            <variable name="X">
              <type>
                <REAL />
              </type>
            </variable>
          </inputVars>
          <localVars>
            <variable name="pt">
              <type>
                <pointer>
                  <baseType>
                    <DWORD />
                  </baseType>
                </pointer>
              </type>
            </variable>
            <variable name="tmp">
              <type>
                <DWORD />
              </type>
            </variable>
          </localVars>
        </interface>
        <body>
          <ST>
            pt := ADR(X);				(* move real to dword, real_to_dword does not work becasze it treats dword as a number on many systems *)
tmp := ROL(pt^,1);			(* rotate left foir easy checking, sign will be at lease significant digit *)
IF tmp &lt; 16#FF000000 THEN
	CHK_REAL := 16#00;		(* normalized and denormalized numbers *)
ELSIF tmp = 16#FF000000 THEN
	CHK_REAL := 16#20;		(* X is +infinity see IEEE754 *)
ELSIF tmp = 16#FF000001 THEN
	CHK_REAL := 16#40;		(* X is -infinity see IEEE754 *)
ELSE
	CHK_REAL := 16#80;		(* X is NAN see IEEE754 *)
END_IF;


(* revision history
hm	 20. jan. 2011	rev 1.0
	original version

*)
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>b4181737-75f2-4fac-bd90-eb82533f8e10</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="DEC_2" pouType="functionBlock">
        <interface>
          <inputVars>
            <variable name="D">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="A">
              <type>
                <BOOL />
              </type>
            </variable>
          </inputVars>
          <outputVars>
            <variable name="Q0">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="Q1">
              <type>
                <BOOL />
              </type>
            </variable>
          </outputVars>
        </interface>
        <body>
          <ST>
            Q0 := D AND NOT A;
Q1 := D AND A;

(* revision history
hm 3.3.2007	rev 1.1
	rewritten in ST for better compatibility

*)
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>74c468c0-e12e-48c7-b93c-5e5146f5c6e3</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="DEC_4" pouType="functionBlock">
        <interface>
          <inputVars>
            <variable name="D">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="A0">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="A1">
              <type>
                <BOOL />
              </type>
            </variable>
          </inputVars>
          <outputVars>
            <variable name="Q0">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="Q1">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="Q2">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="Q3">
              <type>
                <BOOL />
              </type>
            </variable>
          </outputVars>
        </interface>
        <body>
          <ST>
            Q0 := D AND NOT A0 AND NOT A1;
Q1 := D AND A0 AND NOT A1;
Q2 := D AND NOT A0 AND A1;
Q3 := D AND A0 AND A1;

(* revision history
hm 3.3.2007	rev 1.1
	rewritten in ST for better compatibility

*)
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>8aadb4b2-470f-4d40-8deb-7dd0b4a8b424</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="DEC_8" pouType="functionBlock">
        <interface>
          <inputVars>
            <variable name="D">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="A0">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="A1">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="A2">
              <type>
                <BOOL />
              </type>
            </variable>
          </inputVars>
          <outputVars>
            <variable name="Q0">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="Q1">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="Q2">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="Q3">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="Q4">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="Q5">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="Q6">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="Q7">
              <type>
                <BOOL />
              </type>
            </variable>
          </outputVars>
          <localVars>
            <variable name="X">
              <type>
                <INT />
              </type>
            </variable>
          </localVars>
        </interface>
        <body>
          <ST>
            X.0 := A0; X.1 := A1; X.2 := A2;

Q0 := FALSE;
Q1 := FALSE;
Q2 := FALSE;
Q3 := FALSE;
Q4 := FALSE;
Q5 := FALSE;
Q6 := FALSE;
Q7 := FALSE;

CASE X OF
	0 : Q0 := D;
	1 : Q1 := D;
	2 : Q2 := D;
	3 : Q3 := D;
	4 : Q4 := D;
	5 : Q5 := D;
	6 : Q6 := D;
	7 : Q7 := D;
END_CASE;



(* revision history
hm 3. mar. 2007	rev 1.1
	rewritten in ST for better compatibility

hm	26. oct. 2008	rev 1.2
	code optimized

hm	28. mar. 2009	rev 1.3
	replaced multiple assignments
*)
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>f383917f-82f0-4486-b3fa-bedb0a755915</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="DW_TO_REAL" pouType="function">
        <interface>
          <returnType>
            <REAL />
          </returnType>
          <inputVars>
            <variable name="X">
              <type>
                <DWORD />
              </type>
            </variable>
          </inputVars>
          <localVars>
            <variable name="pt">
              <type>
                <pointer>
                  <baseType>
                    <REAL />
                  </baseType>
                </pointer>
              </type>
            </variable>
          </localVars>
        </interface>
        <body>
          <ST>
            pt := ADR(X);
DW_TO_REAL := pt^;

(* revision history
hm	18. apr. 2008
	original version

*)
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>95532431-f275-4a08-89d6-f468362cf04a</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="DWORD_OF_BYTE" pouType="function">
        <interface>
          <returnType>
            <DWORD />
          </returnType>
          <inputVars>
            <variable name="B3">
              <type>
                <BYTE />
              </type>
            </variable>
            <variable name="B2">
              <type>
                <BYTE />
              </type>
            </variable>
            <variable name="B1">
              <type>
                <BYTE />
              </type>
            </variable>
            <variable name="B0">
              <type>
                <BYTE />
              </type>
            </variable>
          </inputVars>
        </interface>
        <body>
          <ST>
            DWORD_OF_BYTE := SHL(SHL(SHL(BYTE_TO_DWORD(B3),8) OR BYTE_TO_DWORD(B2),8) OR BYTE_TO_DWORD(B1),8) OR BYTE_TO_DWORD(B0);


(* revision history
hm	24. jan 2007	rev 1.0
	original version

hm 2. jan 2008	rev 1.1
	inproved performance

hm	23. apr. 2008	rev 1.2
	reverse order of inputs to be more logical

hm	18. jul. 2009	rev 1.3
	added type conversions for compatibility reasons
*)
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>8b741065-3b4f-4778-940e-94586c4b44c8</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="DWORD_OF_WORD" pouType="function">
        <interface>
          <returnType>
            <DWORD />
          </returnType>
          <inputVars>
            <variable name="W1">
              <type>
                <WORD />
              </type>
            </variable>
            <variable name="W0">
              <type>
                <WORD />
              </type>
            </variable>
          </inputVars>
        </interface>
        <body>
          <ST>
            DWORD_OF_WORD := SHL(WORD_TO_DWORD(W1),16) OR WORD_TO_DWORD(W0);


(* revision history

hm	18. jul. 2009	rev 1.0
	original version

*)
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>59b2c758-f1e4-4945-b3b8-9243b378a4f8</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="GRAY_TO_BYTE" pouType="function">
        <interface>
          <returnType>
            <BYTE />
          </returnType>
          <inputVars>
            <variable name="IN">
              <type>
                <BYTE />
              </type>
            </variable>
          </inputVars>
        </interface>
        <body>
          <ST>
            GRAY_TO_BYTE := SHR(IN,4) XOR IN;
GRAY_TO_BYTE := SHR(GRAY_TO_BYTE,2) XOR GRAY_TO_BYTE;
GRAY_TO_BYTE := SHR(GRAY_TO_BYTE,1) XOR GRAY_TO_BYTE;

(* revision history
hm	9. nov. 2009	rev 1.0
	original version

*)
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>75254d6a-dd32-4563-88d7-7cee90633761</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="INT_TO_BCDC" pouType="function">
        <interface>
          <returnType>
            <BYTE />
          </returnType>
          <inputVars>
            <variable name="IN">
              <type>
                <INT />
              </type>
            </variable>
          </inputVars>
        </interface>
        <body>
          <ST>
            INT_TO_BCDC := SHL(INT_TO_BYTE(IN / INT#10),4) OR INT_TO_BYTE(in MOD INT#10);

(* revision history
hm	13.12.2007
	original version

hm	30.6.2008	rev 1.1
	changed name INT_TO_BCD to INT_TO_BCDC to avoid collision with util.lib
	corrected error in code

*)
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>7ab903fe-24f8-4d6d-af1a-7834cd0dd9f7</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="MUX_2" pouType="function">
        <interface>
          <returnType>
            <BOOL />
          </returnType>
          <inputVars>
            <variable name="D0">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="D1">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="A0">
              <type>
                <BOOL />
              </type>
            </variable>
          </inputVars>
        </interface>
        <body>
          <ST>
            MUX_2 := SEL(A0, D0, D1);


(*
revision history:
hm	5.10.2006		rev 1.1
	changed to ST Langage for better portability.

hm	16. oct. 2008	rev 1.2
	improved performance

*)
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>e5bcf9d8-19f5-41d7-9739-b67dcc2f7eb1</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="MUX_4" pouType="function">
        <interface>
          <returnType>
            <BOOL />
          </returnType>
          <inputVars>
            <variable name="D0">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="D1">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="D2">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="D3">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="A0">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="A1">
              <type>
                <BOOL />
              </type>
            </variable>
          </inputVars>
        </interface>
        <body>
          <ST>
            IF A1 THEN
	MUX_4 := SEL(A0, D2, D3);
ELSE
	MUX_4 := SEL(A0, D0, D1);
END_IF;


(*
revision history:
hm 	5.10.2006		rev 1.1
	rewritten to ST for better portability

hm	16. oct. 2008	rev 1.2
	improved performance

*)
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>b1f3b72d-9182-4ef4-8fc3-d2051b11a767</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="PARITY" pouType="function">
        <interface>
          <returnType>
            <BOOL />
          </returnType>
          <inputVars>
            <variable name="in">
              <type>
                <DWORD />
              </type>
            </variable>
          </inputVars>
        </interface>
        <body>
          <ST>
            WHILE in &gt; 0 DO
	PARITY := PARITY XOR in.0 XOR in.1 XOR in.2 XOR in.3;
	in := SHR(in,4);
END_WHILE;

(* code before rev 1.2
WHILE in &gt; 0 DO
	IF in.0 THEN cnt := cnt +1; END_IF;
	in := SHR(in,1);
END_WHILE;
IF (cnt MOD 2) = 1 THEN parity := TRUE; ELSE parity := FALSE; END_IF;
*)

(* revision history

rev 1.0 hm 1 sep 2006
	original version

rev 1.1 hm 10.9.2007
	changed algorithm to improve performance

rev 1.2	hm	8 dec 2007
	changed algorithm to improve performance

rev 1.3	hm	18 feb 2008
	changed algorithm to improve performance
*)
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>6ec4a81c-767a-40c0-83d5-06f9ad97233a</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="REAL_TO_DW" pouType="function">
        <interface>
          <returnType>
            <DWORD />
          </returnType>
          <inputVars>
            <variable name="X">
              <type>
                <REAL />
              </type>
            </variable>
          </inputVars>
          <localVars>
            <variable name="pt">
              <type>
                <pointer>
                  <baseType>
                    <DWORD />
                  </baseType>
                </pointer>
              </type>
            </variable>
          </localVars>
        </interface>
        <body>
          <ST>
            pt := ADR(X);
REAL_TO_DW := pt^;

(* revision history
hm	18. apr. 2008
	original version

*)
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>0ab63332-18c2-4564-a480-7229ab94cf1d</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="REFLECT" pouType="function">
        <interface>
          <returnType>
            <DWORD />
          </returnType>
          <inputVars>
            <variable name="D">
              <type>
                <DWORD />
              </type>
            </variable>
            <variable name="L">
              <type>
                <INT />
              </type>
            </variable>
          </inputVars>
          <localVars>
            <variable name="i">
              <type>
                <INT />
              </type>
            </variable>
          </localVars>
        </interface>
        <body>
          <ST>
            REFLECT := 0;
FOR i := 1 TO L DO
	REFLECT := SHL(REFLECT, 1) OR BOOL_TO_DWORD(D.0);
	D := SHR(D, 1);
END_FOR;
REFLECT := REFLECT OR SHL(D, L);

(* revision history
hm	 16. jan 2011
	new module

*)
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>74a116dc-99e9-4372-9ac7-daadee9fcd1a</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="REVERSE" pouType="function">
        <interface>
          <returnType>
            <BYTE />
          </returnType>
          <inputVars>
            <variable name="IN">
              <type>
                <BYTE />
              </type>
            </variable>
          </inputVars>
        </interface>
        <body>
          <ST>
            (* new code donated by rebler wolfgang *)
REVERSE := ROR(in,1) AND 2#10001000 OR ROL(in,1) AND 2#00010001 OR ROR(in,3) AND 2#01000100 OR ROL(in,3) AND 2#00100010;

(* old code
REVERSE := SHL(in,7) OR SHR(in,7) OR (ROR(in,3) AND 2#01000100) OR (ROL(in,3) AND 2#00100010)
	OR (SHL(in,1) AND 2#00010000) OR (SHR(in,1) AND 2#00001000);
*)

(* revision history
hm		9.oct 2007		rev 1.0
	original version

hm		18. feb 2008	rev 1.1
	improved performance

RW    3. feb. 2021  	rev 1.2
	improved performance
*)
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>40ab819a-b848-43d6-8e4c-3e6e812f58f9</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="SHL1" pouType="function">
        <interface>
          <returnType>
            <DWORD />
          </returnType>
          <inputVars>
            <variable name="IN">
              <type>
                <DWORD />
              </type>
            </variable>
            <variable name="N">
              <type>
                <INT />
              </type>
            </variable>
          </inputVars>
          <localVars constant="true">
            <variable name="temp">
              <type>
                <DWORD />
              </type>
              <initialValue>
                <simpleValue value="16#FFFFFFFF" />
              </initialValue>
            </variable>
          </localVars>
        </interface>
        <body>
          <ST>
            SHL1 := SHR(temp,32-N) OR SHL(IN,N);


(* revision history
hm	14.9.2007		rev 1.0
	original version

hm	27. dec 2007	rev 1.1
	changed code for better performance

*)
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>3bf19c49-628f-4935-90df-10ee8b5c7b12</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="SHR1" pouType="function">
        <interface>
          <returnType>
            <DWORD />
          </returnType>
          <inputVars>
            <variable name="IN">
              <type>
                <DWORD />
              </type>
            </variable>
            <variable name="N">
              <type>
                <INT />
              </type>
            </variable>
          </inputVars>
          <localVars constant="true">
            <variable name="temp">
              <type>
                <DWORD />
              </type>
              <initialValue>
                <simpleValue value="16#FFFFFFFF" />
              </initialValue>
            </variable>
          </localVars>
        </interface>
        <body>
          <ST>
            SHR1 := SHL(temp,32-N) OR SHR(IN,N);

(* revision history
hm	14.9.2007		rev 1.0
	original version

hm	27. dec 2007	rev 1.1
	changed code for better performance

*)
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>43a578a3-9ab8-4738-a483-483e779c07aa</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="SWAP_BYTE" pouType="function">
        <interface>
          <returnType>
            <WORD />
          </returnType>
          <inputVars>
            <variable name="IN">
              <type>
                <WORD />
              </type>
            </variable>
          </inputVars>
        </interface>
        <body>
          <ST>
            SWAP_BYTE := ROL(in,8);


(* revision history
hm		4. feb 2008	rev 1.0
	original version

*)
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>6a5d7814-3fab-4385-bc15-4b97ee8b5880</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="SWAP_BYTE2" pouType="function">
        <interface>
          <returnType>
            <DWORD />
          </returnType>
          <inputVars>
            <variable name="IN">
              <type>
                <DWORD />
              </type>
            </variable>
          </inputVars>
        </interface>
        <body>
          <ST>
            Swap_Byte2 := (ROR(in,8) AND 16#FF00FF00) OR (ROL(in,8) AND 16#00FF00FF);

(* revision history
hm		4. feb 2008	rev 1.0
	original version

*)

          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>245f4666-e296-4570-9e91-d9c8a104ddd4</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="WORD_OF_BYTE" pouType="function">
        <interface>
          <returnType>
            <WORD />
          </returnType>
          <inputVars>
            <variable name="B1">
              <type>
                <BYTE />
              </type>
            </variable>
            <variable name="B0">
              <type>
                <BYTE />
              </type>
            </variable>
          </inputVars>
        </interface>
        <body>
          <ST>
            WORD_OF_BYTE := SHL(BYTE_TO_WORD(B1),8) OR BYTE_TO_WORD(B0);

(* revision history
hm	24. jan 2007	rev 1.0
	original version

hm	2. jan 2008	rev 1.1
	improved performance

hm	19. feb 2008	rev 1.2
	replaced and with or for better compatibility

hm	23. apr. 2008	rev 1.3
	reverse order of inputs to be more logical

hm	18. jul. 2009	rev 1.4
	added type conversions for compatibility reasons

*)
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>dbd340fc-a2f1-4d35-993b-c389f953ec3f</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="WORD_OF_DWORD" pouType="function">
        <interface>
          <returnType>
            <WORD />
          </returnType>
          <inputVars>
            <variable name="in">
              <type>
                <DWORD />
              </type>
            </variable>
            <variable name="N">
              <type>
                <BYTE />
              </type>
            </variable>
          </inputVars>
        </interface>
        <body>
          <ST>
            WORD_OF_DWORD := DWORD_TO_WORD(SHR(in,SHL(n,4)));

(* revision history
hm	17. jan 2007	rev 1.0
	original version

hm	2. jan 2008		rev 1.1
	improved performance

hm	30. oct. 2008	rev 1.2
	improved performance
*)

          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>fcf68e0c-fbd8-4091-9ad8-86178eb1dad5</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="A_TRIG" pouType="functionBlock">
        <interface>
          <inputVars>
            <variable name="IN">
              <type>
                <REAL />
              </type>
            </variable>
            <variable name="RES">
              <type>
                <REAL />
              </type>
            </variable>
          </inputVars>
          <outputVars>
            <variable name="Q">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="D">
              <type>
                <REAL />
              </type>
            </variable>
          </outputVars>
          <localVars>
            <variable name="last_in">
              <type>
                <REAL />
              </type>
            </variable>
          </localVars>
        </interface>
        <body>
          <ST>
            D := IN - LAST_IN;
Q := ABS(D) &gt; res;
IF Q THEN last_in := IN; END_IF;
D := IN - LAST_IN;


(* revision history

hm 	16. jul. 2008	rev 1.0
	original version released

hm	25. oct. 2008	rev 1.1
	code optimization
	a_trig now also works for res = 0

*)
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>31191e72-b014-4ff5-a85d-c3cc7704719c</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="B_TRIG" pouType="functionBlock">
        <interface>
          <inputVars>
            <variable name="CLK">
              <type>
                <BOOL />
              </type>
            </variable>
          </inputVars>
          <outputVars>
            <variable name="Q">
              <type>
                <BOOL />
              </type>
            </variable>
          </outputVars>
          <localVars>
            <variable name="edge">
              <type>
                <BOOL />
              </type>
            </variable>
          </localVars>
        </interface>
        <body>
          <ST>
            Q := clk XOR edge;
edge := CLK;


(* revision history
hm		4. aug. 2006	rev 1.0
	original version

*)
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>d30bfe5c-d296-4a5b-9129-1d00412fd3e0</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="CLICK_CNT" pouType="functionBlock">
        <interface>
          <inputVars>
            <variable name="IN">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="N">
              <type>
                <INT />
              </type>
            </variable>
            <variable name="TC">
              <type>
                <TIME />
              </type>
            </variable>
          </inputVars>
          <outputVars>
            <variable name="Q">
              <type>
                <BOOL />
              </type>
            </variable>
          </outputVars>
          <localVars>
            <variable name="tx">
              <type>
                <derived name="TP" />
              </type>
            </variable>
            <variable name="edge">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="cnt">
              <type>
                <INT />
              </type>
              <initialValue>
                <simpleValue value="-1" />
              </initialValue>
            </variable>
          </localVars>
        </interface>
        <body>
          <ST>
            (* Q shall only be active for one cycle only *)
Q := FALSE;

IF in AND NOT edge AND NOT tx.q THEN
	(* a rising edge on in sets the counter to 0 *)
	cnt := 0;
ELSIF tx.Q AND NOT IN AND edge THEN
	(* count falling edges when tp.q is true *)
	cnt := cnt + 1;
ELSIF NOT tx.Q THEN
	Q := cnt = N;
	cnt := -1;
END_IF;

(* remember the status of IN *)
edge := IN;
tx(in := IN, pt := TC);


(* revision history

hm 	16. jul. 2008	rev 1.0
	original version released


*)
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>851f41e1-8674-48ee-b0c0-e2b62ab959b4</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="CLICK_DEC" pouType="functionBlock">
        <interface>
          <inputVars>
            <variable name="IN">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="TC">
              <type>
                <TIME />
              </type>
            </variable>
          </inputVars>
          <outputVars>
            <variable name="Q0">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="Q1">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="Q2">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="Q3">
              <type>
                <BOOL />
              </type>
            </variable>
          </outputVars>
          <localVars>
            <variable name="tx">
              <type>
                <derived name="TP" />
              </type>
            </variable>
            <variable name="edge">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="cnt">
              <type>
                <INT />
              </type>
              <initialValue>
                <simpleValue value="-1" />
              </initialValue>
            </variable>
          </localVars>
        </interface>
        <body>
          <ST>
            (* Q shall only be active for one cycle only *)
IF in = FALSE THEN
	Q0 := FALSE;
	Q1 := FALSE;
	Q2:= FALSE;
	Q3 := FALSE;
END_IF;

IF in AND NOT edge AND NOT tx.q THEN
	(* a rising edge on in sets the counter to 0 *)
	cnt := 0;
ELSIF tx.Q AND NOT IN AND edge THEN
	(* count falling edges when tp.q is true *)
	cnt := cnt + 1;
ELSIF NOT tx.Q THEN
	CASE cnt OF
		0 : Q0 := TRUE;
		1 : Q1 := TRUE;
		2 : Q2 := TRUE;
		3 : Q3 := TRUE;
	END_CASE;
	cnt := -1;
END_IF;

(* remember the status of IN *)
edge := IN;
tx(in := IN, pt := TC);



(* revision history

hm 17. jul. 2008	rev 1.0
	original version released

hm	14. mar. 2009	rev 1.1
	removed double assignments

*)
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>6011b434-5ba5-4a08-8068-95d86de794e8</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="CLK_DIV" pouType="functionBlock">
        <interface>
          <inputVars>
            <variable name="clk">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="rst">
              <type>
                <BOOL />
              </type>
            </variable>
          </inputVars>
          <outputVars>
            <variable name="Q0">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="Q1">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="Q2">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="Q3">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="Q4">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="Q5">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="Q6">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="Q7">
              <type>
                <BOOL />
              </type>
            </variable>
          </outputVars>
          <localVars>
            <variable name="cnt">
              <type>
                <BYTE />
              </type>
            </variable>
          </localVars>
        </interface>
        <body>
          <ST>
            IF rst THEN
	cnt:= 0;
	Q0 := 0;
	Q1 := 0;
	Q2 := 0;
	Q3 := 0;
	Q4 := 0;
	Q5 := 0;
	Q6 := 0;
	Q7 := 0;
ELSIF clk THEN
	cnt:= cnt +1;
	Q0 := cnt.0;
	Q1 := cnt.1;
	Q2 := cnt.2;
	Q3 := cnt.3;
	Q4 := cnt.4;
	Q5 := cnt.5;
	Q6 := cnt.6;
	Q7 := cnt.7;
END_IF;

(* revision history
hm	4. aug. 2006	rev 1.0
	original version

hm	2. jan 2008		rev 1.1
	improved performance

*)
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>54486e54-5ebf-40be-9b38-6047238b1f80</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="CLK_N" pouType="functionBlock">
        <interface>
          <inputVars>
            <variable name="N">
              <type>
                <INT />
              </type>
            </variable>
          </inputVars>
          <outputVars>
            <variable name="Q">
              <type>
                <BOOL />
              </type>
            </variable>
          </outputVars>
          <localVars>
            <variable name="edge">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="stime">
              <type>
                <DWORD />
              </type>
            </variable>
            <variable name="clk">
              <type>
                <BOOL />
              </type>
            </variable>
          </localVars>
        </interface>
        <body>
          <ST>
            stime := SHR(T_PLC_MS(),N);
clk := stime.0;
Q := clk XOR edge;
edge := CLK;

(* revision history
hm	16. dec 2007		rev 1.0
	original version

*)
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>2ef33164-b544-4935-9951-5e19f4af66e9</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="CLK_PRG" pouType="functionBlock">
        <interface>
          <inputVars>
            <variable name="PT">
              <type>
                <TIME />
              </type>
              <initialValue>
                <simpleValue value="TIME#10ms" />
              </initialValue>
            </variable>
          </inputVars>
          <outputVars>
            <variable name="Q">
              <type>
                <BOOL />
              </type>
            </variable>
          </outputVars>
          <localVars>
            <variable name="init">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="last">
              <type>
                <TIME />
              </type>
            </variable>
            <variable name="tx">
              <type>
                <TIME />
              </type>
            </variable>
          </localVars>
        </interface>
        <body>
          <ST>
            (* read system time *)
tx := DWORD_TO_TIME(T_PLC_MS());

(* initialize on startup *)
IF NOT init THEN
	init := TRUE;
	last := tx - pt;
END_IF;

(* generate output pulse when next_pulse is reached *)
Q := tx - last &gt;= pt;
IF Q THEN last := tx; END_IF;


(* revision hiostory

hm 25 feb 2007	rev 1.1
	rewritten code for higher performance
	pt can now be changed during runtime

hm	17. sep 2007	rev 1.2
	replaced time() with t_plc_ms() for compatibility reasons

hm	25. oct. 2008	rev 1.3
	optimized code

*)
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>dbf37a6d-99e7-44ef-a646-d5eef835a4e6</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="CLK_PULSE" pouType="functionBlock">
        <interface>
          <inputVars>
            <variable name="PT">
              <type>
                <TIME />
              </type>
            </variable>
            <variable name="N">
              <type>
                <INT />
              </type>
            </variable>
            <variable name="RST">
              <type>
                <BOOL />
              </type>
            </variable>
          </inputVars>
          <outputVars>
            <variable name="Q">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="CNT">
              <type>
                <INT />
              </type>
            </variable>
            <variable name="RUN">
              <type>
                <BOOL />
              </type>
            </variable>
          </outputVars>
          <localVars>
            <variable name="tx">
              <type>
                <DWORD />
              </type>
            </variable>
            <variable name="tn">
              <type>
                <DWORD />
              </type>
            </variable>
            <variable name="init">
              <type>
                <BOOL />
              </type>
            </variable>
          </localVars>
        </interface>
        <body>
          <ST>
            tx := T_PLC_MS();		(* read system *)
Q := FALSE;				(* reset Q we generate pulses only for one cycle *)
RUN := CNT &lt; N;

IF NOT init OR RST THEN
	init := TRUE;
	CNT := 0;
	tn := tx - TIME_TO_DWORD(PT);
	RUN := FALSE;
ELSIF (cnt &lt; N OR N = 0) AND tx - tn &gt;= TIME_TO_DWORD(PT) THEN		(* generate a pulse *)
	CNT := CNT + 1;
	Q := TRUE;
	tn := tn + TIME_TO_DWORD(PT);
END_IF;



(* revision history
hm		4. aug 2006		rev 1.0
	original version

hm		17. sep 2007	rev 1.1
	replaced time() with T_PLC_S() for compatblity reasons

hm		16. feb. 2011	rev 1.2
	fixed an error when timer overflows 
*)
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>27d18b49-043f-4d81-a812-695ee09ddd10</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="CYCLE_4" pouType="functionBlock">
        <interface>
          <inputVars>
            <variable name="E">
              <type>
                <BOOL />
              </type>
              <initialValue>
                <simpleValue value="TRUE" />
              </initialValue>
            </variable>
            <variable name="T0">
              <type>
                <TIME />
              </type>
            </variable>
            <variable name="T1">
              <type>
                <TIME />
              </type>
            </variable>
            <variable name="T2">
              <type>
                <TIME />
              </type>
            </variable>
            <variable name="T3">
              <type>
                <TIME />
              </type>
            </variable>
            <variable name="S0">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="SX">
              <type>
                <INT />
              </type>
            </variable>
            <variable name="SL">
              <type>
                <BOOL />
              </type>
            </variable>
          </inputVars>
          <outputVars>
            <variable name="STATE">
              <type>
                <INT />
              </type>
            </variable>
          </outputVars>
          <localVars>
            <variable name="tx">
              <type>
                <TIME />
              </type>
            </variable>
            <variable name="last">
              <type>
                <TIME />
              </type>
            </variable>
            <variable name="init">
              <type>
                <BOOL />
              </type>
            </variable>
          </localVars>
        </interface>
        <body>
          <ST>
            (* read system timer *)
tx := DWORD_TO_TIME(T_PLC_MS());
(* init on first cycle *)
IF NOT init THEN
	init := TRUE;
	last := tx;
END_IF;

IF E THEN
	IF SL THEN
		(* when sx &gt; 0 then the state sx is forced to start *)
		state:= LIMIT(0,SX,3);
		last := tx;
		(* this is to avoid to reset sx from the calling programm it does work fine on codesys but i am not sure about other systems, because we are writing to an input *)
		SL := FALSE;
	ELSE
		CASE state OF
			0 :	(* wait for T0 and switch to next cycle *)
				IF tx - last &gt;= T0 THEN
					state := 1;
					last := tx;
				END_IF;
			1 : (* wait for T1 over 1st cycle *)
				IF tx - last &gt;= T1 THEN
					state := 2;
					last := tx;
				END_IF;
			2 : (* wait for T1 over 1st cycle *)
				IF tx - last &gt;= T2 THEN
					state := 3;
					last := tx;
				END_IF;
			3 : (* wait for T2 over 2nd cycle *)
				IF tx - last &gt;= T3 THEN
					IF S0 THEN State := 0; END_IF; (* if S0 is false, the sequence stops at state 3 *)
					last := tx;
				END_IF;
		END_CASE;
	END_IF;
ELSE
	state := 0;
	last := tx;
END_IF;



(*
hm	3. nov. 2008	rev 1.0
	original version

*)
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>d7eae52c-e7fa-46db-82fd-69ac0dcfbd87</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="D_TRIG" pouType="functionBlock">
        <interface>
          <inputVars>
            <variable name="in">
              <type>
                <DWORD />
              </type>
            </variable>
          </inputVars>
          <outputVars>
            <variable name="Q">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="X">
              <type>
                <DWORD />
              </type>
            </variable>
          </outputVars>
          <localVars>
            <variable name="last_in">
              <type>
                <DWORD />
              </type>
            </variable>
          </localVars>
        </interface>
        <body>
          <ST>
            Q := in &lt;&gt; last_in;
X := in - last_in;
last_in := in;


(* revision history

hm 	4.09.2007		rev 1.0
	original version released

hm	19. feb. 2008	rev 1.1
	performance improvement
*)
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>fcf88bea-d42b-4083-8cce-02fca6203fd4</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="GEN_BIT" pouType="functionBlock">
        <interface>
          <inputVars>
            <variable name="in0">
              <type>
                <DWORD />
              </type>
            </variable>
            <variable name="in1">
              <type>
                <DWORD />
              </type>
            </variable>
            <variable name="in2">
              <type>
                <DWORD />
              </type>
            </variable>
            <variable name="in3">
              <type>
                <DWORD />
              </type>
            </variable>
            <variable name="clk">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="steps">
              <type>
                <INT />
              </type>
            </variable>
            <variable name="rep">
              <type>
                <INT />
              </type>
            </variable>
            <variable name="rst">
              <type>
                <BOOL />
              </type>
            </variable>
          </inputVars>
          <outputVars>
            <variable name="Q0">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="Q1">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="Q2">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="Q3">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="cnt">
              <type>
                <INT />
              </type>
            </variable>
            <variable name="run">
              <type>
                <BOOL />
              </type>
            </variable>
          </outputVars>
          <localVars>
            <variable name="r0">
              <type>
                <DWORD />
              </type>
            </variable>
            <variable name="r1">
              <type>
                <DWORD />
              </type>
            </variable>
            <variable name="r2">
              <type>
                <DWORD />
              </type>
            </variable>
            <variable name="r3">
              <type>
                <DWORD />
              </type>
            </variable>
            <variable name="rx">
              <type>
                <INT />
              </type>
              <initialValue>
                <simpleValue value="1" />
              </initialValue>
            </variable>
          </localVars>
        </interface>
        <body>
          <ST>
            (* check if number of runs is finished or rep = 0 which means continuous *)

IF clk AND NOT rst THEN
	run := (rep = 0) OR (rx &lt;= rep);
	IF run THEN
		(* check for step counter reached and reset to 0 if cnt = steps *)
		IF cnt = steps THEN
			cnt := 0;
		END_IF;

		(* when cnt = 0 then reload the inputs into the registers *)
		IF cnt = 0 THEN
			r0 := in0;
			r1 := in1;
			r2 := in2;
			r3 := in3;
		END_IF;

		(* when cnt &lt; steps, shift the lowest bits to the outputs *)
		IF (cnt &lt; steps) THEN
			Q0 := r0.0;
			Q1 := r1.0;
			Q2 := r2.0;
			Q3 := r3.0;
			r0 := SHR(r0,1);
			r1 := SHR(r1,1);
			r2 := SHR(r2,1);
			r3 := SHR(r3,1);
		END_IF;

		(* increment the step counter *)
		cnt := cnt +1;
		IF (cnt = steps) AND (rep &lt;&gt; 0) THEN rx := rx +1; END_IF;
		IF (rx &gt; rep) AND (rep &lt;&gt; 0) THEN run := FALSE; END_IF;
	END_IF;
ELSE
	IF rst THEN
		run := FALSE;
		Q0 := FALSE;
		Q1 := FALSE;
		Q2 := FALSE;
		Q3 := FALSE;
		r0 := 0;
		r1 := 0;
		r2 := 0;
		r3 := 0;
		cnt := 0;
		rx := 1;
	END_IF;
END_IF;



(* revision histroy
hm	4 aug 2006	rev 1.0
	original version

hm 15. oct. 2008	rev 1.1
	improved performance

hm	14. mar. 2009	rev 1.2
	removed double assignments

*)
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>d7d87785-654f-464f-9d3c-175f47e9434f</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="GEN_SQ" pouType="functionBlock">
        <interface>
          <inputVars>
            <variable name="PT">
              <type>
                <TIME />
              </type>
            </variable>
          </inputVars>
          <outputVars>
            <variable name="Q">
              <type>
                <BOOL />
              </type>
            </variable>
          </outputVars>
          <localVars>
            <variable name="tn">
              <type>
                <DWORD />
              </type>
            </variable>
            <variable name="tx">
              <type>
                <DWORD />
              </type>
            </variable>
            <variable name="init">
              <type>
                <BOOL />
              </type>
            </variable>
          </localVars>
        </interface>
        <body>
          <ST>
            (* read system time *)
tx := T_PLC_MS();

IF NOT init THEN
	init := TRUE;
	tn := tx;
	Q := TRUE;
ELSIF tx - tn &gt;= SHR(TIME_TO_DWORD(PT),1) THEN
	Q := NOT Q;
	tn := tn + SHR(TIME_TO_DWORD(pt),1);
END_IF;


(* revision history
hm	4. aug 2006	rev 1.0
	original version

hm	17. sep 2007	rev 1.1
	replaced time() with T_PLC_MS() for compatibility reasons

hm	18. jul. 2009	rev 1.2
	improved accuracy

hm	16. feb 2011	rev 1.3
	corrected an error with timer overflow 
*)




          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>01ac5a45-b35a-48d3-9688-50efbf39a6fe</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="SCHEDULER" pouType="functionBlock">
        <interface>
          <inputVars>
            <variable name="E0">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="E1">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="E2">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="E3">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="T0">
              <type>
                <TIME />
              </type>
              <addData>
                <data name="http://www.3s-software.com/plcopenxml/attributes" handleUnknown="implementation">
                  <Attributes>
                    <Attribute Name="input_constant" Value="" />
                  </Attributes>
                </data>
              </addData>
            </variable>
            <variable name="T1">
              <type>
                <TIME />
              </type>
              <addData>
                <data name="http://www.3s-software.com/plcopenxml/attributes" handleUnknown="implementation">
                  <Attributes>
                    <Attribute Name="input_constant" Value="" />
                  </Attributes>
                </data>
              </addData>
            </variable>
            <variable name="T2">
              <type>
                <TIME />
              </type>
              <addData>
                <data name="http://www.3s-software.com/plcopenxml/attributes" handleUnknown="implementation">
                  <Attributes>
                    <Attribute Name="input_constant" Value="" />
                  </Attributes>
                </data>
              </addData>
            </variable>
            <variable name="T3">
              <type>
                <TIME />
              </type>
              <addData>
                <data name="http://www.3s-software.com/plcopenxml/attributes" handleUnknown="implementation">
                  <Attributes>
                    <Attribute Name="input_constant" Value="" />
                  </Attributes>
                </data>
              </addData>
            </variable>
          </inputVars>
          <outputVars>
            <variable name="Q0">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="Q1">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="Q2">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="Q3">
              <type>
                <BOOL />
              </type>
            </variable>
          </outputVars>
          <localVars>
            <variable name="init">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="s0">
              <type>
                <TIME />
              </type>
            </variable>
            <variable name="s1">
              <type>
                <TIME />
              </type>
            </variable>
            <variable name="s2">
              <type>
                <TIME />
              </type>
            </variable>
            <variable name="s3">
              <type>
                <TIME />
              </type>
            </variable>
            <variable name="tx">
              <type>
                <TIME />
              </type>
            </variable>
            <variable name="c">
              <type>
                <INT />
              </type>
            </variable>
          </localVars>
        </interface>
        <body>
          <ST>
            (* read system_time *)
tx := DWORD_TO_TIME(T_PLC_MS());

IF NOT init THEN
	init := TRUE;
	s0 := tx - T0;
	s1 := tx - T1;
	s2 := tx - T2;
	s3 := tx - T3;
END_IF;

Q0 := FALSE;
Q1 := FALSE;
Q2 := FALSE;
Q3 :=FALSE;

CASE c OF
	0: 	IF tx - s0 &gt;= T0 THEN
			Q0 := E0;
			s0 := tx;
		END_IF;
		c := 1;
	1: 	IF tx - s1 &gt;= T1 THEN
			Q1 := E1;
			s1 := tx;
		END_IF;
		c := 2;
	2: 	IF tx - s2 &gt;= T2 THEN
			Q2 := E2;
			s2 := tx;
		END_IF;
		c := 3;
	3: 	IF tx - s3 &gt;= T3 THEN
			Q3 := E3;
			s3 := tx;
		END_IF;
		c := 0;
END_CASE;


(* revision history

hm 28. sep. 2008	rev 1.0
	original version

hm	14. mar. 2009	rev 1.1
	removed double assignments

*)
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>4ddc3335-2e45-40d0-b351-f303da2c7873</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="SCHEDULER_2" pouType="functionBlock">
        <interface>
          <inputVars>
            <variable name="E0">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="E1">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="E2">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="E3">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="C0">
              <type>
                <UINT />
              </type>
              <addData>
                <data name="http://www.3s-software.com/plcopenxml/attributes" handleUnknown="implementation">
                  <Attributes>
                    <Attribute Name="input_constant" Value="" />
                  </Attributes>
                </data>
              </addData>
            </variable>
            <variable name="C1">
              <type>
                <UINT />
              </type>
              <addData>
                <data name="http://www.3s-software.com/plcopenxml/attributes" handleUnknown="implementation">
                  <Attributes>
                    <Attribute Name="input_constant" Value="" />
                  </Attributes>
                </data>
              </addData>
            </variable>
            <variable name="C2">
              <type>
                <UINT />
              </type>
              <addData>
                <data name="http://www.3s-software.com/plcopenxml/attributes" handleUnknown="implementation">
                  <Attributes>
                    <Attribute Name="input_constant" Value="" />
                  </Attributes>
                </data>
              </addData>
            </variable>
            <variable name="C3">
              <type>
                <UINT />
              </type>
              <addData>
                <data name="http://www.3s-software.com/plcopenxml/attributes" handleUnknown="implementation">
                  <Attributes>
                    <Attribute Name="input_constant" Value="" />
                  </Attributes>
                </data>
              </addData>
            </variable>
            <variable name="O0">
              <type>
                <UINT />
              </type>
              <addData>
                <data name="http://www.3s-software.com/plcopenxml/attributes" handleUnknown="implementation">
                  <Attributes>
                    <Attribute Name="input_constant" Value="" />
                  </Attributes>
                </data>
              </addData>
            </variable>
            <variable name="O1">
              <type>
                <UINT />
              </type>
              <addData>
                <data name="http://www.3s-software.com/plcopenxml/attributes" handleUnknown="implementation">
                  <Attributes>
                    <Attribute Name="input_constant" Value="" />
                  </Attributes>
                </data>
              </addData>
            </variable>
            <variable name="O2">
              <type>
                <UINT />
              </type>
              <addData>
                <data name="http://www.3s-software.com/plcopenxml/attributes" handleUnknown="implementation">
                  <Attributes>
                    <Attribute Name="input_constant" Value="" />
                  </Attributes>
                </data>
              </addData>
            </variable>
            <variable name="O3">
              <type>
                <UINT />
              </type>
              <addData>
                <data name="http://www.3s-software.com/plcopenxml/attributes" handleUnknown="implementation">
                  <Attributes>
                    <Attribute Name="input_constant" Value="" />
                  </Attributes>
                </data>
              </addData>
            </variable>
          </inputVars>
          <outputVars>
            <variable name="Q0">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="Q1">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="Q2">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="Q3">
              <type>
                <BOOL />
              </type>
            </variable>
          </outputVars>
          <localVars>
            <variable name="sx">
              <type>
                <UINT />
              </type>
            </variable>
          </localVars>
        </interface>
        <body>
          <ST>
            Q0 := E0 AND (sx MOD C0 - O0 = 0);
Q1 := E1 AND (sx MOD C1 - O1 = 0);
Q2 := E2 AND (sx MOD C2 - O2 = 0);
Q3 := E3 AND (sx MOD C3 - O3 = 0);

(* increment cycle counter every cycle *)
sx := sx + 1;


(* revision history
hm 29. sep. 2008		rev 1.0
	original version


*)
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>3406b056-a124-4e55-9d34-45449f7bae8f</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="SEQUENCE_4" pouType="functionBlock">
        <interface>
          <inputVars>
            <variable name="in0">
              <type>
                <BOOL />
              </type>
              <initialValue>
                <simpleValue value="TRUE" />
              </initialValue>
            </variable>
            <variable name="in1">
              <type>
                <BOOL />
              </type>
              <initialValue>
                <simpleValue value="TRUE" />
              </initialValue>
            </variable>
            <variable name="in2">
              <type>
                <BOOL />
              </type>
              <initialValue>
                <simpleValue value="TRUE" />
              </initialValue>
            </variable>
            <variable name="in3">
              <type>
                <BOOL />
              </type>
              <initialValue>
                <simpleValue value="TRUE" />
              </initialValue>
            </variable>
            <variable name="start">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="rst">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="wait0">
              <type>
                <TIME />
              </type>
            </variable>
            <variable name="delay0">
              <type>
                <TIME />
              </type>
            </variable>
            <variable name="wait1">
              <type>
                <TIME />
              </type>
            </variable>
            <variable name="delay1">
              <type>
                <TIME />
              </type>
            </variable>
            <variable name="wait2">
              <type>
                <TIME />
              </type>
            </variable>
            <variable name="delay2">
              <type>
                <TIME />
              </type>
            </variable>
            <variable name="wait3">
              <type>
                <TIME />
              </type>
            </variable>
            <variable name="delay3">
              <type>
                <TIME />
              </type>
            </variable>
            <variable name="stop_on_error">
              <type>
                <BOOL />
              </type>
              <addData>
                <data name="http://www.3s-software.com/plcopenxml/attributes" handleUnknown="implementation">
                  <Attributes>
                    <Attribute Name="input_constant" Value="" />
                  </Attributes>
                </data>
              </addData>
            </variable>
          </inputVars>
          <outputVars>
            <variable name="Q0">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="Q1">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="Q2">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="Q3">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="QX">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="run">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="step">
              <type>
                <INT />
              </type>
              <initialValue>
                <simpleValue value="-1" />
              </initialValue>
            </variable>
            <variable name="status">
              <type>
                <BYTE />
              </type>
            </variable>
          </outputVars>
          <localVars>
            <variable name="last">
              <type>
                <TIME />
              </type>
            </variable>
            <variable name="edge">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="tx">
              <type>
                <TIME />
              </type>
            </variable>
            <variable name="init">
              <type>
                <BOOL />
              </type>
            </variable>
          </localVars>
        </interface>
        <body>
          <ST>
            (* read sps timer *)
tx := DWORD_TO_TIME(T_PLC_MS());

(* initialize on startup *)
IF NOT init THEN
	last := tx;
	init := TRUE;
	status := 110;
END_IF;

(* asynchronous reset *)
IF rst THEN
	step := -1;
	Q0 := 0;
	Q1 := 0;
	Q2 := 0;
	Q3 := 0;
	status := 110;
	run := 0;

(* edge on start input restarts the sequencer *)
ELSIF start AND NOT edge THEN
	step := 0;
	last := tx;
	status := 111;
	Q0 := 0;
	Q1 := 0;
	Q2 := 0;
	Q3 := 0;
	run := 1;
END_IF;
edge := start;

(* check if stop on status is necessary *)
IF status &gt; 0 AND status &lt; 100 AND stop_on_error THEN RETURN; END_IF;

(* sequence is running *)
IF run AND step = 0 THEN
	IF NOT q0 AND in0 AND tx - last &lt;= wait0 THEN
		Q0 := TRUE;
		last := tx;
	ELSIF NOT q0 AND tx - last &gt; wait0 THEN
		status := 1;
		run := FALSE;
	ELSIF q0 AND tx - last &gt;= delay0 THEN
		step := 1;
		last := tx;
	END_IF;
END_IF;
IF run AND step = 1 THEN
	IF NOT q1 AND in1 AND tx - last &lt;= wait1 THEN
		Q0 := FALSE;
		Q1 := TRUE;
		last := tx;
	ELSIF NOT q1 AND Tx - last &gt; wait1 THEN
		status := 2;
		q0 := FALSE;
		run := FALSE;
	ELSIF q1 AND tx - last &gt;= delay1 THEN
		step := 2;
		last := tx;
	END_IF;
END_IF;
IF run AND step = 2 THEN
	IF NOT q2 AND in2 AND tx - last &lt;= wait2 THEN
		Q1 := FALSE;
		Q2 := TRUE;
		last := tx;
	ELSIF NOT q2 AND Tx - last &gt; wait2 THEN
		status := 3;
		q1 := FALSE;
		run := FALSE;
	ELSIF q2 AND tx - last &gt;= delay2 THEN
		step := 3;
		last := tx;
	END_IF;
END_IF;
IF run AND step = 3 THEN
	IF NOT q3 AND in3 AND tx - last &lt;= wait3 THEN
		Q2 := FALSE;
		Q3 := TRUE;
		last := tx;
	ELSIF NOT q3 AND Tx - last &gt; wait3 THEN
		status := 4;
		q2 := FALSE;
		run := FALSE;
	ELSIF q3 AND tx - last &gt;= delay3 THEN
		step := -1;
		q3 := FALSE;
		run := FALSE;
		status := 110;
	END_IF;
END_IF;
QX := q0 OR q1 OR q2 OR q3;

(*
hm 1.10.06		rev 1.1
	corrected delay logic to be after event and not before
	added any output

hm 1.12.06		rev 1.2
	corrected failure in sequence logic.
	added init at startup to prevent from initial error after start.

hm 17.1.2007		rev 1.3
	changed output fault to status for better compatibility with other modules (ESR).
	added stop on error functionality and setup variable
	default for inputs in0..3 is true.
	renamed variable state to step

hm	17.sep 2007	rev 1.4
	replaced time() with T_PLC_MS() for compatibility reasons

hm	13. mar. 2009	rev 1.5
	renamed output any to qx for compatibility resons

*)
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>11526852-98d1-4c1e-b0a7-37cf02f6e4fe</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="SEQUENCE_64" pouType="functionBlock">
        <interface>
          <inputVars>
            <variable name="START">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="SMAX">
              <type>
                <INT />
              </type>
            </variable>
            <variable name="PROG">
              <type>
                <array>
                  <dimension lower="0" upper="63" />
                  <baseType>
                    <TIME />
                  </baseType>
                </array>
              </type>
            </variable>
            <variable name="RST">
              <type>
                <BOOL />
              </type>
            </variable>
          </inputVars>
          <outputVars>
            <variable name="STATE">
              <type>
                <INT />
              </type>
              <initialValue>
                <simpleValue value="-1" />
              </initialValue>
            </variable>
            <variable name="TRIG">
              <type>
                <BOOL />
              </type>
            </variable>
          </outputVars>
          <localVars>
            <variable name="tx">
              <type>
                <TIME />
              </type>
            </variable>
            <variable name="edge">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="last">
              <type>
                <TIME />
              </type>
            </variable>
          </localVars>
        </interface>
        <body>
          <ST>
            (* read system timer *)
tx := DWORD_TO_TIME(T_PLC_MS());
TRIG := FALSE;

IF RST THEN
	STATE := -1;

(* start sequence *)
ELSIF START AND NOT edge THEN
	STATE := 0;
	last := tx;
	TRIG := TRUE;

(* sequence generator *)
ELSIF (STATE &gt;= 0) THEN
	IF (tx - last) &gt;= PROG[STATE] THEN
		STATE := INC2(STATE, 1, -1, SMAX);
		last := tx;
		TRIG := TRUE;
	END_IF;
END_IF;

edge := START;



(* revision history
hm	29. jun. 2008
	original version

*)
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>55bf80b0-6dee-48f6-b512-2e049aeaf163</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="SEQUENCE_8" pouType="functionBlock">
        <interface>
          <inputVars>
            <variable name="in0">
              <type>
                <BOOL />
              </type>
              <initialValue>
                <simpleValue value="TRUE" />
              </initialValue>
            </variable>
            <variable name="in1">
              <type>
                <BOOL />
              </type>
              <initialValue>
                <simpleValue value="TRUE" />
              </initialValue>
            </variable>
            <variable name="in2">
              <type>
                <BOOL />
              </type>
              <initialValue>
                <simpleValue value="TRUE" />
              </initialValue>
            </variable>
            <variable name="in3">
              <type>
                <BOOL />
              </type>
              <initialValue>
                <simpleValue value="TRUE" />
              </initialValue>
            </variable>
            <variable name="in4">
              <type>
                <BOOL />
              </type>
              <initialValue>
                <simpleValue value="TRUE" />
              </initialValue>
            </variable>
            <variable name="in5">
              <type>
                <BOOL />
              </type>
              <initialValue>
                <simpleValue value="TRUE" />
              </initialValue>
            </variable>
            <variable name="in6">
              <type>
                <BOOL />
              </type>
              <initialValue>
                <simpleValue value="TRUE" />
              </initialValue>
            </variable>
            <variable name="in7">
              <type>
                <BOOL />
              </type>
              <initialValue>
                <simpleValue value="TRUE" />
              </initialValue>
            </variable>
            <variable name="start">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="rst">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="wait0">
              <type>
                <TIME />
              </type>
            </variable>
            <variable name="delay0">
              <type>
                <TIME />
              </type>
            </variable>
            <variable name="wait1">
              <type>
                <TIME />
              </type>
            </variable>
            <variable name="delay1">
              <type>
                <TIME />
              </type>
            </variable>
            <variable name="wait2">
              <type>
                <TIME />
              </type>
            </variable>
            <variable name="delay2">
              <type>
                <TIME />
              </type>
            </variable>
            <variable name="wait3">
              <type>
                <TIME />
              </type>
            </variable>
            <variable name="delay3">
              <type>
                <TIME />
              </type>
            </variable>
            <variable name="wait4">
              <type>
                <TIME />
              </type>
            </variable>
            <variable name="delay4">
              <type>
                <TIME />
              </type>
            </variable>
            <variable name="wait5">
              <type>
                <TIME />
              </type>
            </variable>
            <variable name="delay5">
              <type>
                <TIME />
              </type>
            </variable>
            <variable name="wait6">
              <type>
                <TIME />
              </type>
            </variable>
            <variable name="delay6">
              <type>
                <TIME />
              </type>
            </variable>
            <variable name="wait7">
              <type>
                <TIME />
              </type>
            </variable>
            <variable name="delay7">
              <type>
                <TIME />
              </type>
            </variable>
            <variable name="stop_on_error">
              <type>
                <BOOL />
              </type>
              <addData>
                <data name="http://www.3s-software.com/plcopenxml/attributes" handleUnknown="implementation">
                  <Attributes>
                    <Attribute Name="input_constant" Value="" />
                  </Attributes>
                </data>
              </addData>
            </variable>
          </inputVars>
          <outputVars>
            <variable name="Q0">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="Q1">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="Q2">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="Q3">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="Q4">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="Q5">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="Q6">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="Q7">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="QX">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="run">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="step">
              <type>
                <INT />
              </type>
              <initialValue>
                <simpleValue value="-1" />
              </initialValue>
            </variable>
            <variable name="status">
              <type>
                <BYTE />
              </type>
            </variable>
          </outputVars>
          <localVars>
            <variable name="last">
              <type>
                <TIME />
              </type>
            </variable>
            <variable name="edge">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="tx">
              <type>
                <TIME />
              </type>
            </variable>
            <variable name="init">
              <type>
                <BOOL />
              </type>
            </variable>
          </localVars>
        </interface>
        <body>
          <ST>
            (* read sps timer *)
tx := DWORD_TO_TIME(T_PLC_MS());

(* initialize on startup *)
IF NOT init THEN
	last := tx;
	init := TRUE;
	status := 110;
END_IF;

(* asynchronous reset *)
IF rst THEN
	step := -1;
	Q0 := 0;
	Q1 := 0;
	Q2 := 0;
	Q3 := 0;
	Q4 := 0;
	Q5 := 0;
	Q6 := 0;
	Q7 := 0;
	status := 110;
	run := 0;

(* edge on start input restarts the sequencer *)
ELSIF start AND NOT edge THEN
	step := 0;
	last := tx;
	status := 111;
	Q0 := 0;
	Q1 := 0;
	Q2 := 0;
	Q3 := 0;
	Q4 := 0;
	Q5 := 0;
	Q6 := 0;
	Q7 := 0;
	run := 1;
END_IF;
edge := start;

(* check if stop on error is necessary *)
IF status &gt; 0 AND status &lt; 100 AND stop_on_error THEN RETURN; END_IF;

(* sequence is running *)
IF run AND step = 0 THEN
	IF NOT q0 AND in0 AND tx - last &lt;= wait0 THEN
		Q0 := TRUE;
		last := tx;
	ELSIF NOT q0 AND tx - last &gt; wait0 THEN
		status := 1;
		run := FALSE;
	ELSIF q0 AND tx - last &gt;= delay0 THEN
		step := 1;
		last := tx;
	END_IF;
END_IF;
IF run AND step = 1 THEN
	IF NOT q1 AND in1 AND tx - last &lt;= wait1 THEN
		Q0 := FALSE;
		Q1 := TRUE;
		last := tx;
	ELSIF NOT q1 AND Tx - last &gt; wait1 THEN
		status := 2;
		q0 := FALSE;
		run := FALSE;
	ELSIF q1 AND tx - last &gt;= delay1 THEN
		step := 2;
		last := tx;
	END_IF;
END_IF;
IF run AND step = 2 THEN
	IF NOT q2 AND in2 AND tx - last &lt;= wait2 THEN
		Q1 := FALSE;
		Q2 := TRUE;
		last := tx;
	ELSIF NOT q2 AND Tx - last &gt; wait2 THEN
		status := 3;
		q1 := FALSE;
		run := FALSE;
	ELSIF q2 AND tx - last &gt;= delay2 THEN
		step := 3;
		last := tx;
	END_IF;
END_IF;
IF run AND step = 3 THEN
	IF NOT q3 AND in3 AND tx - last &lt;= wait3 THEN
		Q2 := FALSE;
		Q3 := TRUE;
		last := tx;
	ELSIF NOT q3 AND Tx - last &gt; wait3 THEN
		status := 4;
		q2 := FALSE;
		run := FALSE;
	ELSIF q3 AND tx - last &gt;= delay3 THEN
		step := 4;
		last := tx;
	END_IF;
END_IF;
IF run AND step = 4 THEN
	IF NOT q4 AND in4 AND tx - last &lt;= wait4 THEN
		Q3 := FALSE;
		Q4 := TRUE;
		last := tx;
	ELSIF NOT q4 AND Tx - last &gt; wait4 THEN
		status := 5;
		q3 := FALSE;
		run := FALSE;
	ELSIF q4 AND tx - last &gt;= delay4 THEN
		step := 5;
		last := tx;
	END_IF;
END_IF;
IF run AND step = 5 THEN
	IF NOT q5 AND in5 AND tx - last &lt;= wait5 THEN
		Q4 := FALSE;
		Q5 := TRUE;
		last := tx;
	ELSIF NOT q5 AND Tx - last &gt; wait5 THEN
		status := 6;
		q4 := FALSE;
		run := FALSE;
	ELSIF q5 AND tx - last &gt;= delay5 THEN
		step := 6;
		last := tx;
	END_IF;
END_IF;
IF run AND step = 6 THEN
	IF NOT q6 AND in6 AND tx - last &lt;= wait6 THEN
		Q5 := FALSE;
		Q6 := TRUE;
		last := tx;
	ELSIF NOT q6 AND Tx - last &gt; wait6 THEN
		status := 7;
		q5 := FALSE;
		run := FALSE;
	ELSIF q6 AND tx - last &gt;= delay6 THEN
		step := 7;
		last := tx;
	END_IF;
END_IF;
IF run AND step = 7 THEN
	IF NOT q7 AND in7 AND tx - last &lt;= wait7 THEN
		Q6 := FALSE;
		Q7 := TRUE;
		last := tx;
	ELSIF NOT q7 AND Tx - last &gt; wait7 THEN
		status := 8;
		q6 := FALSE;
		run := FALSE;
	ELSIF q7 AND tx - last &gt;= delay7 THEN
		step := -1;
		Q7 := FALSE;
		Run := FALSE;
		status := 110;
	END_IF;
END_IF;
QX := q0 OR q1 OR q2 OR q3 OR q4 OR q5 OR q6 OR q7;

(*
hm 1.10.06		rev 1.1
	corrected delay logic to be after event and not before
	added any output

hm 1.12.06		rev 1.2
	corrected failure in sequence logic.
	added init at startup to prevent from initial statuss after start.

hm 17.1.2007		rev 1.3
	changed output fault to status for better compatibility with other modules (ESR)
	added stop on error functionality and setup variable
	default for inputs in0..7 is true.
	renames variable state to step

hm	17.sep 2007	rev 1.4
	replaced time() with T_PLC_MS() for compatibility reasons

hm	13. mar. 2009	rev 1.5
	renamed output any to qx for compatibility resons

*)
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>6aacf39c-ffb2-4b7e-b1c9-3ce2bca7de7c</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="TMAX" pouType="functionBlock">
        <interface>
          <inputVars>
            <variable name="IN">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="PT">
              <type>
                <TIME />
              </type>
            </variable>
          </inputVars>
          <outputVars>
            <variable name="Q">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="Z">
              <type>
                <BOOL />
              </type>
            </variable>
          </outputVars>
          <localVars>
            <variable name="tx">
              <type>
                <TIME />
              </type>
            </variable>
            <variable name="start">
              <type>
                <TIME />
              </type>
            </variable>
            <variable name="last_in">
              <type>
                <BOOL />
              </type>
            </variable>
          </localVars>
        </interface>
        <body>
          <ST>
            (* read system timer *)
tx := DWORD_TO_TIME(T_PLC_MS());

Z := FALSE;

IF NOT in THEN
	Q := FALSE;
ELSIF IN AND NOT last_in THEN
	Q := TRUE;
	start := tx;
ELSIF (tx - start &gt;= PT) AND Q THEN
	Q := FALSE;
	Z := TRUE;
END_IF;

last_in := IN;



(* revision history
hm	20. jul. 2008	rev 1.0
	original version

*)
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>6ad322b3-2ba9-4975-8152-377ff062a8e0</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="TMIN" pouType="functionBlock">
        <interface>
          <inputVars>
            <variable name="IN">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="PT">
              <type>
                <TIME />
              </type>
            </variable>
          </inputVars>
          <outputVars>
            <variable name="Q">
              <type>
                <BOOL />
              </type>
            </variable>
          </outputVars>
          <localVars>
            <variable name="pm">
              <type>
                <derived name="TP" />
              </type>
            </variable>
          </localVars>
        </interface>
        <body>
          <ST>
            pm(in := IN, PT := PT);
Q := IN OR pm.Q;


(* revision history
hm	21. jul. 2008	rev 1.0
	original version

*)
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>0065f6c2-dd85-4f8b-8504-3f5f626c39dc</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="TOF_1" pouType="functionBlock">
        <interface>
          <inputVars>
            <variable name="IN">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="PT">
              <type>
                <TIME />
              </type>
            </variable>
            <variable name="RST">
              <type>
                <BOOL />
              </type>
            </variable>
          </inputVars>
          <outputVars>
            <variable name="Q">
              <type>
                <BOOL />
              </type>
            </variable>
          </outputVars>
          <localVars>
            <variable name="tx">
              <type>
                <TIME />
              </type>
            </variable>
            <variable name="start">
              <type>
                <TIME />
              </type>
            </variable>
          </localVars>
        </interface>
        <body>
          <ST>
            (* read system timer *)
tx := DWORD_TO_TIME(T_PLC_MS());

IF RST THEN
	Q := FALSE;
ELSIF IN THEN
	Q := TRUE;
	start := tx;
ELSIF tx - start &gt;= PT THEN
	Q := FALSE;
END_IF;




(* revision history
hm	17. jul. 2008	rev 1.0
	original version

*)
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>5db82c5f-1539-4ecc-b459-64395a02a775</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="TONOF" pouType="functionBlock">
        <interface>
          <inputVars>
            <variable name="IN">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="T_ON">
              <type>
                <TIME />
              </type>
            </variable>
            <variable name="T_OFF">
              <type>
                <TIME />
              </type>
            </variable>
          </inputVars>
          <outputVars>
            <variable name="Q">
              <type>
                <BOOL />
              </type>
            </variable>
          </outputVars>
          <localVars>
            <variable name="X">
              <type>
                <derived name="TON" />
              </type>
            </variable>
            <variable name="old">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="mode">
              <type>
                <BOOL />
              </type>
            </variable>
          </localVars>
        </interface>
        <body>
          <ST>
            IF IN XOR old THEN
  X(IN := FALSE, PT := SEL(IN,T_OFF,T_ON));
  mode := IN;
  old := IN;
END_IF;
X(IN := TRUE);
IF X.Q THEN Q := mode;END_IF;

(* revision history
hm	10. dec 2007	rev 1.0
	original version

hm	17. sep. 2007	rev 1.1
	improved performance

hm	21. jul. 2009	rev 1.2
	fixed a timing probelm


*)

          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>3094251a-1ca0-438d-8f92-3d5861af5417</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="TP_1" pouType="functionBlock">
        <interface>
          <inputVars>
            <variable name="IN">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="PT">
              <type>
                <TIME />
              </type>
            </variable>
            <variable name="RST">
              <type>
                <BOOL />
              </type>
            </variable>
          </inputVars>
          <outputVars>
            <variable name="Q">
              <type>
                <BOOL />
              </type>
            </variable>
          </outputVars>
          <localVars>
            <variable name="tx">
              <type>
                <TIME />
              </type>
            </variable>
            <variable name="start">
              <type>
                <TIME />
              </type>
            </variable>
            <variable name="ix">
              <type>
                <BOOL />
              </type>
            </variable>
          </localVars>
        </interface>
        <body>
          <ST>
            (* read system timer *)
tx := DWORD_TO_TIME(T_PLC_MS());

IF RST THEN
	Q := FALSE;
ELSIF IN AND NOT ix THEN
	Q := TRUE;
	start := tx;
ELSIF tx - start &gt;= PT THEN
	Q := FALSE;
END_IF;

ix:= IN;



(* revision history
hm	28. jun. 2008
	original version

*)
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>0c2ad3e4-859b-45a8-a3a2-224fab4c7ec5</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="TP_1D" pouType="functionBlock">
        <interface>
          <inputVars>
            <variable name="IN">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="PT1">
              <type>
                <TIME />
              </type>
            </variable>
            <variable name="PTD">
              <type>
                <TIME />
              </type>
            </variable>
            <variable name="RST">
              <type>
                <BOOL />
              </type>
            </variable>
          </inputVars>
          <outputVars>
            <variable name="Q">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="W">
              <type>
                <BOOL />
              </type>
            </variable>
          </outputVars>
          <localVars>
            <variable name="tx">
              <type>
                <TIME />
              </type>
            </variable>
            <variable name="start">
              <type>
                <TIME />
              </type>
            </variable>
            <variable name="ix">
              <type>
                <BOOL />
              </type>
            </variable>
          </localVars>
        </interface>
        <body>
          <ST>
            (* read system timer *)
tx := DWORD_TO_TIME(T_PLC_MS());

IF RST THEN
	Q := FALSE;
	rst := FALSE;
	W := FALSE;
ELSIF W THEN
	IF tx - start &gt;= PTD THEN
		W := FALSE;
	END_IF;
ELSIF IN AND NOT ix THEN
	Q := TRUE;
	start := tx;
	in := FALSE;
ELSIF tx - start &gt;= PT1 THEN
	Q := FALSE;
	W := TRUE;
	start := tx;
END_IF;

ix := IN;



(* revision history
hm	28. jun. 2008
	original version

*)
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>2007ffd7-39a2-4146-b862-4428c68557cb</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="TP_X" pouType="functionBlock">
        <interface>
          <inputVars>
            <variable name="IN">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="PT">
              <type>
                <TIME />
              </type>
            </variable>
          </inputVars>
          <outputVars>
            <variable name="Q">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="ET">
              <type>
                <TIME />
              </type>
            </variable>
          </outputVars>
          <localVars>
            <variable name="edge">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="start">
              <type>
                <TIME />
              </type>
            </variable>
            <variable name="tx">
              <type>
                <TIME />
              </type>
            </variable>
          </localVars>
        </interface>
        <body>
          <ST>
            (* read system_time *)
tx := DWORD_TO_TIME(T_PLC_MS());

(* rising edge trigger *)
IF IN AND NOT edge THEN
	start := tx;
	Q := PT &gt; t#0ms;
ELSIF Q THEN
	ET := tx - start;
	IF ET &gt;= PT THEN
		Q := FALSE;
		ET := t#0ms;
	END_IF;
END_IF;
edge := IN;

(* revision history
hm	4. aug 2006		rev 1.0
	original version

hm	17. sep 2007	rev 1.1
	replaced time() with T_PLC_MS() for compatibility reasons

hm	19. oct. 2008	rev 1.2
	renamed to TP_R to TP_X for compatibility reasons

hm	17. dec. 2008	rev 1.3
	code optimized

*)
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>65499c20-b350-44df-9233-9cd64f7727d2</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="FIFO_16" pouType="functionBlock">
        <interface>
          <inputVars>
            <variable name="Din">
              <type>
                <DWORD />
              </type>
            </variable>
            <variable name="E">
              <type>
                <BOOL />
              </type>
              <initialValue>
                <simpleValue value="TRUE" />
              </initialValue>
            </variable>
            <variable name="RD">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="WD">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="RST">
              <type>
                <BOOL />
              </type>
            </variable>
          </inputVars>
          <outputVars>
            <variable name="Dout">
              <type>
                <DWORD />
              </type>
            </variable>
            <variable name="EMPTY">
              <type>
                <BOOL />
              </type>
              <initialValue>
                <simpleValue value="TRUE" />
              </initialValue>
            </variable>
            <variable name="FULL">
              <type>
                <BOOL />
              </type>
            </variable>
          </outputVars>
          <localVars>
            <variable name="fifo">
              <type>
                <array>
                  <dimension lower="0" upper="n" />
                  <baseType>
                    <DWORD />
                  </baseType>
                </array>
              </type>
            </variable>
            <variable name="pr">
              <type>
                <INT />
              </type>
            </variable>
            <variable name="pw">
              <type>
                <INT />
              </type>
            </variable>
          </localVars>
          <localVars constant="true">
            <variable name="n">
              <type>
                <INT />
              </type>
              <initialValue>
                <simpleValue value="16" />
              </initialValue>
              <documentation>
                 changing this value will chage the number of stored elements in the fifo 
              </documentation>
            </variable>
          </localVars>
        </interface>
        <body>
          <ST>
            IF RST THEN
	pw := pr;
	FULL := FALSE;
	EMPTY := TRUE;
	Dout := 0;
ELSIF E THEN
	IF NOT EMPTY AND RD THEN
		Dout := fifo[pr];
		pr := INC1(pr,n);
		EMPTY := pr = pw;
		FULL := FALSE;
	END_IF;
	IF NOT FULL AND WD THEN
		fifo[pw] := Din;
		pw := INC1(pw,n);
		FULL := pw = pr;
		EMPTY := FALSE;
	END_IF;
END_IF;


(* revision history

hm	4. aug. 2006	rev 1.0
	original version

hm	19. feb 2008	rev 1.1
	performance improvements

hm	17. oct. 2008	rev 1.2
	improved performance

ks	27. oct. 2008	rev 1.3
	optimized coding

hm	14. mar. 2009	rev 1.4
	removed double assignments

hm 24. jul. 2009	rev 2.0
	chaged inputs E and WR to E, WD and WR
	allow read and write in one cycle

*)

          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>39f4666f-692f-4fe2-805c-5e9e12530c8f</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="FIFO_32" pouType="functionBlock">
        <interface>
          <inputVars>
            <variable name="Din">
              <type>
                <DWORD />
              </type>
            </variable>
            <variable name="E">
              <type>
                <BOOL />
              </type>
              <initialValue>
                <simpleValue value="TRUE" />
              </initialValue>
            </variable>
            <variable name="RD">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="WD">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="RST">
              <type>
                <BOOL />
              </type>
            </variable>
          </inputVars>
          <outputVars>
            <variable name="Dout">
              <type>
                <DWORD />
              </type>
            </variable>
            <variable name="EMPTY">
              <type>
                <BOOL />
              </type>
              <initialValue>
                <simpleValue value="TRUE" />
              </initialValue>
            </variable>
            <variable name="FULL">
              <type>
                <BOOL />
              </type>
            </variable>
          </outputVars>
          <localVars>
            <variable name="fifo">
              <type>
                <array>
                  <dimension lower="0" upper="n" />
                  <baseType>
                    <DWORD />
                  </baseType>
                </array>
              </type>
            </variable>
            <variable name="pr">
              <type>
                <INT />
              </type>
            </variable>
            <variable name="pw">
              <type>
                <INT />
              </type>
            </variable>
          </localVars>
          <localVars constant="true">
            <variable name="n">
              <type>
                <INT />
              </type>
              <initialValue>
                <simpleValue value="32" />
              </initialValue>
              <documentation>
                 changing this value will chage the number of stored elements in the fifo 
              </documentation>
            </variable>
          </localVars>
        </interface>
        <body>
          <ST>
            IF RST THEN
	pw := pr;
	FULL := FALSE;
	EMPTY := TRUE;
	Dout := 0;
ELSIF E THEN
	IF NOT EMPTY AND RD THEN
		Dout := fifo[pr];
		pr := INC1(pr,n);
		EMPTY := pr = pw;
		FULL := FALSE;
	END_IF;
	IF NOT FULL AND WD THEN
		fifo[pw] := Din;
		pw := INC1(pw,n);
		FULL := pw = pr;
		EMPTY := FALSE;
	END_IF;
END_IF;

(* revision history
hm	4. aug. 2006	rev 1.0
	original version

hm	19. feb 2008	rev 1.1
	performance improvements

hm	17. oct. 2008	rev 1.2
	improved performance

ks	27. oct. 2008 rev 1.3
	improved code

hm	14. mar. 2009	rev 1.4
	removed double assignments

hm 24. jul. 2009	rev 2.0
	chaged inputs E and WR to E, WD and WR
	allow read and write in one cycle

*)


          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>3b88ba9f-7d89-4c3b-af47-2c13bfb7e01a</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="STACK_16" pouType="functionBlock">
        <interface>
          <inputVars>
            <variable name="Din">
              <type>
                <DWORD />
              </type>
            </variable>
            <variable name="E">
              <type>
                <BOOL />
              </type>
              <initialValue>
                <simpleValue value="TRUE" />
              </initialValue>
            </variable>
            <variable name="RD">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="WD">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="RST">
              <type>
                <BOOL />
              </type>
            </variable>
          </inputVars>
          <outputVars>
            <variable name="Dout">
              <type>
                <DWORD />
              </type>
            </variable>
            <variable name="EMPTY">
              <type>
                <BOOL />
              </type>
              <initialValue>
                <simpleValue value="TRUE" />
              </initialValue>
            </variable>
            <variable name="FULL">
              <type>
                <BOOL />
              </type>
            </variable>
          </outputVars>
          <localVars>
            <variable name="stack">
              <type>
                <array>
                  <dimension lower="0" upper="n" />
                  <baseType>
                    <DWORD />
                  </baseType>
                </array>
              </type>
            </variable>
            <variable name="pt">
              <type>
                <INT />
              </type>
            </variable>
          </localVars>
          <localVars constant="true">
            <variable name="n">
              <type>
                <INT />
              </type>
              <initialValue>
                <simpleValue value="15" />
              </initialValue>
              <documentation>
                 changing this value will chage the number of stored elements in the fifo 
              </documentation>
            </variable>
          </localVars>
        </interface>
        <body>
          <ST>
            IF RST THEN
	(* asynchronous reset for the fifo *)
	pt := 0;
	EMPTY := TRUE;
	FULL := FALSE;
	Dout := 0;
ELSIF E THEN
	IF NOT EMPTY AND RD THEN
		(* read one element *)
		pt := pt - 1;
		Dout := stack[pt];
		EMPTY := pt = 0;
		FULL := FALSE;
	END_IF;
	IF NOT FULL AND WD THEN
		(* write one element *)
		stack[pt] := Din;
		pt := pt + 1;
		FULL := pt &gt; n;
		EMPTY := FALSE;
	END_IF;
END_IF;


(* revision history
hm	4. aug. 2006	rev 1.0
	original version

hm	19. feb 2008	rev 1.1
	performance improvements

hm	17. oct. 2008	rev 1.2
	deleted unnecessary init with 0

hm	27. oct. 2008	rev 1.3
	optimized performance

hm	25. jul 2009	rev 2.0
	changed inputs to allow simultsaneous read and write
*)


          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>8f412310-b164-4140-b726-90dc83f4b27f</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="STACK_32" pouType="functionBlock">
        <interface>
          <inputVars>
            <variable name="Din">
              <type>
                <DWORD />
              </type>
            </variable>
            <variable name="E">
              <type>
                <BOOL />
              </type>
              <initialValue>
                <simpleValue value="TRUE" />
              </initialValue>
            </variable>
            <variable name="RD">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="WD">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="RST">
              <type>
                <BOOL />
              </type>
            </variable>
          </inputVars>
          <outputVars>
            <variable name="Dout">
              <type>
                <DWORD />
              </type>
            </variable>
            <variable name="EMPTY">
              <type>
                <BOOL />
              </type>
              <initialValue>
                <simpleValue value="TRUE" />
              </initialValue>
            </variable>
            <variable name="FULL">
              <type>
                <BOOL />
              </type>
            </variable>
          </outputVars>
          <localVars>
            <variable name="stack">
              <type>
                <array>
                  <dimension lower="0" upper="n" />
                  <baseType>
                    <DWORD />
                  </baseType>
                </array>
              </type>
            </variable>
            <variable name="pt">
              <type>
                <INT />
              </type>
            </variable>
          </localVars>
          <localVars constant="true">
            <variable name="n">
              <type>
                <INT />
              </type>
              <initialValue>
                <simpleValue value="31" />
              </initialValue>
              <documentation>
                 changing this value will chage the number of stored elements in the fifo 
              </documentation>
            </variable>
          </localVars>
        </interface>
        <body>
          <ST>
            IF RST THEN
	(* asynchronous reset for the fifo *)
	pt := 0;
	EMPTY := TRUE;
	FULL := FALSE;
	Dout := 0;
ELSIF E THEN
	IF NOT EMPTY AND RD THEN
		(* read one element *)
		pt := pt - 1;
		Dout := stack[pt];
		EMPTY := pt = 0;
		FULL := FALSE;
	END_IF;
	IF NOT FULL AND WD THEN
		(* write one element *)
		stack[pt] := Din;
		pt := pt + 1;
		FULL := pt &gt; n;
		EMPTY := FALSE;
	END_IF;
END_IF;


(* revision history
hm	4. aug. 2006	rev 1.0
	original version

hm	19. feb 2008	rev 1.1
	performance improvements

hm	17. oct. 2008	rev 1.2
	deleted unnecessary init with 0

ks	27. oct. 2008	rev 1.3
	optimized performance

hm	25. jul 2009	rev 2.0
	changed inputs to allow simultsaneous read and write

*)

          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>3a032fcc-d5a3-48e4-87ea-02a22cfca38b</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="CRC_GEN" pouType="function">
        <interface>
          <returnType>
            <DWORD />
          </returnType>
          <inputVars>
            <variable name="PT">
              <type>
                <pointer>
                  <baseType>
                    <array>
                      <dimension lower="0" upper="32000" />
                      <baseType>
                        <BYTE />
                      </baseType>
                    </array>
                  </baseType>
                </pointer>
              </type>
            </variable>
            <variable name="SIZE">
              <type>
                <INT />
              </type>
            </variable>
            <variable name="PL">
              <type>
                <INT />
              </type>
            </variable>
            <variable name="PN">
              <type>
                <DWORD />
              </type>
            </variable>
            <variable name="INIT">
              <type>
                <DWORD />
              </type>
            </variable>
            <variable name="REV_IN">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="REV_OUT">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="XOR_OUT">
              <type>
                <DWORD />
              </type>
            </variable>
          </inputVars>
          <localVars>
            <variable name="pos">
              <type>
                <INT />
              </type>
            </variable>
            <variable name="shift">
              <type>
                <INT />
              </type>
            </variable>
            <variable name="dx">
              <type>
                <BYTE />
              </type>
            </variable>
            <variable name="bits">
              <type>
                <INT />
              </type>
            </variable>
          </localVars>
        </interface>
        <body>
          <ST>
            (* align polygon *)
shift := 32 - PL;
PN := SHL(PN, shift);

(* load first 4 bytes into register minimum message size is 4 bytes
	for smaller messages fill with 0#s at the beginning*)
FOR pos := 0 TO 3 DO
	IF REV_IN THEN CRC_GEN := SHL(CRC_GEN, 8) OR REVERSE(PT^[pos]); ELSE CRC_GEN := SHL(CRC_GEN, 8) OR PT^[pos]; END_IF;
END_FOR;
pos := 4;

(* xor with init value *)
CRC_GEN := CRC_GEN XOR SHL(init, shift);

(* calculate CRC for each byte *)
WHILE pos &lt; size DO
	IF REV_IN THEN DX := REVERSE(PT^[pos]); ELSE DX := PT^[pos]; END_IF;
	pos := pos + 1;
	(* crc calculation for one byte *)
	FOR bits := 0 TO 7 DO
		IF CRC_GEN.31 THEN
			CRC_GEN := (SHL(CRC_GEN, 1) OR BOOL_TO_DWORD(DX.7)) XOR PN;
		ELSE
			CRC_GEN := SHL(CRC_GEN, 1) OR BOOL_TO_DWORD(DX.7);
		END_IF;
		dx := SHL(dx, 1);
	END_FOR;
END_WHILE;

(* all bytes are processed, need to finish the registers 32 bits *)
FOR bits := 0 TO 31 DO
	IF CRC_GEN.31 THEN
		CRC_GEN := (SHL(CRC_GEN, 1) ) XOR PN;
	ELSE
		CRC_GEN := SHL(CRC_GEN, 1);
	END_IF;
END_FOR;

(* final XOR *)
CRC_GEN := SHR(CRC_GEN, shift) XOR XOR_OUT;

(* reverse the crc_out put if necessary *)
IF REV_OUT THEN CRC_GEN := REFLECT(CRC_GEN, PL); END_IF;

(* suggested optimization by deninis klopke
die betreffs genannte Funktion kann folgendermaßen optimiert werden:
In Zeilen 33 und 35 des Implementierungsteils kann jeweils der Teil „OR BOOL_TO_DWORD(DX.7)“ entfallen, da nach 8maligem Linksshift von „DX“ in Zeile 26 der Wert von DX = BYTE#0 ist. Eine weitere Veroderung mit diesem Wert hat keine Auswirkungen auf das Ergebnis mehr.
*)

(* typical crc polynoms

CRC-4-ITU 			x4 + x + 1 					(ITU G.704, p. 12) 	0x3 or 0xC (0x9)
CRC-5-ITU 			x5 + x4 + x2 + 1 			(ITU G.704, p. 9) 	0x15 or 0x15 (0x0B) Bluetooth
CRC-5-USB 			x5 + x2 + 1 				(use: USB token packets) 	0x05 or 0x14 (0x9)
CRC-6-ITU 			x6 + x + 1 					(ITU G.704, p. 3) 	0x03 or 0x30 (0x21)
CRC-7 				x7 + x3 + 1 				(use: telecom systems, MMC) 	0x09 or 0x48 (0x11)
CRC-8-ATM 			x8 + x2 + x + 1 				(use: ATM HEC) 	0x07 or 0xE0 (0xC1)
CRC-8-CCITT 		x8 + x7 + x3 + x2 + 1 		(use: 1-Wire bus) 	0x8D or 0xB1 (0x63)
CRC-8-Dallas/Maxim 	x8 + x5 + x4 + 1 			(use: 1-Wire bus) 	0x31 or 0x8C (0x19)
CRC-8 				x8 + x7 + x6 + x4 + x2 + 1 	0xD5 or 0xAB (0x57)
CRC-8-SAE J1850 	x8 + x4 + x3 + x2 + 1 		0x1D or 0xB8
CRC-10 				x10 + x9 + x5 + x4 + x + 1 	0x233 or 0x331 (0x263)
CRC-12 				x12 + x11 + x3 + x2 + x + 1 (use: telecom systems) 	0x80F or 0xF01 (0xE03)
CRC-15-CAN 			x15 + x14 + x10 + x8 + x7 + x4 + x3 + 1 	0x4599 or 0x4CD1 (0x19A3)
CRC-16-Fletcher 	Not a CRC; see Fletcher's checksum 	Used in Adler-32 A &amp; B CRCs
CRC-16-CCITT 	x16 + x12 + x5 + 1 (XMODEM,X.25, V.41, Bluetooth, PPP, IrDA; known as "CRC-CCITT") 	0x1021 or 0x8408 (0x0811)
CRC-16-IBM 	x16 + x15 + x2 + 1 (USB, many others; also known as "CRC-16") 	0x8005 or 0xA001 (0x4003)
CRC-24-Radix-64 	x24 + x23 + x18 + x17 + x14 + x11 + x10 + x7 + x6 + x5 + x4 + x3 + x + 1 	0x864CFB or 0xDF3261 (0xBE64C3)
CRC-32-Adler 	Not a CRC; see Adler-32 	See Adler-32
CRC-32-MPEG2 	x32 + x26 + x23 + x22 + x16 + x12 + x11 + x10 + x8 + x7 + x5 + x4 + x2 + x + 1 	0x04C11DB7 or 0xEDB88320 (0xDB710641) Also used in IEEE 802.3
CRC-32-IEEE 802.3 	x32 + x26 + x23 + x22 + x16 + x12 + x11 + x10 + x8 + x7 + x5 + x4 + x2 + x + 1 (V.42) 	0x04C11DB7 or 0xEDB88320 (0xDB710641)
CRC-32C (Castagnoli) 	x32 + x28 + x27 + x26 + x25 + x23 + x22 + x20 + x19 + x18 + x14 + x13 + x11 + x10 + x9 + x8 + x6 + 1 	0x1EDC6F41 or 0x82F63B78 (0x05EC76F1)
CRC-64-ISO 	x64 + x4 + x3 + x + 1 (use: ISO 3309) 	0x000000000000001B or 0xD800000000000000 (0xB000000000000001)
CRC-64-ECMA-182 	x64 + x62 + x57 + x55 + x54 + x53 + x52 + x47 + x46 + x45 + x40 + x39 + x38 + x37 + x35 + x33 + x32 + x31 + x29 + x27 + x24 + x23 + x22 + x21 + x19 + x17 + x13 + x12 + x10 + x9 + x7 + x4 + x + 1
(as described in ECMA-182 p.63) 	0x42F0E1EBA9EA3693 or 0xC96C5795D7870F42 (0x92D8AF2BAF0E1E85)
*)



(* revision history

hm	9.6.2007		rev 1.0		
	original version 

hm	11.9.2007		rev 1.1
	deleted unused variable i

hm	9. oct 2007 	rev 1.2
	added init code for crc and xor_out
	added refelct in and reflect_out (rev_in und Rev_out)

hm	2. jan 2008	rev 1.3
	small changes for performance improvements

hm	16. mar. 2008	rev 1.4
	changed type of input size to uint

hm	10. mar. 2009	rev 1.5
	removed nested comments

hm	16. jan. 2011	rev 2.0
	new version

dk 3. feb 2021		rev 2.1
	improved code by dennis koepke

*)
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>6f107264-311f-4135-9dd1-b5fd577ec9fd</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="MATRIX" pouType="functionBlock">
        <interface>
          <inputVars>
            <variable name="x1">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="x2">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="x3">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="x4">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="X5">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="Release">
              <type>
                <BOOL />
              </type>
              <addData>
                <data name="http://www.3s-software.com/plcopenxml/attributes" handleUnknown="implementation">
                  <Attributes>
                    <Attribute Name="input_constant" Value="" />
                  </Attributes>
                </data>
              </addData>
            </variable>
          </inputVars>
          <outputVars>
            <variable name="code">
              <type>
                <BYTE />
              </type>
            </variable>
            <variable name="TP">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="y1">
              <type>
                <BOOL />
              </type>
              <initialValue>
                <simpleValue value="TRUE" />
              </initialValue>
            </variable>
            <variable name="y2">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="y3">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="y4">
              <type>
                <BOOL />
              </type>
            </variable>
          </outputVars>
          <localVars>
            <variable name="line">
              <type>
                <BYTE />
              </type>
            </variable>
            <variable name="X">
              <type>
                <array>
                  <dimension lower="0" upper="3" />
                  <baseType>
                    <BYTE />
                  </baseType>
                </array>
              </type>
              <documentation>
                 scan line inputs 
              </documentation>
            </variable>
            <variable name="L">
              <type>
                <array>
                  <dimension lower="0" upper="3" />
                  <baseType>
                    <BYTE />
                  </baseType>
                </array>
              </type>
              <documentation>
                 scan line status 
              </documentation>
            </variable>
            <variable name="i">
              <type>
                <INT />
              </type>
            </variable>
            <variable name="temp">
              <type>
                <BYTE />
              </type>
            </variable>
          </localVars>
        </interface>
        <body>
          <ST>
            TP := FALSE;
CODE := 0;
(* read scan lines *)
X[line].0 := X1;
X[line].1 := X2;
X[line].2 := X3;
X[line].3 := X4;
X[line].4 := X5;

(* compare for change *)
FOR i := 0 TO 3 DO
	IF X[i] &lt;&gt; L[i] THEN
		(* scan line information has changed code need to be found and generated *)
		temp := x[i] XOR L[i];
		IF temp.0 THEN
			CODE := 1;
			code.7 := X[i].0;
			L[i].0 := X[i].0;
		ELSIF temp.1 THEN
			code := 2;
			code.7 := X[i].1;
			L[i].1 := X[i].1;
		ELSIF temp.2 THEN
			code := 3;
			code.7 := X[i].2;
			L[i].2 := X[i].2;
		ELSIF temp.3 THEN
			CODE := 4;
			CODE.7 := X[i].3;
			L[i].3 := X[i].3;
		ELSIF temp.4 THEN
			CODE := 5;
			CODE.7 := X[i].4;
			L[i].4 := X[i].4;
		END_IF;
		TP := TRUE;
		CODE.4 := Line.0;
		CODE.5 := Line.1;
		CODE.6 := Line.2;

		(* check if release codes need to be killed *)
		IF NOT release AND CODE &lt; 127 THEN
			CODE := 0;
			TP := FALSE;
		END_IF;
		EXIT;
	END_IF;
END_FOR;

(* increment scan line every cycle *)
line := (line + 1) AND 2#0000_0011;
temp := SHL(BYTE#1,line);
Y1 := temp.0;
Y2 := temp.1;
Y3 := temp.2;
Y4 := temp.3;




(* revision history
hm		10.6.2007	rev 1.0		
	original version 


hm		11.9.2007	rev 1.1		
	deleted unused variables k and old_code

hm		23.12.2007	rev 1.2
	added exit statement in for loop instead of i:=5

hm		26. oct. 2008	rev 1.3
	code optimized

*)

          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>78655e08-5233-4e93-ae89-b51add411fde</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="PIN_CODE" pouType="functionBlock">
        <interface>
          <inputVars>
            <variable name="CB">
              <type>
                <BYTE />
              </type>
            </variable>
            <variable name="E">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="PIN">
              <type>
                <string length="8" />
              </type>
              <addData>
                <data name="http://www.3s-software.com/plcopenxml/attributes" handleUnknown="implementation">
                  <Attributes>
                    <Attribute Name="input_constant" Value="" />
                  </Attributes>
                </data>
              </addData>
            </variable>
          </inputVars>
          <outputVars>
            <variable name="TP">
              <type>
                <BOOL />
              </type>
            </variable>
          </outputVars>
          <localVars>
            <variable name="POS">
              <type>
                <INT />
              </type>
              <initialValue>
                <simpleValue value="1" />
              </initialValue>
            </variable>
          </localVars>
        </interface>
        <body>
          <ST>
            tp := FALSE;
IF e THEN
	IF CB = CODE(pin, pos) THEN
		pos := pos + 1;
		IF pos &gt; LEN(PIN) THEN
			(* proper code is detected *)
			TP := TRUE;
			pos := 1;
		END_IF;
	ELSE
		pos := 1;
	END_IF;
END_IF;


(* revision history
hm	30. oct. 2008	rev 1.0		
	original version 


*)

          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>8e36e582-22ee-422e-bac2-120d75f6a74a</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="ACOSH" pouType="function">
        <interface>
          <returnType>
            <REAL />
          </returnType>
          <inputVars>
            <variable name="X">
              <type>
                <REAL />
              </type>
            </variable>
          </inputVars>
        </interface>
        <body>
          <ST>
            ACOSH := LN(SQRT(X * X - 1.0) + X);

(* revision history
hm		12 jan 2007	rev 1.0
	original version

hm		2. dec 2007	rev 1.1
	changed code for better performance

hm	16. mar. 2007		rev 1.2
	changed sequence of calculations to improve performance

hm	10. mar. 2009		rev 1.3
	real constants updated to new systax using dot

*)
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>de14335f-663b-4f34-a274-577800021320</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="ACOTH" pouType="function">
        <interface>
          <returnType>
            <REAL />
          </returnType>
          <inputVars>
            <variable name="X">
              <type>
                <REAL />
              </type>
            </variable>
          </inputVars>
        </interface>
        <body>
          <ST>
            ACOTH := LN((x+1.0)/(x-1.0))*0.5;

(* revision history
hm		12 jan 2007	rev 1.0
	original version

hm		5. jan 2008	rev 1.1
	improved code for better performance

hm	10. mar. 2009		rev 1.2
	real constants updated to new systax using dot

*)
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>2dd74260-dc25-42d3-ac8d-4e01207e1396</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="AGDF" pouType="function">
        <interface>
          <returnType>
            <REAL />
          </returnType>
          <inputVars>
            <variable name="X">
              <type>
                <REAL />
              </type>
            </variable>
          </inputVars>
        </interface>
        <body>
          <ST>
            AGDF := LN((1.0 + SIN(X)) / COS(X));

(* comment
the current implementation gives sufficient accuracy only up to X = 1.57 or an output &gt; 10.
is X closer to PI/2 then the function is more and more unreliable
*)



(* revision history
hm	27. apr. 2008	rev 1.0
	original version

hm	10. mar. 2009	rev 1.1
	real constants updated to new systax using dot

*)

          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>93285f16-ac1e-4b1a-8f14-653a7d25f26e</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="_ARRAY_ABS" pouType="function">
        <interface>
          <returnType>
            <BOOL />
          </returnType>
          <inputVars>
            <variable name="pt">
              <type>
                <pointer>
                  <baseType>
                    <array>
                      <dimension lower="0" upper="32000" />
                      <baseType>
                        <REAL />
                      </baseType>
                    </array>
                  </baseType>
                </pointer>
              </type>
            </variable>
            <variable name="size">
              <type>
                <UINT />
              </type>
            </variable>
          </inputVars>
          <localVars>
            <variable name="i">
              <type>
                <UINT />
              </type>
            </variable>
            <variable name="stop">
              <type>
                <UINT />
              </type>
            </variable>
          </localVars>
        </interface>
        <body>
          <ST>
            stop := SHR(size,2)-1;
FOR i := 0 TO stop DO
	PT^[i] := ABS(PT^[i]);
END_FOR;
_ARRAY_ABS := TRUE;


(* revision history
hm	2. apr 2008		rev 1.0
	original version

*)
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>c1cb2400-787b-4655-aa35-c8cb530b2c20</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="_ARRAY_ADD" pouType="function">
        <interface>
          <returnType>
            <BOOL />
          </returnType>
          <inputVars>
            <variable name="pt">
              <type>
                <pointer>
                  <baseType>
                    <array>
                      <dimension lower="0" upper="32000" />
                      <baseType>
                        <REAL />
                      </baseType>
                    </array>
                  </baseType>
                </pointer>
              </type>
            </variable>
            <variable name="size">
              <type>
                <UINT />
              </type>
            </variable>
            <variable name="X">
              <type>
                <REAL />
              </type>
            </variable>
          </inputVars>
          <localVars>
            <variable name="i">
              <type>
                <UINT />
              </type>
            </variable>
            <variable name="stop">
              <type>
                <UINT />
              </type>
            </variable>
          </localVars>
        </interface>
        <body>
          <ST>
            stop := SHR(size,2)-1;
FOR i := 0 TO stop DO
	PT^[i] := PT^[i] + X;
END_FOR;
_ARRAY_ADD := TRUE;


(* revision history
hm	2. apr 2008		rev 1.0
	original version

*)
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>f74b54cc-8b66-4afc-8874-6cd37f98f202</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="_ARRAY_INIT" pouType="function">
        <interface>
          <returnType>
            <BOOL />
          </returnType>
          <inputVars>
            <variable name="pt">
              <type>
                <pointer>
                  <baseType>
                    <array>
                      <dimension lower="0" upper="32000" />
                      <baseType>
                        <REAL />
                      </baseType>
                    </array>
                  </baseType>
                </pointer>
              </type>
            </variable>
            <variable name="size">
              <type>
                <UINT />
              </type>
            </variable>
            <variable name="init">
              <type>
                <REAL />
              </type>
            </variable>
          </inputVars>
          <localVars>
            <variable name="i">
              <type>
                <UINT />
              </type>
            </variable>
            <variable name="stop">
              <type>
                <UINT />
              </type>
            </variable>
          </localVars>
        </interface>
        <body>
          <ST>
            stop := SHR(size,2)-1;
FOR i := 0 TO stop DO
	pt^[i] := init;
END_FOR;

_array_init := TRUE;

(* revision History

hm 6.1.2007		rev 1.1
	change type of function to bool
	added  array_init := true to set output true.

hm	14.11.2007	rev 1.2
	changed stop calculation to be more efficient

hm	16.3. 2008		rev 1.3
	changed type of input size to uint
*)
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>434055b9-6091-414b-bbed-6392bc4c3bae</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="_ARRAY_MEDIAN" pouType="function">
        <interface>
          <returnType>
            <REAL />
          </returnType>
          <inputVars>
            <variable name="pt">
              <type>
                <pointer>
                  <baseType>
                    <array>
                      <dimension lower="0" upper="32000" />
                      <baseType>
                        <REAL />
                      </baseType>
                    </array>
                  </baseType>
                </pointer>
              </type>
            </variable>
            <variable name="size">
              <type>
                <UINT />
              </type>
            </variable>
          </inputVars>
          <localVars>
            <variable name="i">
              <type>
                <UINT />
              </type>
            </variable>
            <variable name="stop">
              <type>
                <UINT />
              </type>
            </variable>
          </localVars>
        </interface>
        <body>
          <ST>
            _ARRAY_SORT(pt,size);
stop := SHR(size,2)-1;
IF EVEN(UINT_TO_INT(stop)) THEN
	_ARRAY_MEDIAN := pt^[SHR(stop,1)];
ELSE
	i := SHR(stop,1);
	_ARRAY_MEDIAN := (pt^[i] + pt^[i+1]) * 0.5;
END_IF;

(* old code
stop := (size - SIZEOF(pt)) / SIZEOF(pt);
FOR i := 0 TO stop - 1 DO
	FOR m := i + 1 TO stop DO
		IF pt^[i] &gt; pt^[m] THEN
			temp := pt^[i];
			pt^[i] := pt^[m];
			pt^[m] := temp;
		END_IF;
	END_FOR;
END_FOR;
IF even(stop) THEN
	_array_median := pt^[stop/2];
ELSE
	i := stop/2;
	_array_median := (pt^[i] + pt^[i+1])/2;
END_IF;
*)
(* revision history
hm 	3.3.2007		rev 1.1
	corrected an error, changed the statement line 14	i := TRUNC(stop/2); to i := stop/2;

hm		22. sep 2007	rev 1.2
	changed algorithm to use _array_soft for performance reasons

hm		8. oct 2007		rev 1.3
	deleted unused variables m and temp

hm		14. nov 2007	rev 1.4
	corrected a problem with size calculation

hm		16.3. 2008		rev 1.5
	changed type of input size to uint
	performance improvements
*)
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>5e267b60-efdd-4347-9e46-98fd63a7ebe5</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="_ARRAY_MUL" pouType="function">
        <interface>
          <returnType>
            <BOOL />
          </returnType>
          <inputVars>
            <variable name="pt">
              <type>
                <pointer>
                  <baseType>
                    <array>
                      <dimension lower="0" upper="32000" />
                      <baseType>
                        <REAL />
                      </baseType>
                    </array>
                  </baseType>
                </pointer>
              </type>
            </variable>
            <variable name="size">
              <type>
                <UINT />
              </type>
            </variable>
            <variable name="X">
              <type>
                <REAL />
              </type>
            </variable>
          </inputVars>
          <localVars>
            <variable name="i">
              <type>
                <UINT />
              </type>
            </variable>
            <variable name="stop">
              <type>
                <UINT />
              </type>
            </variable>
          </localVars>
        </interface>
        <body>
          <ST>
            stop := SHR(size,2)-1;
FOR i := 0 TO stop DO
	PT^[i] := PT^[i] * X;
END_FOR;
_ARRAY_MUL := TRUE;


(* revision history
hm	2. apr 2008		rev 1.0
	original version

*)
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>9f8d597f-a226-4ba0-8f56-5abba5d7d0e0</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="_ARRAY_SHUFFLE" pouType="function">
        <interface>
          <returnType>
            <BOOL />
          </returnType>
          <inputVars>
            <variable name="pt">
              <type>
                <pointer>
                  <baseType>
                    <array>
                      <dimension lower="0" upper="32000" />
                      <baseType>
                        <REAL />
                      </baseType>
                    </array>
                  </baseType>
                </pointer>
              </type>
            </variable>
            <variable name="size">
              <type>
                <UINT />
              </type>
            </variable>
          </inputVars>
          <localVars>
            <variable name="temp">
              <type>
                <REAL />
              </type>
            </variable>
            <variable name="pos">
              <type>
                <INT />
              </type>
            </variable>
            <variable name="i">
              <type>
                <INT />
              </type>
            </variable>
            <variable name="stop">
              <type>
                <INT />
              </type>
            </variable>
          </localVars>
        </interface>
        <body>
          <ST>
            stop := UINT_TO_INT(SHR(size,2)-1);
FOR i := 0 TO stop DO
        pos := RDM2(i+pos,0,stop);
        (* swap elements *)
        temp := pt^[i];
        pt^[i] := pt^[pos];
        pt^[pos] := temp;
END_FOR;

_ARRAY_SHUFFLE := TRUE;


(* revision History
hm 	4. mar 2008	rev 1.0
	original version

hm	16. mar. 2008	rev 1.1
	changed type of input size to uint

hm	30. mar. 2008	rev 1.2
	changed last in rdm2 fromm pos to i + pos to allow for more randomness

*)
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>be27e8c8-750a-4ba8-8875-340c040f35dd</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="_ARRAY_SORT" pouType="function">
        <interface>
          <returnType>
            <BOOL />
          </returnType>
          <inputVars>
            <variable name="PT">
              <type>
                <pointer>
                  <baseType>
                    <array>
                      <dimension lower="1" upper="32000" />
                      <baseType>
                        <REAL />
                      </baseType>
                    </array>
                  </baseType>
                </pointer>
              </type>
            </variable>
            <variable name="SIZE">
              <type>
                <UINT />
              </type>
            </variable>
          </inputVars>
          <localVars>
            <variable name="stack_count">
              <type>
                <UINT />
              </type>
              <documentation>
                 Laufvariable Stack
              </documentation>
            </variable>
            <variable name="stack">
              <type>
                <array>
                  <dimension lower="1" upper="32" />
                  <baseType>
                    <UINT />
                  </baseType>
                </array>
              </type>
              <documentation>
                 Stackgröße~ 1,6*Log(n)/log(2) 
              </documentation>
            </variable>
            <variable name="links">
              <type>
                <UINT />
              </type>
              <documentation>
                 Anfangselement des Arrays 
              </documentation>
            </variable>
            <variable name="rechts">
              <type>
                <UINT />
              </type>
              <documentation>
                 Endelement des Arrays 
              </documentation>
            </variable>
            <variable name="pivot">
              <type>
                <REAL />
              </type>
              <documentation>
                 temporärer Schwellwert für Tauschbedingung 
              </documentation>
            </variable>
            <variable name="i">
              <type>
                <UINT />
              </type>
              <documentation>
                 Laufvariable1 
              </documentation>
            </variable>
            <variable name="j">
              <type>
                <UINT />
              </type>
              <documentation>
                 Laufvariable2 
              </documentation>
            </variable>
            <variable name="ende_innen">
              <type>
                <BOOL />
              </type>
              <documentation>
                 Ende innere Schleife 
              </documentation>
            </variable>
            <variable name="ende_aussen">
              <type>
                <BOOL />
              </type>
              <documentation>
                 Ende äußere Schleife 
              </documentation>
            </variable>
            <variable name="tmp">
              <type>
                <REAL />
              </type>
              <documentation>
                 Hilfsvariable zum Tauschen von Werten 
              </documentation>
            </variable>
          </localVars>
        </interface>
        <body>
          <ST>
            (* Startwerte zur Arraygröße *)
links := 1;					(* Anfangselement des Arrays *)
rechts := SHR(size,2);		(* Endelement des Arrays *)
stack_count := 1;			(* Laufvariable Stack *)

WHILE NOT ende_aussen DO						(* äußere Schleife *)
	IF links &lt; rechts THEN
		pivot := PT^[SHR(rechts+links,1)];			(* Wert des mittleren Elements als Pivot-Wert *)
		i := links -1;
		j := rechts +1;

		(* innere Schleife, teile Feld *)
		ende_innen := FALSE;
		REPEAT

			(* steigende Reihenfolge *)
			REPEAT	i := i+1;	UNTIL (PT^[i] &gt;= pivot) OR NOT (i &lt; rechts)	END_REPEAT;
			REPEAT	j := j-1;	UNTIL (PT^[j] &lt;= pivot) OR NOT (j &gt; links)	END_REPEAT;


			(*sinkende Reihenfolge *)
(*			REPEAT	i := i+1;	UNTIL (PT^[i] &lt;= pivot) OR NOT (i &lt; rechts)	END_REPEAT	*)
(*			REPEAT	j := j-1;	UNTIL (PT^[j] &gt;= pivot) OR NOT (j &gt; links)	END_REPEAT	*)

			IF i &gt;= j THEN
				ende_innen := TRUE;
			ELSE
				   tmp := PT^[j];
				PT^[j] := PT^[i];
				PT^[i] := tmp;
			END_IF;

		UNTIL ende_innen END_REPEAT;

		(* Push stack *)
		stack[stack_count] := rechts;		(* rechten Teil später sortieren *)
		IF Stack_count &lt; 32 THEN
			stack_count := stack_count +1;
		ELSE
			ende_aussen := TRUE;
			_ARRAY_SORT := FALSE;					(* Fehler: Stack zu klein *)
		END_IF;

		(* linken Teil sortiern *)
		rechts := MAX(links, i-1);

	ELSE

		IF stack_count = 1 THEN
			ende_aussen := TRUE;
		ELSE

			links := rechts+1;

			(* pop stack *)
			stack_count := stack_count -1;		(* jetzt rechten Teil sortierne *)
			rechts:= stack[stack_count];
		END_IF;

	END_IF;

END_WHILE;

_ARRAY_SORT := TRUE;				(* Sortierung beendet *)


(* algorithm used before rev 2.0

size := SHR(size,2);
size2 := UINT_TO_INT(SHR(size,1));
FOR i := SIZE2  TO 1 BY -1 DO
	j:=i;
    WHILE j &lt;= SIZE2 DO
     	stop := j * 2 + 1;
        IF stop &gt; UINT_TO_INT(SIZE) THEN stop := stop - 1;
        ELSIF pt^[stop-1] &gt; pt^[stop] THEN stop := stop - 1;
		END_IF;
        IF pt^[j] &lt; pt^[stop] THEN
         	temp := pt^[j];
            pt^[j] := pt^[stop];
            pt^[stop] := temp;
        END_IF;
        j := stop;
    END_WHILE;
END_FOR;

*)

(* heapsort
FOR heapsize := UINT_TO_INT(size) TO 1 BY -1 DO
	popmax := pt^[1];
	pt^[1] := pt^[heapsize];
   	i := 1;
	hs2 := SHR(heapsize,1);
	WHILE i &lt;= hs2 DO
       	stop := i * 2 + 1;  
        	IF stop &gt; heapsize THEN stop := stop - 1;
        	ELSIF pt^[stop-1] &gt; pt^[stop] THEN stop := stop - 1;
	 	END_IF;
        	IF pt^[i] &lt; pt^[stop] THEN
            		temp := pt^[i];
            		pt^[i] := pt^[stop];
            		pt^[stop] := temp;
        	END_IF;
        	i := stop;
    	END_WHILE;
	pt^[heapsize] := popmax;
END_FOR;

_ARRAY_SORT2 := TRUE;
*)

(* old algorithm bubble sort used before rev 1.2
stop := (size - SIZEOF(pt)) / SIZEOF(pt);
FOR i := 0 TO stop - 1 DO
	FOR m := i + 1 TO stop DO
		IF pt^[i] &gt; pt^[m] THEN
			temp := pt^[i];
			pt^[i] := pt^[m];
			pt^[m] := temp;
		END_IF;
	END_FOR;
END_FOR;
_array_sort := TRUE;

*)


(* revision history

hm 	6.1.2007 	rev 1.1
	changed return value to true

hm	22. sep 2007	rev 1.2
	changed sorting algorithm to heap sort for performance reasons

hm 	14. nov 2007	rev 1.3
	changed calculation of stop to be more efficient

hm	15 dec 2007	rev 1.4
	added function return true

hm	5. jan 2008		rev 1.5
	improved performance

hm	16. mar. 2008	rev 1.6
	changed type of input size to uint

hm	28. mar. 2008	rev 1.7
	changed input f to pt

hm	19. jan. 2011	rev 2.0
	new faster algorithm using qucksort (Alexander Drikitis)

*)

          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>648ed47e-1b14-42a1-b410-f8cc6f98b272</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="ARRAY_AVG" pouType="function">
        <interface>
          <returnType>
            <REAL />
          </returnType>
          <inputVars>
            <variable name="pt">
              <type>
                <pointer>
                  <baseType>
                    <array>
                      <dimension lower="0" upper="32000" />
                      <baseType>
                        <REAL />
                      </baseType>
                    </array>
                  </baseType>
                </pointer>
              </type>
            </variable>
            <variable name="size">
              <type>
                <UINT />
              </type>
            </variable>
          </inputVars>
          <localVars>
            <variable name="i">
              <type>
                <UINT />
              </type>
            </variable>
            <variable name="stop">
              <type>
                <UINT />
              </type>
            </variable>
          </localVars>
        </interface>
        <body>
          <ST>
            stop := SHR(size,2)-1;
ARRAY_AVG := pt^[0];
FOR i := 1 TO stop DO
	ARRAY_AVG := ARRAY_AVG + pt^[i];
END_FOR;
ARRAY_AVG := ARRAY_AVG / UINT_TO_REAL(stop + 1);


(* revision history
hm	2. oct 2007		rev 1.0
	original version

hm	12. dec 2007	rev 1.1
	chaged code for better performance

hm	16. mar. 2008	rev 1.2
	changed input size to uint

hm	10. mar. 2009	rev 1.3
	added type conversion for compatibility reasons
*)
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>373104fd-7c16-470b-9305-6ea57ee1ef13</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="ARRAY_GAV" pouType="function">
        <interface>
          <returnType>
            <REAL />
          </returnType>
          <inputVars>
            <variable name="pt">
              <type>
                <pointer>
                  <baseType>
                    <array>
                      <dimension lower="0" upper="32000" />
                      <baseType>
                        <REAL />
                      </baseType>
                    </array>
                  </baseType>
                </pointer>
              </type>
            </variable>
            <variable name="size">
              <type>
                <UINT />
              </type>
            </variable>
          </inputVars>
          <localVars>
            <variable name="i">
              <type>
                <UINT />
              </type>
            </variable>
            <variable name="stop">
              <type>
                <UINT />
              </type>
            </variable>
          </localVars>
        </interface>
        <body>
          <ST>
            stop := SHR(size,2)-1;
ARRAY_GAV := 1.0;
FOR i := 0 TO stop DO
	IF pt^[i] &gt; 0.0 THEN
		ARRAY_GAV := ARRAY_GAV * pt^[i];
	ELSE
		ARRAY_GAV := 0.0;
		RETURN;
	END_IF;
END_FOR;
ARRAY_GAV := SQRTN(ARRAY_GAV,UINT_TO_INT(stop)+1);


(* revision history
hm	2. apr 2008	rev 1.0
	original version

hm	10. mar. 2009	rev 1.1
	real constants updated to new systax using dot

*)
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>cb9bc6a0-9cf3-4aa1-9712-0aa7ece9eec0</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="ARRAY_HAV" pouType="function">
        <interface>
          <returnType>
            <REAL />
          </returnType>
          <inputVars>
            <variable name="pt">
              <type>
                <pointer>
                  <baseType>
                    <array>
                      <dimension lower="0" upper="32000" />
                      <baseType>
                        <REAL />
                      </baseType>
                    </array>
                  </baseType>
                </pointer>
              </type>
            </variable>
            <variable name="size">
              <type>
                <UINT />
              </type>
            </variable>
          </inputVars>
          <localVars>
            <variable name="i">
              <type>
                <UINT />
              </type>
            </variable>
            <variable name="stop">
              <type>
                <UINT />
              </type>
            </variable>
          </localVars>
        </interface>
        <body>
          <ST>
            stop := SHR(size,2)-1;
FOR i := 0 TO stop DO
	IF pt^[i] &lt;&gt; 0.0 THEN
		ARRAY_HAV := ARRAY_HAV + 1.0 / pt^[i];
	ELSE
		ARRAY_HAV := 0.0;
		RETURN;
	END_IF;
END_FOR;
ARRAY_HAV := UINT_TO_REAL(stop + 1) / ARRAY_HAV;


(* revision history
hm	2. apr 2008	rev 1.0
	original version

hm	10. mar. 2009	rev 1.1
	real constants updated to new systax using dot

*)
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>60aae304-baef-4958-8ae1-ccad9a97e38d</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="ARRAY_MAX" pouType="function">
        <interface>
          <returnType>
            <REAL />
          </returnType>
          <inputVars>
            <variable name="pt">
              <type>
                <pointer>
                  <baseType>
                    <array>
                      <dimension lower="0" upper="32000" />
                      <baseType>
                        <REAL />
                      </baseType>
                    </array>
                  </baseType>
                </pointer>
              </type>
            </variable>
            <variable name="size">
              <type>
                <UINT />
              </type>
            </variable>
          </inputVars>
          <localVars>
            <variable name="i">
              <type>
                <UINT />
              </type>
            </variable>
            <variable name="stop">
              <type>
                <UINT />
              </type>
            </variable>
          </localVars>
        </interface>
        <body>
          <ST>
            stop := (size -SIZEOF(pt)) / SIZEOF(pt);
array_max := pt^[0];
FOR i := 1 TO stop DO
	IF pt^[i] &gt; array_max THEN array_max := pt^[i]; END_IF;
END_FOR;

(* revision history
hm	2. oct 2006		rev 1.0
	original version

hm	16. mar. 2008	rev 1.1
	changed input size to uint
*)
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>319f6d89-efe5-4592-b5f7-d36a33206b5f</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="ARRAY_MIN" pouType="function">
        <interface>
          <returnType>
            <REAL />
          </returnType>
          <inputVars>
            <variable name="pt">
              <type>
                <pointer>
                  <baseType>
                    <array>
                      <dimension lower="0" upper="32000" />
                      <baseType>
                        <REAL />
                      </baseType>
                    </array>
                  </baseType>
                </pointer>
              </type>
            </variable>
            <variable name="size">
              <type>
                <UINT />
              </type>
            </variable>
          </inputVars>
          <localVars>
            <variable name="i">
              <type>
                <UINT />
              </type>
            </variable>
            <variable name="stop">
              <type>
                <UINT />
              </type>
            </variable>
          </localVars>
        </interface>
        <body>
          <ST>
            stop := (size - SIZEOF(pt)) / SIZEOF(pt);
array_min := pt^[0];
FOR i := 1 TO stop DO
	IF pt^[i] &lt; array_min THEN array_min := pt^[i]; END_IF;
END_FOR;


(* revision history
hm		2. oct. 2006
	original version

hm		16. mar. 2008
	changed type of input size to uint

*)
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>3c2cc243-ebcf-40c2-a662-6d66aadf6d63</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="ARRAY_SDV" pouType="function">
        <interface>
          <returnType>
            <REAL />
          </returnType>
          <inputVars>
            <variable name="pt">
              <type>
                <pointer>
                  <baseType>
                    <array>
                      <dimension lower="0" upper="32000" />
                      <baseType>
                        <REAL />
                      </baseType>
                    </array>
                  </baseType>
                </pointer>
              </type>
            </variable>
            <variable name="size">
              <type>
                <UINT />
              </type>
            </variable>
          </inputVars>
        </interface>
        <body>
          <ST>
            (* standard deviation is simply the square root of the variance *)

array_sdv := SQRT(array_var(pt, size));

(* revision history
hm 	1.4.2007		rev 1.0
	function created

hm	16. mar. 2008	rev 1.1
	changed type of input size to uint

*)
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>79105c5d-22f7-46ae-a5e4-41eb805b5c73</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="ARRAY_SPR" pouType="function">
        <interface>
          <returnType>
            <REAL />
          </returnType>
          <inputVars>
            <variable name="pt">
              <type>
                <pointer>
                  <baseType>
                    <array>
                      <dimension lower="0" upper="32000" />
                      <baseType>
                        <REAL />
                      </baseType>
                    </array>
                  </baseType>
                </pointer>
              </type>
            </variable>
            <variable name="size">
              <type>
                <UINT />
              </type>
            </variable>
          </inputVars>
          <localVars>
            <variable name="i">
              <type>
                <UINT />
              </type>
            </variable>
            <variable name="stop">
              <type>
                <UINT />
              </type>
            </variable>
            <variable name="array_max">
              <type>
                <REAL />
              </type>
            </variable>
            <variable name="array_min">
              <type>
                <REAL />
              </type>
            </variable>
          </localVars>
        </interface>
        <body>
          <ST>
            stop := (size -SIZEOF(pt)) / SIZEOF(pt);
array_min := pt^[0];
array_max := pt^[0];
FOR i := 1 TO stop DO
	IF pt^[i] &gt; array_max THEN array_max := pt^[i];
	ELSIF pt^[i] &lt; array_min THEN array_min := pt^[i];
	END_IF;
END_FOR;
array_spr := array_max - array_min;


(* revision history
hm 	2. oct. 2006	rev 1.0
	original version

hm	16. mar. 2008	rev 1.1
	changed type of input size to uint

*)
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>073a098f-a7db-4d54-aa23-e9a555e38230</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="ARRAY_SUM" pouType="function">
        <interface>
          <returnType>
            <REAL />
          </returnType>
          <inputVars>
            <variable name="pt">
              <type>
                <pointer>
                  <baseType>
                    <array>
                      <dimension lower="0" upper="32000" />
                      <baseType>
                        <REAL />
                      </baseType>
                    </array>
                  </baseType>
                </pointer>
              </type>
            </variable>
            <variable name="size">
              <type>
                <UINT />
              </type>
            </variable>
          </inputVars>
          <localVars>
            <variable name="i">
              <type>
                <UINT />
              </type>
            </variable>
            <variable name="stop">
              <type>
                <UINT />
              </type>
            </variable>
          </localVars>
        </interface>
        <body>
          <ST>
            stop := (size -SIZEOF(pt)) / SIZEOF(pt);
array_sum := pt^[0];
FOR i := 1 TO stop DO
	array_sum := array_sum + pt^[i];
END_FOR;

(* revision history
hm 	2. oct. 2006	rev 1.0
	function created

hm	16. mar. 2008	rev 1.1
	changed type of input size to uint

*)
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>d897eb78-d564-45d5-ad83-4da47a248172</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="ARRAY_TREND" pouType="function">
        <interface>
          <returnType>
            <REAL />
          </returnType>
          <inputVars>
            <variable name="pt">
              <type>
                <pointer>
                  <baseType>
                    <array>
                      <dimension lower="0" upper="32000" />
                      <baseType>
                        <REAL />
                      </baseType>
                    </array>
                  </baseType>
                </pointer>
              </type>
            </variable>
            <variable name="size">
              <type>
                <UINT />
              </type>
            </variable>
          </inputVars>
          <localVars>
            <variable name="i">
              <type>
                <UINT />
              </type>
            </variable>
            <variable name="stop">
              <type>
                <UINT />
              </type>
            </variable>
            <variable name="x">
              <type>
                <REAL />
              </type>
            </variable>
            <variable name="stop2">
              <type>
                <UINT />
              </type>
            </variable>
          </localVars>
        </interface>
        <body>
          <ST>
            stop := SHR(size,2)-1;
stop2 := SHR(stop,1);
FOR i := 0 TO stop2 DO x := x - pt^[i]; END_FOR;
IF EVEN(UINT_TO_INT(stop)) THEN
	FOR i := stop2 TO stop DO X := X + pt^[i]; END_FOR;
ELSE
	FOR i := stop2 + 1 TO stop DO X := X + pt^[i]; END_FOR;
END_IF;
ARRAY_TREND := x / UINT_TO_REAL(stop2 + 1);

(* revision history
hm	2 oct 2007	rev 1.0
	original version

hm	12 dec 2007	rev 1.1
	changed code for better performance

hm	16. mar. 2008	rev 1.2
	changed type of input size to uint

hm	10. mar. 2009	rev 1.3
	added type conversions for compatibility reasons
*)
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>a922e6d4-2183-4da2-9ed2-e0c616050709</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="ARRAY_VAR" pouType="function">
        <interface>
          <returnType>
            <REAL />
          </returnType>
          <inputVars>
            <variable name="pt">
              <type>
                <pointer>
                  <baseType>
                    <array>
                      <dimension lower="0" upper="32000" />
                      <baseType>
                        <REAL />
                      </baseType>
                    </array>
                  </baseType>
                </pointer>
              </type>
            </variable>
            <variable name="size">
              <type>
                <UINT />
              </type>
            </variable>
          </inputVars>
          <localVars>
            <variable name="avg">
              <type>
                <REAL />
              </type>
            </variable>
            <variable name="i">
              <type>
                <UINT />
              </type>
            </variable>
            <variable name="stop">
              <type>
                <UINT />
              </type>
            </variable>
          </localVars>
        </interface>
        <body>
          <ST>
            (* at first we calualte the arithmetic average of the array *)

stop := SHR(size,2)-1;
avg := pt^[0];
FOR i := 1 TO stop DO
	avg := avg + pt^[i];
END_FOR;
avg := avg / UINT_TO_REAL(stop + 1);

(* in a second run we calculate the variance of the array *)

array_var := (pt^[0] - avg) * (pt^[0] - avg);
FOR i := 1 TO stop DO
	array_var := array_var + (pt^[i] - avg) * (pt^[i] - avg);
END_FOR;
ARRAY_VAR := ARRAY_VAR / UINT_TO_REAL(stop);

(* revision history
hm 	1.4.2007	rev 1.0
	function created

hm	12.12.2007	rev 1.1
	changed code for better performance

hm	16. mar. 2008	rev 1.2
	changed type of input size to uint

hm	10. mar. 2009	rev 1.3
	added type conversions for compatibility reasons
*)
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>0a2f9190-f067-467d-bf37-16af255c5b9e</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="IS_SORTED" pouType="function">
        <interface>
          <returnType>
            <BOOL />
          </returnType>
          <inputVars>
            <variable name="pt">
              <type>
                <pointer>
                  <baseType>
                    <array>
                      <dimension lower="0" upper="32000" />
                      <baseType>
                        <REAL />
                      </baseType>
                    </array>
                  </baseType>
                </pointer>
              </type>
            </variable>
            <variable name="size">
              <type>
                <UINT />
              </type>
            </variable>
          </inputVars>
          <localVars>
            <variable name="stop">
              <type>
                <INT />
              </type>
            </variable>
            <variable name="i">
              <type>
                <INT />
              </type>
            </variable>
          </localVars>
        </interface>
        <body>
          <ST>
            stop := UINT_TO_INT(SHR(size,2)-2);
FOR i := 0 TO stop DO
	IF pt^[i] &gt; pt^[i+1] THEN
		IS_SORTED := FALSE;
		RETURN;
	END_IF;
END_FOR;

IS_SORTED := TRUE;

(* revision history

hm 	29. mar. 2008 	rev 1.0
	original version

hm	4. apr. 2008	rev 1.1
	added type conversion to avoid warnings under codesys 3.0
*)

          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>dd0f57dd-1a6d-47bd-8fda-e6ac5878348d</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="ASINH" pouType="function">
        <interface>
          <returnType>
            <REAL />
          </returnType>
          <inputVars>
            <variable name="X">
              <type>
                <REAL />
              </type>
            </variable>
          </inputVars>
        </interface>
        <body>
          <ST>
            ASINH := LN(SQRT(X * X + 1.0)+X);

(* revision history
hm		12 jan 2007	rev 1.0
	original version

hm		2. dec 2007	rev 1.1
	changed code for better performance

hm		16.3. 2007		rev 1.2
	changed sequence of calculations to improve performance

hm	10. mar. 2009		rev 1.3
	real constants updated to new systax using dot

*)
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>3d5c2afd-a19a-4a2d-b699-471feb60f84f</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="ATAN2" pouType="function">
        <interface>
          <returnType>
            <REAL />
          </returnType>
          <inputVars>
            <variable name="Y">
              <type>
                <REAL />
              </type>
            </variable>
            <variable name="X">
              <type>
                <REAL />
              </type>
            </variable>
          </inputVars>
        </interface>
        <body>
          <ST>
            IF X &gt; 0.0 THEN
	ATAN2 := ATAN(Y/X);
ELSIF X &lt; 0.0 THEN
	IF Y &gt;=0.0 THEN
		ATAN2 := ATAN(Y/X) + MATH.PI;
	ELSE
		ATAN2 := ATAN(Y/X) - MATH.PI;
	END_IF;
ELSIF Y &gt; 0.0 THEN
	ATAN2 := MATH.PI05;
ELSIF Y &lt; 0.0 THEN
	ATAN2 := -MATH.PI05;
ELSE
	ATAN2 := 0.0;
END_IF;


(* revision history
hm	20.  apr. 2008	rev 1.0
	original version

hm	18. oct. 2008	rev 1.1
	changed to use math constants

hm	10. mar. 2009	rev 1.2
	real constants updated to new systax using dot

*)

          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>35cffaa8-ef92-4a69-8bf1-eb26ad278af9</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="ATANH" pouType="function">
        <interface>
          <returnType>
            <REAL />
          </returnType>
          <inputVars>
            <variable name="X">
              <type>
                <REAL />
              </type>
            </variable>
          </inputVars>
        </interface>
        <body>
          <ST>
            ATANH := LN((1.0 + x)/(1.0 - x)) * 0.5;


(* revision history
hm		12 jan 2007	rev 1.0
	original version

hm		5. jan 2008	rev 1.1
	improved code for better performance

hm	10. mar. 2009		rev 1.2
	real constants updated to new systax using dot

*)

          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>d3e5a763-1409-43c9-8628-2bfb9b220cc8</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="BETA" pouType="function">
        <interface>
          <returnType>
            <REAL />
          </returnType>
          <inputVars>
            <variable name="X">
              <type>
                <REAL />
              </type>
            </variable>
            <variable name="Y">
              <type>
                <REAL />
              </type>
            </variable>
          </inputVars>
        </interface>
        <body>
          <ST>
            BETA := GAMMA(X) * GAMMA(Y) / GAMMA(x + y);


(* revision history
hm	26. oct. 2008	rev 1.0
	original version

*)
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>d32428e1-51ee-41c5-b0a0-6ae4d01ffc44</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="BINOM" pouType="function">
        <interface>
          <returnType>
            <DINT />
          </returnType>
          <inputVars>
            <variable name="N">
              <type>
                <INT />
              </type>
            </variable>
            <variable name="K">
              <type>
                <INT />
              </type>
            </variable>
          </inputVars>
          <localVars>
            <variable name="i">
              <type>
                <INT />
              </type>
            </variable>
          </localVars>
        </interface>
        <body>
          <ST>
            IF 2 * K &gt; n THEN
	k := n - k;
END_IF;
IF k &gt; n THEN
	RETURN;
ELSIF k = 0 OR k = n THEN
	BINOM := 1;
ELSIF k = 1 THEN
	BINOM := n;
ELSE
	BINOM := n;
	n := n + 1;
	FOR i := 2 TO k DO
		BINOM := BINOM * (n - i) / i;
	END_FOR;
END_IF;



(*
binomialkoeffizient(n, k)
1  wenn k = 0 return 1
2  wenn 2k &gt; n
3      dann führe aus ergebnis \leftarrow binomialkoeffizient(n, n-k)
4  sonst führe aus ergebnis \leftarrow n
5          von i \leftarrow 2 bis k
6              führe aus ergebnis \leftarrow ergebnis \cdot (n + 1 - i)
7                        ergebnis \leftarrow ergebnis : i
8  return ergebnis
*)



(* revision history
hm	25. oct. 2008	rev 1.0
	original version


*)
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>f5cc746b-bda2-4cbb-84f8-e701c2d1d52f</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="CAUCHY" pouType="function">
        <interface>
          <returnType>
            <REAL />
          </returnType>
          <inputVars>
            <variable name="X">
              <type>
                <REAL />
              </type>
            </variable>
            <variable name="T">
              <type>
                <REAL />
              </type>
            </variable>
            <variable name="U">
              <type>
                <REAL />
              </type>
            </variable>
          </inputVars>
          <localVars>
            <variable name="tmp">
              <type>
                <REAL />
              </type>
            </variable>
          </localVars>
        </interface>
        <body>
          <ST>
            tmp := x - t;
CAUCHY := math.PI_INV * U / (U*U + tmp*tmp);



(* revision hisdtory
hm	26. oct. 2008	rev 1.0
	original version

*)
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>dd7f41a1-384a-43e4-837f-daa7c06c4d0a</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="CAUCHYCD" pouType="function">
        <interface>
          <returnType>
            <REAL />
          </returnType>
          <inputVars>
            <variable name="X">
              <type>
                <REAL />
              </type>
            </variable>
            <variable name="T">
              <type>
                <REAL />
              </type>
            </variable>
            <variable name="U">
              <type>
                <REAL />
              </type>
            </variable>
          </inputVars>
        </interface>
        <body>
          <ST>
            CAUCHYCD := 0.5 + math.PI_INV * ATAN((X - T) / U);



(* revision hisdtory
hm	26. oct. 2008	rev 1.0
	original version

*)
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>1d3936ca-bcd4-40b1-a5ae-f89e65dc0c4f</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="CEIL" pouType="function">
        <interface>
          <returnType>
            <INT />
          </returnType>
          <inputVars>
            <variable name="X">
              <type>
                <REAL />
              </type>
            </variable>
          </inputVars>
        </interface>
        <body>
          <ST>
            CEIL := REAL_TO_INT(x);
IF CEIL &lt; X THEN
	CEIL := CEIL + 1;
END_IF;


(* revision history
hm	7. feb. 2007	rev 1.0
	original version

hm	21. mar. 2008	rev 1.1
	use REAL_TO_INT instead of trunc for compatibility reasons

*)

          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>7759e0f0-b62c-485d-b257-382b7c84afe2</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="CEIL2" pouType="function">
        <interface>
          <returnType>
            <DINT />
          </returnType>
          <inputVars>
            <variable name="X">
              <type>
                <REAL />
              </type>
            </variable>
          </inputVars>
        </interface>
        <body>
          <ST>
            CEIL2 := REAL_TO_DINT(X);
IF DINT_TO_REAL(CEIL2) &lt; X THEN
	CEIL2 := CEIL2 + 1;
END_IF;


(* revision history
hm	21. mar. 2008	rev 1.0
	original version

hm	4. apr. 2008	rev 1.1
	added type conversion to avoid warnings under codesys 3.0

hm	30. jun. 2008	rev 1.2
	added type conversion to avoid warnings under codesys 3.0

hm	10. mar. 2009	rev 1.3
	use correct statement real_to_DINT

*)

          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>d3eae829-58f9-4994-905d-00ba2715dc8d</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="CMP" pouType="function">
        <interface>
          <returnType>
            <BOOL />
          </returnType>
          <inputVars>
            <variable name="X">
              <type>
                <REAL />
              </type>
            </variable>
            <variable name="Y">
              <type>
                <REAL />
              </type>
            </variable>
            <variable name="N">
              <type>
                <INT />
              </type>
            </variable>
          </inputVars>
          <localVars>
            <variable name="tmp">
              <type>
                <REAL />
              </type>
            </variable>
          </localVars>
        </interface>
        <body>
          <ST>
            tmp := ABS(x);
IF tmp &gt; 0.0 THEN
	tmp := EXP10(INT_TO_REAL(FLOOR(LOG(tmp))-N+1));
ELSE
	tmp := EXP10(tmp);
END_IF;
CMP := ABS(X - Y) &lt; tmp;


(* revision history
hm	12. mar. 2008	rev 1.0
	original version

hm	10. mar. 2009	rev 1.1
	added type conversion for compatibility reasons
*)


          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>d61c8ec4-f5ea-446d-801c-c12341560fd8</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="CABS" pouType="function">
        <interface>
          <returnType>
            <REAL />
          </returnType>
          <inputVars>
            <variable name="X">
              <type>
                <derived name="complex" />
              </type>
            </variable>
          </inputVars>
        </interface>
        <body>
          <ST>
            CABS := HYPOT(x.re, x.im);


(* revision history
hm	21. feb 2008	rev 1.0
	original version

*)
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>b31e9563-f28b-4894-b72e-22a4c3e71335</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="CACOS" pouType="function">
        <interface>
          <returnType>
            <derived name="complex" />
          </returnType>
          <inputVars>
            <variable name="X">
              <type>
                <derived name="complex" />
              </type>
            </variable>
          </inputVars>
          <localVars>
            <variable name="Y">
              <type>
                <derived name="complex" />
              </type>
            </variable>
          </localVars>
        </interface>
        <body>
          <ST>
            y := CACOSH(x);
CACOS.re := y.im;
CACOS.im := -y.re;



(* revision history
hm	21. feb 2008	rev 1.0
	original version


*)
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>917e5765-97cb-41a9-bd94-177c7ddc8aab</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="CACOSH" pouType="function">
        <interface>
          <returnType>
            <derived name="complex" />
          </returnType>
          <inputVars>
            <variable name="X">
              <type>
                <derived name="complex" />
              </type>
            </variable>
          </inputVars>
          <localVars>
            <variable name="Y">
              <type>
                <derived name="complex" />
              </type>
            </variable>
          </localVars>
        </interface>
        <body>
          <ST>
            y.re := (X.re - X.im)*(X.re + X.im) - 1.0;
y.im := 2.0 * X.re * X.im;
y    := CSQRT(y);
y.re := y.re + x.re;
y.im := y.im + x.im;
CACOSH  := CLOG(y);



(* revision history
hm	21. feb 2008	rev 1.0
	original version


*)
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>8dead1d7-55f2-4782-85b7-ad560e2f4edb</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="CADD" pouType="function">
        <interface>
          <returnType>
            <derived name="complex" />
          </returnType>
          <inputVars>
            <variable name="X">
              <type>
                <derived name="complex" />
              </type>
            </variable>
            <variable name="Y">
              <type>
                <derived name="complex" />
              </type>
            </variable>
          </inputVars>
        </interface>
        <body>
          <ST>
            CADD.re := x.re + y.re;
CADD.im := x.im + y.im;


(* revision history
hm	21. feb 2008	rev 1.0
	original version

*)
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>7dfa23b5-a60f-40ef-b045-1a7f70966afd</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="CARG" pouType="function">
        <interface>
          <returnType>
            <REAL />
          </returnType>
          <inputVars>
            <variable name="X">
              <type>
                <derived name="complex" />
              </type>
            </variable>
          </inputVars>
        </interface>
        <body>
          <ST>
            CARG := ATAN2(X.im, X.re);



(* revision history
hm	21. feb. 2008	rev 1.0
	original version

hm	20. apr. 2008	rev 1.1
	use ATAN2 instead of ATAN
*)
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>f08f6955-9cb8-4e77-84fe-4a8958e19cad</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="CASIN" pouType="function">
        <interface>
          <returnType>
            <derived name="complex" />
          </returnType>
          <inputVars>
            <variable name="X">
              <type>
                <derived name="complex" />
              </type>
            </variable>
          </inputVars>
          <localVars>
            <variable name="Y">
              <type>
                <derived name="complex" />
              </type>
            </variable>
          </localVars>
        </interface>
        <body>
          <ST>
            y.re := -x.im;
y.im := x.re;
y := CASINH(y);
CASIN.re := y.im;
CASIN.im := -y.re;



(* revision history
hm	21. feb 2008	rev 1.0
	original version


*)
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>249ee6d2-2d45-4f79-b1d4-d292154cdbde</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="CASINH" pouType="function">
        <interface>
          <returnType>
            <derived name="complex" />
          </returnType>
          <inputVars>
            <variable name="X">
              <type>
                <derived name="complex" />
              </type>
            </variable>
          </inputVars>
          <localVars>
            <variable name="Y">
              <type>
                <derived name="complex" />
              </type>
            </variable>
          </localVars>
        </interface>
        <body>
          <ST>
            y.re := (X.re - X.im)*(X.re + X.im) + 1.0;
y.im := 2.0 * X.re * X.im;
y    := CSQRT(y);
y.re := y.re + x.re;
y.im := y.im + x.im;
CASINH  := CLOG(y);



(* revision history
hm	21. feb 2008	rev 1.0
	original version


*)
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>37a0c9c4-dc06-4f74-97b5-f88ec088828c</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="CATAN" pouType="function">
        <interface>
          <returnType>
            <derived name="complex" />
          </returnType>
          <inputVars>
            <variable name="X">
              <type>
                <derived name="complex" />
              </type>
            </variable>
          </inputVars>
          <localVars>
            <variable name="r2">
              <type>
                <REAL />
              </type>
            </variable>
            <variable name="num">
              <type>
                <REAL />
              </type>
            </variable>
            <variable name="den">
              <type>
                <REAL />
              </type>
            </variable>
          </localVars>
        </interface>
        <body>
          <ST>
            r2 := x.re * x.re;
den := 1.0 - r2 - x.im * x.im;
CATAN.re := 0.5 * ATAN(2.0 * x.re / den);
num := x.im + 1.0;
num := r2 + num * num;
den := x.im - 1.0;
den := r2 + den * den;
CATAN.im := 0.25 * (LN(num)-LN(den));

(* revision history
hm	21. feb 2008	rev 1.0
	original version


*)
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>f020c47e-8d99-4695-ba10-366244063e12</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="CATANH" pouType="function">
        <interface>
          <returnType>
            <derived name="complex" />
          </returnType>
          <inputVars>
            <variable name="X">
              <type>
                <derived name="complex" />
              </type>
            </variable>
          </inputVars>
          <localVars>
            <variable name="i2">
              <type>
                <REAL />
              </type>
            </variable>
            <variable name="num">
              <type>
                <REAL />
              </type>
            </variable>
            <variable name="den">
              <type>
                <REAL />
              </type>
            </variable>
          </localVars>
        </interface>
        <body>
          <ST>
            i2 := x.im * x.im;
num := 1.0 + x.re;
num := i2 + num * num;
den := 1.0 - x.re;
den := i2 + den * den;
CATANH.re := 0.25 * (LN(num) - LN(den));
den := 1 - x.re * x.re - i2;
CATANH.im := 0.5 * ATAN(2.0 * x.im / den);

(* revision history
hm	21. feb 2008	rev 1.0
	original version


*)
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>fd428c10-d6da-494b-a01d-4aef5c4fe65a</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="CCON" pouType="function">
        <interface>
          <returnType>
            <derived name="complex" />
          </returnType>
          <inputVars>
            <variable name="X">
              <type>
                <derived name="complex" />
              </type>
            </variable>
          </inputVars>
        </interface>
        <body>
          <ST>
            CCON.re := x.re;
CCON.im := -x.im;


(* revision history
hm	21. feb 2008	rev 1.0
	original version

*)
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>d9a0ffa7-46fe-4b04-b84a-e901cb93ccbf</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="CCOS" pouType="function">
        <interface>
          <returnType>
            <derived name="complex" />
          </returnType>
          <inputVars>
            <variable name="X">
              <type>
                <derived name="complex" />
              </type>
            </variable>
          </inputVars>
        </interface>
        <body>
          <ST>
            CCOS := CCOSH(CSET(-X.im, X.re));


(* revision history
hm	21. feb 2008	rev 1.0
	original version

*)
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>1e8364ae-45ea-40e0-a13d-01cd9a2dd85d</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="CCOSH" pouType="function">
        <interface>
          <returnType>
            <derived name="complex" />
          </returnType>
          <inputVars>
            <variable name="X">
              <type>
                <derived name="complex" />
              </type>
            </variable>
          </inputVars>
        </interface>
        <body>
          <ST>
            CCOSH.re := cosH(x.re) * COS(x.im);
CCOSH.im := sinH(x.re) * SIN(x.im);


(* revision history
hm	21. feb 2008	rev 1.0
	original version

*)
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>6dbaa28c-d23c-4762-b397-403f19dabbfa</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="CDIV" pouType="function">
        <interface>
          <returnType>
            <derived name="complex" />
          </returnType>
          <inputVars>
            <variable name="X">
              <type>
                <derived name="complex" />
              </type>
            </variable>
            <variable name="Y">
              <type>
                <derived name="complex" />
              </type>
            </variable>
          </inputVars>
          <localVars>
            <variable name="Temp">
              <type>
                <REAL />
              </type>
            </variable>
          </localVars>
        </interface>
        <body>
          <ST>
            temp := Y.re * Y.re + Y.im * Y.im;
CDIV.re := (X.re * Y.re + X.im * Y.im) / temp;
CDIV.im := (X.im * Y.re - X.re * Y.im) / temp;

(* revision history
hm	21. feb 2008	rev 1.0
	original version

*)
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>b2a8ae67-6d1d-4a54-80c4-647aeecdee04</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="CEXP" pouType="function">
        <interface>
          <returnType>
            <derived name="complex" />
          </returnType>
          <inputVars>
            <variable name="X">
              <type>
                <derived name="complex" />
              </type>
            </variable>
          </inputVars>
          <localVars>
            <variable name="Temp">
              <type>
                <REAL />
              </type>
            </variable>
          </localVars>
        </interface>
        <body>
          <ST>
            temp := EXP(X.re);
CEXP.re := temp * COS(X.im);
CEXP.im := temp * SIN(X.im);


(* revision history
hm	21. feb 2008	rev 1.0
	original version

*)
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>2fe9eff1-bdda-40fb-a5dd-bbc15b992f7c</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="CINV" pouType="function">
        <interface>
          <returnType>
            <derived name="complex" />
          </returnType>
          <inputVars>
            <variable name="X">
              <type>
                <derived name="complex" />
              </type>
            </variable>
          </inputVars>
          <localVars>
            <variable name="temp">
              <type>
                <REAL />
              </type>
            </variable>
          </localVars>
        </interface>
        <body>
          <ST>
            temp := X.re * X.re + X.im * X.im;
CINV.re := X.re / temp;
CINV.im := -X.im / temp;

(* revision history
hm	21. feb 2008	rev 1.0
	original version

*)
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>56c91b72-db16-4692-a51a-5df9a2784081</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="CLOG" pouType="function">
        <interface>
          <returnType>
            <derived name="complex" />
          </returnType>
          <inputVars>
            <variable name="X">
              <type>
                <derived name="complex" />
              </type>
            </variable>
          </inputVars>
        </interface>
        <body>
          <ST>
            CLOG.re := LN(HYPOT(X.re, X.im));
CLOG.im := ATAN2(X.im, X.re);


(* revision history
hm	21. feb 2008	rev 1.0
	original version

hm	20. apr. 2008	rev 1.1
	use ATAN2 instead of ATAN
*)
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>8166e23e-600d-40d0-9997-28d8f06e4bab</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="CMUL" pouType="function">
        <interface>
          <returnType>
            <derived name="complex" />
          </returnType>
          <inputVars>
            <variable name="X">
              <type>
                <derived name="complex" />
              </type>
            </variable>
            <variable name="Y">
              <type>
                <derived name="complex" />
              </type>
            </variable>
          </inputVars>
        </interface>
        <body>
          <ST>
            CMUL.re := X.re * Y.re - X.im * Y.im;
CMUL.im := X.re * Y.im + X.im * Y.re;

(* revision history
hm	21. feb 2008	rev 1.0
	original version

*)
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>0f672417-962a-4932-91f0-24f9b1c3ba6e</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="CPOL" pouType="function">
        <interface>
          <returnType>
            <derived name="complex" />
          </returnType>
          <inputVars>
            <variable name="L">
              <type>
                <REAL />
              </type>
            </variable>
            <variable name="A">
              <type>
                <REAL />
              </type>
            </variable>
          </inputVars>
        </interface>
        <body>
          <ST>
            CPOL.re := L * COS(A);
CPOL.im := L * SIN(A);


(* revision history
hm	21. feb 2008	rev 1.0
	original version

*)
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>1456b180-0d7b-492e-a28d-259b9fbb5793</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="CPOW" pouType="function">
        <interface>
          <returnType>
            <derived name="complex" />
          </returnType>
          <inputVars>
            <variable name="X">
              <type>
                <derived name="complex" />
              </type>
            </variable>
            <variable name="Y">
              <type>
                <derived name="Complex" />
              </type>
            </variable>
          </inputVars>
        </interface>
        <body>
          <ST>
            CPOW := CEXP(CMUL(Y,CLOG(X)));


(* revision history
hm	21. feb 2008	rev 1.0
	original version

*)
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>6ed8e266-32e3-4a9a-8ecf-44802e3524d2</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="CSET" pouType="function">
        <interface>
          <returnType>
            <derived name="complex" />
          </returnType>
          <inputVars>
            <variable name="RE">
              <type>
                <REAL />
              </type>
            </variable>
            <variable name="IM">
              <type>
                <REAL />
              </type>
            </variable>
          </inputVars>
        </interface>
        <body>
          <ST>
            CSET.re := RE;
CSET.im := IM;

(* revision history
hm	21. feb 2008	rev 1.0
	original version

*)
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>78ec86f4-7b41-4f88-a11e-2ea027035bfa</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="CSIN" pouType="function">
        <interface>
          <returnType>
            <derived name="complex" />
          </returnType>
          <inputVars>
            <variable name="X">
              <type>
                <derived name="complex" />
              </type>
            </variable>
          </inputVars>
        </interface>
        <body>
          <ST>
            CSIN.re := cosH(X.im) * SIN(X.re);
CSIN.im := sinH(X.im) * COS(X.re);


(* revision history
hm	21. feb 2008	rev 1.0
	original version

*)
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>bcb11246-a6f0-4cd1-b57e-044de200cf33</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="CSINH" pouType="function">
        <interface>
          <returnType>
            <derived name="complex" />
          </returnType>
          <inputVars>
            <variable name="X">
              <type>
                <derived name="complex" />
              </type>
            </variable>
          </inputVars>
        </interface>
        <body>
          <ST>
            CSINH.re := sinH(X.re) * COS(X.im);
CSINH.im := cosH(X.re) * SIN(X.im);


(* revision history
hm	21. feb 2008	rev 1.0
	original version

*)
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>e721f697-ed94-464e-91a7-8df76ad5e8e5</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="CSQRT" pouType="function">
        <interface>
          <returnType>
            <derived name="complex" />
          </returnType>
          <inputVars>
            <variable name="X">
              <type>
                <derived name="complex" />
              </type>
            </variable>
          </inputVars>
          <localVars>
            <variable name="temp">
              <type>
                <REAL />
              </type>
            </variable>
          </localVars>
        </interface>
        <body>
          <ST>
            temp := HYPOT(x.re, x.im);
CSQRT.re :=  SQRT(0.5 * (temp + x.re));
CSQRT.im :=  sgn(x.im) * SQRT(0.5 * (temp - x.re));


(* revision history
hm	21. feb 2008	rev 1.0
	original version

*)
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>5a8f8f71-2fab-4e8f-941b-77f288a01576</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="CSUB" pouType="function">
        <interface>
          <returnType>
            <derived name="complex" />
          </returnType>
          <inputVars>
            <variable name="X">
              <type>
                <derived name="complex" />
              </type>
            </variable>
            <variable name="Y">
              <type>
                <derived name="complex" />
              </type>
            </variable>
          </inputVars>
        </interface>
        <body>
          <ST>
            CSUB.re := X.re - Y.re;
CSUB.im := X.im - Y.im;

(* revision history
hm	21. feb 2008	rev 1.0
	original version

*)
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>f71dc516-02ec-4375-8f40-8a35856f93ba</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="CTAN" pouType="function">
        <interface>
          <returnType>
            <derived name="complex" />
          </returnType>
          <inputVars>
            <variable name="X">
              <type>
                <derived name="complex" />
              </type>
            </variable>
          </inputVars>
          <localVars>
            <variable name="temp">
              <type>
                <REAL />
              </type>
            </variable>
            <variable name="xi2">
              <type>
                <REAL />
              </type>
            </variable>
            <variable name="xr2">
              <type>
                <REAL />
              </type>
            </variable>
          </localVars>
        </interface>
        <body>
          <ST>
            xi2 := 2.0 * x.im;
xr2 := 2.0 * x.re;
temp := 1.0 / (COS(xr2) + COSH( xi2));
CTAN.re := temp * SIN(xr2);
CTAN.im := temp * SINH(xi2);


(* revision history
hm	21. feb 2008	rev 1.0
	original version

hm	10. mar 2009	rev 1.1
	faster code
*)
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>4d63b823-85de-4c3b-8cba-7d15fce1a2ff</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="CTANH" pouType="function">
        <interface>
          <returnType>
            <derived name="complex" />
          </returnType>
          <inputVars>
            <variable name="X">
              <type>
                <derived name="complex" />
              </type>
            </variable>
          </inputVars>
          <localVars>
            <variable name="temp">
              <type>
                <REAL />
              </type>
            </variable>
            <variable name="xi2">
              <type>
                <REAL />
              </type>
            </variable>
            <variable name="xr2">
              <type>
                <REAL />
              </type>
            </variable>
          </localVars>
        </interface>
        <body>
          <ST>
            xi2 := 2.0 * x.im;
xr2 := 2.0 * x.re;
temp := 1.0 / (COSH(xr2) + COS(xi2));
CTANH.re := temp * SINH(xr2);
CTANH.im := temp * SIN(xi2);


(* revision history
hm	21. feb 2008	rev 1.0
	original version

hm	10. mar. 2009	rev 1.1	
	new faster code

*)
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>9a271f13-b1c3-4059-b2da-9a83dffe53ce</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="COSH" pouType="function">
        <interface>
          <returnType>
            <REAL />
          </returnType>
          <inputVars>
            <variable name="X">
              <type>
                <REAL />
              </type>
            </variable>
          </inputVars>
          <localVars>
            <variable name="t">
              <type>
                <REAL />
              </type>
            </variable>
          </localVars>
        </interface>
        <body>
          <ST>
            T := EXP(X);
COSH := (1.0 / T + T) * 0.5;

(* revision histroy
hm	12.1.2007	rev 1.0
	original version

hm	1.12.2007	rev 1.1
	changed code to improve performance

hm	5. jan 2008	rev 1.2
	further performance improvement

hm	10. mar. 2009	rev 1.3
	real constants updated to new systax using dot
*)
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>21239db1-9705-4c54-ba48-34ef5fa7bd8d</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="COTH" pouType="function">
        <interface>
          <returnType>
            <REAL />
          </returnType>
          <inputVars>
            <variable name="X">
              <type>
                <REAL />
              </type>
            </variable>
          </inputVars>
        </interface>
        <body>
          <ST>
            IF X &gt; 20.0 THEN
	COTH :=1.0;
ELSIF X &lt; -20.0 THEN
	COTH := -1.0;
ELSE
	COTH := 1.0 + 2.0 / (EXP(X * 2.0) - 1.0);
END_IF;


(* revision histroy
hm		12.1.2007	rev 1.0
	original version

hm	1.12.2007		rev 1.1
	changed code to improve performance

hm	8. jan 2008	rev 1.2
	further improvement in performance

hm	10. mar 2008	rev 1.3
	extended range of valid inputs to +/- INV
	changed formula for better accuracy

hm	10. mar. 2009	rev 1.4
	real constants updated to new systax using dot
*)
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>d489b777-ebc0-438e-850e-99622070bbfe</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="D_TRUNC" pouType="function">
        <interface>
          <returnType>
            <DINT />
          </returnType>
          <inputVars>
            <variable name="X">
              <type>
                <REAL />
              </type>
            </variable>
          </inputVars>
        </interface>
        <body>
          <ST>
            D_TRUNC := REAL_TO_DINT(X);
IF X &gt; 0.0 THEN
	IF DINT_TO_REAL(D_TRUNC) &gt; X THEN D_TRUNC := D_TRUNC - 1; END_IF;
ELSE
	IF DINT_TO_REAL(D_TRUNC) &lt; X THEN D_TRUNC := D_TRUNC + 1; END_IF;
END_IF;


(* for systems that support a dint truncation this routine can be replaced by trunc() *)


(* revision history
hm	21. mar. 2008	rev 1.0
	original version

hm	31. oct. 2008	rev 1.1
	optimized performance

hm	10. mar. 2009	rev 1.2
	real constants updated to new systax using dot
*)
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>dbe71bd1-e18b-4229-8ddb-05c493b3da7b</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="DEC1" pouType="function">
        <interface>
          <returnType>
            <INT />
          </returnType>
          <inputVars>
            <variable name="X">
              <type>
                <INT />
              </type>
            </variable>
            <variable name="N">
              <type>
                <INT />
              </type>
            </variable>
          </inputVars>
        </interface>
        <body>
          <ST>
            IF X = 0 THEN
	DEC1 := N - 1;
ELSE
	DEC1 := X - 1;
END_IF;


(* this is a very elegant version but 50% slower
X := (X - 1 + N) MOD N;
*)


(* revision history
hm	13. oct. 2008	rev 1.0
	original version

hm	27. oct. 2008	rev 1.1
	added statement to return value for compatibility reasons

*)
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>ee9a9817-2f66-4193-ae88-5e242650ce79</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="DEG" pouType="function">
        <interface>
          <returnType>
            <REAL />
          </returnType>
          <inputVars>
            <variable name="rad">
              <type>
                <REAL />
              </type>
            </variable>
          </inputVars>
        </interface>
        <body>
          <ST>
            DEG := MODR(57.29577951308232 * RAD, 360.0);

(* revision history
hm	4. aug 2006	rev 1.0
	original version

hm 16. oct 2007	rev 1.1
	added modr statement which prohibits deg to become bigger than 360

hm	10. mar. 2009	rev 1.2
	real constants updated to new systax using dot
*)
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>21bb841a-b2a4-4137-ac4c-90b07ecaf2fb</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="DIFFER" pouType="function">
        <interface>
          <returnType>
            <BOOL />
          </returnType>
          <inputVars>
            <variable name="in1">
              <type>
                <REAL />
              </type>
            </variable>
            <variable name="in2">
              <type>
                <REAL />
              </type>
            </variable>
            <variable name="X">
              <type>
                <REAL />
              </type>
            </variable>
          </inputVars>
        </interface>
        <body>
          <ST>
            DIFFER := ABS(in1 - in2) &gt; X;

(* revision history
hm		8. oct 2006		rev 1.0
	original version

hm		16. mar 2008	rev 1.1
	improverd code for performance

*)
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>81e5a80c-9dd1-4800-84a3-eaa39f4268e9</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="R2_ABS" pouType="function">
        <interface>
          <returnType>
            <derived name="REAL2" />
          </returnType>
          <inputVars>
            <variable name="X">
              <type>
                <derived name="REAL2" />
              </type>
            </variable>
          </inputVars>
        </interface>
        <body>
          <ST>
            IF X.RX &gt;= 0.0 THEN
	R2_ABS.RX := X.RX;
	R2_ABS.R1 := X.R1;
ELSE
	R2_ABS.RX := -X.RX;
	R2_ABS.R1 := -X.R1;
END_IF;


(* revision history
hm	21. mar. 2008	rev 1.0
	original version

hm	10. mar. 2009 rev 1.1
	real constants updated to new systax using dot

*)
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>4c7ed903-ea4c-4434-b749-d4dc9055e140</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="R2_ADD" pouType="function">
        <interface>
          <returnType>
            <derived name="REAL2" />
          </returnType>
          <inputVars>
            <variable name="X">
              <type>
                <derived name="Real2" />
              </type>
            </variable>
            <variable name="Y">
              <type>
                <REAL />
              </type>
            </variable>
          </inputVars>
          <localVars>
            <variable name="temp">
              <type>
                <REAL />
              </type>
            </variable>
          </localVars>
        </interface>
        <body>
          <ST>
            temp := X.RX;
R2_ADD.RX := Y + X.R1 + X.RX;
R2_ADD.R1 := temp - R2_ADD.RX + Y + X.R1;


(* revision history
hm		20.3.2008	rev 1.0
	original version

*)
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>be796bea-4e6b-4cec-bf44-dc1c17638033</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="R2_ADD2" pouType="function">
        <interface>
          <returnType>
            <derived name="REAL2" />
          </returnType>
          <inputVars>
            <variable name="X">
              <type>
                <derived name="Real2" />
              </type>
            </variable>
            <variable name="Y">
              <type>
                <derived name="REAL2" />
              </type>
            </variable>
          </inputVars>
        </interface>
        <body>
          <ST>
            R2_ADD2.R1 := X.R1 + Y.R1;
R2_ADD2.RX := X.RX + Y.RX;


(* revision history
hm		20.3.2008	rev 1.0
	original version

*)
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>9b7d01c6-df84-4987-8325-993f0430a043</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="R2_MUL" pouType="function">
        <interface>
          <returnType>
            <derived name="REAL2" />
          </returnType>
          <inputVars>
            <variable name="X">
              <type>
                <derived name="REAL2" />
              </type>
            </variable>
            <variable name="Y">
              <type>
                <REAL />
              </type>
            </variable>
          </inputVars>
        </interface>
        <body>
          <ST>
            R2_MUL.RX := X.RX * Y;
R2_MUL.R1 := X.R1 * Y;


(* revision history
hm		20.3.2008	rev 1.0
	original version

*)
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>d25aace8-e933-4069-b9d3-4dd0f2aa6a74</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="R2_SET" pouType="function">
        <interface>
          <returnType>
            <derived name="REAL2" />
          </returnType>
          <inputVars>
            <variable name="X">
              <type>
                <REAL />
              </type>
            </variable>
          </inputVars>
        </interface>
        <body>
          <ST>
            R2_SET.RX := X;
R2_SET.R1 := 0.0;


(* revision history
hm	2. jun. 2008	rev 1.0
	original version

hm	10. mar. 2009	rev 1.1
	real constants updated to new systax using dot

*)
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>2975cf35-aadf-4444-a398-9f2b1795ce4a</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="ERF" pouType="function">
        <interface>
          <returnType>
            <REAL />
          </returnType>
          <inputVars>
            <variable name="X">
              <type>
                <REAL />
              </type>
            </variable>
          </inputVars>
          <localVars>
            <variable name="x2">
              <type>
                <REAL />
              </type>
            </variable>
            <variable name="ax2">
              <type>
                <REAL />
              </type>
            </variable>
          </localVars>
        </interface>
        <body>
          <ST>
            x2 := X*X;
ax2 := 0.147 * x2 + 1.0;
ERF := SQRT(1.0 - EXP(-X2 * ((0.27323954473516 + aX2)/(ax2)))) * SGN(x);




(* revision history
hm	7. apr. 2008	rev 1.0
	original version

hm	30. jun. 2008	rev 1.1
	added type conversions to avoid warnings under codesys 3.0

hm	25. oct. 2008	rev 1.2
	new code using new algorithm

hm	10. mar. 2009	rev 1.3
	real constants updated to new systax using dot
*)
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>33a9a7dd-ee5a-4df8-8e7d-5167dace27ff</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="ERFC" pouType="function">
        <interface>
          <returnType>
            <REAL />
          </returnType>
          <inputVars>
            <variable name="X">
              <type>
                <REAL />
              </type>
            </variable>
          </inputVars>
        </interface>
        <body>
          <ST>
            ERFC := 1.0 - ERF(X);

(* revision history
hm	7. apr. 2008	rev 1.0
	original version

hm	10. mar. 2009	rev 1.1
	real constants updated to new systax using dot

*)
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>e3350d8d-6d2e-4762-9431-2c3fad5d41f7</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="EVEN" pouType="function">
        <interface>
          <returnType>
            <BOOL />
          </returnType>
          <inputVars>
            <variable name="in">
              <type>
                <DINT />
              </type>
            </variable>
          </inputVars>
        </interface>
        <body>
          <ST>
            EVEN := NOT in.0;

(* revision history
hm	1. oct 2006	rev 1.0
	ORIGINAL VERSION

hm	01.12.2007	rev 1.1
	changed code for improved performance

hm	21. mar. 2008	rev 1.2
	changed type of input IN from INT to DINT
*)
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>5cf3365d-8c20-4145-8328-ec9569fb615a</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="EXP10" pouType="function">
        <interface>
          <returnType>
            <REAL />
          </returnType>
          <inputVars>
            <variable name="X">
              <type>
                <REAL />
              </type>
            </variable>
          </inputVars>
        </interface>
        <body>
          <ST>
            EXP10 := EXP(X * 2.30258509299405);

(* revision history
hm	2. dec 2007		rev 1.0
	original version

*)
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>9c3019a5-2018-476f-a039-e5ec20169601</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="EXPN" pouType="function">
        <interface>
          <returnType>
            <REAL />
          </returnType>
          <inputVars>
            <variable name="X">
              <type>
                <REAL />
              </type>
            </variable>
            <variable name="N">
              <type>
                <INT />
              </type>
            </variable>
          </inputVars>
          <localVars>
            <variable name="sign">
              <type>
                <BOOL />
              </type>
            </variable>
          </localVars>
        </interface>
        <body>
          <ST>
            sign := n.15;
N := ABS(N);
IF N.0 THEN EXPN := X; ELSE EXPN := 1.0; END_IF;
N := SHR(N,1);
WHILE N &gt; 0 DO
   X := X * X;
   IF N.0 THEN EXPN := EXPN * X; END_IF;
   N := SHR(N,1);
END_WHILE;
IF sign THEN EXPN := 1.0 / EXPN; END_IF;



(* revision history
hm	4. dec 2007	rev 1.0
	original version

hm	22. oct. 2008	rev 1.1
	optimized code

hm	10. mar. 2009	rev 1.2
	removed nested comments
	real constants updated to new systax using dot

*)
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>8e27063a-a2c1-4ad8-b3f5-5178f0bbbb10</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="FACT" pouType="function">
        <interface>
          <returnType>
            <DINT />
          </returnType>
          <inputVars>
            <variable name="X">
              <type>
                <INT />
              </type>
            </variable>
          </inputVars>
        </interface>
        <body>
          <ST>
            IF X &gt;= 0 AND X &lt;= 12 THEN
	FACT := math.FACTS[X];
ELSE
	FACT := -1;
END_IF;


(* working code without array
IF X &gt; 12 OR X &lt; 0 THEN
	FACT := -1;
ELSIF X &lt; 7 THEN
	FACT := 1;
	FOR i := 2 TO X DO
		FACT := FACT * i;
	END_FOR;
ELSE
	FACT := 5040;
	FOR i := 8 TO X DO
		FACT := FACT * i;
	END_FOR;
END_IF;
*)

(* revision history
hm 4.3.2007		rev 1.1
	changed a critical error where while loop was indefinite.

hm	10.12.2007	rev 1.2
	start value for i has changed to 2 for better performance

hm	10. mar 2008	rev 1.3
	changed output of fact to dint to allow bigger values

hm	27. oct. 2008	rev 1.4
	optimized code

hm	26. mar. 2011	rev 1.5
	using array math.facts
*)
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>21462f2b-8b45-438f-87bf-11129ea3474d</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="FIB" pouType="function">
        <interface>
          <returnType>
            <DINT />
          </returnType>
          <inputVars>
            <variable name="X">
              <type>
                <INT />
              </type>
            </variable>
          </inputVars>
          <localVars>
            <variable name="t1">
              <type>
                <DINT />
              </type>
            </variable>
            <variable name="t2">
              <type>
                <DINT />
              </type>
            </variable>
          </localVars>
        </interface>
        <body>
          <ST>
            IF X &lt; 0 OR X &gt; 46 THEN
	FIB := -1;
ELSIF x &lt; 2 THEN
	FIB := X;
	RETURN;
ELSE
	(* the fibonacci number is the sum of the two suceeding fibonaci numbers *)
	(* we store the numbers alternatively in t1 and t2 depending on pt *)
	t2 := 1;
	WHILE X &gt; 3 DO
		X := X-2;
		t1 := t1 + t2;
		t2 := t1 + t2;
	END_WHILE;
	IF X &gt; 2 THEN t1 := t1 + t2; END_IF;
	fib := t1 + t2;
END_IF;

(* alternative code for very big numbers

IF X &lt; 31 THEN
	fib := 0.4472136 * (expn(1.618034,X) - expn(-0.618034,X));
ELSE
	fib := 0.4472133 * expn(1.618034,X);
END_IF;

*)

(* revision history
hm		27. dec 2007	rev 1.0
	original version

hm		2. jan 2008	rev 1.1
	deleted unused variable pt

hm		10. mar 2008	rev 1.2
	changed output to dint instead of real

hm		26. mar. 2008	rev 1.3
	function now returns -1 for input &lt; 0 or &gt; 46

*)
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>cf30fa60-b11a-4646-96f3-caff448353db</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="FLOOR" pouType="function">
        <interface>
          <returnType>
            <INT />
          </returnType>
          <inputVars>
            <variable name="X">
              <type>
                <REAL />
              </type>
            </variable>
          </inputVars>
        </interface>
        <body>
          <ST>
            FLOOR := REAL_TO_INT(X);
IF FLOOR &gt; X THEN
	FLOOR := FLOOR - 1;
END_IF;

(* revision history
hm		7. feb 2007		rev 1.0
	originlal version

hm		21. mar. 2008	rev 1.1
	replaced trunc with real_to_int for compatibility reasons

*)
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>0fc70ef3-a2cb-4e00-bfe5-234cfbdef0b2</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="FLOOR2" pouType="function">
        <interface>
          <returnType>
            <DINT />
          </returnType>
          <inputVars>
            <variable name="X">
              <type>
                <REAL />
              </type>
            </variable>
          </inputVars>
        </interface>
        <body>
          <ST>
            FLOOR2 := REAL_TO_DINT(X);
IF DINT_TO_REAL(FLOOR2) &gt; X THEN
	FLOOR2 := FLOOR2 - 1;
END_IF;

(* revision history
hm	21. mar. 2008	rev 1.0
	originlal version

hm	4. apr. 2008	rev 1.1
	added type conversion to avoid warnings under codesys 3.0
*)
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>b5c193e1-7c3a-4f05-ae53-1d96e4a05b48</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="FRACT" pouType="function">
        <interface>
          <returnType>
            <REAL />
          </returnType>
          <inputVars>
            <variable name="x">
              <type>
                <REAL />
              </type>
            </variable>
          </inputVars>
        </interface>
        <body>
          <ST>
            IF ABS(x) &lt; 2.0E9 THEN
	FRACT := x - DINT_TO_REAL(D_TRUNC(x));
ELSE
	FRACT := 0.0;
END_IF;

(* revision history
hm	4. aug 2006	rev 1.0
	original version

hm	11. mar 2008	rev 1.1
	added dint_to_real for compatibility reasons
	now returns 0 for number &gt; 2e9
	changed input to x

hm	21. mar. 2008	rev 1.2
	use D_trunc instead of TRUNC for compatibility reasons

hm	10. mar. 2009	rev 1.3
	real constants updated to new systax using dot

*)
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>64303e7a-bb64-41d1-b675-0b303f2166dc</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="F_LIN" pouType="function">
        <interface>
          <returnType>
            <REAL />
          </returnType>
          <inputVars>
            <variable name="X">
              <type>
                <REAL />
              </type>
            </variable>
            <variable name="A">
              <type>
                <REAL />
              </type>
            </variable>
            <variable name="B">
              <type>
                <REAL />
              </type>
            </variable>
          </inputVars>
        </interface>
        <body>
          <ST>
            F_lin := A * X + B;


          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>fd11577d-2760-48c4-a029-4755c90bac3c</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="F_LIN2" pouType="function">
        <interface>
          <returnType>
            <REAL />
          </returnType>
          <inputVars>
            <variable name="X">
              <type>
                <REAL />
              </type>
            </variable>
            <variable name="X1">
              <type>
                <REAL />
              </type>
            </variable>
            <variable name="Y1">
              <type>
                <REAL />
              </type>
            </variable>
            <variable name="X2">
              <type>
                <REAL />
              </type>
            </variable>
            <variable name="Y2">
              <type>
                <REAL />
              </type>
            </variable>
          </inputVars>
        </interface>
        <body>
          <ST>
            F_LIN2 := (Y2 - Y1) / (X2 - X1) * (X - X1) + Y1;


(* revision history
hm	1. jan. 2007	rev 1.0
	original release

hm	17. dec. 2008	rev 1.1
	optimized formula

*)
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>db0d9a34-4a03-494b-9c6c-9a183c12ae83</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="F_POLY" pouType="function">
        <interface>
          <returnType>
            <REAL />
          </returnType>
          <inputVars>
            <variable name="X">
              <type>
                <REAL />
              </type>
            </variable>
            <variable name="C">
              <type>
                <array>
                  <dimension lower="0" upper="7" />
                  <baseType>
                    <REAL />
                  </baseType>
                </array>
              </type>
            </variable>
          </inputVars>
        </interface>
        <body>
          <ST>
            F_POLY := ((((((( c[7] * x + c[6] ) * x + c[5] ) * x + c[4] ) * x + c[3] ) * x + c[2] ) * x + c[1] ) * x + c[0] ) ;


(* revision history
hm		20. may. 2008		rev 1.0
	original version

hm	18. mar. 2011	rev 1.1
	improved performance
*)

          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>79909b43-2d33-436b-ae49-c680a99125e2</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="F_POWER" pouType="function">
        <interface>
          <returnType>
            <REAL />
          </returnType>
          <inputVars>
            <variable name="a">
              <type>
                <REAL />
              </type>
            </variable>
            <variable name="x">
              <type>
                <REAL />
              </type>
            </variable>
            <variable name="n">
              <type>
                <REAL />
              </type>
            </variable>
          </inputVars>
        </interface>
        <body>
          <ST>
            F_POWER := a * EXPT(X, N);

          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>00171e3c-2b24-4476-99f4-a9a041f062ff</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="F_QUAD" pouType="function">
        <interface>
          <returnType>
            <REAL />
          </returnType>
          <inputVars>
            <variable name="X">
              <type>
                <REAL />
              </type>
            </variable>
            <variable name="A">
              <type>
                <REAL />
              </type>
            </variable>
            <variable name="B">
              <type>
                <REAL />
              </type>
            </variable>
            <variable name="C">
              <type>
                <REAL />
              </type>
            </variable>
          </inputVars>
        </interface>
        <body>
          <ST>
            F_QUAD :=  (A * X + B) * X + C;

(* revision history

hm	1. sep. 2006	rev 1.0
	original version

hm	18. mar. 2001	rev 1.1
	improved performance
*)
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>9d09b9c6-c756-4fa4-877b-0d3e817d2a86</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="FRMP_B" pouType="function">
        <interface>
          <returnType>
            <BYTE />
          </returnType>
          <inputVars>
            <variable name="START">
              <type>
                <BYTE />
              </type>
            </variable>
            <variable name="DIR">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="TD">
              <type>
                <TIME />
              </type>
            </variable>
            <variable name="TR">
              <type>
                <TIME />
              </type>
            </variable>
          </inputVars>
        </interface>
        <body>
          <ST>
            IF TD &lt; TR THEN
	FRMP_B := MIN(DWORD_TO_BYTE(SHL(TIME_TO_DWORD(TD), 8) / TIME_TO_DWORD(TR)), SEL(DIR, START, BYTE#255 - START));
	IF DIR THEN
		FRMP_B := START + FRMP_B;
	ELSE
		FRMP_B := START - FRMP_B;
	END_IF;
ELSE
	FRMP_B := SEL(DIR, 0, 255);
END_IF;


(* revision history

17. feb. 2011	rev 1.0
	new module

*)
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>1a80a19c-c3e7-4378-bba0-4e1703281a72</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="FT_AVG" pouType="functionBlock">
        <interface>
          <inputVars>
            <variable name="IN">
              <type>
                <REAL />
              </type>
            </variable>
            <variable name="E">
              <type>
                <BOOL />
              </type>
              <initialValue>
                <simpleValue value="TRUE" />
              </initialValue>
            </variable>
            <variable name="N">
              <type>
                <INT />
              </type>
              <initialValue>
                <simpleValue value="32" />
              </initialValue>
            </variable>
            <variable name="RST">
              <type>
                <BOOL />
              </type>
            </variable>
          </inputVars>
          <outputVars>
            <variable name="AVG">
              <type>
                <REAL />
              </type>
            </variable>
          </outputVars>
          <localVars>
            <variable name="buff">
              <type>
                <derived name="DELAY" />
              </type>
            </variable>
            <variable name="i">
              <type>
                <INT />
              </type>
            </variable>
            <variable name="init">
              <type>
                <BOOL />
              </type>
            </variable>
          </localVars>
        </interface>
        <body>
          <ST>
            (* limit n to a max of 32 because delay can do max 32 cycles *)
buff.N := LIMIT(0, N, 32);

IF NOT init OR rst THEN
	FOR i := 1 TO N DO
		buff(in := in);
	END_FOR;
	avg := in;
	init := TRUE;
ELSIF E THEN
	buff(in := in);
	avg := avg + (in - buff.out ) / INT_TO_REAL(N);
END_IF;

(* revision history

hm	7. jan. 2007	rev 1.1
	chaged rst logic to load the buffer with the actual input value instead of 0.
	added en input to allow better control of signal flow
	added init to load the buffer with in at startup to avoid rampup at beginning.
	deleted unused variable cnt.

hm	14. jun. 2008	rev 1.2
	set default for input en = TRUE and N = 32

hm	10. oct. 2008	rev 1.3
	improved performance

hm	18. oct. 2008	rev 1.4
	changed input en to e for compatibility reasons

hm	10. mar. 2009	rev 1.5
	added type conversion for compatibility reasons

*)
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>ac412480-d94c-4921-9878-0cef31a17844</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="FT_MIN_MAX" pouType="functionBlock">
        <interface>
          <inputVars>
            <variable name="in">
              <type>
                <REAL />
              </type>
            </variable>
            <variable name="rst">
              <type>
                <BOOL />
              </type>
            </variable>
          </inputVars>
          <outputVars>
            <variable name="mx">
              <type>
                <REAL />
              </type>
            </variable>
            <variable name="mn">
              <type>
                <REAL />
              </type>
            </variable>
          </outputVars>
          <localVars>
            <variable name="init">
              <type>
                <BOOL />
              </type>
            </variable>
          </localVars>
        </interface>
        <body>
          <ST>
            IF rst OR NOT init THEN
	mn := in;
	mx := in;
	init := TRUE;
ELSIF in &lt; mn THEN mn := in;
ELSIF in &gt; mx THEN mx := in;
END_IF;
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>a982670b-e654-4edb-b3e2-844498f8d66c</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="FT_RMP" pouType="functionBlock">
        <interface>
          <inputVars>
            <variable name="Rmp">
              <type>
                <BOOL />
              </type>
              <initialValue>
                <simpleValue value="TRUE" />
              </initialValue>
            </variable>
            <variable name="in">
              <type>
                <REAL />
              </type>
            </variable>
            <variable name="KR">
              <type>
                <REAL />
              </type>
            </variable>
            <variable name="KF">
              <type>
                <REAL />
              </type>
            </variable>
          </inputVars>
          <outputVars>
            <variable name="out">
              <type>
                <REAL />
              </type>
            </variable>
            <variable name="busy">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="UD">
              <type>
                <BOOL />
              </type>
            </variable>
          </outputVars>
          <localVars>
            <variable name="tx">
              <type>
                <TIME />
              </type>
            </variable>
            <variable name="last">
              <type>
                <TIME />
              </type>
            </variable>
            <variable name="init">
              <type>
                <BOOL />
              </type>
            </variable>
          </localVars>
        </interface>
        <body>
          <ST>
            (* read system time *)
tx := DWORD_TO_TIME(T_PLC_MS()) - last;

IF NOT init THEN
	init := TRUE;
	last := tx;
	tx := t#0s;
	out := in;
END_IF;
IF NOT rmp THEN
	out := in;
	busy := FALSE;
ELSIF out &gt; in THEN
	(* ramp down *)
	out := out - TIME_TO_REAL(tx) * 0.001 * KF;
	out := MAX(in, out);
ELSIF out &lt; in THEN
	(* ramp up *)
	out := out + TIME_TO_REAL(tx) * 0.001 * KR;
	out := MIN(in, out);
END_IF;

(* set busy and dir flags *)
IF out &lt; in THEN
	busy := TRUE;
	ud := TRUE;
ELSIF out &gt; in THEN
	busy := TRUE;
	ud := FALSE;
ELSE
	busy := FALSE;
END_IF;
last := last + tx;


(* revision history:

hm 8.10.2006			rev 1.1
	added ud output

hm 12. feb 2007		rev 1.2
	added init variable and corrected a possible startup problem

hm	17. sep 2007	rev 1.3
	replaced time() with t_plc_ms() for compatibility reasons

hm	25. jan 2008	rev 1.4
	performance improvements
	allow KR and KF to be 0
*)
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>bf34227d-1cc6-4caa-95e5-71313a89f72d</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="LINEAR_INT" pouType="function">
        <interface>
          <returnType>
            <REAL />
          </returnType>
          <inputVars>
            <variable name="X">
              <type>
                <REAL />
              </type>
            </variable>
            <variable name="XY">
              <type>
                <array>
                  <dimension lower="1" upper="20" />
                  <dimension lower="0" upper="1" />
                  <baseType>
                    <REAL />
                  </baseType>
                </array>
              </type>
            </variable>
            <variable name="Pts">
              <type>
                <INT />
              </type>
            </variable>
          </inputVars>
          <localVars>
            <variable name="i">
              <type>
                <INT />
              </type>
            </variable>
          </localVars>
        </interface>
        <body>
          <ST>
            (*make sure n is bound within the array size *)
pts := MIN(pts,20);

(* calculate the linear segement interpolation *)
i := 2;
(* search for segment and calculate output
	below and above the defined segments we interpolate the last segment *)
WHILE (i &lt; pts) AND (XY[i,0] &lt; X) DO
	i := i + 1;
END_WHILE;

(* calculate the output value on the corresponding segment coordinates *)
LINEAR_INT := ((XY[i,1] - XY[i-1,1]) * X - XY[i,1] * XY[i-1,0] + XY[i-1,1] * XY[i,0]) / (XY[i,0] - XY[i-1,0]);

(* revision history
hm	7. oct 2007		rev 1.0
	original version

hm	27 dec 2007		rev 1.1
	changed code for better performance
*)

          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>2f0a318f-9f62-4a9e-b5f8-32a7ddee5ba6</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="POLYNOM_INT" pouType="function">
        <interface>
          <returnType>
            <REAL />
          </returnType>
          <inputVars>
            <variable name="X">
              <type>
                <REAL />
              </type>
            </variable>
            <variable name="XY">
              <type>
                <array>
                  <dimension lower="1" upper="5" />
                  <dimension lower="0" upper="1" />
                  <baseType>
                    <REAL />
                  </baseType>
                </array>
              </type>
            </variable>
            <variable name="Pts">
              <type>
                <INT />
              </type>
            </variable>
          </inputVars>
          <localVars>
            <variable name="I">
              <type>
                <INT />
              </type>
            </variable>
            <variable name="J">
              <type>
                <INT />
              </type>
            </variable>
            <variable name="stop">
              <type>
                <INT />
              </type>
            </variable>
          </localVars>
        </interface>
        <body>
          <ST>
            (*make sure n is bound within the array size *)
pts := MIN(pts, 5);

(* this part is only to calculate the polynom parameters, which are then stores in the Y array
	the array values, it is not needed during runtime, unless the parameters will change during runtime
	the remaining code without this setup code can be used within a function to calculate specific functions
	the content of the arrays is then used as constant values within the function *)

FOR i := 1 TO pts DO
	stop := i + 1;
   	FOR j := pts TO stop BY -1 DO
   		XY[j,1] := (XY[j,1] - XY[j-1,1]) / (XY[j,0] - XY[j-i,0]);
	END_FOR;
END_FOR;


(* this part is the actual calculation *)
POLYNOM_INT := 0.0;
FOR i := pts TO 1 BY -1 DO
       POLYNOM_INT := POLYNOM_INT * (X - XY[i,0]) + XY[i,1];
END_FOR;


(* revision history
hm	8. okt 2007	rev 1.0
	original version

hm	17. dec 2007	rev 1.1
	init makes no sense for a function

hm	22. feb 2008	rev 1.2
	improved performance

hm	10. mar. 2009	rev 1.3
	changed syntax of real constants to 0.0

*)
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>a42eb1a9-d212-4cbb-a32a-d933c35ca626</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="GAMMA" pouType="function">
        <interface>
          <returnType>
            <REAL />
          </returnType>
          <inputVars>
            <variable name="X">
              <type>
                <REAL />
              </type>
            </variable>
          </inputVars>
        </interface>
        <body>
          <ST>
            IF x &gt; 0.0 THEN
	GAMMA := SQRT(math.PI2 / X) * EXPT(math.E_INV * (x + 1.0 / (12.0 * x - 0.1 / X)), X);
END_IF;


(* the stirling formula is not very accurate for small values of X
IF X &gt;=0 THEN GAMMA := SQRT(math.PI2 * X) * EXPT(X / math.E, X); END_IF;
*)





(* revision history
hm	10.12.2007	rev 1.0
	original version

hm	18. oct. 2008	rev 1.1
	using math constants

hm	26. oct. 2008	rev 1.2
	using new formula with better accuracy

hm	10. mar. 2009	rev 1.3
	real constants updated to new systax using dot

*)
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>4b384d6c-9e26-4434-9b5b-da496c3094f9</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="GAUSS" pouType="function">
        <interface>
          <returnType>
            <REAL />
          </returnType>
          <inputVars>
            <variable name="X">
              <type>
                <REAL />
              </type>
            </variable>
            <variable name="U">
              <type>
                <REAL />
              </type>
            </variable>
            <variable name="SI">
              <type>
                <REAL />
              </type>
            </variable>
          </inputVars>
          <localVars>
            <variable name="temp">
              <type>
                <REAL />
              </type>
            </variable>
            <variable name="si_inv">
              <type>
                <REAL />
              </type>
            </variable>
          </localVars>
        </interface>
        <body>
          <ST>
            temp := X - U;
si_inv := 1.0  / si;
GAUSS := EXP(Temp * Temp * si_inv * si_inv * - 0.5) * 0.39894228 * si_inv;



(* revision hisdtory
hm	6. apr. 2008	rev 1.0
	original version

hm	27. oct. 2008	rev 1.1
	optimized performance	

hm	10. mar. 2009	rev 1.2
	real constants updated to new systax using dot

*)
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>6962ae3a-50b5-4e62-ab17-0235baf06702</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="GAUSSCD" pouType="function">
        <interface>
          <returnType>
            <REAL />
          </returnType>
          <inputVars>
            <variable name="X">
              <type>
                <REAL />
              </type>
            </variable>
            <variable name="U">
              <type>
                <REAL />
              </type>
            </variable>
            <variable name="SI">
              <type>
                <REAL />
              </type>
            </variable>
          </inputVars>
        </interface>
        <body>
          <ST>
            GAUSSCD := (ERF((X - U) / (SI * 1.414213562)) + 1.0) * 0.5;



(* revision hisdtory
hm	6. apr. 2008	rev 1.0
	original version

hm	10. mar. 2009	rev 1.1
	real constants updated to new systax using dot

*)
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>ab64bd74-6e06-432d-a900-cfd598e9879c</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="GCD" pouType="function">
        <interface>
          <returnType>
            <INT />
          </returnType>
          <inputVars>
            <variable name="A">
              <type>
                <DINT />
              </type>
            </variable>
            <variable name="B">
              <type>
                <DINT />
              </type>
            </variable>
          </inputVars>
          <localVars>
            <variable name="t">
              <type>
                <DINT />
              </type>
            </variable>
          </localVars>
        </interface>
        <body>
          <ST>
            IF A = 0 THEN
	GCD := DINT_TO_INT(ABS(B));
ELSIF B = 0 THEN
	GCD := DINT_TO_INT(ABS(A));
ELSE
	A := ABS(A);
	B := ABS(B);
	GCD := 1;
	WHILE NOT(A.0 OR B.0) DO
		A := SHR(A,1);
		B := SHR(B,1);
		GCD := SHL(GCD,1);
	END_WHILE;
	WHILE A &gt; 0 DO
		IF NOT(A.0) THEN A := SHR(A,1);
		ELSIF NOT(B.0) THEN B := SHR(B,1);
		ELSE
			t:= SHR(ABS(A-B),1);
			IF A &lt; B THEN B := t; ELSE A := T; END_IF;
		END_IF;
	END_WHILE;
	GCD := GCD * DINT_TO_INT(B);
END_IF;


(* revision history
hm	19. jan. 2011	rev 1.0
	original version

*)
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>77ffb09d-42b7-4733-bd91-a43da6b2753a</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="GDF" pouType="function">
        <interface>
          <returnType>
            <REAL />
          </returnType>
          <inputVars>
            <variable name="X">
              <type>
                <REAL />
              </type>
            </variable>
          </inputVars>
        </interface>
        <body>
          <ST>
            IF X = 0.0 THEN
	GDF := 0.0;
ELSIF X &gt; 15.0 THEN
	GDF := math.PI05;
ELSIF X &lt; -15.0 THEN
	GDF := -math.PI05;
ELSE
	GDF := ATAN(EXP(X)) * 2.0 - math.PI05;
END_IF;

(* revision history
hm	27. apr. 2008	rev 1.0
	original version

hm	18. oct. 2008	rev 1.1
	using math constants

hm	10. mar. 2009	rev 1.2
	real constants updated to new systax using dot

*)

          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>299d9367-a2fc-46f0-8660-a2c611e7428f</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="CIRCLE_A" pouType="function">
        <interface>
          <returnType>
            <REAL />
          </returnType>
          <inputVars>
            <variable name="rx">
              <type>
                <REAL />
              </type>
            </variable>
            <variable name="ax">
              <type>
                <REAL />
              </type>
            </variable>
          </inputVars>
        </interface>
        <body>
          <ST>
            circle_A := Rx * RX * 8.726646E-3 * Ax;

(* revision histroy
hm	16. oct 2007	rev 1.0
	original version

hm	4. dec 2007		rev 1.1
	changed code for better performance

hm	22. feb 2008	rev 1.2
	improved performance
*)
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>a5540219-c804-4531-b007-83a9329d9b92</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="CIRCLE_C" pouType="function">
        <interface>
          <returnType>
            <REAL />
          </returnType>
          <inputVars>
            <variable name="Rx">
              <type>
                <REAL />
              </type>
            </variable>
            <variable name="Ax">
              <type>
                <REAL />
              </type>
            </variable>
          </inputVars>
        </interface>
        <body>
          <ST>
            circle_C := 1.7453293E-2 * Rx * Ax;

(* revision histroy
hm	16. oct 2007	rev 1.0
	original version

hm	22. feb 2008	rev 1.1
	improved performance
*)
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>772a169d-4cd3-4cd9-b441-f91532b0d6d4</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="CIRCLE_SEG" pouType="function">
        <interface>
          <returnType>
            <REAL />
          </returnType>
          <inputVars>
            <variable name="RX">
              <type>
                <REAL />
              </type>
            </variable>
            <variable name="HX">
              <type>
                <REAL />
              </type>
            </variable>
          </inputVars>
        </interface>
        <body>
          <ST>
            IF RX &gt; 0.0 THEN
	CIRCLE_SEG := 2.0 * ACOS(1.0 - LIMIT(0.0, HX / RX, 2.0));
	CIRCLE_SEG := (CIRCLE_SEG - SIN(CIRCLE_SEG)) *RX * RX / 2.0;
END_IF;


(* revision histroy
hm	10. mar 2010	rev 1.0
	original version

*)
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>96ec4766-1a47-4815-a434-ca839c79556c</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="CONE_V" pouType="function">
        <interface>
          <returnType>
            <REAL />
          </returnType>
          <inputVars>
            <variable name="rx">
              <type>
                <REAL />
              </type>
            </variable>
            <variable name="hx">
              <type>
                <REAL />
              </type>
            </variable>
          </inputVars>
        </interface>
        <body>
          <ST>
            cone_V := 1.047197551 * RX * RX * hx;

(* revision histroy
hm	17. oct 2007	rev 1.0
	original version

hm	4. dec 2007		rev 1.1
	changed code for better performance

hm	22. feb 2008	rev 1.2
	changed code for better performance
*)
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>2761ce62-0a7f-4f3d-b22b-775be7f79ee3</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="ELLIPSE_A" pouType="function">
        <interface>
          <returnType>
            <REAL />
          </returnType>
          <inputVars>
            <variable name="R1">
              <type>
                <REAL />
              </type>
            </variable>
            <variable name="R2">
              <type>
                <REAL />
              </type>
            </variable>
          </inputVars>
        </interface>
        <body>
          <ST>
            ELLIPSE_A := math.PI * R1 * R2;

(* revision histroy
hm	16. oct 2007	rev 1.0
	original version

hm	18. oct. 2008	rev 1.1
	using math constants
*)
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>99e842a1-830c-4c61-9547-4b821561f8ba</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="ELLIPSE_C" pouType="function">
        <interface>
          <returnType>
            <REAL />
          </returnType>
          <inputVars>
            <variable name="R1">
              <type>
                <REAL />
              </type>
            </variable>
            <variable name="R2">
              <type>
                <REAL />
              </type>
            </variable>
          </inputVars>
        </interface>
        <body>
          <ST>
            ELLIPSE_C := math.PI * (3.0 * (R1+R2) - SQRT((3.0 * r1 + R2) * (3.0 * r2 + r1)));

(* revision histroy
hm	16. oct 2007	rev 1.0
	original version

hm	18. oct. 2008	rev 1.1
	using math constants

hm	10. mar. 2009	rev 1.2
	changed syntax of real constants to 0.0

*)
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>444c7a1c-ef94-46cf-9585-fbfc625a2635</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="SPHERE_V" pouType="function">
        <interface>
          <returnType>
            <REAL />
          </returnType>
          <inputVars>
            <variable name="rx">
              <type>
                <REAL />
              </type>
            </variable>
          </inputVars>
        </interface>
        <body>
          <ST>
            sphere_V := 4.188790205 * Rx * RX * RX;

(* revision histroy
hm	16. oct 2007	rev 1.0
	original version

hm	4. dec 2007		rev 1.1
	changed code for better performance

hm	22. feb 2008		rev 1.2
	changed code for better performance
*)

          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>ab9dab1c-149a-4a19-b961-988ea994cf14</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="TRIANGLE_A" pouType="function">
        <interface>
          <returnType>
            <REAL />
          </returnType>
          <inputVars>
            <variable name="S1">
              <type>
                <REAL />
              </type>
            </variable>
            <variable name="A">
              <type>
                <REAL />
              </type>
            </variable>
            <variable name="S2">
              <type>
                <REAL />
              </type>
            </variable>
            <variable name="S3">
              <type>
                <REAL />
              </type>
            </variable>
          </inputVars>
        </interface>
        <body>
          <ST>
            IF A = 0.0 THEN
	TRIANGLE_A := SQRT((s1+s2+S3) * (s1+s2-S3) * (S2+S3-S1) * (S3+S1-S2)) * 0.25;
ELSE
	TRIANGLE_A := S1 * S2 * SIN(RAD(A)) * 0.5;
END_IF;

(* revision histroy
hm	16. oct 2007	rev 1.0
	original version

hm	22. feb 2008	rev 1.1
	improved performance

hm	10. mar. 2009	rev 1.2
	changed syntax of real constants to 0.0

*)
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>aa386057-9f33-42f7-adae-f8a65db0da96</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="GOLD" pouType="function">
        <interface>
          <returnType>
            <REAL />
          </returnType>
          <inputVars>
            <variable name="X">
              <type>
                <REAL />
              </type>
            </variable>
          </inputVars>
        </interface>
        <body>
          <ST>
            GOLD := (X + SQRT(X*X + 4.0)) * 0.5;


(* revision history
hm	27. apr. 2008	rev 1.0
	original version

hm	10. mar. 2009	rev 1.1
	real constants updated to new systax using dot

*)

          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>0874af53-b313-4da1-af57-3d3ad4c1f77d</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="HYPOT" pouType="function">
        <interface>
          <returnType>
            <REAL />
          </returnType>
          <inputVars>
            <variable name="X">
              <type>
                <REAL />
              </type>
            </variable>
            <variable name="Y">
              <type>
                <REAL />
              </type>
            </variable>
          </inputVars>
        </interface>
        <body>
          <ST>
            HYPOT := SQRT(x*x + y*y);


(* revision history
hm	21. feb 2008	rev 1.0
	original version

*)

          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>10f7b7e9-05a0-4cb0-9a49-15be44973b91</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="INC" pouType="function">
        <interface>
          <returnType>
            <INT />
          </returnType>
          <inputVars>
            <variable name="X">
              <type>
                <INT />
              </type>
            </variable>
            <variable name="D">
              <type>
                <INT />
              </type>
            </variable>
            <variable name="M">
              <type>
                <INT />
              </type>
            </variable>
          </inputVars>
        </interface>
        <body>
          <ST>
            INC := (X + D + M + 1) MOD (M + 1);

(* revision history
hm	7. feb 2007		REV 1.0
	original version

hm	15. jan 2008	rev 1.1
	allow for neagtive increment

*)
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>6137c9c5-890f-4dc6-9c9d-eeaef0ceb3c8</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="INC1" pouType="function">
        <interface>
          <returnType>
            <INT />
          </returnType>
          <inputVars>
            <variable name="X">
              <type>
                <INT />
              </type>
            </variable>
            <variable name="N">
              <type>
                <INT />
              </type>
            </variable>
          </inputVars>
        </interface>
        <body>
          <ST>
            IF X &gt;= N - 1 THEN
	INC1 := 0;
ELSE
	INC1 := X + 1;
END_IF;



(* revision history
hm	13. oct. 2008	rev 1.0
	original version

hm	22. oct. 2008	rev 1.1
	added statement to return value for compatibility reasons

hm	23. feb. 2009	rev 1.2
 	when inc1 is called with X &gt;= N inc will continue with 0
*)
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>9b8494ef-f074-4433-8ba5-01f65b34eef2</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="INC2" pouType="function">
        <interface>
          <returnType>
            <INT />
          </returnType>
          <inputVars>
            <variable name="X">
              <type>
                <INT />
              </type>
            </variable>
            <variable name="D">
              <type>
                <INT />
              </type>
            </variable>
            <variable name="L">
              <type>
                <INT />
              </type>
            </variable>
            <variable name="U">
              <type>
                <INT />
              </type>
            </variable>
          </inputVars>
          <localVars>
            <variable name="tmp">
              <type>
                <INT />
              </type>
            </variable>
          </localVars>
        </interface>
        <body>
          <ST>
            tmp := U - L + 1;
INC2 := (X + D - L + tmp) MOD tmp + L;



(* revision history
hm	29. jun. 2008		REV 1.0
	original version


*)
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>c590727f-1887-425b-8c9a-8fe70f0ca27c</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="INV" pouType="function">
        <interface>
          <returnType>
            <REAL />
          </returnType>
          <inputVars>
            <variable name="X">
              <type>
                <REAL />
              </type>
            </variable>
          </inputVars>
        </interface>
        <body>
          <ST>
            IF X &lt;&gt; 0.0 THEN INV := 1.0 / X; END_IF;




(* revision history
hm	26. oct. 2008	rev 1.0
	original version

hm	10. mar. 2009	rev 1.1
	real constants updated to new systax using dot

*)

          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>d6e8210c-cd7a-4b57-8815-3ac3cfef33da</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="LAMBERT_W" pouType="function">
        <interface>
          <returnType>
            <REAL />
          </returnType>
          <inputVars>
            <variable name="X">
              <type>
                <REAL />
              </type>
            </variable>
          </inputVars>
          <localVars>
            <variable name="w">
              <type>
                <REAL />
              </type>
            </variable>
            <variable name="i">
              <type>
                <INT />
              </type>
            </variable>
            <variable name="we">
              <type>
                <REAL />
              </type>
            </variable>
            <variable name="w1e">
              <type>
                <REAL />
              </type>
            </variable>
            <variable name="last">
              <type>
                <DWORD />
              </type>
            </variable>
            <variable name="ewx">
              <type>
                <REAL />
              </type>
            </variable>
          </localVars>
        </interface>
        <body>
          <ST>
            (* check for valid input and return -1000 if too low *)
IF x &lt; -0.367879441171442 THEN
	LAMBERT_W := -1000.0;
	RETURN;
(* return 0 if x = 0 *)
ELSIF x = 0.0 THEN
	RETURN;
(* first an estimate is calculated *)
ELSIF x &lt;= 500.0 THEN
	w := LN(x + 1.0);
	w := 0.665 * (1.0 + 0.0195 * w) * w + 0.04;
ELSE
	w := LN(x - 4.0) - (1.0 - 1.0/LN(x)) * LN(LN(x));
END_IF;
(* use estimate to calculate exact result *)
FOR i := 0 TO 5 DO
	ewx := EXP(w);
	we := w * ewx - x;
	w1e := (w+1.0) * ewx;
	last := REAL_TO_DW(w) AND 16#FFFF_FFFC;
	w := w - (we / (w1e - (w+2.0) * we / (2.0 * w + 2.0)));
	IF (REAL_TO_DW(w) AND 16#FFFF_FFFC) = last THEN EXIT; END_IF;
END_FOR;
LAMBERT_W := w;


(* revision hisdtory
hm	26. oct. 2008	rev 1.0
	original version

hm	10. mar. 2009	rev 1.1
	real constants updated to new systax using dot

*)
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>d43f8c3d-5edf-4a65-bada-44d3f1d8ca00</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="LANGEVIN" pouType="function">
        <interface>
          <returnType>
            <REAL />
          </returnType>
          <inputVars>
            <variable name="X">
              <type>
                <REAL />
              </type>
            </variable>
          </inputVars>
        </interface>
        <body>
          <ST>
            IF X = 0.0 THEN
	LANGEVIN := 0.0;
ELSE
	LANGEVIN := COTH(X) - 1.0 / X;
END_IF;

(* revision history
hm	10.12.2007	rev 1.0
	original version

hm	11. mar 2008	rev 1.1
	changed formula to avoid problems when x = 0

hm	10. mar. 2009	rev 1.2
	real constants updated to new systax using dot

*)
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>de542845-bf67-4b36-beca-59e6fb3307e3</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="MAX3" pouType="function">
        <interface>
          <returnType>
            <REAL />
          </returnType>
          <inputVars>
            <variable name="in1">
              <type>
                <REAL />
              </type>
            </variable>
            <variable name="in2">
              <type>
                <REAL />
              </type>
            </variable>
            <variable name="in3">
              <type>
                <REAL />
              </type>
            </variable>
          </inputVars>
        </interface>
        <body>
          <ST>
            MAX3 := MAX(MAX(IN1,IN2),IN3);


(* revision history
hm	1.1.2007	rev 1.0
	original release

hm	18. mar. 2011	rev 1.1
	improve performance

*)
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>6b3fc4f9-7944-48ac-a205-3594b479d35f</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="MID3" pouType="function">
        <interface>
          <returnType>
            <REAL />
          </returnType>
          <inputVars>
            <variable name="IN1">
              <type>
                <REAL />
              </type>
            </variable>
            <variable name="IN2">
              <type>
                <REAL />
              </type>
            </variable>
            <variable name="IN3">
              <type>
                <REAL />
              </type>
            </variable>
          </inputVars>
        </interface>
        <body>
          <ST>
            IF IN1 &gt; IN2 THEN MID3 := IN1; IN1 := IN2; IN2 := MID3; END_IF;
IF IN2 &gt; IN3 THEN IN2 := IN3; END_IF;
MID3 := SEL(IN1 &gt; IN2, IN2, IN1);


(*
hm	1.1.2007	rev 1.1
	rewrote the function for better performance

hm	18. mar. 2011	rev 1.2
	improve performance
*)
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>433acfd6-5dcd-495d-b92d-a3ce3cdc618f</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="MIN3" pouType="function">
        <interface>
          <returnType>
            <REAL />
          </returnType>
          <inputVars>
            <variable name="in1">
              <type>
                <REAL />
              </type>
            </variable>
            <variable name="in2">
              <type>
                <REAL />
              </type>
            </variable>
            <variable name="in3">
              <type>
                <REAL />
              </type>
            </variable>
          </inputVars>
        </interface>
        <body>
          <ST>
            MIN3 := MIN(MIN(IN1,IN2),IN3);


(* revision history
hm	1.1.2007	rev 1.0
	original release

hm	18. mar. 2011	rev 1.1
	improve performance

*)
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>4c167375-19f2-4565-a0e6-0c8f6ad378b3</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="MODR" pouType="function">
        <interface>
          <returnType>
            <REAL />
          </returnType>
          <inputVars>
            <variable name="IN">
              <type>
                <REAL />
              </type>
            </variable>
            <variable name="DIVI">
              <type>
                <REAL />
              </type>
            </variable>
          </inputVars>
        </interface>
        <body>
          <ST>
            IF divi = 0.0 THEN
	MODR := 0.0;
ELSE
	MODR := in - DINT_TO_REAL(FLOOR2(in / divi)) * divi;
END_IF;

(* revision history

hm	4. aug.2006		rev 1.0

hm	28. jan.2007	rev 1.1
	modr(x,0) will deliver the result 0

hm	21. mar 2008	rev 1.2
	use D_trunc for compatibility reasons

hm	4. apr. 2008	rev 1.3
	added type conversion to avoid warnings under codesys 3.0

hm	31. oct. 2008	rev 1.4
	changed algorithm to the more common version using floor instead of TRUNC

hm	10. mar. 2009	rev 1.5
	real constants updated to new systax using dot

*)
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>4a79e8a5-c991-42a4-80ab-adc776a70510</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="MUL_ADD" pouType="function">
        <interface>
          <returnType>
            <REAL />
          </returnType>
          <inputVars>
            <variable name="X">
              <type>
                <REAL />
              </type>
            </variable>
            <variable name="K">
              <type>
                <REAL />
              </type>
            </variable>
            <variable name="O">
              <type>
                <REAL />
              </type>
            </variable>
          </inputVars>
        </interface>
        <body>
          <ST>
            MUL_ADD := X * K + O;

(* revision history
hm	28. feb 2007
	original version

hm	11.nov 2007		rev 1.1
	deleted preset values for K and O this makes no sense for a function

*)
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>5e7ee37d-bc54-4c31-ac31-306d6fa35788</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="NEGX" pouType="function">
        <interface>
          <returnType>
            <REAL />
          </returnType>
          <inputVars>
            <variable name="X">
              <type>
                <REAL />
              </type>
            </variable>
          </inputVars>
        </interface>
        <body>
          <ST>
            NEGX := -X;


(* revision history
hm	26. oct. 2008	rev 1.0
	original version


*)

          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>384d16f5-ac9f-430c-9869-2758bc5dd6d8</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="RAD" pouType="function">
        <interface>
          <returnType>
            <REAL />
          </returnType>
          <inputVars>
            <variable name="DEG">
              <type>
                <REAL />
              </type>
            </variable>
          </inputVars>
        </interface>
        <body>
          <ST>
            RAD := MODR(0.0174532925199433 * DEG, math.PI2);

(* revision history
hm	4. aug 2006		rev 1.0
	original version

hm 	16. oct 2007	rev 1.1
	added modr statement which prohibits rad to become bigger than 2PI

hm	18. oct 2008	rev 1.2
	using math constants

*)
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>39fca524-be03-40b9-9077-f0ac161b23f1</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="RDM" pouType="function">
        <interface>
          <returnType>
            <REAL />
          </returnType>
          <inputVars>
            <variable name="last">
              <type>
                <REAL />
              </type>
            </variable>
          </inputVars>
          <localVars>
            <variable name="tn">
              <type>
                <DWORD />
              </type>
            </variable>
            <variable name="tc">
              <type>
                <INT />
              </type>
            </variable>
          </localVars>
        </interface>
        <body>
          <ST>
            tn := T_PLC_MS();
tc := BIT_COUNT(tn);
tn.31 := tn.2;
tn.30 := tn.5;
tn.29 := tn.4;
tn.28 := tn.1;
tn.27 := tn.0;
tn.26 := tn.7;
tn.25 := tn.6;
tn.24 := tn.3;
tn := ROL(tn,BIT_COUNT(tn)) OR 16#80000001;
tn := tn MOD 71474513 + INT_TO_DWORD(tc + 77);
RDM := FRACT(DWORD_TO_REAL(tn) / 10000000.0 * (math.E - LIMIT(0.0,last,1.0)));


(*
pt := ADR(temp);
pt^ := (T_PLC_MS() AND 16#007FFFFF) OR 16#3D000000;
RDM := fract(modR(temp*e+pi1, PI1-last) + modR(temp*PI1+e + last,e-last));
*)

(* revision history
hm		16. jan 2007		rev 1.0
	original version

hm		11. nov 2007		rev 1.1
	changed time() into t_plc_ms()

hm		20. nov 2007		rev 1.2
	changed code of temp calculation to avoid overflow in modr due to resuclt would not fit DINT for high timeer values

hm		5. jan 2008		rev 1.3
	changed calculation of temp to avoid problem with high values of t_plc_ms

hm		2. feb 2008		rev 1.4
	changed algorithm to avoind non iec functions and guarantee more randomness

hm	10. mar. 2008		rev 1.5
	make sure last will be between 0 and 1 to avoid invalid results

hm	16. mar. 2008		rev 1.6
	added conversion for tc to avoid warnings under codesys 3.0

hm	18. may. 2008		rev 1.7
	changed constant E to E1

hm	18. oct. 2008		rev 1.8
	using math constants

hm	10. mar. 2009		rev 1.9
	real constants updated to new systax using dot

*)
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>74d2fd9b-eb17-40fc-8ddb-f0c9c949987d</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="RDM2" pouType="function">
        <interface>
          <returnType>
            <INT />
          </returnType>
          <inputVars>
            <variable name="last">
              <type>
                <INT />
              </type>
            </variable>
            <variable name="low">
              <type>
                <INT />
              </type>
            </variable>
            <variable name="high">
              <type>
                <INT />
              </type>
            </variable>
          </inputVars>
        </interface>
        <body>
          <ST>
            RDM2 := DINT_TO_INT(TRUNC(RDM(FRACT(last * math.PI)) * (high - low + 1)) + low);

(* revision history
hm		29. feb 2008		rev 1.0
	original version

hm		18. oct. 2008		rev 1.1
	using math constants

*)
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>e703b6e9-77aa-4447-81c1-26e90cd171f0</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="RDMDW" pouType="function">
        <interface>
          <returnType>
            <DWORD />
          </returnType>
          <inputVars>
            <variable name="last">
              <type>
                <DWORD />
              </type>
            </variable>
          </inputVars>
          <localVars>
            <variable name="RX">
              <type>
                <REAL />
              </type>
            </variable>
            <variable name="M">
              <type>
                <REAL />
              </type>
            </variable>
          </localVars>
        </interface>
        <body>
          <ST>
            M := BIT_COUNT(last);
RX := RDM(FRACT(M * math.PI));
RDMDW := SHL(REAL_TO_DWORD(rx*65535),16);
RX := RDM(FRACT(M * math.E));
RDMDW := RDMDW OR (REAL_TO_DWORD(rx*65535) AND 16#0000FFFF);



(* revision history
hm		14. mar 2008		rev 1.0
	original version

hm		18. may. 2008		rev 1.1
	changed constant E to E1

hm		18. oct. 2008		rev 1.2
	using math constants

*)
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>05ee5871-a9e2-4433-927a-28a15aa2729b</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="REAL_TO_FRAC" pouType="function">
        <interface>
          <returnType>
            <derived name="FRACTION" />
          </returnType>
          <inputVars>
            <variable name="X">
              <type>
                <REAL />
              </type>
              <documentation>
                 in einen Bruch umzuwandelnder Wert 
              </documentation>
            </variable>
            <variable name="N">
              <type>
                <INT />
              </type>
              <documentation>
                 maximale Größe des Nenners 
              </documentation>
            </variable>
          </inputVars>
          <localVars>
            <variable name="temp">
              <type>
                <DINT />
              </type>
              <documentation>
                 Merker für Berechnungen 
              </documentation>
            </variable>
            <variable name="sign">
              <type>
                <BOOL />
              </type>
              <documentation>
                 Vorzeichen vom Eingangswert 
              </documentation>
            </variable>
            <variable name="X_gerundet">
              <type>
                <DINT />
              </type>
              <documentation>
                 Wert von Bruch, auf ganze Zahl gerundet 
              </documentation>
            </variable>
            <variable name="X_ohne_Nachkomma">
              <type>
                <REAL />
              </type>
              <documentation>
                 Wert von Bruch, ohne Nachkommastellen 
              </documentation>
            </variable>
            <variable name="Numerator">
              <type>
                <DINT />
              </type>
              <initialValue>
                <simpleValue value="1" />
              </initialValue>
              <documentation>
                 Initialwert Zaehler  
              </documentation>
            </variable>
            <variable name="Denominator">
              <type>
                <DINT />
              </type>
              <initialValue>
                <simpleValue value="0" />
              </initialValue>
              <documentation>
                 Initialwert Nenner 
              </documentation>
            </variable>
            <variable name="Numerator_old">
              <type>
                <DINT />
              </type>
              <initialValue>
                <simpleValue value="0" />
              </initialValue>
              <documentation>
                 Initialwert Zaehler der letzten Berechnung  
              </documentation>
            </variable>
            <variable name="Denominator_old">
              <type>
                <DINT />
              </type>
              <initialValue>
                <simpleValue value="1" />
              </initialValue>
              <documentation>
                 Initialwert Zaehler der letzten Berechnung   
              </documentation>
            </variable>
          </localVars>
        </interface>
        <body>
          <ST>
            IF X &lt; 0.0 THEN
	sign := TRUE;								(* Vorzeichen merken *)
	X := ABS(X);								(* Absolutwert berechnen *)
END_IF;

REPEAT
	X_gerundet := REAL_TO_DINT(X);

	(* Zaehler berechnen *)
	temp := numerator * X_gerundet + numerator_old;		(* Zaehler um Vorkammawert erweitern *)
	numerator_old := numerator;							(* Zaehler der letzten Berechnung speichern *)
	numerator := temp;									(* Zaehler dieser Berechnung speichern *)

	(* Nenner berechnen *)
	temp := denominator * X_gerundet + denominator_old;	(* Nenner um Vorkammawert erweitern *)
	denominator_old := denominator;						(* Nenner der letzten Berechnung speichern *)
	denominator := temp;								(* Nenner dieser Berechnung speichern *)

	(* Restwert berechnen *)
	X_ohne_Nachkomma := DINT_TO_REAL(X_gerundet);
	IF X = X_ohne_Nachkomma THEN						(* Bruch geht ohne Rest auf *)
		IF ABS(denominator) &lt;= N THEN						(* kein Rundungsfehler *)
			numerator_old := numerator;					(* Numerator_old wird von Funktion zurückgegeben *)
			denominator_old := denominator;			(* Denominator_old wird von Funktion zurückgegeben *)
		END_IF
		EXIT;											(* keine weitere Berechnung notwendig *)
	ELSE
		X := 1.0 / (X - X_ohne_Nachkomma);				(* Kehrwert vom Rest -&gt; Neuer Bruch *)
	END_IF

UNTIL
	ABS(Denominator) &gt; N
END_REPEAT

(* correct sign if X was negative *)
IF sign THEN
	REAL_TO_FRAC.NUMERATOR := -1 * ABS(DINT_TO_INT(numerator_old));
ELSE
	REAL_TO_FRAC.NUMERATOR :=  ABS(DINT_TO_INT(numerator_old));
END_IF
REAL_TO_FRAC.DENOMINATOR := ABS(DINT_TO_INT(denominator_old));


(* revision history
hm		19. jan. 2011	rev 1.0
	original version

ad		06. apr. 2011	rev 1.1
	optimized code
*)
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>9370ecc5-ee9c-4dfc-82e2-d4c73fcd1c03</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="RND" pouType="function">
        <interface>
          <returnType>
            <REAL />
          </returnType>
          <inputVars>
            <variable name="X">
              <type>
                <REAL />
              </type>
            </variable>
            <variable name="N">
              <type>
                <INT />
              </type>
            </variable>
          </inputVars>
          <localVars>
            <variable name="M">
              <type>
                <REAL />
              </type>
            </variable>
          </localVars>
        </interface>
        <body>
          <ST>
            IF X = 0.0 THEN
	RND := 0.0;
ELSE
	M := EXPN(10.0,N - CEIL(LOG(ABS(X))));
	RND := DINT_TO_REAL(REAL_TO_DINT(X * M)) / M;
END_IF;


(* revision history
hm	11. mar 2008	rev 1.0
	original version

hm	26. oct. 2008	rev 1.1
	code optimization

hm	10. mar. 2009	rev 1.2
	real constants updated to new systax using dot																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																											

*)


          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>ad455559-4cd3-41bb-9fa4-e5c88234f505</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="ROUND" pouType="function">
        <interface>
          <returnType>
            <REAL />
          </returnType>
          <inputVars>
            <variable name="in">
              <type>
                <REAL />
              </type>
            </variable>
            <variable name="N">
              <type>
                <INT />
              </type>
            </variable>
          </inputVars>
          <localVars>
            <variable name="X">
              <type>
                <REAL />
              </type>
            </variable>
          </localVars>
        </interface>
        <body>
          <ST>
            X := setup.DECADES[LIMIT(0,N,8)];
ROUND := DINT_TO_REAL(REAL_TO_DINT(in * X)) / X;



(* revision history
hm	1. sep 2006	rev 1.0
	original version

hm	2. dec 2007	rev 1.1
	changed code for better performance

hm	8. jan 2008	rev 1.2
	further improvement in performance

hm 11. mar. 2008	rev 1.3
	corrected an error with negative numbers
	use real_to_dint instead of trunc

hm	16. mar 2008	rev 1.4
	added type conversion to avoid warning under codesys 3.0

hm	25. oct. 2008	rev 1.5
	new code using global constants decades
*)




          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>3e35873c-ecb5-4dbe-8aac-271212e55daa</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="SGN" pouType="function">
        <interface>
          <returnType>
            <INT />
          </returnType>
          <inputVars>
            <variable name="X">
              <type>
                <REAL />
              </type>
            </variable>
          </inputVars>
        </interface>
        <body>
          <ST>
            IF X &gt; 0 THEN
	SGN := 1;
ELSIF X &lt; 0 THEN
	SGN := -1;
ELSE
	SGN := 0;
END_IF;



(* revision histroy
hm	16. oct 2007	rev 1.0
	original version

hm	11. nov 2007	rev 1.1
	changed type of function from real to int

*)
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>ed41c4de-e575-4c7f-bc11-5417eddf7725</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="SIGMOID" pouType="function">
        <interface>
          <returnType>
            <REAL />
          </returnType>
          <inputVars>
            <variable name="X">
              <type>
                <REAL />
              </type>
            </variable>
          </inputVars>
        </interface>
        <body>
          <ST>
            IF X &gt; 20.0 THEN
	SIGMOID := 1.0;
ELSIF x &lt; -85.0 THEN
	SIGMOID := 0.0;
ELSE
	SIGMOID := 1.0 / (1.0 + EXP(-X));
END_IF;


(* revision history
hm	10.12.2007		rev 1.0
	original version

hm	11. mar. 2008		rev 1.1
	extended range of valid inputs to +inv / -inv

hm 10. mar. 2009		rev 1.2
	real constants updated to new systax using dot																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																											

*)
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>8700d0f4-f24c-4ef3-b1f5-81b3a409cee2</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="SIGN_I" pouType="function">
        <interface>
          <returnType>
            <BOOL />
          </returnType>
          <inputVars>
            <variable name="IN">
              <type>
                <DINT />
              </type>
            </variable>
          </inputVars>
        </interface>
        <body>
          <ST>
            SIGN_I := in.31;

(* revision history
hm 3.3.2007	rev 1.1
	changed method of function for better compatibility to other systems

hm	1.12.2007	rev 1.2
	changed code to improve performance

hm	27. oct. 2008	rev 1.3
	changed type of input to dint

*)
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>034313ff-e35b-489e-98a4-65ba2d34261c</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="SIGN_R" pouType="function">
        <interface>
          <returnType>
            <BOOL />
          </returnType>
          <inputVars>
            <variable name="in">
              <type>
                <REAL />
              </type>
            </variable>
          </inputVars>
        </interface>
        <body>
          <ST>
            SIGN_R := in &lt; 0.0;


(* revision history
hm 19.1.2007	rev 1.1
	changed method of function for better compatibility to other systems

hm	1.12.2007	rev 1.2
	changed code to improve performance

hm	14. jun. 2008	rev 1.3
	improved performace

hm 10. mar. 2009	rev 1.4
	real constants updated to new systax using dot																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																											

*)
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>ab13fc26-3f04-4c9a-961e-ac2c1e0c63ec</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="SINC" pouType="function">
        <interface>
          <returnType>
            <REAL />
          </returnType>
          <inputVars>
            <variable name="X">
              <type>
                <REAL />
              </type>
            </variable>
          </inputVars>
        </interface>
        <body>
          <ST>
            IF X = 0.0 THEN
	SINC := 1.0;
ELSE
	SINC := SIN(x) / x;
END_IF;


(* revision histroy
hm	11. mar. 2008	rev 1.0
	original version

hm	1.12.2007	rev 1.1
	changed code to improove performance

hm 10. mar. 2009	rev 1.2
	real constants updated to new systax using dot																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																											

*)
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>bb6dc2c5-0d27-45d0-b701-0c7f57783ff9</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="SINH" pouType="function">
        <interface>
          <returnType>
            <REAL />
          </returnType>
          <inputVars>
            <variable name="X">
              <type>
                <REAL />
              </type>
            </variable>
          </inputVars>
        </interface>
        <body>
          <ST>
            IF ABS(x) &lt; 2E-3 THEN
	SINH := X;
ELSE
	SINH := (EXP(x) - EXP(-x)) * 0.5;
END_IF;


(* revision history
hm	12.1.2007	rev 1.0
	original version

hm	1.12.2007	rev 1.1
	changed code to improve performance

hm	5. jan 2008	rev 1.2
	further performance improvement

hm	11. mar 2008	rev 1.3
	improved accuracy around 0

*)
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>e1939be9-2baf-4e36-a95a-61422e039da0</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="SQRTN" pouType="function">
        <interface>
          <returnType>
            <REAL />
          </returnType>
          <inputVars>
            <variable name="X">
              <type>
                <REAL />
              </type>
            </variable>
            <variable name="N">
              <type>
                <INT />
              </type>
            </variable>
          </inputVars>
        </interface>
        <body>
          <ST>
            IF N &gt; 0 THEN
	SQRTN := EXP(LN(x) / INT_TO_REAL(n));
ELSE
	SQRTN := 0.0;
END_IF;


(* revision history
hm		12 jan 2007	rev 1.0
	original version

hm		2. dec 2007	rev 1.1
	changed code for better performance

hm		11. mar 2008	rev 1.2
	added result 0 for compatibility reasons

hm 10. mar. 2009	rev 1.3
	added type conversions for compatibility reasons																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																									

*)
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>6584f467-892c-4f39-9fb7-cad1c8ca4f19</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="TANC" pouType="function">
        <interface>
          <returnType>
            <REAL />
          </returnType>
          <inputVars>
            <variable name="X">
              <type>
                <REAL />
              </type>
            </variable>
          </inputVars>
        </interface>
        <body>
          <ST>
            IF X = 0.0 THEN
	TANC := 1.0;
ELSE
	TANC := TAN(x) / x;
END_IF;


(* revision histroy
hm	23. oct. 2008	rev 1.0
	original version

hm 10. mar. 2009	rev 1.1
	real constants updated to new systax using dot																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																											

*)
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>3d5f62fe-aac4-4359-ac06-8f62bdb05a83</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="TANH" pouType="function">
        <interface>
          <returnType>
            <REAL />
          </returnType>
          <inputVars>
            <variable name="X">
              <type>
                <REAL />
              </type>
            </variable>
          </inputVars>
        </interface>
        <body>
          <ST>
            IF X &gt; 20.0 THEN
	TANH := 1.0;
ELSIF X &lt; -20.0 THEN
	TANH := -1.0;
ELSE
	TANH := 1.0 - 2.0 / (EXP(2.0 * x) + 1.0);
END_IF;


(* revision hisdtory
hm		12.1.2007		rev 1.0
	original version

hm		1.12.2007		rev 1.1
	changed code to improve performance

hm		10. mar 2008	rev 1.2
	corrected an error in formula
	extended range of valid inputs to +/- INV

hm 10. mar. 2009	rev 1.3
	real constants updated to new systax using dot																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																											

*)
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>d8021298-36c7-4157-94bc-ec7c645b27a2</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="V3_ABS" pouType="function">
        <interface>
          <returnType>
            <REAL />
          </returnType>
          <inputVars>
            <variable name="A">
              <type>
                <derived name="Vector_3" />
              </type>
            </variable>
          </inputVars>
        </interface>
        <body>
          <ST>
            V3_ABS := SQRT(A.X * A.X + A.Y * A.Y + A.Z * A.Z);


(* revision history
hm		11 dec 2007	rev 1.0
	original version

*)
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>683304f5-ad82-48ad-b49a-9eb5c8f70a6c</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="V3_ADD" pouType="function">
        <interface>
          <returnType>
            <derived name="vector_3" />
          </returnType>
          <inputVars>
            <variable name="A">
              <type>
                <derived name="Vector_3" />
              </type>
            </variable>
            <variable name="B">
              <type>
                <derived name="Vector_3" />
              </type>
            </variable>
          </inputVars>
        </interface>
        <body>
          <ST>
            V3_ADD.X := A.X + B.X;
V3_ADD.Y := A.Y + B.Y;
V3_ADD.Z := A.Z + B.Z;



(* revision history
hm		11 dec 2007	rev 1.0
	original version

*)
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>e969987a-bd5a-4b26-8b4f-bfe4f1df3d8c</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="V3_ANG" pouType="function">
        <interface>
          <returnType>
            <REAL />
          </returnType>
          <inputVars>
            <variable name="A">
              <type>
                <derived name="Vector_3" />
              </type>
            </variable>
            <variable name="B">
              <type>
                <derived name="Vector_3" />
              </type>
            </variable>
          </inputVars>
          <localVars>
            <variable name="d">
              <type>
                <REAL />
              </type>
            </variable>
          </localVars>
        </interface>
        <body>
          <ST>
            d := V3_ABS(A) * V3_ABS(B);
IF d &gt; 0 THEN
	V3_ANG := ACOS(LIMIT(-1.0, V3_DPRO(A, B) / d,1.0));
END_IF;

(* revision history
hm	11. dec. 2007	rev 1.0
	original version

hm	10. mar. 2009	rev 1.1
	changed syntax of real constants to 0.0

*)
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>8ef44f5b-43a0-485e-9b93-54f105934d62</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="V3_DPRO" pouType="function">
        <interface>
          <returnType>
            <REAL />
          </returnType>
          <inputVars>
            <variable name="A">
              <type>
                <derived name="Vector_3" />
              </type>
            </variable>
            <variable name="B">
              <type>
                <derived name="Vector_3" />
              </type>
            </variable>
          </inputVars>
        </interface>
        <body>
          <ST>
            V3_DPRO := A.X * B.X + A.Y * B.Y + A.Z * B.Z;


(* revision history
hm		11 dec 2007	rev 1.0
	original version

*)
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>611f7959-355a-4910-a5b8-6e22fbf2ddf5</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="V3_NORM" pouType="function">
        <interface>
          <returnType>
            <derived name="vector_3" />
          </returnType>
          <inputVars>
            <variable name="A">
              <type>
                <derived name="Vector_3" />
              </type>
            </variable>
          </inputVars>
          <localVars>
            <variable name="la">
              <type>
                <REAL />
              </type>
            </variable>
          </localVars>
        </interface>
        <body>
          <ST>
            la := V3_ABS(A);
IF la &gt; 0.0 THEN
	V3_NORM := V3_SMUL(A, 1.0 / la);
END_IF;

(* revision history
hm	11 dec 2007	rev 1.0
	original version

hm	10. mar. 2009	rev 1.1
	changed syntax of real constants to 0.0

*)
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>22f4b869-67ff-4da4-a4ee-bb722de2b62f</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="V3_NUL" pouType="function">
        <interface>
          <returnType>
            <BOOL />
          </returnType>
          <inputVars>
            <variable name="A">
              <type>
                <derived name="Vector_3" />
              </type>
            </variable>
          </inputVars>
        </interface>
        <body>
          <ST>
            V3_NUL := A.X = 0.0 AND A.Y = 0.0 AND A.Z = 0.0;



(* revision history
hm	12 dec 2007	rev 1.0
	original version

hm	10. mar. 2009	rev 1.1
	changed syntax of real constants to 0.0

*)
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>10844ec0-3910-4f31-842d-af0178dd256b</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="V3_PAR" pouType="function">
        <interface>
          <returnType>
            <BOOL />
          </returnType>
          <inputVars>
            <variable name="A">
              <type>
                <derived name="Vector_3" />
              </type>
            </variable>
            <variable name="B">
              <type>
                <derived name="Vector_3" />
              </type>
            </variable>
          </inputVars>
        </interface>
        <body>
          <ST>
            V3_PAR := V3_ABS(V3_XPRO(A, B)) = 0.0;



(* revision history
hm	11 dec 2007	rev 1.0
	original version

hm	10. mar. 2009	rev 1.1
	changed syntax of real constants to 0.0

*)
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>c16397f6-76ab-4603-864d-d1bfb6637675</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="V3_REV" pouType="function">
        <interface>
          <returnType>
            <derived name="vector_3" />
          </returnType>
          <inputVars>
            <variable name="A">
              <type>
                <derived name="Vector_3" />
              </type>
            </variable>
          </inputVars>
        </interface>
        <body>
          <ST>
            V3_REV.X := -A.X;
V3_REV.Y := -A.Y;
V3_REV.Z := -A.Z;



(* revision history
hm		11 dec 2007	rev 1.0
	original version

*)
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>00b36569-7a4e-414b-97c8-678e7b1e8d17</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="V3_SMUL" pouType="function">
        <interface>
          <returnType>
            <derived name="vector_3" />
          </returnType>
          <inputVars>
            <variable name="A">
              <type>
                <derived name="Vector_3" />
              </type>
            </variable>
            <variable name="M">
              <type>
                <REAL />
              </type>
            </variable>
          </inputVars>
        </interface>
        <body>
          <ST>
            V3_SMUL.X := A.X * M;
V3_SMUL.Y := A.Y * M;
V3_SMUL.Z := A.Z * M;



(* revision history
hm		11 dec 2007	rev 1.0
	original version

*)
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>43acbf5a-190d-430b-87e2-3e84a24d3edd</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="V3_SUB" pouType="function">
        <interface>
          <returnType>
            <derived name="vector_3" />
          </returnType>
          <inputVars>
            <variable name="A">
              <type>
                <derived name="Vector_3" />
              </type>
            </variable>
            <variable name="B">
              <type>
                <derived name="Vector_3" />
              </type>
            </variable>
          </inputVars>
        </interface>
        <body>
          <ST>
            V3_SUB.X := A.X - B.X;
V3_SUB.Y := A.Y - B.Y;
V3_SUB.Z := A.Z - B.Z;



(* revision history
hm		11 dec 2007	rev 1.0
	original version

*)
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>d496b4ac-b440-4044-80e5-bef7bb5670db</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="V3_XANG" pouType="function">
        <interface>
          <returnType>
            <REAL />
          </returnType>
          <inputVars>
            <variable name="A">
              <type>
                <derived name="Vector_3" />
              </type>
            </variable>
          </inputVars>
          <localVars>
            <variable name="la">
              <type>
                <REAL />
              </type>
            </variable>
          </localVars>
        </interface>
        <body>
          <ST>
            la := V3_ABS(a);
IF la &gt; 0.0 THEN
	V3_XANG := ACOS(A.X / la);
END_IF;

(* revision history
hm	11 dec 2007	rev 1.0
	original version

hm	10. mar. 2009	rev 1.1
	changed syntax of real constants to 0.0

*)
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>e15f4eb4-223b-44f8-aefb-bf4970ea2e2c</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="V3_XPRO" pouType="function">
        <interface>
          <returnType>
            <derived name="vector_3" />
          </returnType>
          <inputVars>
            <variable name="A">
              <type>
                <derived name="Vector_3" />
              </type>
            </variable>
            <variable name="B">
              <type>
                <derived name="Vector_3" />
              </type>
            </variable>
          </inputVars>
        </interface>
        <body>
          <ST>
            V3_XPRO.X := A.Y * B.Z - A.Z * B.Y;
V3_XPRO.Y := A.Z * B.X - A.X * B.Z;
V3_XPRO.Z := A.X * B.Y - A.Y * B.X;



(* revision history
hm		11 dec 2007	rev 1.0
	original version

*)
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>c46ff78d-470a-4c00-9b76-6b64c1c4c9c2</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="V3_YANG" pouType="function">
        <interface>
          <returnType>
            <REAL />
          </returnType>
          <inputVars>
            <variable name="A">
              <type>
                <derived name="Vector_3" />
              </type>
            </variable>
          </inputVars>
          <localVars>
            <variable name="la">
              <type>
                <REAL />
              </type>
            </variable>
          </localVars>
        </interface>
        <body>
          <ST>
            la := V3_ABS(a);
IF la &gt; 0.0 THEN
	V3_YANG := ACOS(A.Y / la);
END_IF;

(* revision history
hm	11 dec 2007	rev 1.0
	original version

hm	10. mar. 2009	rev 1.1
	changed syntax of real constants to 0.0

*)
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>d1467871-485a-4e06-afa1-10aa0f725bf1</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="V3_ZANG" pouType="function">
        <interface>
          <returnType>
            <REAL />
          </returnType>
          <inputVars>
            <variable name="A">
              <type>
                <derived name="Vector_3" />
              </type>
            </variable>
          </inputVars>
          <localVars>
            <variable name="la">
              <type>
                <REAL />
              </type>
            </variable>
          </localVars>
        </interface>
        <body>
          <ST>
            la := V3_ABS(a);
IF la &gt; 0.0 THEN
	V3_ZANG := ACOS(A.Z / la);
END_IF;

(* revision history
hm	11 dec 2007	rev 1.0
	original version

hm	10. mar. 2009	rev 1.1
	changed syntax of real constants to 0.0

*)
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>2cb12a03-5e1b-49a4-a7d3-a1b4c34319b2</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="WINDOW" pouType="function">
        <interface>
          <returnType>
            <BOOL />
          </returnType>
          <inputVars>
            <variable name="low">
              <type>
                <REAL />
              </type>
            </variable>
            <variable name="in">
              <type>
                <REAL />
              </type>
            </variable>
            <variable name="high">
              <type>
                <REAL />
              </type>
            </variable>
          </inputVars>
        </interface>
        <body>
          <ST>
            WINDOW := in &lt; high AND in &gt; low;


(* revision history
hm	22.1.2007	rev 1.1
	changed the order of inputs to low, in, high

*)
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>da72f86f-0abd-4023-ace9-3b3bdff6a5f8</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="WINDOW2" pouType="function">
        <interface>
          <returnType>
            <BOOL />
          </returnType>
          <inputVars>
            <variable name="LOW">
              <type>
                <REAL />
              </type>
            </variable>
            <variable name="IN">
              <type>
                <REAL />
              </type>
            </variable>
            <variable name="HIGH">
              <type>
                <REAL />
              </type>
            </variable>
          </inputVars>
        </interface>
        <body>
          <ST>
            WINDOW2 := IN &gt;= LOW AND IN &lt;= HIGH;


(* revision history
hm	31.10.2007	rev 1.0
	original version

*)
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>d419f4d8-f907-4965-9f78-42576132ca4d</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="ESR_COLLECT" pouType="functionBlock">
        <interface>
          <inputVars>
            <variable name="ESR_0">
              <type>
                <array>
                  <dimension lower="0" upper="3" />
                  <baseType>
                    <derived name="esr_data" />
                  </baseType>
                </array>
              </type>
            </variable>
            <variable name="ESR_1">
              <type>
                <array>
                  <dimension lower="0" upper="3" />
                  <baseType>
                    <derived name="esr_data" />
                  </baseType>
                </array>
              </type>
            </variable>
            <variable name="ESR_2">
              <type>
                <array>
                  <dimension lower="0" upper="3" />
                  <baseType>
                    <derived name="esr_data" />
                  </baseType>
                </array>
              </type>
            </variable>
            <variable name="ESR_3">
              <type>
                <array>
                  <dimension lower="0" upper="3" />
                  <baseType>
                    <derived name="esr_data" />
                  </baseType>
                </array>
              </type>
            </variable>
            <variable name="ESR_4">
              <type>
                <array>
                  <dimension lower="0" upper="3" />
                  <baseType>
                    <derived name="esr_data" />
                  </baseType>
                </array>
              </type>
            </variable>
            <variable name="ESR_5">
              <type>
                <array>
                  <dimension lower="0" upper="3" />
                  <baseType>
                    <derived name="esr_data" />
                  </baseType>
                </array>
              </type>
            </variable>
            <variable name="ESR_6">
              <type>
                <array>
                  <dimension lower="0" upper="3" />
                  <baseType>
                    <derived name="esr_data" />
                  </baseType>
                </array>
              </type>
            </variable>
            <variable name="ESR_7">
              <type>
                <array>
                  <dimension lower="0" upper="3" />
                  <baseType>
                    <derived name="esr_data" />
                  </baseType>
                </array>
              </type>
            </variable>
            <variable name="rst">
              <type>
                <BOOL />
              </type>
            </variable>
          </inputVars>
          <inOutVars>
            <variable name="pos">
              <type>
                <INT />
              </type>
            </variable>
          </inOutVars>
          <outputVars>
            <variable name="ESR_OUT">
              <type>
                <array>
                  <dimension lower="0" upper="31" />
                  <baseType>
                    <derived name="esr_data" />
                  </baseType>
                </array>
              </type>
            </variable>
          </outputVars>
          <localVars constant="true">
            <variable name="max_in">
              <type>
                <INT />
              </type>
              <initialValue>
                <simpleValue value="3" />
              </initialValue>
              <documentation>
                 max limit of input array 
              </documentation>
            </variable>
            <variable name="max_out">
              <type>
                <INT />
              </type>
              <initialValue>
                <simpleValue value="32" />
              </initialValue>
              <documentation>
                 number of elements in array 
              </documentation>
            </variable>
          </localVars>
          <localVars>
            <variable name="cnt">
              <type>
                <INT />
              </type>
              <initialValue>
                <simpleValue value="-1" />
              </initialValue>
            </variable>
          </localVars>
        </interface>
        <body>
          <ST>
            IF rst OR cnt &lt; 0 THEN
	pos := -1;
ELSE
	FOR cnt := 0 TO max_in DO
	IF esr_0[cnt].typ &gt; 0 THEN pos := INC1(pos, max_out); esr_out[pos] := esr_0[cnt]; END_IF;
	IF esr_1[cnt].typ &gt; 0 THEN pos := INC1(pos, max_out); esr_out[pos] := esr_1[cnt]; END_IF;
	IF esr_2[cnt].typ &gt; 0 THEN pos := INC1(pos, max_out); esr_out[pos] := esr_2[cnt]; END_IF;
	IF esr_3[cnt].typ &gt; 0 THEN pos := INC1(pos, max_out); esr_out[pos] := esr_3[cnt]; END_IF;
	IF esr_4[cnt].typ &gt; 0 THEN pos := INC1(pos, max_out); esr_out[pos] := esr_4[cnt]; END_IF;
	IF esr_5[cnt].typ &gt; 0 THEN pos := INC1(pos, max_out); esr_out[pos] := esr_5[cnt]; END_IF;
	IF esr_6[cnt].typ &gt; 0 THEN pos := INC1(pos, max_out); esr_out[pos] := esr_6[cnt]; END_IF;
	IF esr_7[cnt].typ &gt; 0 THEN pos := INC1(pos, max_out); esr_out[pos] := esr_7[cnt]; END_IF;
   END_FOR;
END_IF;


(* revision history
hm	26.jan 2007	rev 1.0
	original version

hm	8. dec 2007	rev 1.1
	added reset input

ks	27. oct. 2008	rev 1.2
	optimized code for performance

ks	12. nov. 2009	rev 1.3
	output pos was not pointing to last value	

hm	1. dec. 2009	rev 1.4
	changed pos to be I/O
	reduced output array size to 32 elements
*)
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>d09c19f4-726a-4f35-8feb-6346db99e620</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="ESR_MON_B8" pouType="functionBlock">
        <interface>
          <inputVars>
            <variable name="s0">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="s1">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="s2">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="s3">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="s4">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="s5">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="s6">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="s7">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="DT_in">
              <type>
                <DT />
              </type>
            </variable>
            <variable name="a0">
              <type>
                <string length="10" />
              </type>
              <addData>
                <data name="http://www.3s-software.com/plcopenxml/attributes" handleUnknown="implementation">
                  <Attributes>
                    <Attribute Name="input_constant" Value="" />
                  </Attributes>
                </data>
              </addData>
            </variable>
            <variable name="a1">
              <type>
                <string length="10" />
              </type>
              <addData>
                <data name="http://www.3s-software.com/plcopenxml/attributes" handleUnknown="implementation">
                  <Attributes>
                    <Attribute Name="input_constant" Value="" />
                  </Attributes>
                </data>
              </addData>
            </variable>
            <variable name="a2">
              <type>
                <string length="10" />
              </type>
              <addData>
                <data name="http://www.3s-software.com/plcopenxml/attributes" handleUnknown="implementation">
                  <Attributes>
                    <Attribute Name="input_constant" Value="" />
                  </Attributes>
                </data>
              </addData>
            </variable>
            <variable name="a3">
              <type>
                <string length="10" />
              </type>
              <addData>
                <data name="http://www.3s-software.com/plcopenxml/attributes" handleUnknown="implementation">
                  <Attributes>
                    <Attribute Name="input_constant" Value="" />
                  </Attributes>
                </data>
              </addData>
            </variable>
            <variable name="a4">
              <type>
                <string length="10" />
              </type>
              <addData>
                <data name="http://www.3s-software.com/plcopenxml/attributes" handleUnknown="implementation">
                  <Attributes>
                    <Attribute Name="input_constant" Value="" />
                  </Attributes>
                </data>
              </addData>
            </variable>
            <variable name="a5">
              <type>
                <string length="10" />
              </type>
              <addData>
                <data name="http://www.3s-software.com/plcopenxml/attributes" handleUnknown="implementation">
                  <Attributes>
                    <Attribute Name="input_constant" Value="" />
                  </Attributes>
                </data>
              </addData>
            </variable>
            <variable name="a6">
              <type>
                <string length="10" />
              </type>
              <addData>
                <data name="http://www.3s-software.com/plcopenxml/attributes" handleUnknown="implementation">
                  <Attributes>
                    <Attribute Name="input_constant" Value="" />
                  </Attributes>
                </data>
              </addData>
            </variable>
            <variable name="a7">
              <type>
                <string length="10" />
              </type>
              <addData>
                <data name="http://www.3s-software.com/plcopenxml/attributes" handleUnknown="implementation">
                  <Attributes>
                    <Attribute Name="input_constant" Value="" />
                  </Attributes>
                </data>
              </addData>
            </variable>
          </inputVars>
          <outputVars>
            <variable name="ESR_Flag">
              <type>
                <BOOL />
              </type>
            </variable>
          </outputVars>
          <inOutVars>
            <variable name="ESR_Out">
              <type>
                <array>
                  <dimension lower="0" upper="3" />
                  <baseType>
                    <derived name="esr_data" />
                  </baseType>
                </array>
              </type>
            </variable>
          </inOutVars>
          <localVars>
            <variable name="x0">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="x1">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="x2">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="x3">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="x4">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="x5">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="x6">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="x7">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="tx">
              <type>
                <TIME />
              </type>
            </variable>
            <variable name="cnt">
              <type>
                <INT />
              </type>
            </variable>
          </localVars>
        </interface>
        <body>
          <ST>
            (* read system timer *)
tx := DWORD_TO_TIME(T_PLC_MS());

ESR_Flag := FALSE;
esr_out[3].typ := 0;
esr_out[2].typ := 0;
esr_out[1].typ := 0;
esr_out[0].typ := 0;
cnt := 0;


(* check if inputs have chaged and fill buffer *)
IF s0 &lt;&gt; X0 THEN
	esr_out[cnt].typ := 10 + BOOL_TO_BYTE(s0);
	esr_out[cnt].adress := a0;
	esr_out[cnt].DS := DT_in;
	esr_out[cnt].TS := TX;
	X0 := S0;
	cnt := cnt + 1;
	esr_flag := TRUE;
END_IF;
IF s1 &lt;&gt; X1 THEN
	esr_out[cnt].typ := 10 + BOOL_TO_BYTE(s1);
	esr_out[cnt].adress := a1;
	esr_out[cnt].DS := DT_in;
	esr_out[cnt].TS := TX;
	X1 := S1;
	cnt := cnt + 1;
	esr_flag := TRUE;
END_IF;
IF s2 &lt;&gt; X2 THEN
	esr_out[cnt].typ := 10 + BOOL_TO_BYTE(s2);
	esr_out[cnt].adress := a2;
	esr_out[cnt].DS := DT_in;
	esr_out[cnt].TS := TX;
	X2 := S2;
	cnt := cnt + 1;
	esr_flag := TRUE;
END_IF;
IF s3 &lt;&gt; X3 THEN
	esr_out[cnt].typ := 10 + BOOL_TO_BYTE(s3);
	esr_out[cnt].adress := a3;
	esr_out[cnt].DS := DT_in;
	esr_out[cnt].TS := TX;
	X3 := S3;
	cnt := cnt + 1;
	esr_flag := TRUE;
END_IF;
IF s4 &lt;&gt; X4 AND cnt &lt; 4 THEN
	esr_out[cnt].typ := 10 + BOOL_TO_BYTE(s4);
	esr_out[cnt].adress := a4;
	esr_out[cnt].DS := DT_in;
	esr_out[cnt].TS := TX;
	X4 := S4;
	cnt := cnt + 1;
	esr_flag := TRUE;
END_IF;
IF s5 &lt;&gt; X5  AND cnt &lt; 4 THEN
	esr_out[cnt].typ := 10 + BOOL_TO_BYTE(s5);
	esr_out[cnt].adress := a5;
	esr_out[cnt].DS := DT_in;
	esr_out[cnt].TS := TX;
	X5 := S5;
	cnt := cnt + 1;
	esr_flag := TRUE;
END_IF;
IF s6 &lt;&gt; X6  AND cnt &lt; 4 THEN
	esr_out[cnt].typ := 10 + BOOL_TO_BYTE(s6);
	esr_out[cnt].adress := a6;
	esr_out[cnt].DS := DT_in;
	esr_out[cnt].TS := TX;
	X6 := S6;
	cnt := cnt + 1;
	esr_flag := TRUE;
END_IF;
IF s7 &lt;&gt; X7  AND cnt &lt; 4 THEN
	esr_out[cnt].typ := 10 + BOOL_TO_BYTE(s7);
	esr_out[cnt].adress := a7;
	esr_out[cnt].DS := DT_in;
	esr_out[cnt].TS := TX;
	X7 := S7;
	cnt := cnt + 1;
	esr_flag := TRUE;
END_IF;

(* revision history
hm	26. jan 2007	rev 1.0
	original version

hm	17. sep 2007	rev 1.1
	replaced time() with T_PLC_MS() for compatibility reasons

hm	22. oct. 2008	rev 1.2
	optimized code

hm	1.dec. 2009	rev 1.3
	changed esr_out to be I/O

*)
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>667c79af-abc7-4530-bc7e-575e8a938aef</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="ESR_MON_R4" pouType="functionBlock">
        <interface>
          <inputVars>
            <variable name="R0">
              <type>
                <REAL />
              </type>
            </variable>
            <variable name="R1">
              <type>
                <REAL />
              </type>
            </variable>
            <variable name="R2">
              <type>
                <REAL />
              </type>
            </variable>
            <variable name="R3">
              <type>
                <REAL />
              </type>
            </variable>
            <variable name="DT_in">
              <type>
                <DT />
              </type>
            </variable>
            <variable name="a0">
              <type>
                <string length="10" />
              </type>
              <addData>
                <data name="http://www.3s-software.com/plcopenxml/attributes" handleUnknown="implementation">
                  <Attributes>
                    <Attribute Name="input_constant" Value="" />
                  </Attributes>
                </data>
              </addData>
            </variable>
            <variable name="a1">
              <type>
                <string length="10" />
              </type>
              <addData>
                <data name="http://www.3s-software.com/plcopenxml/attributes" handleUnknown="implementation">
                  <Attributes>
                    <Attribute Name="input_constant" Value="" />
                  </Attributes>
                </data>
              </addData>
            </variable>
            <variable name="a2">
              <type>
                <string length="10" />
              </type>
              <addData>
                <data name="http://www.3s-software.com/plcopenxml/attributes" handleUnknown="implementation">
                  <Attributes>
                    <Attribute Name="input_constant" Value="" />
                  </Attributes>
                </data>
              </addData>
            </variable>
            <variable name="a3">
              <type>
                <string length="10" />
              </type>
              <addData>
                <data name="http://www.3s-software.com/plcopenxml/attributes" handleUnknown="implementation">
                  <Attributes>
                    <Attribute Name="input_constant" Value="" />
                  </Attributes>
                </data>
              </addData>
            </variable>
            <variable name="s0">
              <type>
                <REAL />
              </type>
              <addData>
                <data name="http://www.3s-software.com/plcopenxml/attributes" handleUnknown="implementation">
                  <Attributes>
                    <Attribute Name="input_constant" Value="" />
                  </Attributes>
                </data>
              </addData>
            </variable>
            <variable name="s1">
              <type>
                <REAL />
              </type>
              <addData>
                <data name="http://www.3s-software.com/plcopenxml/attributes" handleUnknown="implementation">
                  <Attributes>
                    <Attribute Name="input_constant" Value="" />
                  </Attributes>
                </data>
              </addData>
            </variable>
            <variable name="s2">
              <type>
                <REAL />
              </type>
              <addData>
                <data name="http://www.3s-software.com/plcopenxml/attributes" handleUnknown="implementation">
                  <Attributes>
                    <Attribute Name="input_constant" Value="" />
                  </Attributes>
                </data>
              </addData>
            </variable>
            <variable name="s3">
              <type>
                <REAL />
              </type>
              <addData>
                <data name="http://www.3s-software.com/plcopenxml/attributes" handleUnknown="implementation">
                  <Attributes>
                    <Attribute Name="input_constant" Value="" />
                  </Attributes>
                </data>
              </addData>
            </variable>
          </inputVars>
          <outputVars>
            <variable name="ESR_Flag">
              <type>
                <BOOL />
              </type>
            </variable>
          </outputVars>
          <inOutVars>
            <variable name="ESR_Out">
              <type>
                <array>
                  <dimension lower="0" upper="3" />
                  <baseType>
                    <derived name="esr_data" />
                  </baseType>
                </array>
              </type>
            </variable>
          </inOutVars>
          <localVars>
            <variable name="p0">
              <type>
                <pointer>
                  <baseType>
                    <DWORD />
                  </baseType>
                </pointer>
              </type>
            </variable>
            <variable name="p1">
              <type>
                <pointer>
                  <baseType>
                    <DWORD />
                  </baseType>
                </pointer>
              </type>
            </variable>
            <variable name="p2">
              <type>
                <pointer>
                  <baseType>
                    <DWORD />
                  </baseType>
                </pointer>
              </type>
            </variable>
            <variable name="p3">
              <type>
                <pointer>
                  <baseType>
                    <DWORD />
                  </baseType>
                </pointer>
              </type>
            </variable>
            <variable name="x0">
              <type>
                <REAL />
              </type>
            </variable>
            <variable name="x1">
              <type>
                <REAL />
              </type>
            </variable>
            <variable name="x2">
              <type>
                <REAL />
              </type>
            </variable>
            <variable name="x3">
              <type>
                <REAL />
              </type>
            </variable>
            <variable name="tx">
              <type>
                <TIME />
              </type>
            </variable>
            <variable name="cnt">
              <type>
                <INT />
              </type>
            </variable>
          </localVars>
        </interface>
        <body>
          <ST>
            (* read system timer *)
tx := DWORD_TO_TIME(T_PLC_MS());
P0 := ADR(R0);
P1 := ADR(R1);
P2 := ADR(R2);
P3 := ADR(R3);

ESR_Flag := FALSE;
esr_out[3].typ := 0;
esr_out[2].typ := 0;
esr_out[1].typ := 0;
esr_out[0].typ := 0;
cnt := 0;

(* check if inputs have chaged and fill buffer *)
IF DIFFER(R0,  X0, S0) THEN
	esr_out[cnt].typ := 20;
	esr_out[cnt].adress := a0;
	esr_out[cnt].DS := DT_in;
	esr_out[cnt].TS := TX;
	esr_out[cnt].data[0] := Byte_of_Dword(P0^,0);
	esr_out[cnt].data[1] := Byte_of_Dword(P0^,1);
	esr_out[cnt].data[2] := Byte_of_Dword(P0^,2);
	esr_out[cnt].data[3] := Byte_of_Dword(P0^,3);
	X0 := R0;
	cnt := cnt + 1;
	esr_flag := TRUE;
END_IF;
IF differ(R1,  X1, S1) THEN
	esr_out[cnt].typ := 20;
	esr_out[cnt].adress := a1;
	esr_out[cnt].DS := DT_in;
	esr_out[cnt].TS := TX;
	esr_out[cnt].data[0] := Byte_of_Dword(P1^,0);
	esr_out[cnt].data[1] := Byte_of_Dword(P1^,1);
	esr_out[cnt].data[2] := Byte_of_Dword(P1^,2);
	esr_out[cnt].data[3] := Byte_of_Dword(P1^,3);
	X1 := R1;
	cnt := cnt + 1;
	esr_flag := TRUE;
END_IF;
IF differ(R2,  X2, S2) THEN
	esr_out[cnt].typ := 20;
	esr_out[cnt].adress := a2;
	esr_out[cnt].DS := DT_in;
	esr_out[cnt].TS := TX;
	esr_out[cnt].data[0] := Byte_of_Dword(P2^,0);
	esr_out[cnt].data[1] := Byte_of_Dword(P2^,1);
	esr_out[cnt].data[2] := Byte_of_Dword(P2^,2);
	esr_out[cnt].data[3] := Byte_of_Dword(P2^,3);
	X2 := R2;
	cnt := cnt + 1;
	esr_flag := TRUE;
END_IF;
IF DIFFER(R3,  X3, S3) THEN
	esr_out[cnt].typ := 20;
	esr_out[cnt].adress := a3;
	esr_out[cnt].DS := DT_in;
	esr_out[cnt].TS := TX;
	esr_out[cnt].data[0] := Byte_of_Dword(P3^,0);
	esr_out[cnt].data[1] := Byte_of_Dword(P3^,1);
	esr_out[cnt].data[2] := Byte_of_Dword(P3^,2);
	esr_out[cnt].data[3] := Byte_of_Dword(P3^,3);
	X3 := R3;
	cnt := cnt + 1;
	esr_flag := TRUE;
END_IF;


(* revision history
hm	26. jan 2007	rev 1.0
	original version

hm	17. sep. 2007		rev 1.1
	replaced time() with T_PLC_MS() for compatibility reasons

hm	8. dec. 2007		rev 1.2
	corrected an error while esr typ would not be set

hm	16. mar. 2008		rev 1.3
	deleted wrong conversion real_to_dword

hm	1. dec 2009		rev 1.4
	changed esr_out to be I/O

*)

          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>6abb2378-ebd3-4b17-83fd-5574c279d6de</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="ESR_MON_X8" pouType="functionBlock">
        <interface>
          <inputVars>
            <variable name="s0">
              <type>
                <BYTE />
              </type>
            </variable>
            <variable name="s1">
              <type>
                <BYTE />
              </type>
            </variable>
            <variable name="s2">
              <type>
                <BYTE />
              </type>
            </variable>
            <variable name="s3">
              <type>
                <BYTE />
              </type>
            </variable>
            <variable name="s4">
              <type>
                <BYTE />
              </type>
            </variable>
            <variable name="s5">
              <type>
                <BYTE />
              </type>
            </variable>
            <variable name="s6">
              <type>
                <BYTE />
              </type>
            </variable>
            <variable name="s7">
              <type>
                <BYTE />
              </type>
            </variable>
            <variable name="DT_in">
              <type>
                <DT />
              </type>
            </variable>
            <variable name="Mode">
              <type>
                <BYTE />
              </type>
              <initialValue>
                <simpleValue value="3" />
              </initialValue>
            </variable>
            <variable name="a0">
              <type>
                <string length="10" />
              </type>
              <addData>
                <data name="http://www.3s-software.com/plcopenxml/attributes" handleUnknown="implementation">
                  <Attributes>
                    <Attribute Name="input_constant" Value="" />
                  </Attributes>
                </data>
              </addData>
            </variable>
            <variable name="a1">
              <type>
                <string length="10" />
              </type>
              <addData>
                <data name="http://www.3s-software.com/plcopenxml/attributes" handleUnknown="implementation">
                  <Attributes>
                    <Attribute Name="input_constant" Value="" />
                  </Attributes>
                </data>
              </addData>
            </variable>
            <variable name="a2">
              <type>
                <string length="10" />
              </type>
              <addData>
                <data name="http://www.3s-software.com/plcopenxml/attributes" handleUnknown="implementation">
                  <Attributes>
                    <Attribute Name="input_constant" Value="" />
                  </Attributes>
                </data>
              </addData>
            </variable>
            <variable name="a3">
              <type>
                <string length="10" />
              </type>
              <addData>
                <data name="http://www.3s-software.com/plcopenxml/attributes" handleUnknown="implementation">
                  <Attributes>
                    <Attribute Name="input_constant" Value="" />
                  </Attributes>
                </data>
              </addData>
            </variable>
            <variable name="a4">
              <type>
                <string length="10" />
              </type>
              <addData>
                <data name="http://www.3s-software.com/plcopenxml/attributes" handleUnknown="implementation">
                  <Attributes>
                    <Attribute Name="input_constant" Value="" />
                  </Attributes>
                </data>
              </addData>
            </variable>
            <variable name="a5">
              <type>
                <string length="10" />
              </type>
              <addData>
                <data name="http://www.3s-software.com/plcopenxml/attributes" handleUnknown="implementation">
                  <Attributes>
                    <Attribute Name="input_constant" Value="" />
                  </Attributes>
                </data>
              </addData>
            </variable>
            <variable name="a6">
              <type>
                <string length="10" />
              </type>
              <addData>
                <data name="http://www.3s-software.com/plcopenxml/attributes" handleUnknown="implementation">
                  <Attributes>
                    <Attribute Name="input_constant" Value="" />
                  </Attributes>
                </data>
              </addData>
            </variable>
            <variable name="a7">
              <type>
                <string length="10" />
              </type>
              <addData>
                <data name="http://www.3s-software.com/plcopenxml/attributes" handleUnknown="implementation">
                  <Attributes>
                    <Attribute Name="input_constant" Value="" />
                  </Attributes>
                </data>
              </addData>
            </variable>
          </inputVars>
          <outputVars>
            <variable name="ESR_Flag">
              <type>
                <BOOL />
              </type>
            </variable>
          </outputVars>
          <inOutVars>
            <variable name="ESR_Out">
              <type>
                <array>
                  <dimension lower="0" upper="3" />
                  <baseType>
                    <derived name="esr_data" />
                  </baseType>
                </array>
              </type>
            </variable>
          </inOutVars>
          <localVars>
            <variable name="x0">
              <type>
                <BYTE />
              </type>
            </variable>
            <variable name="x1">
              <type>
                <BYTE />
              </type>
            </variable>
            <variable name="x2">
              <type>
                <BYTE />
              </type>
            </variable>
            <variable name="x3">
              <type>
                <BYTE />
              </type>
            </variable>
            <variable name="x4">
              <type>
                <BYTE />
              </type>
            </variable>
            <variable name="x5">
              <type>
                <BYTE />
              </type>
            </variable>
            <variable name="x6">
              <type>
                <BYTE />
              </type>
            </variable>
            <variable name="x7">
              <type>
                <BYTE />
              </type>
            </variable>
            <variable name="tx">
              <type>
                <TIME />
              </type>
            </variable>
            <variable name="cnt">
              <type>
                <INT />
              </type>
            </variable>
          </localVars>
        </interface>
        <body>
          <ST>
            (* read system timer *)
tx := DWORD_TO_TIME(T_PLC_MS());

ESR_Flag := FALSE;
esr_out[3].typ := 0;
esr_out[2].typ := 0;
esr_out[1].typ := 0;
esr_out[0].typ := 0;
cnt := 0;


(* check if inputs have chaged and fill buffer *)
IF s0 &lt;&gt; X0 AND ((s0 &lt; 100) OR (S0 &gt; 99 AND S0 &lt; 200 AND mode &gt;= 2) OR (S0 &gt; 199 AND mode = 3)) THEN
	esr_out[cnt] := status_to_ESR(s0, a0, DT_in, TX);
	X0 := S0;
	cnt := cnt + 1;
	esr_flag := TRUE;
END_IF;
IF s1 &lt;&gt; X1 AND ((s1 &lt; 100) OR (S1 &gt; 99 AND S1 &lt; 200 AND mode &gt;= 2) OR (S1 &gt; 199 AND mode = 3)) THEN
	esr_out[cnt] := status_to_ESR(s1, a1, DT_in, TX);
	X1 := S1;
	cnt := cnt + 1;
	esr_flag := TRUE;
END_IF;
IF s2 &lt;&gt; X2 AND ((s2 &lt; 100) OR (S2 &gt; 99 AND S2 &lt; 200 AND mode &gt;= 2) OR (S2 &gt; 199 AND mode = 3)) THEN
	esr_out[cnt] := status_to_ESR(s2, a2, DT_in, TX);
	X2 := S2;
	cnt := cnt + 1;
	esr_flag := TRUE;
END_IF;
IF s3 &lt;&gt; X3 AND ((s3 &lt; 100) OR (S3 &gt; 99 AND S3 &lt; 200 AND mode &gt;= 2) OR (S3 &gt; 199 AND mode = 3)) THEN
	esr_out[cnt] := status_to_ESR(s3, a3, DT_in, TX);
	X3 := S3;
	cnt := cnt + 1;
	esr_flag := TRUE;
END_IF;
IF cnt &lt; 4 AND s4 &lt;&gt; X4 AND ((s4 &lt; 100) OR (S4 &gt; 99 AND S4 &lt; 200 AND mode &gt;= 2) OR (S4 &gt; 199 AND mode = 3)) THEN
	esr_out[cnt] := status_to_ESR(s4, a4, DT_in, TX);
	X4 := S4;
	cnt := cnt + 1;
	esr_flag := TRUE;
END_IF;
IF cnt &lt; 4 AND s5 &lt;&gt; X5 AND ((s5 &lt; 100) OR (S5 &gt; 99 AND S5 &lt; 200 AND mode &gt;= 2) OR (S5 &gt; 199 AND mode = 3)) THEN
	esr_out[cnt] := status_to_ESR(s5, a5, DT_in, TX);
	X5 := S5;
	cnt := cnt + 1;
	esr_flag := TRUE;
END_IF;
IF cnt &lt; 4 AND s6 &lt;&gt; X6 AND ((s6 &lt; 100) OR (S6 &gt; 99 AND S6 &lt; 200 AND mode &gt;= 2) OR (S6 &gt; 199 AND mode = 3)) THEN
	esr_out[cnt] := status_to_ESR(s6, a6, DT_in, TX);
	X6 := S6;
	cnt := cnt + 1;
	esr_flag := TRUE;
END_IF;
IF cnt &lt; 4 AND s7 &lt;&gt; X7 AND ((s7 &lt; 100) OR (S7 &gt; 99 AND S7 &lt; 200 AND mode &gt;= 2) OR (S7 &gt; 199 AND mode = 3)) THEN
	esr_out[cnt] := status_to_ESR(s7, a7, DT_in, TX);
	X7 := S7;
	cnt := cnt + 1;
	esr_flag := TRUE;
END_IF;


(* revision history
hm	26. jan 2007		rev 1.0
	original version

hm	17. sep 2007	rev 1.1
	replaced time() with T_PLC_MS() for compatibility reasons

hm	1. dec. 2009	rev 1.2
	changed esr_out to be I/O


*)
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>1be201f8-977a-442f-91dd-2da8bfb83d29</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="OSCAT_VERSION" pouType="function">
        <interface>
          <returnType>
            <DWORD />
          </returnType>
          <inputVars>
            <variable name="IN">
              <type>
                <BOOL />
              </type>
            </variable>
          </inputVars>
        </interface>
        <body>
          <ST>
            IF in THEN
	OSCAT_VERSION := DATE_TO_DWORD(D#2024-07-16);
ELSE
	OSCAT_VERSION := 335;
END_IF;

(* revision history
hm	6. oct 2006	rev 1.0
	original version

hm	16. dec 2007	rev 1.1
	added possibility to return date and version depending on IN.

*)
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>89c9c858-25fc-487f-912f-5401b0b0770b</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="STATUS_TO_ESR" pouType="function">
        <interface>
          <returnType>
            <derived name="esr_data" />
          </returnType>
          <inputVars>
            <variable name="status">
              <type>
                <BYTE />
              </type>
            </variable>
            <variable name="adress">
              <type>
                <string length="10" />
              </type>
            </variable>
            <variable name="DT_in">
              <type>
                <DT />
              </type>
            </variable>
            <variable name="TS">
              <type>
                <TIME />
              </type>
            </variable>
          </inputVars>
        </interface>
        <body>
          <ST>
            IF status &lt; 100 THEN
	status_to_ESR.typ := 1;
ELSIF status &lt; 200 THEN
	status_to_ESR.typ := 2;
ELSE
	status_to_ESR.typ := 3;
END_IF;
status_to_ESR.adress:= adress;
status_to_ESR.DS := DT_in;
status_to_ESR.TS := TS;
status_to_ESR.data[0] := status;

          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>4589eab0-86ba-4d89-aa46-e3e608f30176</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="BIN_TO_BYTE" pouType="function">
        <interface>
          <returnType>
            <BYTE />
          </returnType>
          <inputVars>
            <variable name="BIN">
              <type>
                <string length="12" />
              </type>
            </variable>
          </inputVars>
          <localVars>
            <variable name="pt">
              <type>
                <pointer>
                  <baseType>
                    <BYTE />
                  </baseType>
                </pointer>
              </type>
            </variable>
            <variable name="i">
              <type>
                <INT />
              </type>
            </variable>
            <variable name="X">
              <type>
                <BYTE />
              </type>
            </variable>
            <variable name="stop">
              <type>
                <INT />
              </type>
            </variable>
          </localVars>
        </interface>
        <body>
          <ST>
            pt := ADR(bin);
stop := LEN(bin);
FOR I := 1 TO stop DO
	x := pt^;
	(* calculate the value of the digit *)
	IF X = 48 THEN
		BIN_TO_BYTE := SHL(BIN_TO_BYTE,1);
	ELSIF X = 49 THEN
		BIN_TO_BYTE := SHL(BIN_TO_BYTE,1) OR 1;
	END_IF;
	pt := pt + 1;
END_FOR;



(* revision histroy
hm	18. jun. 2008	rev 1.0
	original release

hm	20. sep. 2008	rev 1.1
	changed length of input string from 20 to 12

hm	26. jul. 2009	rev 1.2
	optimized code
*)	

          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>0aeb637b-bd72-470c-9dc7-0c14df888484</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="BIN_TO_DWORD" pouType="function">
        <interface>
          <returnType>
            <DWORD />
          </returnType>
          <inputVars>
            <variable name="BIN">
              <type>
                <string length="40" />
              </type>
            </variable>
          </inputVars>
          <localVars>
            <variable name="pt">
              <type>
                <pointer>
                  <baseType>
                    <BYTE />
                  </baseType>
                </pointer>
              </type>
            </variable>
            <variable name="i">
              <type>
                <INT />
              </type>
            </variable>
            <variable name="X">
              <type>
                <BYTE />
              </type>
            </variable>
            <variable name="stop">
              <type>
                <INT />
              </type>
            </variable>
          </localVars>
        </interface>
        <body>
          <ST>
            pt := ADR(bin);
stop := LEN(bin);
FOR I := 1 TO stop DO
	x := pt^;
	(* calculate the value of the digit *)
	IF X = 48 THEN
		BIN_TO_DWORD := SHL(BIN_TO_DWORD,1);
	ELSIF X = 49 THEN
		BIN_TO_DWORD := SHL(BIN_TO_DWORD,1) OR 1;
	END_IF;
	pt := pt + 1;
END_FOR;



(* revision histroy
hm	18. jun. 2008	rev 1.0
	original release

hm	20. sep. 2008	rev 1.1
	changed length of input dtring from 20 to 40

hm	26. jul 2009	rev 1.2
	optimized code
*)	

          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>9bab1c7d-6e9a-4b51-ab71-9d29399c0413</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="BYTE_TO_STRB" pouType="function">
        <interface>
          <returnType>
            <string length="8" />
          </returnType>
          <inputVars>
            <variable name="IN">
              <type>
                <BYTE />
              </type>
            </variable>
          </inputVars>
          <localVars>
            <variable name="i">
              <type>
                <INT />
              </type>
            </variable>
            <variable name="pt">
              <type>
                <pointer>
                  <baseType>
                    <BYTE />
                  </baseType>
                </pointer>
              </type>
            </variable>
          </localVars>
        </interface>
        <body>
          <ST>
            (* pointer für die ausgabe ermitteln *)
pt := ADR(BYTE_TO_STRB);
(* die 8 ausgabecharacter ermitteln und schreiben *)
FOR i := 1 TO 8 DO
	pt^ := BOOL_TO_BYTE(in.7) + 48;
	in := SHL(in,1);
	pt := pt + 1;
END_FOR;

(* der ausgabestring muss noch mit 0 abgeschlossen werden *)
pt^ := 0;

(* code before rev 1.1
FOR i := 1 TO 8 DO
	IF in.0 = 0 THEN temp := CONCAT('0', temp); ELSE temp := CONCAT('1', temp); END_IF;
	in := SHR(in, 1);
END_FOR;
BYTE_TO_STRB := temp;
*)


(* revision history

hm		9.6.2007	rev 1.0		
	original version 

hm	15. dec 2007	rev 1.1
	inprooved code for higher performance

hm	29. mar. 2008	rev 1.2
	changed STRING to STRING(8)

hm	20. jun. 2008	rev 1.3
	performance improvement

*)
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>10bd5ebc-c755-4c18-b820-47e4693a679a</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="BYTE_TO_STRH" pouType="function">
        <interface>
          <returnType>
            <string length="2" />
          </returnType>
          <inputVars>
            <variable name="IN">
              <type>
                <BYTE />
              </type>
            </variable>
          </inputVars>
          <localVars>
            <variable name="temp">
              <type>
                <BYTE />
              </type>
            </variable>
            <variable name="PT">
              <type>
                <pointer>
                  <baseType>
                    <BYTE />
                  </baseType>
                </pointer>
              </type>
            </variable>
          </localVars>
        </interface>
        <body>
          <ST>
            (* read pointer to output string *)
PT := ADR(BYTE_TO_STRH);
(* calculate high order hex value *)
temp := SHR(in,4);
(* convert value to hex character *)
IF temp &lt;= 9 THEN temp := temp + 48; ELSE temp := temp + 55; END_IF;
(* write friat character to output string *)
PT^ := temp;
(* calculate low order hex value *)
temp := in AND 2#00001111;
IF temp &lt;= 9 THEN temp := temp + 48; ELSE temp := temp + 55; END_IF;
(* increment pointer and wirte low order character *)
pt := pt + 1;
pt^ := temp;
(* set pointer at the end of the output string and close the string with 0 *)
pt := pt + 1;
pt^:= 0;


(* code before rev 1.2
FOR i := 1 TO 2 DO
	X := in AND 2#1111;
	IF X &lt;= 9 THEN X := X + 48; ELSE X := X + 55; END_IF;
	Cx := CHR(X);
	temp := CONCAT(Cx, temp);
	in := SHR(in,4);
END_FOR;
BYTE_TO_STRH := temp;
*)

(* revision history

hm	9.6.2007		rev 1.0		
	original version 

hm	11.9.2007		rev 1.1		
	changed coding for compatibility with twincat, under twincat concat cannot have a function as argument.	

hm	15 dec 2007		REV 1.2
	changed code for higher performance

hm	29. mar. 2008	rev 1.3
	changed STRING to STRING(2)
*)
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>54b18f65-ad1a-42f5-8eba-6a8b5e571b8a</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="CAPITALIZE" pouType="function">
        <interface>
          <returnType>
            <string length="STRING_LENGTH" />
          </returnType>
          <inputVars>
            <variable name="str">
              <type>
                <string length="STRING_LENGTH" />
              </type>
            </variable>
          </inputVars>
          <localVars>
            <variable name="PT">
              <type>
                <pointer>
                  <baseType>
                    <BYTE />
                  </baseType>
                </pointer>
              </type>
            </variable>
            <variable name="pos">
              <type>
                <INT />
              </type>
            </variable>
            <variable name="L">
              <type>
                <INT />
              </type>
            </variable>
            <variable name="first">
              <type>
                <BOOL />
              </type>
              <initialValue>
                <simpleValue value="TRUE" />
              </initialValue>
            </variable>
          </localVars>
        </interface>
        <body>
          <ST>
            PT := ADR(CAPITALIZE);
CAPITALIZE := str;
L := LEN(str);
FOR pos := 1 TO l DO
	IF first THEN pt^ := TO_UPPER(pt^);	END_IF;
	(* remember in first if the next char needs to capitalized *)
	first := pt^= 32;
	PT := pt + 1;
END_FOR;

(* revision histroy
hm		4. mar 2008	rev 1.0
	original release

hm	29. mar. 2008	rev 1.1
	changed STRING to STRING(STRING_LENGTH)

hm	20. jun. 2008	rev 1.2
	improved performance

*)	

          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>d0a9e979-4240-4a3a-9769-aafb4c30e365</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="CHARCODE" pouType="function">
        <interface>
          <returnType>
            <BYTE />
          </returnType>
          <inputVars>
            <variable name="STR">
              <type>
                <string length="10" />
              </type>
            </variable>
          </inputVars>
          <localVars>
            <variable name="found">
              <type>
                <string length="1" />
              </type>
            </variable>
            <variable name="search">
              <type>
                <string length="10" />
              </type>
            </variable>
            <variable name="pos">
              <type>
                <INT />
              </type>
            </variable>
            <variable name="i">
              <type>
                <INT />
              </type>
            </variable>
          </localVars>
        </interface>
        <body>
          <ST>
            IF LEN(str) = 1 THEN
	CHARCODE := CODE(STR, 1);
ELSIF str &lt;&gt; '' THEN
	(* construct search string *)
	search := CONCAT('&amp;', str);
	search := CONCAT(search, ';');
	WHILE pos = 0 AND (i &lt; 4) DO
		i := i + 1;
		pos := FIND(setup.CHARNAMES[i], search);
	END_WHILE;
	found := MID(setup.CHARNAMES[i], 1, pos - 1);
	CHARCODE := CODE(found, 1);
END_IF;




(* revision history
hm	13. may. 2008	rev 1.0
	original version

hm	19. oct. 2008	rev 1.1
	changed setup constants

hm	24. oct. 2008	rev 1.2
	optimized code
*)

          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>98c2e682-4b8d-494e-b744-a8d0d2b9d01c</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="CHARNAME" pouType="function">
        <interface>
          <returnType>
            <string length="10" />
          </returnType>
          <inputVars>
            <variable name="C">
              <type>
                <BYTE />
              </type>
            </variable>
          </inputVars>
          <localVars>
            <variable name="pos">
              <type>
                <INT />
              </type>
            </variable>
            <variable name="i">
              <type>
                <INT />
              </type>
            </variable>
          </localVars>
        </interface>
        <body>
          <ST>
            IF C &lt;&gt; 0 THEN
	(* construct search string from code followed by $ sign, also clear charname string*)
	CHARNAME := CHR_TO_STRING(C);
	CHARNAME := CONCAT(CHARNAME,'&amp;');
	CHARNAME := CONCAT(';', CHARNAME);
	WHILE pos = 0 AND (i &lt; 4) DO
		i := i + 1;
		pos := FIND(setup.CHARNAMES[i], CHARNAME);
	END_WHILE;
	IF pos &gt; 0 THEN
		CHARNAME := MID(setup.CHARNAMES[i], 10, pos + 3);
		(* search for end of name and truncate *)
		pos := FIND(CHARNAME, ';');
		CHARNAME := LEFT(CHARNAME,pos - 1);
	ELSE
		CHARNAME := CHR_TO_STRING(C);
	END_IF;
ELSE
	CHARNAME := '';
END_IF;




(* revision history
hm	13. may. 2008	rev 1.0
	original version

hm	16. jun. 2008	rev 1.1
	changed nested call of concat for better compatibility

hm	19. oct. 2008	rev 1.2
	changes setup constants

hm	24. oct. 2008	rev 1.3
	new code for high performance

hm	17. dec. 2008	rev 1.4
	changed function chr to chr_to_string
*)

          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>7d3673fd-3b48-448a-aec3-cf285eec2bac</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="CHR_TO_STRING" pouType="function">
        <interface>
          <returnType>
            <string length="1" />
          </returnType>
          <inputVars>
            <variable name="C">
              <type>
                <BYTE />
              </type>
            </variable>
          </inputVars>
          <localVars>
            <variable name="PT">
              <type>
                <pointer>
                  <baseType>
                    <BYTE />
                  </baseType>
                </pointer>
              </type>
            </variable>
          </localVars>
        </interface>
        <body>
          <ST>
            PT := ADR(CHR_TO_STRING);
PT^ := C;
pt := pt + 1;
pt^ := 0;

(* revision history
hm	16 jan 2007		rev 1.0
	original version

hm	4. feb. 2008	rev 1.1
	return string would not be terminated properly

hm	29. mar. 2008	rev 1.2
	changed STRING to STRING(1)

hm	17. dec. 2008	rev 1.3
	changed name of function from chr to chr_to_string
*)
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>5a217dfa-4a39-4866-8621-66e4bfcfdb4f</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="CLEAN" pouType="function">
        <interface>
          <returnType>
            <string length="STRING_LENGTH" />
          </returnType>
          <inputVars>
            <variable name="IN">
              <type>
                <string length="STRING_LENGTH" />
              </type>
            </variable>
            <variable name="CX">
              <type>
                <string length="80" />
              </type>
            </variable>
          </inputVars>
          <localVars>
            <variable name="pos">
              <type>
                <INT />
              </type>
              <initialValue>
                <simpleValue value="1" />
              </initialValue>
            </variable>
            <variable name="stop">
              <type>
                <INT />
              </type>
            </variable>
          </localVars>
        </interface>
        <body>
          <ST>
            (* copy input string *)
CLEAN := IN;
stop := LEN(in);
WHILE pos &lt;= stop DO
	IF FIND(cx, MID(CLEAN, 1, pos)) &gt; 0 THEN
		(* charcter found skip to next one *)
		pos := pos + 1;
	ELSE
		(* wrong chracter needs to be deleted *)
		CLEAN := DELETE(CLEAN, 1, pos);
		stop := stop - 1;	(* the string is one character shorter now *)
	END_IF;
END_WHILE;



(* revision history

hm		18. jun. 2008	rev 1.0		
	original version 


*)
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>165f501d-9266-4859-9d6c-96bfa750ea31</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="CODE" pouType="function">
        <interface>
          <returnType>
            <BYTE />
          </returnType>
          <inputVars>
            <variable name="STR">
              <type>
                <string length="STRING_LENGTH" />
              </type>
            </variable>
            <variable name="POS">
              <type>
                <INT />
              </type>
            </variable>
          </inputVars>
          <localVars>
            <variable name="PT">
              <type>
                <pointer>
                  <baseType>
                    <BYTE />
                  </baseType>
                </pointer>
              </type>
            </variable>
          </localVars>
        </interface>
        <body>
          <ST>
            IF pos &lt; 1 OR pos &gt; LEN(str) THEN
	CODE := 0;
	RETURN;
ELSE
	PT := ADR(STR) + INT_TO_DWORD(pos - 1);
	CODE := pt^;
END_IF;

(* revision history
hm	9. mar. 2008	rev 1.0
	original version

hm	29. mar. 2008	rev 1.1
	changed STRING to STRING(STRING_LENGTH)
*)
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>a3c696e6-cff9-4923-ae83-a20a97290f24</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="COUNT_CHAR" pouType="function">
        <interface>
          <returnType>
            <INT />
          </returnType>
          <inputVars>
            <variable name="str">
              <type>
                <string length="STRING_LENGTH" />
              </type>
            </variable>
            <variable name="chr">
              <type>
                <BYTE />
              </type>
            </variable>
          </inputVars>
          <localVars>
            <variable name="l">
              <type>
                <INT />
              </type>
            </variable>
            <variable name="pt">
              <type>
                <pointer>
                  <baseType>
                    <BYTE />
                  </baseType>
                </pointer>
              </type>
            </variable>
            <variable name="pos">
              <type>
                <INT />
              </type>
            </variable>
          </localVars>
        </interface>
        <body>
          <ST>
            PT := ADR(str);
l := LEN(str);
COUNT_CHAR := 0;
FOR pos := 1 TO l DO
	IF pt^ = CHR THEN COUNT_CHAR := COUNT_CHAR + 1; END_IF;
    PT := PT + 1;
END_FOR;


(* revision history
hm	29. feb 2008	rev 1.0
	original version

hm	29. mar. 2008	rev 1.1
	changed STRING to STRING(STRING_LENGTH)
*)
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>ac3a6ca1-6049-47c9-90f7-b2c590f05ca5</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="COUNT_SUBSTRING" pouType="function">
        <interface>
          <returnType>
            <INT />
          </returnType>
          <inputVars>
            <variable name="SEARCH">
              <type>
                <string />
              </type>
            </variable>
            <variable name="STR">
              <type>
                <string />
              </type>
            </variable>
          </inputVars>
          <localVars>
            <variable name="pos">
              <type>
                <INT />
              </type>
            </variable>
            <variable name="size">
              <type>
                <INT />
              </type>
            </variable>
          </localVars>
        </interface>
        <body>
          <ST>
            COUNT_SUBSTRING := 0;
size := LEN(SEARCH);
REPEAT
   pos := FIND(STR,SEARCH);
   IF pos &gt; 0 THEN
      STR := REPLACE(STR, '', size,pos);
      COUNT_SUBSTRING := COUNT_SUBSTRING + 1;
   END_IF;
UNTIL pos = 0
END_REPEAT;


(* revision history
ks	20. jan. 2011	rev 1.0
	original version

*)


          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>4d464d42-9cdb-405e-9cd6-f0d25221876a</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="DEC_TO_BYTE" pouType="function">
        <interface>
          <returnType>
            <BYTE />
          </returnType>
          <inputVars>
            <variable name="DEC">
              <type>
                <string length="10" />
              </type>
            </variable>
          </inputVars>
          <localVars>
            <variable name="pt">
              <type>
                <pointer>
                  <baseType>
                    <BYTE />
                  </baseType>
                </pointer>
              </type>
            </variable>
            <variable name="i">
              <type>
                <INT />
              </type>
            </variable>
            <variable name="X">
              <type>
                <BYTE />
              </type>
            </variable>
            <variable name="stop">
              <type>
                <INT />
              </type>
            </variable>
          </localVars>
        </interface>
        <body>
          <ST>
            pt := ADR(dec);
stop := LEN(DEC);
FOR I := 1 TO stop DO
	(* read the first character and subtract 48 to get value in decimal 0 = 48 *)
	x := pt^;
	(* calculate the value of the digit *)
	IF X &gt; 47 AND x &lt; 58 THEN
		DEC_TO_BYTE := DEC_TO_BYTE * 10 + X - 48;
	END_IF;
	pt := pt + 1;
END_FOR;



(* revision histroy
hm	20. jun. 2008	rev 1.0
	original release

hm	30. sep.2008	rev 1.1
	changed length of input string from 20 to 10
	corrected an error where decoding of characters 8 and 9 would fail

*)	

          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>2884ac5b-aef8-4f53-a07f-4ff079d4a7d6</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="DEC_TO_DWORD" pouType="function">
        <interface>
          <returnType>
            <DWORD />
          </returnType>
          <inputVars>
            <variable name="DEC">
              <type>
                <string length="20" />
              </type>
            </variable>
          </inputVars>
          <localVars>
            <variable name="pt">
              <type>
                <pointer>
                  <baseType>
                    <BYTE />
                  </baseType>
                </pointer>
              </type>
            </variable>
            <variable name="i">
              <type>
                <INT />
              </type>
            </variable>
            <variable name="X">
              <type>
                <BYTE />
              </type>
            </variable>
            <variable name="stop">
              <type>
                <INT />
              </type>
            </variable>
          </localVars>
        </interface>
        <body>
          <ST>
            pt := ADR(dec);
stop := LEN(dec);
FOR I := 1 TO stop DO
	(* read the first character and subtract 48 to get value in decimal 0 = 48 *)
	x := pt^;
	(* calculate the value of the digit *)
	IF X &gt; 47 AND x &lt; 58 THEN
		DEC_TO_DWORD := DEC_TO_DWORD * 10 + X - 48;
	END_IF;
	pt := pt + 1;
END_FOR;



(* revision histroy
hm	20. jun. 2008	rev 1.0
	original release

hm	30. sep. 2008	rev 1.1
	corrected an error where decoding of characters 8 and 9 would fail
*)	

          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>35cc7809-42ca-47fd-bf3e-f8c7f3425340</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="DEC_TO_INT" pouType="function">
        <interface>
          <returnType>
            <INT />
          </returnType>
          <inputVars>
            <variable name="DEC">
              <type>
                <string length="10" />
              </type>
            </variable>
          </inputVars>
          <localVars>
            <variable name="pt">
              <type>
                <pointer>
                  <baseType>
                    <BYTE />
                  </baseType>
                </pointer>
              </type>
            </variable>
            <variable name="i">
              <type>
                <INT />
              </type>
            </variable>
            <variable name="X">
              <type>
                <BYTE />
              </type>
            </variable>
            <variable name="sign">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="stop">
              <type>
                <INT />
              </type>
            </variable>
          </localVars>
        </interface>
        <body>
          <ST>
            pt := ADR(dec);
stop := LEN(dec);
FOR I := 1 TO stop DO
	(* read the first character and subtract 48 to get value in decimal 0 = 48 *)
	x := pt^;
	(* calculate the value of the digit *)
	IF X &gt; 47 AND x &lt; 58 THEN
		DEC_TO_INT := DEC_TO_INT * 10 + X - 48;
	ELSIF X = 45 AND DEC_TO_INT = 0 THEN
		sign := TRUE;
	END_IF;
	pt := pt + 1;
END_FOR;
IF sign THEN DEC_TO_INT := -DEC_TO_INT; END_IF;


(* revision histroy
hm	20. jun. 2008	rev 1.0
	original release

hm	30. sep. 2008	rev 1.1
	changed length of input string from 20 to 10
	corrected an error where decoding of characters 8 and 9 would fail
*)	

          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>c484631b-ee93-4e2f-83b5-5bce4bc766f0</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="DEL_CHARS" pouType="function">
        <interface>
          <returnType>
            <string length="STRING_LENGTH" />
          </returnType>
          <inputVars>
            <variable name="IN">
              <type>
                <string length="STRING_LENGTH" />
              </type>
            </variable>
            <variable name="CX">
              <type>
                <string length="80" />
              </type>
            </variable>
          </inputVars>
          <localVars>
            <variable name="pos">
              <type>
                <INT />
              </type>
              <initialValue>
                <simpleValue value="1" />
              </initialValue>
            </variable>
            <variable name="stop">
              <type>
                <INT />
              </type>
            </variable>
          </localVars>
        </interface>
        <body>
          <ST>
            (* copy input string *)
DEL_CHARS := IN;
stop := LEN(in);
WHILE pos &lt;= stop DO
	IF FIND(cx, MID(DEL_CHARS, 1, pos)) &gt; 0 THEN
		(* wrong chracter needs to be deleted *)
		DEL_CHARS := DELETE(DEL_CHARS, 1, pos);
		stop := stop - 1;	(* the string is one character shorter now *)
	ELSE
		(* charcter not found skip to next one *)
		pos := pos + 1;
	END_IF;
END_WHILE;



(* revision history

hm		18. jun. 2008	rev 1.0		
	original version 


*)
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>73d36776-7a3f-48c6-94b3-1e98d97760ef</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="DT_TO_STRF" pouType="function">
        <interface>
          <returnType>
            <string />
          </returnType>
          <inputVars>
            <variable name="DTI">
              <type>
                <DT />
              </type>
            </variable>
            <variable name="MS">
              <type>
                <INT />
              </type>
            </variable>
            <variable name="FMT">
              <type>
                <string />
              </type>
            </variable>
            <variable name="LANG">
              <type>
                <INT />
              </type>
            </variable>
          </inputVars>
          <localVars constant="true">
            <variable name="FILL">
              <type>
                <string length="1" />
              </type>
              <initialValue>
                <simpleValue value="'0'" />
              </initialValue>
            </variable>
            <variable name="BLANK">
              <type>
                <string length="1" />
              </type>
              <initialValue>
                <simpleValue value="' '" />
              </initialValue>
            </variable>
          </localVars>
          <localVars>
            <variable name="ly">
              <type>
                <INT />
              </type>
            </variable>
            <variable name="dx">
              <type>
                <DATE />
              </type>
            </variable>
            <variable name="fs">
              <type>
                <string length="10" />
              </type>
            </variable>
            <variable name="td">
              <type>
                <TOD />
              </type>
            </variable>
            <variable name="tmp">
              <type>
                <INT />
              </type>
            </variable>
            <variable name="pos">
              <type>
                <INT />
              </type>
            </variable>
            <variable name="f">
              <type>
                <INT />
              </type>
            </variable>
          </localVars>
        </interface>
        <body>
          <ST>
            IF LANG &lt; 1 THEN ly := language.DEFAULT; ELSE ly := MIN(language.LMAX, LANG); END_IF;

(* decode date and time information *)
dx := DT_TO_DATE(DTI);
td := DT_TO_TOD(DTI);

(* parse the format string *)
DT_TO_STRF := FMT;
pos := FIND(DT_TO_STRF, '#');
WHILE pos &gt; 0 DO
	(* retrieve format identifier *)
	f := CODE(DT_TO_STRF, pos + 1);
	(* generate the return string according to the format character *)
	fs := '';
	CASE f OF
		65 : (* letter A retunrs the year in 4 digits *)
			fs := INT_TO_STRING(YEAR_OF_DATE(dx));
		66 : (* letter B returns the year in exactly 2 digits *)
			fs := RIGHT(INT_TO_STRING(YEAR_OF_DATE(dx)),2);
		67 : (* letter C returns the month with 1 or 2 digits *)
			fs := INT_TO_STRING(MONTH_OF_DATE(dx));
		68 : (* letter D returns the month with exactly 2 digits *)
			fs := INT_TO_STRING(MONTH_OF_DATE(dx));
			IF LEN(fs) &lt; 2 THEN fs := CONCAT('0', fs); END_IF;
		69 : (* letter E returns the month with 3 characters *)
			fs := MONTH_TO_STRING(MONTH_OF_DATE(dx), ly, 3);
		70 : (* letter F returns the month with all characters *)
			fs := MONTH_TO_STRING(MONTH_OF_DATE(dx), ly, 0);
		71 : (* letter G returns the day with up to 2 digits *)
			fs := INT_TO_STRING(DAY_OF_MONTH(dx));
		72 : (* letter H returns the day of the month with exactly 2 digits *)
			fs := INT_TO_STRING(DAY_OF_MONTH(dx));
			IF LEN(fs) &lt; 2 THEN fs := CONCAT(FILL, fs); END_IF;
		73 : (* letter I returns the weekday as the number 1..7 1 = monday *)
			fs := INT_TO_STRING(DAY_OF_WEEK(dx));
		74 : (* letter J returns the weekday in 2 character writing *)
			fs := WEEKDAY_TO_STRING(DAY_OF_WEEK(dx), ly, 2);
		75 : (* letter K returns the weekday with all characters *)
			fs := WEEKDAY_TO_STRING(DAY_OF_WEEK(dx), ly, 0);
		76 : (* letter L returns AM or PM for the given DateTime *)
			IF td &gt;= TOD#12:00 THEN fs := 'PM'; ELSE fs := 'AM'; END_IF;
		77 : (* letter M returns the hour in 1 or 2 digit form 0..24h *)
			fs := INT_TO_STRING(HOUR(td));
		78 : (* letter N returns the hour in exactly 2 digit form 0..24h *)
			fs := INT_TO_STRING(HOUR(td));
			IF LEN(fs) &lt; 2 THEN fs := CONCAT(FILL, fs); END_IF;
		79 : (* letter O returns the hour in 1 or 2 digit form 0..12h *)
			tmp := HOUR(td) MOD 12;
			IF tmp = 0 THEN tmp := 12; END_IF;
			fs := INT_TO_STRING(tmp);
		80 : (* letter P returns the hour in exactly 2 digit form 0..12h *)
			tmp := HOUR(td) MOD 12;
			IF tmp = 0 THEN tmp := 12; END_IF;
			fs := INT_TO_STRING(tmp);
			IF LEN(fs) &lt; 2 THEN fs := CONCAT(FILL, fs); END_IF;
		81 : (* letter Q returns the minute of the hour in 1 or two digit form *)
			fs := INT_TO_STRING(MINUTE(td));
		82 : (* letter R returns the minute of the hour in exactly two digit form *)
			fs := INT_TO_STRING(MINUTE(td));
			IF LEN(fs) &lt; 2 THEN fs := CONCAT(FILL, fs); END_IF;
		83 : (* letter S returns the second of the minute in 1 or two digit form *)
			fs := INT_TO_STRING(REAL_TO_INT(SECOND(td)));
		84 : (* letter T returns the second of the minute in exactly two digit form *)
			fs := INT_TO_STRING(REAL_TO_INT(SECOND(td)));
			IF LEN(fs) &lt; 2 THEN fs := CONCAT(FILL, fs); END_IF;
		85 : (* letter U returns the milliseconds in 1 to 3 digits *)
			fs := INT_TO_STRING(MS);
		86 : (* letter V returns the milliseconds in exactly 3 digit form *)
			fs := INT_TO_STRING(MS);
			fs := CONCAT('00',fs);
			fs := RIGHT(fs, 3);
		87 : (* letter W returns the day of the month with exactly 2 digits first digit is filled with blank if necessary *)
			fs := INT_TO_STRING(DAY_OF_MONTH(dx));
			IF LEN(fs) &lt; 2 THEN fs := CONCAT(BLANK, fs); END_IF;
		88 : (* letter X returns the month with exactly 2 digits first digit is filled with blank if necessary *)
			fs := INT_TO_STRING(MONTH_OF_DATE(dx));
			IF LEN(fs) &lt; 2 THEN fs := CONCAT(BLANK, fs); END_IF;
		END_CASE;
	DT_TO_STRF := REPLACE(DT_TO_STRF, fs, 2, pos);
	pos := FIND(DT_TO_STRF, '#');
END_WHILE;


(* revision history
hm	7. oct. 2008	rev 1.0
	original version

hm	19. oct. 2008	rev 1.1
	changed language setup constants
*)

          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>37af227c-d3b7-43dd-90da-f542c6373191</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="DWORD_TO_STRB" pouType="function">
        <interface>
          <returnType>
            <string length="32" />
          </returnType>
          <inputVars>
            <variable name="IN">
              <type>
                <DWORD />
              </type>
            </variable>
          </inputVars>
          <localVars>
            <variable name="pt">
              <type>
                <pointer>
                  <baseType>
                    <BYTE />
                  </baseType>
                </pointer>
              </type>
            </variable>
            <variable name="i">
              <type>
                <INT />
              </type>
            </variable>
          </localVars>
        </interface>
        <body>
          <ST>
            (* pointer für die ausgabe ermitteln *)
pt := ADR(DWORD_TO_STRB);
(* die 8 ausgabecharacter ermitteln und schreiben *)
FOR i := 1 TO 32 DO
	pt^:= BOOL_TO_BYTE(in.31) + 48;
	in := SHL(in,1);
	pt := pt + 1;
END_FOR;

(* der ausgabestring muss nochg mit 0 abgeschlossen werden *)
pt^ := 0;

(* revision history
hm		9.6.2007	rev 1.0		
	original version

hm		15.dec 2007	rev 1.1
	changed code for better performance

hm	29. mar. 2008	rev 1.2
	changed STRING to STRING(32)

hm	20. jun. 2008	rev 1.3
	performance improvement

*)

          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>dcf3b769-e507-47be-ab00-affad03f59d5</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="DWORD_TO_STRF" pouType="function">
        <interface>
          <returnType>
            <string length="20" />
          </returnType>
          <inputVars>
            <variable name="IN">
              <type>
                <DWORD />
              </type>
            </variable>
            <variable name="N">
              <type>
                <INT />
              </type>
            </variable>
          </inputVars>
        </interface>
        <body>
          <ST>
            (* limit N to max 20 characters *)
(* convert dword to string first and cut to length N *)
DWORD_TO_STRF := FIX(DWORD_TO_STRING(in),LIMIT(0,N,20),48,1);


(* revision history
hm	26. jan.2007	rev 1.0		
	original version

hm	29. mar. 2008	rev 1.1
	changed STRING to STRING(20)
	limit the output string to max 20 digits
*)

          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>088627e1-001f-4548-8332-8dcf8d12e98d</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="DWORD_TO_STRH" pouType="function">
        <interface>
          <returnType>
            <string length="8" />
          </returnType>
          <inputVars>
            <variable name="IN">
              <type>
                <DWORD />
              </type>
            </variable>
          </inputVars>
          <localVars>
            <variable name="i">
              <type>
                <INT />
              </type>
            </variable>
            <variable name="temp">
              <type>
                <BYTE />
              </type>
            </variable>
            <variable name="pt">
              <type>
                <pointer>
                  <baseType>
                    <BYTE />
                  </baseType>
                </pointer>
              </type>
            </variable>
          </localVars>
        </interface>
        <body>
          <ST>
            (* read output adress to pointer *)
pt := ADR(DWORD_TO_STRH) + 8;
(* wirte the closing byte for the string *)
pt^:= 0;

(* write the 8 hex characters backwards *)
FOR i := 1 TO 8 DO;
	(* decrement the pointer *)
	pt := pt - 1;
	(* read the lowest order hex value *)
	temp := DWORD_TO_BYTE(in AND 16#0000000F);
	(* convert value to hex character *)
	IF temp &lt;= 9 THEN temp := temp + 48; ELSE temp := temp + 55; END_IF;
	(* write character to output string *)
	PT^ := temp;
	(* shift in for nect hex character *)
	in := SHR(in,4);
END_FOR;


(* code beofre rev 1.2
FOR i := 1 TO 8 DO
	X := DWORD_TO_BYTE(in AND 2#1111);
	IF X &lt;= 9 THEN X := X + 48; ELSE X := X + 55; END_IF;
	Cx := CHR(X);
	temp := CONCAT(Cx, temp);
	in := SHR(in,4);
END_FOR;
DWORD_TO_STRH := temp;
*)


(* revision history
hm	9. jun. 2007	rev 1.0		
	original version 

hm	11. sep. 2007	rev 1.1
	changed coding for compatibility with twincat, concat cannot support a function as an argument.

hm	15. dec. 2007	rev 1.2
	changed code for better performance

hm	29. mar. 2008	rev 1.3
	changed STRING to STRING(8)

*)

          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>a0b1fa56-5c60-4de3-ba6b-76ba28af34d2</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="EXEC" pouType="function">
        <interface>
          <returnType>
            <string length="STRING_LENGTH" />
          </returnType>
          <inputVars>
            <variable name="str">
              <type>
                <string length="STRING_LENGTH" />
              </type>
            </variable>
          </inputVars>
          <localVars>
            <variable name="pos">
              <type>
                <INT />
              </type>
            </variable>
            <variable name="R1">
              <type>
                <REAL />
              </type>
            </variable>
            <variable name="R2">
              <type>
                <REAL />
              </type>
            </variable>
            <variable name="operator">
              <type>
                <string length="10" />
              </type>
            </variable>
          </localVars>
        </interface>
        <body>
          <ST>
            (* extract both numbers and operator *)
EXEC := UPPERCASE(TRIM(str));

pos := FINDB_NONUM(EXEC);
IF pos &gt; 1 THEN R1 := STRING_TO_REAL(LEFT(EXEC,pos-1)); END_IF;
R2 := STRING_TO_REAL(RIGHT(EXEC,LEN(EXEC)-pos));
EXEC := LEFT(EXEC,pos);
pos := FINDB_NUM(EXEC);
operator := RIGHT(EXEC,LEN(EXEC) - pos);
IF operator = '' AND LEN(str) = 0 THEN
	EXEC := '';
	RETURN;
ELSIF operator = '' THEN
	EXEC := str;
	RETURN;
END_IF;
IF operator = '^' THEN
	EXEC := REAL_TO_STRING(EXPT(R1, R2));
ELSIF operator = 'SQRT' THEN
	EXEC := REAL_TO_STRING(SQRT(R2));
ELSIF operator = 'SIN' THEN
	EXEC := REAL_TO_STRING(SIN(r2));
ELSIF operator = 'COS' THEN
	EXEC := REAL_TO_STRING(COS(r2));
ELSIF operator = 'TAN' THEN
	EXEC := REAL_TO_STRING(TAN(R2));
ELSIF operator = '*' THEN
	EXEC := REAL_TO_STRING(R1 * R2);
ELSIF operator = '/' THEN
	IF R2 &lt;&gt; 0 THEN EXEC := REAL_TO_STRING(R1 / R2); ELSE EXEC := 'ERROR'; END_IF;
ELSIF operator = '+' THEN
	EXEC := REAL_TO_STRING(r1 + r2);
ELSIF operator = '-' THEN
	EXEC := REAL_TO_STRING(r1 - r2);
ELSE
	EXEC := 'ERROR';
END_IF;

IF EXEC = 'ERROR' THEN
	RETURN;
(* some systems deliver integer instead of real *)
ELSIF FIND(EXEC,'.') = 0 THEN
	EXEC := CONCAT(EXEC, '.0');
(* some systems deliver n. instead of n.0 ! *)
ELSIF RIGHT(EXEC,1) = '.' THEN
	EXEC := CONCAT(EXEC,'0');
END_IF;


(* revision history

hm 	6.feb 2007		rev 1.1
	cos has to be written in uppercase
	divide by 0 will return an error

hm	5. mar. 2008	rev 1.2
	add a 0 to the string if a '.' is at the end of the string

hm	20. mar. 2008	rev 1.3
	make sure the function always returns a real value in the form of x.y

hm	29. mar. 2008	rev 1.4
	changed STRING to STRING(STRING_LENGTH)
*)
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>4480688b-3728-493a-824c-e6bf8f1ddc27</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="FILL" pouType="function">
        <interface>
          <returnType>
            <string length="STRING_LENGTH" />
          </returnType>
          <inputVars>
            <variable name="C">
              <type>
                <BYTE />
              </type>
            </variable>
            <variable name="L">
              <type>
                <INT />
              </type>
            </variable>
          </inputVars>
          <localVars>
            <variable name="i">
              <type>
                <INT />
              </type>
            </variable>
            <variable name="sx">
              <type>
                <string length="1" />
              </type>
            </variable>
          </localVars>
        </interface>
        <body>
          <ST>
            Sx := CHR_TO_STRING(c);
(* limit L to maximum 80 characters the length of a standard string *)
L := LIMIT(0,L,STRING_LENGTH);
(* create a string of characters to be connected to str *)
FOR i := 1 TO 8 DO
	FILL := CONCAT(FILL,FILL);
	IF L.7 THEN FILL := CONCAT(FILL,Sx); END_IF;
	L := SHL(L,1);
END_FOR;




(* revision histroy
hm	29. mar. 2008	rev 1.0
	original release

hm	17. dec. 2008	rev 1.1
	changed function chr to chr_to_string

*)
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>4cbc0fd2-fe7e-42f0-a728-1f0668e2ceff</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="FIND_CHAR" pouType="function">
        <interface>
          <returnType>
            <INT />
          </returnType>
          <inputVars>
            <variable name="str">
              <type>
                <string length="STRING_LENGTH" />
              </type>
            </variable>
            <variable name="pos">
              <type>
                <INT />
              </type>
            </variable>
          </inputVars>
          <localVars>
            <variable name="i">
              <type>
                <INT />
              </type>
            </variable>
            <variable name="pt">
              <type>
                <pointer>
                  <baseType>
                    <array>
                      <dimension lower="1" upper="255" />
                      <baseType>
                        <BYTE />
                      </baseType>
                    </array>
                  </baseType>
                </pointer>
              </type>
            </variable>
            <variable name="stop">
              <type>
                <INT />
              </type>
            </variable>
            <variable name="X">
              <type>
                <BYTE />
              </type>
            </variable>
          </localVars>
        </interface>
        <body>
          <ST>
            pt := ADR(str);
stop := LEN(str);
FOR i := MAX(pos,1) TO stop DO;
	X := pt^[i];
	IF X &gt; 31 AND ((setup.EXTENDED_ASCII AND X &lt;&gt; 127) OR (NOT setup.EXTENDED_ASCII AND X &lt; 127)) THEN
		FIND_CHAR := i;
		RETURN;
	END_IF;
END_FOR;
FIND_CHAR := 0;


(* revision history
hm	29. feb 2008	rev 1.0
	original version

hm	26. mar. 2008	rev 1.1
	char will now accept extended ascii

hm	29. mar. 2008	rev 1.2
	changed STRING to STRING(STRING_LENGTH)

hm	21. oct. 2008	rev 1.3
	changes setup constants
	optimized code
*)


          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>a8b6aa06-1fb1-49b4-b0f6-56b091bfcc06</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="FIND_CTRL" pouType="function">
        <interface>
          <returnType>
            <INT />
          </returnType>
          <inputVars>
            <variable name="str">
              <type>
                <string length="STRING_LENGTH" />
              </type>
            </variable>
            <variable name="pos">
              <type>
                <INT />
              </type>
            </variable>
          </inputVars>
          <localVars>
            <variable name="i">
              <type>
                <INT />
              </type>
            </variable>
            <variable name="pt">
              <type>
                <pointer>
                  <baseType>
                    <array>
                      <dimension lower="1" upper="255" />
                      <baseType>
                        <BYTE />
                      </baseType>
                    </array>
                  </baseType>
                </pointer>
              </type>
            </variable>
            <variable name="stop">
              <type>
                <INT />
              </type>
            </variable>
            <variable name="x">
              <type>
                <BYTE />
              </type>
            </variable>
          </localVars>
        </interface>
        <body>
          <ST>
            pt := ADR(str);
stop := LEN(str);
FOR i := MAX(pos,1) TO stop DO;
	x := PT^[I];
	IF x &lt; 32 OR X = 127 THEN
		FIND_CTRL := i;
		RETURN;
	END_IF;
END_FOR;
FIND_CTRL := 0;


(* revision history
hm	29. feb 2008	rev 1.0
	original version

hm	26. mar. 2008	rev 1.1
	character 127 is now recognized as control

hm	29. mar. 2008	rev 1.2
	changed STRING to STRING(STRING_LENGTH)
*)
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>bf20f7ad-c6e6-4a42-bc0b-f0714a6d72a3</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="FIND_NONUM" pouType="function">
        <interface>
          <returnType>
            <INT />
          </returnType>
          <inputVars>
            <variable name="str">
              <type>
                <string length="STRING_LENGTH" />
              </type>
            </variable>
            <variable name="pos">
              <type>
                <INT />
              </type>
            </variable>
          </inputVars>
          <localVars>
            <variable name="i">
              <type>
                <INT />
              </type>
            </variable>
            <variable name="pt">
              <type>
                <pointer>
                  <baseType>
                    <array>
                      <dimension lower="1" upper="255" />
                      <baseType>
                        <BYTE />
                      </baseType>
                    </array>
                  </baseType>
                </pointer>
              </type>
            </variable>
            <variable name="end">
              <type>
                <INT />
              </type>
            </variable>
            <variable name="X">
              <type>
                <BYTE />
              </type>
            </variable>
          </localVars>
        </interface>
        <body>
          <ST>
            pt := ADR(str);
end := LEN(str);
FOR i := MAX(pos,1) TO end DO;
	X := pt^[i];
	IF (X &lt; 48 AND X &lt;&gt; 46) OR X &gt; 57 THEN
		FIND_NONUM := i;
		RETURN;
	END_IF;
END_FOR;
FIND_NONUM := 0;


(* revision history
hm	6. oct. 2006	rev 1.0
	original version

hm	29. feb 2008	rev 1.1
	added input pos to start search at position

hm	29. mar. 2008	rev 1.2
	changed STRING to STRING(STRING_LENGTH)

hm	21. oct. 2008	rev 1.3
	optimized code

*)
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>d4aad2e0-9975-4de3-a00a-0546b06bde58</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="FIND_NUM" pouType="function">
        <interface>
          <returnType>
            <INT />
          </returnType>
          <inputVars>
            <variable name="str">
              <type>
                <string length="STRING_LENGTH" />
              </type>
            </variable>
            <variable name="pos">
              <type>
                <INT />
              </type>
            </variable>
          </inputVars>
          <localVars>
            <variable name="i">
              <type>
                <INT />
              </type>
            </variable>
            <variable name="pt">
              <type>
                <pointer>
                  <baseType>
                    <array>
                      <dimension lower="1" upper="255" />
                      <baseType>
                        <BYTE />
                      </baseType>
                    </array>
                  </baseType>
                </pointer>
              </type>
            </variable>
            <variable name="stop">
              <type>
                <INT />
              </type>
            </variable>
            <variable name="X">
              <type>
                <BYTE />
              </type>
            </variable>
          </localVars>
        </interface>
        <body>
          <ST>
            pt := ADR(str);
stop := LEN(str);
FOR i := MAX(pos,1) TO stop DO;
	X := pt^[i];
	IF (X &gt; 47 AND X &lt; 58) OR X = 46 THEN
		FIND_NUM := i;
		RETURN;
	END_IF;
END_FOR;
FIND_NUM := 0;


(* revision history
hm	6. oct. 2006	rev 1.0
	original version

hm	29. feb 2008	rev 1.1
	added input pos to start search at position

hm	29. mar. 2008	rev 1.2
	changed STRING to STRING(STRING_LENGTH)

*)
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>60c17c7a-9280-4ce5-a586-4af5711fdb68</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="FINDB" pouType="function">
        <interface>
          <returnType>
            <INT />
          </returnType>
          <inputVars>
            <variable name="str1">
              <type>
                <string length="STRING_LENGTH" />
              </type>
            </variable>
            <variable name="str2">
              <type>
                <string length="STRING_LENGTH" />
              </type>
            </variable>
          </inputVars>
          <localVars>
            <variable name="pos">
              <type>
                <INT />
              </type>
            </variable>
            <variable name="length">
              <type>
                <INT />
              </type>
            </variable>
          </localVars>
        </interface>
        <body>
          <ST>
            length := LEN(str2);
FOR pos := LEN(str1) - length + 1 TO 1 BY -1 DO
	IF MID(str1,length,pos) = str2 THEN
		FindB := pos;
		RETURN;
	END_IF;
END_FOR;
FindB := 0;

(* revision history
hm	6. oct 2006		rev 1.0
	original version

hm	15 dec 2007		rev 1.1
	changed code for better performance

hm	29. feb 2008	rev 1.2
	added findb := 0 for compatibility reasons

hm	29. mar. 2008	rev 1.3
	changed STRING to STRING(STRING_LENGTH)
*)
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>5dc11711-14df-47f0-841a-9c714637e380</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="FINDB_NONUM" pouType="function">
        <interface>
          <returnType>
            <INT />
          </returnType>
          <inputVars>
            <variable name="str">
              <type>
                <string length="STRING_LENGTH" />
              </type>
            </variable>
          </inputVars>
          <localVars>
            <variable name="pos">
              <type>
                <INT />
              </type>
            </variable>
            <variable name="pt">
              <type>
                <pointer>
                  <baseType>
                    <BYTE />
                  </baseType>
                </pointer>
              </type>
            </variable>
          </localVars>
        </interface>
        <body>
          <ST>
            pt := ADR(str) + LEN(str) - 1;
FOR pos := LEN(str) TO 1 BY -1 DO;
	IF (PT^ &lt; 48 AND PT^ &lt;&gt; 46) OR PT^ &gt; 57 THEN
		FINDB_NONUM := pos;
		RETURN;
	END_IF;
	PT := PT - 1;
END_FOR;
FINDB_NONUM := 0;


(* revision history
hm	6. oct 2006		rev 1.0
	original version

hm	29. feb 2008	rev 1.1
	improved performance

hm	29. mar. 2008	rev 1.2
	changed STRING to STRING(STRING_LENGTH)

hm	21. oct. 2008	rev 1.3
	optimized code
*)
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>95bd0332-4c8f-4ac1-a51b-46c4c19ef9fb</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="FINDB_NUM" pouType="function">
        <interface>
          <returnType>
            <INT />
          </returnType>
          <inputVars>
            <variable name="str">
              <type>
                <string length="STRING_LENGTH" />
              </type>
            </variable>
          </inputVars>
          <localVars>
            <variable name="pos">
              <type>
                <INT />
              </type>
            </variable>
            <variable name="pt">
              <type>
                <pointer>
                  <baseType>
                    <BYTE />
                  </baseType>
                </pointer>
              </type>
            </variable>
          </localVars>
        </interface>
        <body>
          <ST>
            pt := ADR(str) + LEN(str) - 1;
FOR pos := LEN(str) TO 1 BY -1 DO;
	IF (PT^ &gt; 47 AND PT^ &lt; 58) OR PT^ = 46 THEN
		FINDB_NUM := pos;
		RETURN;
	END_IF;
	PT := PT - 1;
END_FOR;
FINDB_NUM := 0;

(* revision history
hm	6. oct 2006		rev 1.0
	original version

hm	29. feb 2008	rev 1.1
	improved performance

hm	29. mar. 2008	rev 1.2
	changed STRING to STRING(STRING_LENGTH)
*)
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>895393ef-3928-4d51-bd49-f9f4c6c0c2b0</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="FINDP" pouType="function">
        <interface>
          <returnType>
            <INT />
          </returnType>
          <inputVars>
            <variable name="str">
              <type>
                <string length="STRING_LENGTH" />
              </type>
            </variable>
            <variable name="src">
              <type>
                <string length="STRING_LENGTH" />
              </type>
            </variable>
            <variable name="pos">
              <type>
                <INT />
              </type>
            </variable>
          </inputVars>
          <localVars>
            <variable name="i">
              <type>
                <INT />
              </type>
            </variable>
            <variable name="ls">
              <type>
                <INT />
              </type>
            </variable>
            <variable name="lx">
              <type>
                <INT />
              </type>
            </variable>
            <variable name="stp">
              <type>
                <INT />
              </type>
            </variable>
          </localVars>
        </interface>
        <body>
          <ST>
            ls := LEN(str);
lx := LEN(src);
IF ls &lt; lx OR lx = 0 THEN RETURN; END_IF;
stp := ls - lx + 1;
FOR i := MAX(pos,1) TO stp DO
	IF MID(str,lx,i) = src THEN
		FINDP := i;
		RETURN;
	END_IF;
END_FOR;
FINDP := 0;

(* revision histroy
hm	4. feb. 2008	rev 1.0
	original release

hm	29. feb 2008	rev 1.1
	ADDED MAX(pos,1) in loop initialization

hm	29. mar. 2008	rev 1.2
	changed STRING to STRING(STRING_LENGTH)
*)	

          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>517b92ad-f158-4a3a-8654-8a769ea0a1ad</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="FIX" pouType="function">
        <interface>
          <returnType>
            <string length="STRING_LENGTH" />
          </returnType>
          <inputVars>
            <variable name="str">
              <type>
                <string length="STRING_LENGTH" />
              </type>
            </variable>
            <variable name="L">
              <type>
                <INT />
              </type>
            </variable>
            <variable name="C">
              <type>
                <BYTE />
              </type>
            </variable>
            <variable name="M">
              <type>
                <INT />
              </type>
            </variable>
          </inputVars>
          <localVars>
            <variable name="N">
              <type>
                <INT />
              </type>
            </variable>
            <variable name="SX">
              <type>
                <string length="STRING_LENGTH" />
              </type>
            </variable>
          </localVars>
        </interface>
        <body>
          <ST>
            (* make sure L does not exceed the limits of a string *)
N := LIMIT(0,L,STRING_LENGTH) - LEN(str);
IF N &lt;= 0 THEN
	(* truncate the string at length N *)
	IF M = 1 THEN
		FIX := RIGHT(str,L);
	ELSE
		FIX := LEFT(str,L);
	END_IF;
ELSIF M = 1 THEN
	(* connect fill characters at the beginning *)
	sx := FILL(C,N);
	FIX := CONCAT(sx,str);
ELSIF M = 2 THEN
	(* center str beween fill characters *)
	(* for an uneven number of fill characters, there is one more at the end *)
	sx := FILL(C,SHR(N+1,1));
	FIX := CONCAT(str,sx);
	SX := LEFT(sx,SHR(N,1));
	FIX := CONCAT(sx,FIX);
ELSE
	(* connect fill characters at the end *)
	SX := FILL(C,N);
	FIX := CONCAT(str,SX);
END_IF;


(* revision histroy
hm	29. mar. 2008	rev 1.0
	original release

*)
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>c773c548-fc09-4bc3-8943-67e6f804cc95</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="FLOAT_TO_REAL" pouType="function">
        <interface>
          <returnType>
            <REAL />
          </returnType>
          <inputVars>
            <variable name="FLT">
              <type>
                <string length="20" />
              </type>
            </variable>
          </inputVars>
          <localVars>
            <variable name="pt">
              <type>
                <pointer>
                  <baseType>
                    <array>
                      <dimension lower="1" upper="20" />
                      <baseType>
                        <BYTE />
                      </baseType>
                    </array>
                  </baseType>
                </pointer>
              </type>
            </variable>
            <variable name="i">
              <type>
                <INT />
              </type>
            </variable>
            <variable name="X">
              <type>
                <BYTE />
              </type>
            </variable>
            <variable name="sign">
              <type>
                <INT />
              </type>
              <initialValue>
                <simpleValue value="1" />
              </initialValue>
            </variable>
            <variable name="stop">
              <type>
                <INT />
              </type>
            </variable>
            <variable name="tmp">
              <type>
                <DINT />
              </type>
            </variable>
            <variable name="d">
              <type>
                <INT />
              </type>
            </variable>
          </localVars>
        </interface>
        <body>
          <ST>
            pt := ADR(FLT);
stop := LEN(FLT);

(* we first check for sign and exit if first number or dot is reached *)
FOR i := 1 TO stop DO
	X := pt^[i];
	IF X &gt; 47 AND X &lt; 58 OR X = 46 THEN
		EXIT;
	ELSIF X = 45 THEN
		(* code 45 is sign *)
		sign := -1;
	END_IF;
END_FOR;

(* now we scan numbers till end or dot or E is reached *)
FOR i := i TO stop DO
	X := pt^[i];
	IF X = 44 OR X = 46 OR X = 69 OR X = 101 THEN
		EXIT;
	(* calculate the value of the digit *)
	ELSIF X &gt; 47 AND x &lt; 58 THEN
		tmp := tmp * 10 + X - 48;
	END_IF;
END_FOR;

(* process the portion after the comma if comma or dot is reached exit if exponent starts *)
IF x = 44 OR X = 46 THEN
	FOR i := i + 1 TO stop DO
		X := pt^[i];
		IF X = 69 OR X = 101 THEN
			EXIT;
		ELSIF x &gt; 47 AND x &lt; 58 THEN
			tmp := tmp * 10 + X - 48;
			d := d - 1;
		END_IF;
	END_FOR;
END_IF;

(* process exponent if present *)
IF X = 69 OR X = 101 THEN
	d := d + DEC_TO_INT(RIGHT(FLT, stop - i));
END_IF;

FLOAT_TO_REAL :=  EXPN(10, d) * DINT_TO_REAL(TMP * SIGN);




(* revision histroy
hm	22. jun. 2008	rev 1.0
	original release

hm	2. oct. 2008	rev 1.1
	fixed an error, characters 8 and 9 would not be converted

hm	22. oct. 2008	rev 1.2
	last fix was not done correctly

hm	23. oct. 2008	rev 1.3
	optimzed code
*)	

          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>6b10dbd2-1284-4230-aeeb-23cf5b06e8e5</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="FSTRING_TO_BYTE" pouType="function">
        <interface>
          <returnType>
            <BYTE />
          </returnType>
          <inputVars>
            <variable name="IN">
              <type>
                <string length="12" />
              </type>
            </variable>
          </inputVars>
        </interface>
        <body>
          <ST>
            IF LEFT(IN, 2) = '2#' THEN
	(* we need to convert binary *)
	FSTRING_TO_BYTE := BIN_TO_BYTE(RIGHT(in, LEN(in) - 2));
ELSIF LEFT(in, 2) = '8#' THEN
	(* weneed to convert octals *)
	FSTRING_TO_BYTE := OCT_TO_BYTE(RIGHT(in, LEN(in) - 2));
ELSIF LEFT(in, 3) = '16#' THEN
	(* we need to convert hexadecimal *)
	FSTRING_TO_BYTE := HEX_TO_BYTE(RIGHT(in, LEN(in) - 3));
ELSE
	(* we assume decimal representation *)
	FSTRING_TO_BYTE := DEC_TO_BYTE(CLEAN(in,'0123456789'));
END_IF;


(* revision histroy
hm	18. jun. 2008	rev 1.0
	original release

hm	20. sep. 2008	rev 1.1
	changed length of input string from 20 to 12
*)	

          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>268a823c-ab32-4ce7-91ba-2ff6e566a0ba</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="FSTRING_TO_DT" pouType="function">
        <interface>
          <returnType>
            <DT />
          </returnType>
          <inputVars>
            <variable name="SDT">
              <type>
                <string length="60" />
              </type>
            </variable>
            <variable name="FMT">
              <type>
                <string length="60" />
              </type>
            </variable>
          </inputVars>
          <localVars constant="true">
            <variable name="ignore">
              <type>
                <string length="1" />
              </type>
              <initialValue>
                <simpleValue value="'*'" />
              </initialValue>
              <documentation>
                 ignore character is * 
              </documentation>
            </variable>
            <variable name="fchar">
              <type>
                <string length="1" />
              </type>
              <initialValue>
                <simpleValue value="'#'" />
              </initialValue>
              <documentation>
                 format character is # 
              </documentation>
            </variable>
          </localVars>
          <localVars>
            <variable name="c">
              <type>
                <string length="1" />
              </type>
            </variable>
            <variable name="tmp">
              <type>
                <string length="20" />
              </type>
            </variable>
            <variable name="end">
              <type>
                <INT />
              </type>
            </variable>
            <variable name="dy">
              <type>
                <INT />
              </type>
              <initialValue>
                <simpleValue value="1970" />
              </initialValue>
            </variable>
            <variable name="dm">
              <type>
                <INT />
              </type>
              <initialValue>
                <simpleValue value="1" />
              </initialValue>
            </variable>
            <variable name="dd">
              <type>
                <INT />
              </type>
              <initialValue>
                <simpleValue value="1" />
              </initialValue>
            </variable>
            <variable name="th">
              <type>
                <INT />
              </type>
            </variable>
            <variable name="tm">
              <type>
                <INT />
              </type>
            </variable>
            <variable name="ts">
              <type>
                <INT />
              </type>
            </variable>
          </localVars>
        </interface>
        <body>
          <ST>
            (* scan input string *)
WHILE fmt &lt;&gt; '' DO
	c := LEFT(fmt,1);
	IF c = ignore THEN
		(* skip ignore characters *)
		fmt := DELETE(fmt,1,1);
		sdt := DELETE(sdt,1,1);
	ELSIF C = fchar THEN
		(* format chracter found skip format char and read identifier *)
		(* store format identifier in c and skip to next char in fmt *)
		c := MID(fmt,1,2);
		fmt := DELETE(fmt,2,1);
		(* extract the substring until the end of sdt or to next char of fmt *)
		IF fmt = '' THEN
			tmp := sdt;
		ELSE
			(* serach for end of substring *)
			end := FIND(sdt, LEFT(fmt,1))-1;
			tmp := LEFT(sdt, end);
			sdt := DELETE(sdt, end,1);
		END_IF;
		(* extract information from substring *)
		IF c = 'Y' THEN
			dy := STRING_TO_INT(tmp);
			IF dy &lt; 100 THEN dy := dy + 2000; END_IF;
		ELSIF c = 'M' THEN
			dm := STRING_TO_INT(tmp);
		ELSIF c = 'N' THEN
			dm := FSTRING_TO_MONTH(tmp,0);
		ELSIF c = 'D' THEN
			dd := STRING_TO_INT(tmp);
		ELSIF c = 'h' THEN
			th := STRING_TO_INT(tmp);
		ELSIF c = 'm' THEN
			tm := STRING_TO_INT(tmp);
		ELSIF c = 's' THEN
			ts := STRING_TO_INT(tmp);
		END_IF;
	ELSIF c = LEFT(sdt,1) THEN
		(* skip matching characters *)
		fmt := DELETE(fmt,1,1);
		sdt := DELETE(sdt,1,1);
	ELSE
		RETURN;
	END_IF;
END_WHILE;

FSTRING_TO_DT := SET_DT(dy,dm,dd,th,tm,ts);


(* revision histroy
hm	24. sep. 2008	rev 1.0
	original release


*)	

          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>3f2cd5ce-5a3e-4458-8ecc-7de9eefc8dbf</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="FSTRING_TO_DWORD" pouType="function">
        <interface>
          <returnType>
            <DWORD />
          </returnType>
          <inputVars>
            <variable name="IN">
              <type>
                <string length="40" />
              </type>
            </variable>
          </inputVars>
        </interface>
        <body>
          <ST>
            IF LEFT(IN, 2) = '2#' THEN
	(* we need to convert binary *)
	FSTRING_TO_DWORD := BIN_TO_DWORD(RIGHT(in, LEN(in) - 2));
ELSIF LEFT(in, 2) = '8#' THEN
	(* weneed to convert octals *)
	FSTRING_TO_DWORD := OCT_TO_DWORD(RIGHT(in, LEN(in) - 2));
ELSIF LEFT(in, 3) = '16#' THEN
	(* we need to convert hexadecimal *)
	FSTRING_TO_DWORD := HEX_TO_DWORD(RIGHT(in, LEN(in) - 3));
ELSE
	(* we assume decimal representation *)
	FSTRING_TO_DWORD := DEC_TO_DWORD(CLEAN(in,'0123456789'));
END_IF;


(* revision histroy
hm	18. jun. 2008	rev 1.0
	original release

hm	20. sep. 2008	rev 1.1
	changed length of input dtring from 20 to 40


*)	

          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>20aee51f-14d1-4cc0-be8d-777c5f8c2c24</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="FSTRING_TO_MONTH" pouType="function">
        <interface>
          <returnType>
            <INT />
          </returnType>
          <inputVars>
            <variable name="MTH">
              <type>
                <string length="20" />
              </type>
            </variable>
            <variable name="LANG">
              <type>
                <INT />
              </type>
            </variable>
          </inputVars>
          <localVars>
            <variable name="lx">
              <type>
                <INT />
              </type>
            </variable>
          </localVars>
        </interface>
        <body>
          <ST>
            IF LANG = 0 THEN lx := LANGUAGE.DEFAULT; ELSE lx := MIN(LANG, LANGUAGE.LMAX); END_IF;
MTH := TRIM(mth);
MTH := CAPITALIZE(LOWERCASE(MTH));

FOR FSTRING_TO_MONTH := 1 TO 12 DO
	IF MTH = language.MONTHS[lx, FSTRING_TO_MONTH] THEN RETURN; END_IF;
	IF MTH = language.MONTHS3[lx, FSTRING_TO_MONTH] THEN RETURN; END_IF;
END_FOR;

(* since no name matched try to decode as integer *)
FSTRING_TO_MONTH := STRING_TO_INT(MTH);




(* revision histroy
hm	25. sep. 2008	rev 1.0
	original release

hm	19. oct. 2008	rev 1.1
	changed language setup constants

hm	25. oct. 2008	rev 1.2
	optimized code
*)	

          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>12ffb3b4-5ea1-41f2-83ab-ec9858a909d1</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="FSTRING_TO_WEEK" pouType="function">
        <interface>
          <returnType>
            <BYTE />
          </returnType>
          <inputVars>
            <variable name="WEEK">
              <type>
                <string length="60" />
              </type>
            </variable>
            <variable name="LANG">
              <type>
                <INT />
              </type>
            </variable>
          </inputVars>
          <localVars>
            <variable name="pos">
              <type>
                <INT />
              </type>
            </variable>
          </localVars>
        </interface>
        <body>
          <ST>
            pos := FIND(WEEK, ',');
WHILE pos &gt; 0 DO
	FSTRING_TO_WEEK := FSTRING_TO_WEEK OR SHR(BYTE#128, FSTRING_TO_WEEKDAY(MID(WEEK, pos - 1, 1), LANG));
	WEEK := RIGHT(WEEK, LEN(Week) - pos);
	pos := FIND(WEEK, ',');
END_WHILE;
FSTRING_TO_WEEK := (FSTRING_TO_WEEK OR SHR(BYTE#128, FSTRING_TO_WEEKDAY(WEEK, LANG))) AND BYTE#127;


(* revision histroy
hm	18. jun. 2008	rev 1.0
	original release

hm	25. oct. 2008	rev 1.1
	using language defauls and input lang
*)	

          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>d9e29b07-2b05-450d-a1d6-3c64ab37df4d</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="FSTRING_TO_WEEKDAY" pouType="function">
        <interface>
          <returnType>
            <INT />
          </returnType>
          <inputVars>
            <variable name="WDAY">
              <type>
                <string length="20" />
              </type>
            </variable>
            <variable name="LANG">
              <type>
                <INT />
              </type>
            </variable>
          </inputVars>
          <localVars>
            <variable name="tmp">
              <type>
                <string length="2" />
              </type>
            </variable>
            <variable name="i">
              <type>
                <INT />
              </type>
            </variable>
            <variable name="ly">
              <type>
                <INT />
              </type>
            </variable>
          </localVars>
        </interface>
        <body>
          <ST>
            IF LANG = 0 THEN ly := LANGUAGE.DEFAULT; ELSE ly := MIN(LANG, LANGUAGE.LMAX); END_IF;
(* tmp needs to be calculated first otherwise find can return wrong values *)
tmp := TRIM(wday);
tmp := CAPITALIZE(LOWERCASE(tmp));
FOR i := 1 TO 7 DO
	IF language.WEEKDAYS2[ly, i] = tmp THEN
		FSTRING_TO_WEEKDAY := i;
		RETURN;
	END_IF;
END_FOR;
FSTRING_TO_WEEKDAY := STRING_TO_INT(WDAY);




(* revision histroy
hm	18. jun. 2008	rev 1.0
	original release

hm	18. jul. 2008	rev 1.1
	changed nested call of left(trim()) for compatibility reasons

hm	25. oct. 2008	rev 1.2
	using language constants
*)	

          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>f4af2588-62b0-4376-92fd-d03dac3a3a3d</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="HEX_TO_BYTE" pouType="function">
        <interface>
          <returnType>
            <BYTE />
          </returnType>
          <inputVars>
            <variable name="HEX">
              <type>
                <string length="5" />
              </type>
            </variable>
          </inputVars>
          <localVars>
            <variable name="pt">
              <type>
                <pointer>
                  <baseType>
                    <BYTE />
                  </baseType>
                </pointer>
              </type>
            </variable>
            <variable name="i">
              <type>
                <INT />
              </type>
            </variable>
            <variable name="X">
              <type>
                <BYTE />
              </type>
            </variable>
            <variable name="stop">
              <type>
                <INT />
              </type>
            </variable>
          </localVars>
        </interface>
        <body>
          <ST>
            pt := ADR(hex);
stop := LEN(hex);
FOR I := 1 TO stop DO
	(* read the first character and subtract 48 to get value in decimal 0 = 48 *)
	x := pt^;
	(* calculate the value of the digit *)
	IF X &gt; 47 AND x &lt; 58 THEN
		HEX_TO_BYTE := SHL(HEX_TO_BYTE,4) + X - 48;
	ELSIF X &gt; 64 AND X &lt; 71 THEN
		HEX_TO_BYTE := SHL(HEX_TO_BYTE,4) + X - 55;
	ELSIF X &gt; 96 AND X &lt; 103 THEN
		HEX_TO_BYTE := SHL(HEX_TO_BYTE,4) + X - 87;
	END_IF;
	pt := pt + 1;
END_FOR;




(* revision histroy
hm	18. jun. 2008	rev 1.0
	original release

hm	20. sep.2008	rev 1.1
	changed length of input string from 20 to 5

*)	

          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>8697cf54-599b-48c3-8976-9db93f39ac11</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="HEX_TO_DWORD" pouType="function">
        <interface>
          <returnType>
            <DWORD />
          </returnType>
          <inputVars>
            <variable name="Hex">
              <type>
                <string length="20" />
              </type>
            </variable>
          </inputVars>
          <localVars>
            <variable name="pt">
              <type>
                <pointer>
                  <baseType>
                    <BYTE />
                  </baseType>
                </pointer>
              </type>
            </variable>
            <variable name="i">
              <type>
                <INT />
              </type>
            </variable>
            <variable name="X">
              <type>
                <BYTE />
              </type>
            </variable>
            <variable name="stop">
              <type>
                <INT />
              </type>
            </variable>
          </localVars>
        </interface>
        <body>
          <ST>
            pt := ADR(hex);
stop := LEN(hex);
FOR I := 1 TO stop DO
	(* read the first character and subtract 48 to get value in decimal 0 = 48 *)
	x := pt^;
	(* calculate the value of the digit *)
	IF X &gt; 47 AND x &lt; 58 THEN
		HEX_TO_DWORD := SHL(HEX_TO_DWORD,4) + X - 48;
	ELSIF X &gt; 64 AND X &lt; 71 THEN
		HEX_TO_DWORD := SHL(HEX_TO_DWORD,4) + X - 55;
	ELSIF X &gt; 96 AND X &lt; 103 THEN
		HEX_TO_DWORD := SHL(HEX_TO_DWORD,4) + X - 87;
	END_IF;
	pt := pt + 1;
END_FOR;



(* revision histroy
hm	2.10.2007		rev 1.0
	original release

hm	19.11.2007		rev 1.1
	changed type of function from int to dword

hm 	4. mar 2008		rev 1.2
	added support for a..f and return 0 for invalid string

hm	29. mar. 2008	rev 1.3
	changed STRING to STRING(8)

hm	18. jun. 2008	rev 1.4
	changed input hex to STRING(20)
	function now ignores wrong characters
*)	

          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>a082038f-14a9-46fb-a5d7-88a41be2a69e</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="IS_ALNUM" pouType="function">
        <interface>
          <returnType>
            <BOOL />
          </returnType>
          <inputVars>
            <variable name="str">
              <type>
                <string length="STRING_LENGTH" />
              </type>
            </variable>
          </inputVars>
          <localVars>
            <variable name="L">
              <type>
                <INT />
              </type>
            </variable>
            <variable name="pt">
              <type>
                <pointer>
                  <baseType>
                    <BYTE />
                  </baseType>
                </pointer>
              </type>
            </variable>
            <variable name="pos">
              <type>
                <INT />
              </type>
            </variable>
          </localVars>
        </interface>
        <body>
          <ST>
            PT := ADR(str);
L := LEN(str);
FOR pos := 1 TO L DO
	IF NOT (ISC_ALPHA(pt^) OR ISC_NUM(pt^)) THEN
		IS_ALNUM := FALSE;
		RETURN;
	END_IF;
    	PT := PT + 1;
END_FOR;
IS_ALNUM := L &gt; 0;


(* revision history
hm	29. feb 2008	rev 1.0
	original version

hm	29. mar. 2008	rev 1.1
	changed STRING to STRING(STRING_LENGTH)
*)
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>7d9451c7-d5b7-4c3c-9649-f715c595714e</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="IS_ALPHA" pouType="function">
        <interface>
          <returnType>
            <BOOL />
          </returnType>
          <inputVars>
            <variable name="str">
              <type>
                <string length="STRING_LENGTH" />
              </type>
            </variable>
          </inputVars>
          <localVars>
            <variable name="L">
              <type>
                <INT />
              </type>
            </variable>
            <variable name="pt">
              <type>
                <pointer>
                  <baseType>
                    <BYTE />
                  </baseType>
                </pointer>
              </type>
            </variable>
            <variable name="pos">
              <type>
                <INT />
              </type>
            </variable>
          </localVars>
        </interface>
        <body>
          <ST>
            PT := ADR(str);
L := LEN(str);
FOR pos := 1 TO L DO
	IF NOT ISC_ALPHA(pt^) THEN
		IS_ALPHA := FALSE;
		RETURN;
	END_IF;
    	PT := PT + 1;
END_FOR;
IS_ALPHA := L &gt; 0;


(* revision history
hm	29. feb 2008	rev 1.0
	original version

hm	29. mar. 2008	rev 1.1
	changed STRING to STRING(STRING_LENGTH)
*)
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>44053742-4ad7-4f29-8a09-275651aae8e2</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="IS_CC" pouType="function">
        <interface>
          <returnType>
            <BOOL />
          </returnType>
          <inputVars>
            <variable name="str">
              <type>
                <string length="STRING_LENGTH" />
              </type>
            </variable>
            <variable name="cmp">
              <type>
                <string length="STRING_LENGTH" />
              </type>
            </variable>
          </inputVars>
          <localVars>
            <variable name="L">
              <type>
                <INT />
              </type>
            </variable>
            <variable name="pos">
              <type>
                <INT />
              </type>
            </variable>
          </localVars>
        </interface>
        <body>
          <ST>
            L := LEN(str);
FOR pos := 1 TO L DO
	IF FIND(CMP,MID(str,1,pos)) = 0 THEN RETURN; END_IF;
END_FOR;
IS_CC := L &gt; 0;



(* revision history
hm	19. mar 2008	rev 1.0
	original version

hm	29. mar. 2008	rev 1.1
	changed STRING to STRING(STRING_LENGTH)
*)
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>9ef8095a-5c8d-4476-8177-9b3ea482fd3b</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="IS_CTRL" pouType="function">
        <interface>
          <returnType>
            <BOOL />
          </returnType>
          <inputVars>
            <variable name="STR">
              <type>
                <string length="STRING_LENGTH" />
              </type>
            </variable>
          </inputVars>
          <localVars>
            <variable name="L">
              <type>
                <INT />
              </type>
            </variable>
            <variable name="pt">
              <type>
                <pointer>
                  <baseType>
                    <BYTE />
                  </baseType>
                </pointer>
              </type>
            </variable>
            <variable name="pos">
              <type>
                <INT />
              </type>
            </variable>
          </localVars>
        </interface>
        <body>
          <ST>
            PT := ADR(str);
L := LEN(str);
FOR pos := 1 TO L DO
	IF NOT (ISC_CTRL(pt^)) THEN
		IS_CTRL := FALSE;
		RETURN;
	END_IF;
    	PT := PT + 1;
END_FOR;
IS_CTRL := L &gt; 0;


(* revision history
hm	29. feb. 2008	rev 1.0
	original version

hm	29. mar. 2008	rev 1.1
	changed STRING to STRING(STRING_LENGTH)
*)
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>a0af2962-aa06-47c3-a9a6-b3a55285ff18</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="IS_HEX" pouType="function">
        <interface>
          <returnType>
            <BOOL />
          </returnType>
          <inputVars>
            <variable name="str">
              <type>
                <string length="STRING_LENGTH" />
              </type>
            </variable>
          </inputVars>
          <localVars>
            <variable name="L">
              <type>
                <INT />
              </type>
            </variable>
            <variable name="pt">
              <type>
                <pointer>
                  <baseType>
                    <BYTE />
                  </baseType>
                </pointer>
              </type>
            </variable>
            <variable name="pos">
              <type>
                <INT />
              </type>
            </variable>
          </localVars>
        </interface>
        <body>
          <ST>
            PT := ADR(str);
L := LEN(str);
FOR pos := 1 TO L DO
	IF NOT (ISC_HEX(pt^)) THEN
		IS_HEX := FALSE;
		RETURN;
	END_IF;
    	PT := PT + 1;
END_FOR;
IS_HEX := L &gt; 0;


(* revision history
hm	29. feb 2008	rev 1.0
	original version

hm	29. mar. 2008	rev 1.1
	changed STRING to STRING(STRING_LENGTH)
*)
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>7750ce86-a364-47e3-a9cd-63216965f8a5</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="IS_LOWER" pouType="function">
        <interface>
          <returnType>
            <BOOL />
          </returnType>
          <inputVars>
            <variable name="str">
              <type>
                <string length="STRING_LENGTH" />
              </type>
            </variable>
          </inputVars>
          <localVars>
            <variable name="l">
              <type>
                <INT />
              </type>
            </variable>
            <variable name="pt">
              <type>
                <pointer>
                  <baseType>
                    <BYTE />
                  </baseType>
                </pointer>
              </type>
            </variable>
            <variable name="pos">
              <type>
                <INT />
              </type>
            </variable>
          </localVars>
        </interface>
        <body>
          <ST>
            PT := ADR(str);
L := LEN(str);
FOR pos := 1 TO L DO
	IF NOT (ISC_LOWER(pt^)) THEN
		IS_LOWER := FALSE;
		RETURN;
	END_IF;
    	PT := PT + 1;
END_FOR;
IS_LOWER := L &gt; 0;


(* revision history
hm	29. feb 2008	rev 1.0
	original version

hm	29. mar. 2008	rev 1.1
	changed STRING to STRING(STRING_LENGTH)
*)
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>028199c1-6919-4bdd-b5af-309b38a61507</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="IS_NCC" pouType="function">
        <interface>
          <returnType>
            <BOOL />
          </returnType>
          <inputVars>
            <variable name="str">
              <type>
                <string length="STRING_LENGTH" />
              </type>
            </variable>
            <variable name="cmp">
              <type>
                <string length="STRING_LENGTH" />
              </type>
            </variable>
          </inputVars>
          <localVars>
            <variable name="L">
              <type>
                <INT />
              </type>
            </variable>
            <variable name="pos">
              <type>
                <INT />
              </type>
            </variable>
          </localVars>
        </interface>
        <body>
          <ST>
            L := LEN(str);
FOR pos := 1 TO L DO
	IF FIND(CMP,MID(str,1,pos)) &gt; 0 THEN RETURN; END_IF;
END_FOR;
IS_NCC := TRUE;



(* revision history
hm	19. mar 2008	rev 1.0
	original version

hm	29. mar. 2008	rev 1.1
	changed STRING to STRING(STRING_LENGTH)
*)
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>8e3e30de-70b6-43d5-8a1f-9cc4446ebb39</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="IS_NUM" pouType="function">
        <interface>
          <returnType>
            <BOOL />
          </returnType>
          <inputVars>
            <variable name="str">
              <type>
                <string length="STRING_LENGTH" />
              </type>
            </variable>
          </inputVars>
          <localVars>
            <variable name="L">
              <type>
                <INT />
              </type>
            </variable>
            <variable name="pt">
              <type>
                <pointer>
                  <baseType>
                    <BYTE />
                  </baseType>
                </pointer>
              </type>
            </variable>
            <variable name="pos">
              <type>
                <INT />
              </type>
            </variable>
          </localVars>
        </interface>
        <body>
          <ST>
            PT := ADR(str);
L := LEN(str);
FOR pos := 1 TO L DO
	IF NOT (ISC_NUM(pt^)) THEN
		IS_NUM := FALSE;
		RETURN;
	END_IF;
    	PT := PT + 1;
END_FOR;
IS_NUM := L &gt; 0;


(* revision history
hm	29. feb 2008	rev 1.0
	original version

hm	29. mar. 2008	rev 1.1
	changed STRING to STRING(STRING_LENGTH)
*)
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>caeab4ec-d9e5-447b-b918-d9eb1d1d9274</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="IS_UPPER" pouType="function">
        <interface>
          <returnType>
            <BOOL />
          </returnType>
          <inputVars>
            <variable name="str">
              <type>
                <string length="STRING_LENGTH" />
              </type>
            </variable>
          </inputVars>
          <localVars>
            <variable name="L">
              <type>
                <INT />
              </type>
            </variable>
            <variable name="pt">
              <type>
                <pointer>
                  <baseType>
                    <BYTE />
                  </baseType>
                </pointer>
              </type>
            </variable>
            <variable name="pos">
              <type>
                <INT />
              </type>
            </variable>
          </localVars>
        </interface>
        <body>
          <ST>
            PT := ADR(str);
L := LEN(str);
FOR pos := 1 TO L DO
	IF NOT (ISC_UPPER(pt^)) THEN
		IS_UPPER := FALSE;
		RETURN;
	END_IF;
    	PT := PT + 1;
END_FOR;
IS_UPPER := L &gt; 0;


(* revision history
hm	29. feb 2008	rev 1.0
	original version

hm	29. mar. 2008	rev 1.1
	changed STRING to STRING(STRING_LENGTH)
*)
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>ed487eda-d429-4052-8b36-5a534d0161c5</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="ISC_ALPHA" pouType="function">
        <interface>
          <returnType>
            <BOOL />
          </returnType>
          <inputVars>
            <variable name="IN">
              <type>
                <BYTE />
              </type>
            </variable>
          </inputVars>
        </interface>
        <body>
          <ST>
            IF setup.EXTENDED_ASCII THEN
	ISC_ALPHA := (in &gt; 64 AND in &lt; 91) OR (in &gt; 191  AND in &lt;&gt; 215 AND in &lt;&gt; 247) OR (in &gt; 96 AND in &lt; 123);
ELSE
	ISC_ALPHA := (IN &gt; 64 AND IN &lt; 91) OR (in &gt; 96 AND in &lt; 123);
END_IF;

(* revision history
hm	6. mar. 2008	rev 1.0
	original version

hm	19. oct. 2008	rev 1.1
	changes setup constants
*)

          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>ee9eceea-ed26-4167-9263-dc35ef410b0c</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="ISC_CTRL" pouType="function">
        <interface>
          <returnType>
            <BOOL />
          </returnType>
          <inputVars>
            <variable name="IN">
              <type>
                <BYTE />
              </type>
            </variable>
          </inputVars>
        </interface>
        <body>
          <ST>
            ISC_CTRL := IN &lt; 32 OR IN = 127;

(* revision history
hm		6. mar. 2008	rev 1.0
	original version

*)
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>77f4270b-85a0-4a17-8fa7-077301f3ca6e</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="ISC_HEX" pouType="function">
        <interface>
          <returnType>
            <BOOL />
          </returnType>
          <inputVars>
            <variable name="IN">
              <type>
                <BYTE />
              </type>
            </variable>
          </inputVars>
        </interface>
        <body>
          <ST>
            ISC_HEX := (IN &gt; 47 AND IN &lt; 58) OR (IN &gt; 64 AND IN &lt; 71) OR (IN &gt; 96 AND IN &lt; 103);

(* revision history
hm		6. mar. 2008	rev 1.0
	original version

*)
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>bb877efc-6cd1-4e80-931d-d70a93adb2c1</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="ISC_LOWER" pouType="function">
        <interface>
          <returnType>
            <BOOL />
          </returnType>
          <inputVars>
            <variable name="IN">
              <type>
                <BYTE />
              </type>
            </variable>
          </inputVars>
        </interface>
        <body>
          <ST>
            IF setup.EXTENDED_ASCII THEN
	ISC_LOWER := ((in &gt; 96) AND (in &lt; 123)) OR ((in &gt; 222) AND (in &lt;&gt; 247));
ELSE
	ISC_LOWER := ((in &gt; 96) AND (in &lt; 123));
END_IF;

(* revision history
hm	6. mar. 2008	rev 1.0
	original version

hm	19. oct. 2008	rev 1.1
	changes setup constants
*)
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>b6526b2f-70ab-4de4-a9e3-9382abb5cfc8</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="ISC_NUM" pouType="function">
        <interface>
          <returnType>
            <BOOL />
          </returnType>
          <inputVars>
            <variable name="IN">
              <type>
                <BYTE />
              </type>
            </variable>
          </inputVars>
        </interface>
        <body>
          <ST>
            ISC_NUM := IN &gt; 47 AND IN &lt; 58;

(* revision history
hm		6. mar. 2008	rev 1.0
	original version

*)
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>fc233119-3d4f-4dc1-ade1-3ed09fd642b7</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="ISC_UPPER" pouType="function">
        <interface>
          <returnType>
            <BOOL />
          </returnType>
          <inputVars>
            <variable name="IN">
              <type>
                <BYTE />
              </type>
            </variable>
          </inputVars>
        </interface>
        <body>
          <ST>
            IF setup.EXTENDED_ASCII THEN
	ISC_UPPER :=  ((in &gt; 64) AND (in &lt; 91)) OR (((in &gt; 191) AND (in &lt; 223)) AND (in &lt;&gt; 215));
ELSE
	ISC_UPPER := ((in &gt; 64) AND (in &lt; 91));
END_IF;


(* revision history
hm	6. mar. 2008	rev 1.0
	original version

hm	19. oct. 2008	rev 1.1
	changes setup constants

*)
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>4d0fc5fc-1cc4-4e95-a905-d6047a233baf</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="LOWERCASE" pouType="function">
        <interface>
          <returnType>
            <string length="STRING_LENGTH" />
          </returnType>
          <inputVars>
            <variable name="str">
              <type>
                <string length="STRING_LENGTH" />
              </type>
            </variable>
          </inputVars>
          <localVars>
            <variable name="PT">
              <type>
                <pointer>
                  <baseType>
                    <BYTE />
                  </baseType>
                </pointer>
              </type>
            </variable>
            <variable name="pos">
              <type>
                <INT />
              </type>
            </variable>
            <variable name="l">
              <type>
                <INT />
              </type>
            </variable>
          </localVars>
        </interface>
        <body>
          <ST>
            PT := ADR(LOWERCASE);
lowercase := str;
l := LEN(str);
FOR pos := 1 TO l DO
	pt^ := TO_LOWER(pt^);
	PT := PT + 1;
END_FOR;

(* revision histroy
hm	6. oct. 2006	rev 1.0
	original release

hm	4. feb. 2008	rev 1.1
	improved performance
	added Ä.Ö,Ü

hm	6. mar. 2008	rev 1.2
	added support for exteded Ascii

hm	29. mar. 2008	rev 1.3
	changed STRING to STRING(STRING_LENGTH)
*)	

          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>a5133c0a-dd24-413e-b317-980f38aef02f</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="MESSAGE_4R" pouType="functionBlock">
        <interface>
          <inputVars>
            <variable name="M0">
              <type>
                <string length="STRING_LENGTH" />
              </type>
            </variable>
            <variable name="M1">
              <type>
                <string length="STRING_LENGTH" />
              </type>
            </variable>
            <variable name="M2">
              <type>
                <string length="STRING_LENGTH" />
              </type>
            </variable>
            <variable name="M3">
              <type>
                <string length="STRING_LENGTH" />
              </type>
            </variable>
            <variable name="MM">
              <type>
                <INT />
              </type>
              <initialValue>
                <simpleValue value="3" />
              </initialValue>
            </variable>
            <variable name="ENQ">
              <type>
                <BOOL />
              </type>
              <initialValue>
                <simpleValue value="TRUE" />
              </initialValue>
            </variable>
            <variable name="CLK">
              <type>
                <BOOL />
              </type>
              <initialValue>
                <simpleValue value="TRUE" />
              </initialValue>
            </variable>
            <variable name="T1">
              <type>
                <TIME />
              </type>
              <initialValue>
                <simpleValue value="TIME#3s0ms" />
              </initialValue>
            </variable>
          </inputVars>
          <outputVars>
            <variable name="MX">
              <type>
                <string length="STRING_LENGTH" />
              </type>
            </variable>
            <variable name="MN">
              <type>
                <INT />
              </type>
            </variable>
            <variable name="TR">
              <type>
                <BOOL />
              </type>
            </variable>
          </outputVars>
          <localVars>
            <variable name="timer">
              <type>
                <derived name="TON" />
              </type>
            </variable>
            <variable name="edge">
              <type>
                <BOOL />
              </type>
            </variable>
          </localVars>
        </interface>
        <body>
          <ST>
            (* check for rising edge on EN *)
TR := FALSE;
IF ENQ THEN
	IF (NOT edge AND clk) OR timer.q THEN
			MN := INC1(MN, MM);
			TR := TRUE;
			timer(in := FALSE);
			CASE MN OF
				0 : MX := M0;
				1 : MX := M1;
				2 : MX := M2;
				3 : MX := M3;
			END_CASE;
	END_IF;
	edge := clk;
	timer( in := CLK, pt := T1);
ELSE
	MX := '';
	MN := 0;
END_IF;




(* revision history
hm	8. oct. 2008	rev 1.0
	original version

hm	27. oct. 2008	rev 1.1
	changed _INC to INC1

*)

          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>ef43a1aa-9eac-4d56-953d-0f7a0e106acb</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="MESSAGE_8" pouType="functionBlock">
        <interface>
          <inputVars>
            <variable name="IN1">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="IN2">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="IN3">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="IN4">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="IN5">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="IN6">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="IN7">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="IN8">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="S1">
              <type>
                <string length="STRING_LENGTH" />
              </type>
              <addData>
                <data name="http://www.3s-software.com/plcopenxml/attributes" handleUnknown="implementation">
                  <Attributes>
                    <Attribute Name="input_constant" Value="" />
                  </Attributes>
                </data>
              </addData>
            </variable>
            <variable name="S2">
              <type>
                <string length="STRING_LENGTH" />
              </type>
              <addData>
                <data name="http://www.3s-software.com/plcopenxml/attributes" handleUnknown="implementation">
                  <Attributes>
                    <Attribute Name="input_constant" Value="" />
                  </Attributes>
                </data>
              </addData>
            </variable>
            <variable name="S3">
              <type>
                <string length="STRING_LENGTH" />
              </type>
              <addData>
                <data name="http://www.3s-software.com/plcopenxml/attributes" handleUnknown="implementation">
                  <Attributes>
                    <Attribute Name="input_constant" Value="" />
                  </Attributes>
                </data>
              </addData>
            </variable>
            <variable name="S4">
              <type>
                <string length="STRING_LENGTH" />
              </type>
              <addData>
                <data name="http://www.3s-software.com/plcopenxml/attributes" handleUnknown="implementation">
                  <Attributes>
                    <Attribute Name="input_constant" Value="" />
                  </Attributes>
                </data>
              </addData>
            </variable>
            <variable name="S5">
              <type>
                <string length="STRING_LENGTH" />
              </type>
              <addData>
                <data name="http://www.3s-software.com/plcopenxml/attributes" handleUnknown="implementation">
                  <Attributes>
                    <Attribute Name="input_constant" Value="" />
                  </Attributes>
                </data>
              </addData>
            </variable>
            <variable name="S6">
              <type>
                <string length="STRING_LENGTH" />
              </type>
              <addData>
                <data name="http://www.3s-software.com/plcopenxml/attributes" handleUnknown="implementation">
                  <Attributes>
                    <Attribute Name="input_constant" Value="" />
                  </Attributes>
                </data>
              </addData>
            </variable>
            <variable name="S7">
              <type>
                <string length="STRING_LENGTH" />
              </type>
              <addData>
                <data name="http://www.3s-software.com/plcopenxml/attributes" handleUnknown="implementation">
                  <Attributes>
                    <Attribute Name="input_constant" Value="" />
                  </Attributes>
                </data>
              </addData>
            </variable>
            <variable name="S8">
              <type>
                <string length="STRING_LENGTH" />
              </type>
              <addData>
                <data name="http://www.3s-software.com/plcopenxml/attributes" handleUnknown="implementation">
                  <Attributes>
                    <Attribute Name="input_constant" Value="" />
                  </Attributes>
                </data>
              </addData>
            </variable>
          </inputVars>
          <outputVars>
            <variable name="M">
              <type>
                <string length="STRING_LENGTH" />
              </type>
            </variable>
          </outputVars>
        </interface>
        <body>
          <ST>
            (* check if an alarm is present if yes set the output M otherwise clear M *)
IF in1 THEN
	M := S1;
ELSIF in2 THEN
	M := S2;
ELSIF in3 THEN
	M := S3;
ELSIF in4 THEN
	M := S4;
ELSIF in5 THEN
	M := S5;
ELSIF in6 THEN
	M := S6;
ELSIF in7 THEN
	M := S7;
ELSIF in8 THEN
	M := S8;
ELSE
	M := '';
END_IF;

(* revision history
hm	26.12.2007		rev 1.0
	original version

hm	29. mar. 2008	rev 1.1
	changed STRING to STRING(STRING_LENGTH)
*)

          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>11d47efd-1574-425c-8c62-ea9afdfb0e81</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="MIRROR" pouType="function">
        <interface>
          <returnType>
            <string length="STRING_LENGTH" />
          </returnType>
          <inputVars>
            <variable name="str">
              <type>
                <string length="STRING_LENGTH" />
              </type>
            </variable>
          </inputVars>
          <localVars>
            <variable name="pi">
              <type>
                <pointer>
                  <baseType>
                    <array>
                      <dimension lower="1" upper="255" />
                      <baseType>
                        <BYTE />
                      </baseType>
                    </array>
                  </baseType>
                </pointer>
              </type>
            </variable>
            <variable name="po">
              <type>
                <pointer>
                  <baseType>
                    <BYTE />
                  </baseType>
                </pointer>
              </type>
            </variable>
            <variable name="lx">
              <type>
                <INT />
              </type>
            </variable>
            <variable name="i">
              <type>
                <INT />
              </type>
            </variable>
          </localVars>
        </interface>
        <body>
          <ST>
            pi := ADR(str);
po := ADR(mirror);
lx := LEN(str);
FOR i := lx TO 1 BY - 1 DO
	po^ := pi^[i];
	po := po + 1;
END_FOR;
(* close output string *)
po^:= 0;


(* revision histroy
hm	4. feb. 2008	rev 1.0
	original release

hm	29. mar. 2008	rev 1.1
	changed STRING to STRING(STRING_LENGTH)
*)	

          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>bdd92dd8-cafd-4a45-909c-f4ad5c192991</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="MONTH_TO_STRING" pouType="function">
        <interface>
          <returnType>
            <string length="10" />
          </returnType>
          <inputVars>
            <variable name="MTH">
              <type>
                <INT />
              </type>
            </variable>
            <variable name="LANG">
              <type>
                <INT />
              </type>
            </variable>
            <variable name="LX">
              <type>
                <INT />
              </type>
            </variable>
          </inputVars>
          <localVars>
            <variable name="ly">
              <type>
                <INT />
              </type>
            </variable>
          </localVars>
        </interface>
        <body>
          <ST>
            IF LANG &lt;= 0 THEN Ly := LANGUAGE.DEFAULT; ELSE ly := MIN(LANG, language.LMAX); END_IF;
IF MTH &lt; 1 OR MTH &gt; 12 THEN
	RETURN;
ELSIF LX = 0 THEN
	MONTH_TO_STRING := language.MONTHS[ly, MTH];
ELSIF Lx = 3 THEN
	MONTH_TO_STRING := language.MONTHS3[ly, MTH];
END_IF;


(* revisison history

hm	21. sep. 2008	rev 1.0
	original version

hm	19. oct. 2008	rev 1.1
	changed language setup constants

hm 16.  jul 2024   rev 1.2
       addaed boundary check to respect array limits
*)
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>86f48f59-d26e-4a46-86c7-b1ae9a6d398b</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="OCT_TO_BYTE" pouType="function">
        <interface>
          <returnType>
            <BYTE />
          </returnType>
          <inputVars>
            <variable name="OCT">
              <type>
                <string length="10" />
              </type>
            </variable>
          </inputVars>
          <localVars>
            <variable name="pt">
              <type>
                <pointer>
                  <baseType>
                    <BYTE />
                  </baseType>
                </pointer>
              </type>
            </variable>
            <variable name="i">
              <type>
                <INT />
              </type>
            </variable>
            <variable name="X">
              <type>
                <BYTE />
              </type>
            </variable>
            <variable name="stop">
              <type>
                <INT />
              </type>
            </variable>
          </localVars>
        </interface>
        <body>
          <ST>
            pt := ADR(oct);
stop := LEN(oct);
FOR I := 1 TO stop DO
	(* read the first character and subtract 48 to get value in decimal 0 = 48 *)
	x := pt^;
	(* calculate the value of the digit *)
	IF X &gt; 47 AND x &lt; 56 THEN
		OCT_TO_BYTE := SHL(OCT_TO_BYTE,3) + X - 48;
	END_IF;
	pt := pt + 1;
END_FOR;



(* revision histroy
hm	18. jun. 2008	rev 1.0
	original release

hm	20. sep. 2008	rev 1.1
	changed length of input string from 20 to 10

*)	

          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>5892fd06-77d1-4a17-9a09-f88b26cbcbe8</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="OCT_TO_DWORD" pouType="function">
        <interface>
          <returnType>
            <DWORD />
          </returnType>
          <inputVars>
            <variable name="OCT">
              <type>
                <string length="20" />
              </type>
            </variable>
          </inputVars>
          <localVars>
            <variable name="pt">
              <type>
                <pointer>
                  <baseType>
                    <BYTE />
                  </baseType>
                </pointer>
              </type>
            </variable>
            <variable name="i">
              <type>
                <INT />
              </type>
            </variable>
            <variable name="X">
              <type>
                <BYTE />
              </type>
            </variable>
            <variable name="stop">
              <type>
                <INT />
              </type>
            </variable>
          </localVars>
        </interface>
        <body>
          <ST>
            pt := ADR(oct);
stop := LEN(oct);
FOR I := 1 TO stop DO
	(* read the first character and subtract 48 to get value in decimal 0 = 48 *)
	x := pt^;
	(* calculate the value of the digit *)
	IF X &gt; 47 AND x &lt; 56 THEN
		OCT_TO_DWORD := SHL(OCT_TO_DWORD,3) + X - 48;
	END_IF;
	pt := pt + 1;
END_FOR;




(* revision histroy
hm	18. jun. 2008	rev 1.0
	original release


*)	

          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>b7f7da91-6a7a-4d10-bb35-754f96fd85ab</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="REAL_TO_STRF" pouType="function">
        <interface>
          <returnType>
            <string length="20" />
          </returnType>
          <inputVars>
            <variable name="IN">
              <type>
                <REAL />
              </type>
            </variable>
            <variable name="N">
              <type>
                <INT />
              </type>
            </variable>
            <variable name="D">
              <type>
                <string length="1" />
              </type>
            </variable>
          </inputVars>
          <localVars>
            <variable name="O">
              <type>
                <REAL />
              </type>
            </variable>
            <variable name="i">
              <type>
                <INT />
              </type>
            </variable>
          </localVars>
        </interface>
        <body>
          <ST>
            (* LIMIT N to 0 .. 7 *)
N := LIMIT(0,N,7);
(* round the input to N digits and convert to string *)
O := ABS(in) * EXP10(N);
REAL_TO_STRF := DINT_TO_STRING(REAL_TO_DINT(O));
(* add zeroes in front to make sure sting is at least 8 digits long *)
FOR i := LEN(REAL_TO_STRF) TO N DO REAL_TO_STRF := CONCAT('0', REAL_TO_STRF); END_FOR;
(* add a dot if n &gt; 0 *)
IF n &gt; 0 THEN REAL_TO_STRF := INSERT(REAL_TO_STRF, D, LEN(REAL_TO_STRF) - N); END_IF;
(* add a minus sign if in is negative *)
IF in &lt; 0 THEN REAL_TO_STRF := CONCAT('-', REAL_TO_STRF); END_IF;


(* revision history
hm	26 jan 2007	rev 1.0
	original version

hm	20. nov. 2007	rev 1.1
	when N=0 ther will be no dot at the end of the string.

hm	15. dec. 2007	rev 1.2
	changed code for better performance

hm	4. mar. 2008	rev 1.3
	result is now rounded instead of trunc

hm	20. mar. 2008	rev 1.4
	changed trunc to real_to_dint because trunc was generating wrong values on wago 842

hm	29. mar. 2008	rev 1.5
	changed STRING to STRING(20)

hm	4. apr. 2008	rev 1.6
	added variable O to avoid an error uner CoDeSys SP PLCWinNT V2.4

hm	27. feb. 2009	rev 1.7
	added a missing zero for IN &lt; 1

hm 2. jan 2012	rev 1.8
	added input parameter D to specify decimal separator
*)

          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>2bb54bf8-f4ed-4e42-923e-b310d68f6e0c</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="REPLACE_ALL" pouType="function">
        <interface>
          <returnType>
            <string length="STRING_LENGTH" />
          </returnType>
          <inputVars>
            <variable name="str">
              <type>
                <string length="STRING_LENGTH" />
              </type>
            </variable>
            <variable name="src">
              <type>
                <string length="STRING_LENGTH" />
              </type>
            </variable>
            <variable name="rep">
              <type>
                <string length="STRING_LENGTH" />
              </type>
            </variable>
          </inputVars>
          <localVars>
            <variable name="pos">
              <type>
                <INT />
              </type>
            </variable>
            <variable name="lp">
              <type>
                <INT />
              </type>
            </variable>
            <variable name="lx">
              <type>
                <INT />
              </type>
            </variable>
          </localVars>
        </interface>
        <body>
          <ST>
            REPLACE_ALL := str;
lx := LEN(src);
lp := LEN(rep);
pos := FINDP(REPLACE_ALL, src, 1);
WHILE pos &gt; 0 DO
	REPLACE_ALL := REPLACE(REPLACE_ALL,rep,lx, pos);
	pos := FINDP(REPLACE_ALL, src, pos + lp);
END_WHILE;

(* revision histroy
hm	4. feb. 2008	rev 1.0
	original release

hm	29. mar. 2008	rev 1.1
	changed STRING to STRING(STRING_LENGTH)
*)	

          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>f764a0d3-3eb9-4d74-af86-59e0c08d7d60</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="REPLACE_CHARS" pouType="function">
        <interface>
          <returnType>
            <string length="STRING_LENGTH" />
          </returnType>
          <inputVars>
            <variable name="STR">
              <type>
                <string length="STRING_LENGTH" />
              </type>
            </variable>
            <variable name="SRC">
              <type>
                <string />
              </type>
            </variable>
            <variable name="REP">
              <type>
                <string />
              </type>
            </variable>
          </inputVars>
          <localVars>
            <variable name="a">
              <type>
                <INT />
              </type>
            </variable>
            <variable name="b">
              <type>
                <INT />
              </type>
            </variable>
            <variable name="c">
              <type>
                <string length="1" />
              </type>
            </variable>
            <variable name="stp">
              <type>
                <INT />
              </type>
            </variable>
          </localVars>
        </interface>
        <body>
          <ST>
            REPLACE_CHARS := STR;
(* make sure rep and src are of same length and length is &gt; 0 *)
a := LEN(src);
b := LEN(rep);
IF a &lt; b THEN
	rep := LEFT(rep, a);
ELSIF b &lt; a THEN
	src := LEFT(src, b);
END_IF;

(* search the string and replace if necessary *)
stp := LEN(str);
FOR a := 1 TO stp DO
	c := MID(REPLACE_CHARS, 1, a);
	b := FIND(src, c);
	IF b &gt; 0 THEN
		REPLACE_CHARS := REPLACE(REPLACE_CHARS, MID(rep, 1, b), 1, a);
	END_IF;
END_FOR;



(* revision history
hm	14. may. 2008	rev 1.0
	original version

*)

          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>694e4851-ed8b-4f23-a9f6-c3241138c885</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="REPLACE_UML" pouType="function">
        <interface>
          <returnType>
            <string length="STRING_LENGTH" />
          </returnType>
          <inputVars>
            <variable name="str">
              <type>
                <string length="STRING_LENGTH" />
              </type>
            </variable>
          </inputVars>
          <localVars>
            <variable name="L">
              <type>
                <INT />
              </type>
            </variable>
            <variable name="pt">
              <type>
                <pointer>
                  <baseType>
                    <BYTE />
                  </baseType>
                </pointer>
              </type>
            </variable>
            <variable name="pto">
              <type>
                <pointer>
                  <baseType>
                    <BYTE />
                  </baseType>
                </pointer>
              </type>
            </variable>
            <variable name="ptm">
              <type>
                <pointer>
                  <baseType>
                    <BYTE />
                  </baseType>
                </pointer>
              </type>
            </variable>
            <variable name="pt1">
              <type>
                <pointer>
                  <baseType>
                    <BYTE />
                  </baseType>
                </pointer>
              </type>
            </variable>
            <variable name="pt2">
              <type>
                <pointer>
                  <baseType>
                    <BYTE />
                  </baseType>
                </pointer>
              </type>
            </variable>
            <variable name="su">
              <type>
                <string length="2" />
              </type>
            </variable>
            <variable name="pos">
              <type>
                <INT />
              </type>
            </variable>
          </localVars>
        </interface>
        <body>
          <ST>
            PT := ADR(str);
pto := ADR(REPLACE_UML);
ptm := pto + INT_TO_DWORD(string_length);
pt1 := ADR(su);
pt2 := pt1 + 1;
L := LEN(str);
WHILE pos &lt; L AND pos &lt; string_length DO
	IF pt^ &lt; 127 THEN
		(* no uml character simlply copy the character*)
		pto^ := pt^;
	ELSE
		(* convert the uml character *)
		su := TO_UML(pt^);
		(* we must make sure pointer are not out of range *)
		pto^ := pt1^;
		IF pto &lt; ptm AND pt2^ &gt; 0 THEN
			pto := pto + 1;
			pto^ := pt2^;
		END_IF;
	END_IF;
	(* increment pointers *)
	pt := pt + 1;
	pto := pto + 1;
	pos := pos + 1;
END_WHILE;

(* properly close the output string *)
pto^ := 0;


(* revision history
hm	29. feb 2008	rev 1.0
	original version

hm	29. mar. 2008	rev 1.1
	changed STRING to STRING(STRING_LENGTH)
	new code to avoid pointer out of range
	use new function to_uml
*)
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>521324d1-3a39-4456-bea6-7e753f63b415</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="TICKER" pouType="functionBlock">
        <interface>
          <inputVars>
            <variable name="N">
              <type>
                <INT />
              </type>
            </variable>
            <variable name="PT">
              <type>
                <TIME />
              </type>
            </variable>
          </inputVars>
          <inOutVars>
            <variable name="Text">
              <type>
                <string length="STRING_LENGTH" />
              </type>
            </variable>
          </inOutVars>
          <outputVars>
            <variable name="Display">
              <type>
                <string length="STRING_LENGTH" />
              </type>
            </variable>
          </outputVars>
          <localVars>
            <variable name="delay">
              <type>
                <derived name="TP" />
              </type>
            </variable>
            <variable name="step">
              <type>
                <INT />
              </type>
            </variable>
          </localVars>
        </interface>
        <body>
          <ST>
            
(* generate next ticker when delay is low *)
IF N &lt; LEN(text) THEN
	IF NOT delay.Q THEN
		(* increase step for next tick *)
		step := step + 1;
		IF step &gt; LEN(text) THEN step := 1; END_IF;
		(* extract dispay from text *)
		display := MID(text, N, step);
		(* set delay timer for next tick *)
		delay(in := TRUE, PT := PT);
	ELSE;
		(* execute delay timer *)
		delay(in := FALSE);
	END_IF;
ELSE
	display := text;
END_IF;
(* revision history
hm	4. dec. 2007	rev 1.0
	original version

hm	15. dec. 2007	rev 1.1
	step now starts at 1 instaed of 0

hm	29. mar. 2008	rev 1.2
	changed STRING to STRING(STRING_LENGTH)
*)
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>f096b874-3f19-415f-9785-e637e1e24c66</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="TO_LOWER" pouType="function">
        <interface>
          <returnType>
            <BYTE />
          </returnType>
          <inputVars>
            <variable name="IN">
              <type>
                <BYTE />
              </type>
            </variable>
          </inputVars>
        </interface>
        <body>
          <ST>
            IF in &gt; 64 AND in &lt; 91 THEN
   TO_LOWER := in OR 16#20;
ELSIF (in &gt; 191 AND in &lt; 223) AND in &lt;&gt; 215 AND setup.EXTENDED_ASCII THEN
   TO_LOWER := in OR 16#20;
ELSE
   TO_LOWER := in;
END_IF;


(* revision history
hm	6. mar. 2008	rev 1.0
	original version

hm	19. oct. 2008	rev 1.1
	changed setup constants

ks	25. oct. 2008	rev 1.2
	optimized code
*)
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>fb79935a-2978-4015-bcd9-cb7eb12716b1</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="TO_UML" pouType="function">
        <interface>
          <returnType>
            <string length="2" />
          </returnType>
          <inputVars>
            <variable name="IN">
              <type>
                <BYTE />
              </type>
            </variable>
          </inputVars>
        </interface>
        <body>
          <ST>
            CASE in OF
	196:	(* Ä *)
		TO_UML := 'Ae';
	214:	(* Ö *)
		TO_UML := 'Oe';
	220:	(* Ü *)
		TO_UML := 'Ue';
	223:	(* ß *)
		TO_UML := 'ss';
	228:	(* ä *)
		TO_UML := 'ae';
	246:	(* ö *)
		TO_UML := 'oe';
	252:	(* ü *)
		TO_UML := 'ue';
ELSE
	TO_UML := CHR_TO_STRING(IN);
END_CASE;



(* revision history
hm	29. mar. 2008	rev 1.0
	original version

hm	17. dec. 2008	rev 1.1
	changes name of function chr to chr_to_string

*)
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>419ce673-7550-4e21-8f34-cd98a8538519</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="TO_UPPER" pouType="function">
        <interface>
          <returnType>
            <BYTE />
          </returnType>
          <inputVars>
            <variable name="IN">
              <type>
                <BYTE />
              </type>
            </variable>
          </inputVars>
        </interface>
        <body>
          <ST>
            IF in &gt; 96 AND in &lt; 123 THEN
   TO_UPPER := in AND 16#DF;
ELSIF in &gt; 223 AND in &lt;&gt; 247 AND in &lt;&gt; 255 AND setup.EXTENDED_ASCII THEN
   TO_UPPER := in AND 16#DF;
ELSE
   TO_UPPER := in;
END_IF;




(* revision history
hm	6. mar. 2008	rev 1.0
	original version

hm	19. oct. 2008	rev 1.1
	changed setup constants

ks	25. oct. 2008	rev 1.2
	optimized code

hm 16. jan 2009	rev 1.3
	corrected an error in module

*)
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>4b6e3779-abc7-4c4f-84c1-c88f9b5264ee</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="TRIM" pouType="function">
        <interface>
          <returnType>
            <string length="STRING_LENGTH" />
          </returnType>
          <inputVars>
            <variable name="str">
              <type>
                <string length="STRING_LENGTH" />
              </type>
            </variable>
          </inputVars>
          <localVars>
            <variable name="pos">
              <type>
                <INT />
              </type>
            </variable>
          </localVars>
        </interface>
        <body>
          <ST>
            TRIM := str;
REPEAT
	pos := FIND(trim,' ');
	IF pos &gt; 0 THEN TRIM := REPLACE(TRIM,'',1,pos); END_IF;
UNTIL pos = 0	END_REPEAT;


(* revision histroy
hm	6.10.2006		rev 1.0
	original release

hm	20. mar. 2008	rev 1.1
	avoid to call replace with pos = 0 because some systems will produce an error

hm	29. mar. 2008	rev 1.2
	changed STRING to STRING(STRING_LENGTH)
*)
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>0d78c907-8992-4041-9daa-976f34794752</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="TRIM1" pouType="function">
        <interface>
          <returnType>
            <string length="STRING_LENGTH" />
          </returnType>
          <inputVars>
            <variable name="str">
              <type>
                <string length="STRING_LENGTH" />
              </type>
            </variable>
          </inputVars>
          <localVars>
            <variable name="pos">
              <type>
                <INT />
              </type>
            </variable>
          </localVars>
        </interface>
        <body>
          <ST>
            TRIM1 := str;
REPEAT
	pos := FIND(trim1,'  ');
	IF pos &gt; 0 THEN TRIM1 := REPLACE(TRIM1,' ',2,pos); END_IF;
UNTIL pos = 0	END_REPEAT;
(* beginning and ending blanks need to be stripped off *)
IF LEFT(trim1,1) = ' ' THEN trim1 := DELETE(trim1,1,1); END_IF;
IF RIGHT(trim1,1) = ' ' THEN trim1 := DELETE(trim1,1,LEN(trim1)); END_IF;


(* revision histroy
hm	4. feb. 2008    rev 1.0
	original release

hm	20. mar. 2008	rev 1.1
	avoid to call replace with pos = 0 because some systems will produce an error

hm	29. mar. 2008	rev 1.2
	changed STRING to STRING(STRING_LENGTH)
*)
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>e40aceb7-295f-458a-a3fe-2b4581a1ee41</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="TRIME" pouType="function">
        <interface>
          <returnType>
            <string length="string_length" />
          </returnType>
          <inputVars>
            <variable name="str">
              <type>
                <string length="STRING_LENGTH" />
              </type>
            </variable>
          </inputVars>
        </interface>
        <body>
          <ST>
            TRIME := str;
(* beginning blanks need to be stripped off *)
WHILE LEFT(TRIME,1) = ' ' DO
	TRIME := DELETE(TRIME,1,1);
END_WHILE;

(* ending blanks need to be stripped off *)
WHILE RIGHT(TRIME,1) = ' ' DO
	TRIME := DELETE(TRIME,1,LEN(TRIME));
END_WHILE;


(* revision histroy
hm	28. mar. 2008	rev 1.0
	original release

*)
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>ce8401d8-0a4f-4484-9905-1f8c2890dc17</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="UPPERCASE" pouType="function">
        <interface>
          <returnType>
            <string length="STRING_LENGTH" />
          </returnType>
          <inputVars>
            <variable name="str">
              <type>
                <string length="STRING_LENGTH" />
              </type>
            </variable>
          </inputVars>
          <localVars>
            <variable name="pt">
              <type>
                <pointer>
                  <baseType>
                    <BYTE />
                  </baseType>
                </pointer>
              </type>
            </variable>
            <variable name="pos">
              <type>
                <INT />
              </type>
            </variable>
            <variable name="l">
              <type>
                <INT />
              </type>
            </variable>
          </localVars>
        </interface>
        <body>
          <ST>
            pt := ADR(UPPERCASE);
UPPERCASE := str;
l := LEN(str);
FOR pos := 1 TO l DO
	pt^ := TO_UPPER(pt^);
	pt := pt + 1;
END_FOR;

(* revision histroy
hm	6. oct. 2006	rev 1.0
	original release

hm	4. feb. 2008	rev 1.1
	improved performance
	added Ä,Ö,Ü

hm	6. mar. 2008	rev 1.2
	added support for exteded Ascii

hm	29. mar. 2008	rev 1.3
	changed STRING to STRING(STRING_LENGTH)

*)	

          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>437d53c1-b36a-4b49-8104-e233c079570a</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="WEEKDAY_TO_STRING" pouType="function">
        <interface>
          <returnType>
            <string length="10" />
          </returnType>
          <inputVars>
            <variable name="WDAY">
              <type>
                <INT />
              </type>
            </variable>
            <variable name="LANG">
              <type>
                <INT />
              </type>
            </variable>
            <variable name="LX">
              <type>
                <INT />
              </type>
            </variable>
          </inputVars>
          <localVars>
            <variable name="ly">
              <type>
                <INT />
              </type>
            </variable>
          </localVars>
        </interface>
        <body>
          <ST>
            IF LANG = 0 THEN ly := LANGUAGE.DEFAULT; ELSE ly := MIN(LANG, LANGUAGE.LMAX); END_IF;
IF wday &lt; 1 OR wday &gt; 7 THEN
	RETURN;
ELSIF LX = 0 THEN
	WEEKDAY_TO_STRING := language.WEEKDAYS[ly, WDAY];
ELSIF Lx = 2 THEN
	WEEKDAY_TO_STRING := language.WEEKDAYS2[ly, WDAY];
END_IF;


(* revisison history

hm	21. sep. 2008	rev 1.0
	original version

hm	19. oct. 2008	rev 1.1
	changed language setup constants
*)
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>e2ea22d6-05d5-4cd8-98b1-eb954c9aced7</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="CALENDAR_CALC" pouType="functionBlock">
        <interface>
          <inputVars>
            <variable name="SPE">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="H">
              <type>
                <REAL />
              </type>
              <initialValue>
                <simpleValue value="-0.83333333333" />
              </initialValue>
            </variable>
          </inputVars>
          <inOutVars>
            <variable name="XCAL">
              <type>
                <derived name="CALENDAR" />
              </type>
            </variable>
            <variable name="HOLIDAYS">
              <type>
                <array>
                  <dimension lower="0" upper="29" />
                  <baseType>
                    <derived name="HOLIDAY_DATA" />
                  </baseType>
                </array>
              </type>
            </variable>
          </inOutVars>
          <localVars>
            <variable name="last">
              <type>
                <DT />
              </type>
            </variable>
            <variable name="last_day">
              <type>
                <DINT />
              </type>
            </variable>
            <variable name="holy">
              <type>
                <derived name="HOLIDAY" />
              </type>
            </variable>
            <variable name="sun">
              <type>
                <derived name="SUN_TIME" />
              </type>
            </variable>
            <variable name="last_hour">
              <type>
                <INT />
              </type>
            </variable>
            <variable name="utod">
              <type>
                <TOD />
              </type>
            </variable>
            <variable name="pos">
              <type>
                <derived name="SUN_POS" />
              </type>
            </variable>
            <variable name="plast">
              <type>
                <DT />
              </type>
            </variable>
          </localVars>
          <tempVars>
            <variable name="dtemp">
              <type>
                <DINT />
              </type>
            </variable>
            <variable name="tmp">
              <type>
                <INT />
              </type>
            </variable>
          </tempVars>
        </interface>
        <body>
          <ST>
            IF xcal.UTC &lt;&gt; last THEN
	(* run once per second *)
	(* update utc last calculated  *)
	last := XCAL.UTC;
	utod := DT_TO_TOD(xcal.UTC);

	(* calculate ltc from utc *)
	XCAL.LOCAL_DT := UTC_TO_LTIME(XCAL.UTC, XCAL.DST_EN, XCAL.OFFSET);
	XCAL.LOCAL_DATE := DT_TO_DATE(XCAL.LOCAL_DT);
	XCAL.LOCAL_TOD := DT_TO_TOD(XCAL.LOCAL_DT);
	dtemp := DAY_OF_DATE(XCAL.LOCAL_DATE);
	xcal.night := XCAL.LOCAL_TOD &lt; XCAL.SUN_RISE OR XCAL.LOCAL_TOD &gt; XCAL.SUN_SET;

	(* run once per hour *)
	tmp := HOUR(xcal.LOCAL_TOD);
	IF  tmp &lt;&gt; last_hour THEN
		XCAL.DST_ON := DST(XCAL.UTC) AND xcal.DST_EN;
		last_hour := tmp;
	END_IF;

	(* run once per day *)
	IF dtemp &lt;&gt; last_day THEN
		last_day := dtemp;
		(* a new day has started, recalculate daily events *)
		XCAL.YEAR := YEAR_OF_DATE(XCAL.LOCAL_DATE);
		XCAL.MONTH := MONTH_OF_DATE(XCAL.LOCAL_DATE);
		XCAL.DAY := DAY_OF_MONTH(XCAL.LOCAL_DATE);
		XCAL.WEEKDAY := DAY_OF_WEEK(XCAL.LOCAL_DATE);
		HOLY(date_in := XCAL.LOCAL_DATE, LANGU := xcal.LANGUAGE, HOLIDAYS := HOLIDAYS);
		XCAL.HOLIDAY := HOLY.Y;
		XCAL.HOLY_NAME := HOLY.NAME;
		sun(latitude := XCAL.LATITUDE, longitude := xcal.LONGITUDE, utc := DT_TO_DATE(xcal.UTC), H := H);
		XCAL.SUN_RISE := DINT_TO_TOD(TOD_TO_DINT(sun.sun_rise) + XCAL.OFFSET * 60000 + SEL(XCAL.DST_ON,DINT#0,3600000));
		XCAL.SUN_SET := DINT_TO_TOD(TOD_TO_DINT(sun.sun_set) + XCAL.OFFSET * 60000 + SEL(XCAL.DST_ON,DINT#0,3600000));
		XCAL.SUN_MIDDAY := DINT_TO_TOD(TOD_TO_DINT(sun.MIDDAY) + XCAL.OFFSET * 60000 + SEL(XCAL.DST_ON,DINT#0,3600000));
		XCAL.SUN_HEIGTH := sun.sun_declination;
		XCAL.WORK_WEEK := WORK_WEEK(XCAL.LOCAL_DATE);
	END_IF;

	(* calculate the suns position every 10 seconds when SPE = TRUE *)
	IF SPE AND xcal.UTC -  plast &gt;= t#25s THEN
		plast := last;
		pos(latitude := xcal.LATITUDE, longitude := xcal.LONGITUDE, utc := xcal.UTC);
		xcal.SUN_HOR := pos.B;
		xcal.SUN_VER := pos.HR;
	END_IF;
END_IF;



(* revision history

hm 23. oct. 2008	rev 1.0
	original version

hm	8. feb. 2009	rev 1.1
	night was calculated wrong
	added sun position data

hm	10. mar. 2009	rev 1.2
	added work_week, sun_midday, sun_heigth
	sun_position will only be calculated evey 25 seconds
	dst will only become true when dst_en = true

hm	23. jan 2010	rev 1.3
	sun_rise, sun_set and sun_midday are now calculated in local time

hm	18. jan. 2011	rev 1.4
	added input holidays to specify local holidays
	changed call for function sun_time

hm	2. feb. 2011	rev 1.5
	added input H to specify twilight

hm	6. apr. 2011	rev 1.6
	night was calculated wrong

HM 3. Feb 2021    rev 1.7
   chaged LDT &gt;&gt; LOCAL_DT, LDATE &gt;&gt; LOCAL_DT, LTOD &gt;&gt; LOCAL_TOD

*)
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>3e9a6fe3-0deb-41b2-815e-66cd37d5d1df</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="DATE_ADD" pouType="function">
        <interface>
          <returnType>
            <DATE />
          </returnType>
          <inputVars>
            <variable name="IDATE">
              <type>
                <DATE />
              </type>
            </variable>
            <variable name="D">
              <type>
                <INT />
              </type>
            </variable>
            <variable name="W">
              <type>
                <INT />
              </type>
            </variable>
            <variable name="M">
              <type>
                <INT />
              </type>
            </variable>
            <variable name="Y">
              <type>
                <INT />
              </type>
            </variable>
          </inputVars>
          <localVars>
            <variable name="mo">
              <type>
                <INT />
              </type>
            </variable>
            <variable name="yr">
              <type>
                <INT />
              </type>
            </variable>
            <variable name="dm">
              <type>
                <INT />
              </type>
            </variable>
          </localVars>
        </interface>
        <body>
          <ST>
            DATE_ADD := UDINT_TO_DATE(DATE_TO_UDINT(IDATE) + INT_TO_UDINT(D + W * 7) * UDINT#86400);
yr := Y + YEAR_OF_DATE(DATE_ADD);
mo := M + MONTH_OF_DATE(DATE_ADD);
dm := DAY_OF_MONTH(DATE_ADD);
WHILE mo &gt; 12 DO
	mo := mo - 12;
	yr := yr + 1;
END_WHILE;
WHILE mo &lt; 1 DO
	mo := mo + 12;
	yr := yr - 1;
END_WHILE;
DATE_ADD := SET_DATE(yr, mo, dm);


(* revision history

hm 27.12.2006	rev 1.0
	nrw module

hm 12.4.2007		rev 1.1
	corrected an error while date would be incorrect when year  = 0

hm	1.11.2007		rev 1.2
	added int_to_dword stetements to avoid possible overrun with möller ecp4

hm	22. mar. 2008	rev 1.3
	fixed some bugs when month was negative

hm	7. oct. 2008	rev 1.4
	changed function year to year_of_date
	changed function month to month_of_date

hm	29. mar. 2009	rev 1.5
	improved performance

hm	27. jan. 2011	rev 1.6
	faster code

hm	2. feb. 2011		rev 1.7
	fixed an error, weeks not calculated

hm	22. mar. 2011	rev 1.8
	fixed an error in formula
*)
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>8a934e33-7cfe-456e-87ca-acd7e298c2bf</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="DAY_OF_DATE" pouType="function">
        <interface>
          <returnType>
            <DINT />
          </returnType>
          <inputVars>
            <variable name="idate">
              <type>
                <DATE />
              </type>
            </variable>
          </inputVars>
        </interface>
        <body>
          <ST>
            DAY_OF_DATE := DWORD_TO_DINT(DATE_TO_DWORD(idate) / 86400);


(* revision history
hm		16.9.2007		rev 1.0
	original version

hm		1. okt 2007		rev 1.1
	added step7 compatibility

hm		22. mar. 2008	rev 1.2
	changed output from int to Dint because the total date range is 49710 days

hm		7. apr. 2008	rev 1.3
	deleted unused step7 code

*)
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>e621743d-64b1-41ad-97a7-c7f0430773f0</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="DAY_OF_MONTH" pouType="function">
        <interface>
          <returnType>
            <INT />
          </returnType>
          <inputVars>
            <variable name="IDATE">
              <type>
                <DATE />
              </type>
            </variable>
          </inputVars>
          <localVars>
            <variable name="leap">
              <type>
                <INT />
              </type>
            </variable>
          </localVars>
        </interface>
        <body>
          <ST>
            (* calculate the day in the year *)
DAY_OF_MONTH := DAY_OF_YEAR(idate);
(* leap will be set to one for a leap year *)
leap := BOOL_TO_INT(LEAP_OF_DATE(idate));
(* if leap year deduct one from the days of the year *)
DAY_OF_MONTH := DAY_OF_MONTH - leap;
(* search if we are in month december to march ? *)
IF DAY_OF_MONTH &gt; setup.MTH_OFS[9] THEN
	IF DAY_OF_MONTH &gt; setup.MTH_OFS[11] THEN
		IF DAY_OF_MONTH &gt; setup.mth_ofs[12] THEN
			DAY_OF_MONTH := DAY_OF_MONTH - setup.MTH_OFS[12];
		ELSE
			DAY_OF_MONTH := DAY_OF_MONTH - setup.MTH_OFS[11];
		END_IF;
	ELSE
		IF DAY_OF_MONTH &gt; setup.mth_ofs[10] THEN
			DAY_OF_MONTH := DAY_OF_MONTH - setup.MTH_OFS[10];
		ELSE
			DAY_OF_MONTH := DAY_OF_MONTH - setup.MTH_OFS[9];
		END_IF;
	END_IF;
ELSIF DAY_OF_MONTH &gt; setup.MTH_OFS[5] THEN
	IF DAY_OF_MONTH &gt; setup.MTH_OFS[7] THEN
		IF DAY_OF_MONTH &gt; setup.mth_ofs[8] THEN
			DAY_OF_MONTH := DAY_OF_MONTH - setup.MTH_OFS[8];
		ELSE
			DAY_OF_MONTH := DAY_OF_MONTH - setup.MTH_OFS[7];
		END_IF;
	ELSE
		IF DAY_OF_MONTH &gt; setup.mth_ofs[6] THEN
			DAY_OF_MONTH := DAY_OF_MONTH - setup.MTH_OFS[6];
		ELSE
			DAY_OF_MONTH := DAY_OF_MONTH - setup.MTH_OFS[5];
		END_IF;
	END_IF;
ELSIF DAY_OF_MONTH &gt; setup.MTH_OFS[3] THEN
	IF DAY_OF_MONTH &gt; setup.MTH_OFS[4] THEN
		DAY_OF_MONTH := DAY_OF_MONTH - setup.MTH_OFS[4];
	ELSE
		DAY_OF_MONTH := DAY_OF_MONTH - setup.MTH_OFS[3];
	END_IF;
ELSE
	(* since now we must be in february or january we need to add leap again *)
	DAY_OF_MONTH := DAY_OF_MONTH + leap;
	IF DAY_OF_MONTH &gt; setup.MTH_OFS[2] THEN DAY_OF_MONTH := DAY_OF_MONTH - setup.mth_ofs[2]; END_IF;
	(* since nothing was true before, day_of_month must already be good *)
END_IF;


(*
Revision history

hm 22.1.2007		rev 1.1
	deleted unused variable day_in_year and day_in_year_begin

hm	1. okt 2007	rev 1.2
	changed code to use day_of_year and leap_of_date
	added compatibility to STEP7

hm	8. oct 2007	rev 1.3
	deleted unused variable yr

hm	8. jan 2008	rev 1.4
	improved performance

hm	25. oct. 2008	rev 2.0
	new code using setup constants

hm	10. mar. 2009	rev 2.1
	removed nested comments

*)


          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>fc259f55-0b52-4d08-a77a-dcf8e2c4135b</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="DAY_OF_WEEK" pouType="function">
        <interface>
          <returnType>
            <INT />
          </returnType>
          <inputVars>
            <variable name="IDATE">
              <type>
                <DATE />
              </type>
            </variable>
          </inputVars>
        </interface>
        <body>
          <ST>
            DAY_OF_WEEK := DWORD_TO_INT((DATE_TO_DWORD(idate) / 86400 + 3) MOD 7) + 1;


(* revision history
hm 	21.8.06 		rev 1.1
	corrected a miscalculation

hm	23.12.2007		rev 1.2
	correction for step7

hm	7. apr. 2008	rev 1.3
	deleted unused step7 code

hm	7. oct. 2008	rev 1.4
	changed name of function from weekday to day_of_week

*)




          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>8a1b65b6-6f7c-470b-94ad-ee081dcb162c</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="DAY_OF_YEAR" pouType="function">
        <interface>
          <returnType>
            <INT />
          </returnType>
          <inputVars>
            <variable name="IDATE">
              <type>
                <DATE />
              </type>
            </variable>
          </inputVars>
        </interface>
        <body>
          <ST>
            DAY_OF_YEAR := UDINT_TO_INT((DATE_TO_UDINT(idate) / UDINT#86400) MOD UDINT#1461);
IF DAY_OF_YEAR &gt; 729 THEN
	IF DAY_OF_YEAR &gt; 1095 THEN DAY_OF_YEAR := DAY_OF_YEAR - 1095; ELSE DAY_OF_YEAR := DAY_OF_YEAR - 729; END_IF;
ELSIF DAY_OF_YEAR &gt; 364 THEN
	DAY_OF_YEAR := DAY_OF_YEAR - 364;
ELSE
	DAY_OF_YEAR := DAY_OF_YEAR + 1;
END_IF;


(*
DAY_OF_YEAR := DWORD_TO_INT((DATE_TO_DWORD(idate) - DATE_TO_DWORD(YEAR_BEGIN(YEAR_OF_DATE(idate)))) / 86400) + 1;
*)


(* revivision history
hm	4. aug. 2007		rev 1.0
	original version

hm	1. oct. 2007		rev 1.1
	added compatibility to STEP7

hm	4. jan. 2008		rev 1.2
	changed code for better performance

hm	7. oct. 2008		rev 1.3
	changed name of function year to year_of_date

hm	28. jan. 2011	rev 1.4
	improved code
*)
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>0939d32b-f804-45d5-b4f5-a489326224cb</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="DAY_TO_TIME" pouType="function">
        <interface>
          <returnType>
            <TIME />
          </returnType>
          <inputVars>
            <variable name="IN">
              <type>
                <REAL />
              </type>
            </variable>
          </inputVars>
        </interface>
        <body>
          <ST>
            DAY_TO_TIME := DWORD_TO_TIME(REAL_TO_DWORD(IN * 86400000.0));


(* revision history
hm	4. aug. 2006	rev 1.0
	original release

hm	24. feb. 2009	rev 1.1
	renamed input to IN
*)
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>2627f0ed-46f0-4962-9726-d7ea4a018296</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="DAYS_DELTA" pouType="function">
        <interface>
          <returnType>
            <DINT />
          </returnType>
          <inputVars>
            <variable name="date_1">
              <type>
                <DATE />
              </type>
            </variable>
            <variable name="date_2">
              <type>
                <DATE />
              </type>
            </variable>
          </inputVars>
        </interface>
        <body>
          <ST>
            IF DATE_1 &gt; DATE_2 THEN
	DAYS_DELTA := - DWORD_TO_DINT((DATE_TO_DWORD(date_1) - DATE_TO_DWORD(date_2)) / 86400);
ELSE
	DAYS_DELTA := DWORD_TO_DINT((DATE_TO_DWORD(date_2) - DATE_TO_DWORD(date_1)) / 86400);
END_IF;

(* revision history
hm	27. dec 2006	rev 1.0
	original version

hm	16.9.2007		rev 1.1
	coorected an error in formula and changed algorithm to show positive and negative delta

hm	22. mar. 2008	rev 1.2
	changed output from int to dint because the total date range is 49710 days

hm	25. jan. 2011	rev 1.3
	improved performance
*)
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>4ac20e80-8857-4bd8-812e-5d9edbe41f23</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="DAYS_IN_MONTH" pouType="function">
        <interface>
          <returnType>
            <INT />
          </returnType>
          <inputVars>
            <variable name="IDATE">
              <type>
                <DATE />
              </type>
            </variable>
          </inputVars>
        </interface>
        <body>
          <ST>
            DAYS_IN_MONTH := DAY_OF_YEAR(IDATE);
IF LEAP_OF_DATE(IDATE) THEN
	CASE DAYS_IN_MONTH OF
		32..60	:	DAYS_IN_MONTH := 29;
		92..121 :	DAYS_IN_MONTH := 30;
		153..182:	DAYS_IN_MONTH := 30;
		245..274:	DAYS_IN_MONTH := 30;
		306..335:	DAYS_IN_MONTH := 30;
	ELSE
		DAYS_IN_MONTH := 31;
	END_CASE;
ELSE
	CASE DAYS_IN_MONTH OF
		32..59	:	DAYS_IN_MONTH := 28;
		91..120 :	DAYS_IN_MONTH := 30;
		152..181:	DAYS_IN_MONTH := 30;
		244..273:	DAYS_IN_MONTH := 30;
		305..334:	DAYS_IN_MONTH := 30;
	ELSE
		DAYS_IN_MONTH := 31;
	END_CASE;
END_IF;



(* revision history
hm	27. mar. 2009		rev 1.0
	original version

*)
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>6d022f16-875d-4df0-a857-a324e28eef18</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="DAYS_IN_YEAR" pouType="function">
        <interface>
          <returnType>
            <INT />
          </returnType>
          <inputVars>
            <variable name="IDATE">
              <type>
                <DATE />
              </type>
            </variable>
          </inputVars>
        </interface>
        <body>
          <ST>
            IF LEAP_OF_DATE(IDATE) THEN
	DAYS_IN_YEAR := 366;
ELSE
	DAYS_IN_YEAR := 365;
END_IF;


(* revision history
hm	27. mar. 2009		rev 1.0
	original version

*)
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>14b1d84a-992e-4488-a324-eaac58ad0b4d</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="DCF77" pouType="functionBlock">
        <interface>
          <inputVars>
            <variable name="REC">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="SET">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="SDT">
              <type>
                <DT />
              </type>
            </variable>
            <variable name="DSI">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="SYNC_TIMEOUT">
              <type>
                <TIME />
              </type>
              <initialValue>
                <simpleValue value="TIME#2m0s0ms" />
              </initialValue>
              <addData>
                <data name="http://www.3s-software.com/plcopenxml/attributes" handleUnknown="implementation">
                  <Attributes>
                    <Attribute Name="input_constant" Value="" />
                  </Attributes>
                </data>
              </addData>
            </variable>
            <variable name="TIME_OFFSET">
              <type>
                <INT />
              </type>
              <initialValue>
                <simpleValue value="1" />
              </initialValue>
              <addData>
                <data name="http://www.3s-software.com/plcopenxml/attributes" handleUnknown="implementation">
                  <Attributes>
                    <Attribute Name="input_constant" Value="" />
                  </Attributes>
                </data>
              </addData>
            </variable>
            <variable name="DST_EN">
              <type>
                <BOOL />
              </type>
              <initialValue>
                <simpleValue value="TRUE" />
              </initialValue>
              <addData>
                <data name="http://www.3s-software.com/plcopenxml/attributes" handleUnknown="implementation">
                  <Attributes>
                    <Attribute Name="input_constant" Value="" />
                  </Attributes>
                </data>
              </addData>
            </variable>
          </inputVars>
          <outputVars>
            <variable name="TP">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="DS">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="WDAY">
              <type>
                <INT />
              </type>
            </variable>
            <variable name="ERROR">
              <type>
                <BOOL />
              </type>
              <initialValue>
                <simpleValue value="TRUE" />
              </initialValue>
            </variable>
            <variable name="RTC">
              <type>
                <DT />
              </type>
            </variable>
            <variable name="RTC1">
              <type>
                <DT />
              </type>
            </variable>
            <variable name="MSEC">
              <type>
                <INT />
              </type>
            </variable>
            <variable name="SYNC">
              <type>
                <BOOL />
              </type>
            </variable>
          </outputVars>
          <localVars>
            <variable name="mez">
              <type>
                <DT />
              </type>
            </variable>
            <variable name="utc">
              <type>
                <DT />
              </type>
            </variable>
            <variable name="state">
              <type>
                <INT />
              </type>
            </variable>
            <variable name="edge">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="tx">
              <type>
                <TIME />
              </type>
            </variable>
            <variable name="ty">
              <type>
                <TIME />
              </type>
            </variable>
            <variable name="last">
              <type>
                <TIME />
              </type>
            </variable>
            <variable name="bits">
              <type>
                <array>
                  <dimension lower="0" upper="58" />
                  <baseType>
                    <BOOL />
                  </baseType>
                </array>
              </type>
            </variable>
            <variable name="cnt">
              <type>
                <INT />
              </type>
            </variable>
            <variable name="i">
              <type>
                <INT />
              </type>
            </variable>
            <variable name="old_time">
              <type>
                <DT />
              </type>
            </variable>
            <variable name="minute">
              <type>
                <INT />
              </type>
            </variable>
            <variable name="hour">
              <type>
                <INT />
              </type>
            </variable>
            <variable name="day">
              <type>
                <INT />
              </type>
            </variable>
            <variable name="month">
              <type>
                <INT />
              </type>
            </variable>
            <variable name="year">
              <type>
                <INT />
              </type>
            </variable>
            <variable name="last_sync">
              <type>
                <TIME />
              </type>
            </variable>
            <variable name="t1">
              <type>
                <TIME />
              </type>
            </variable>
            <variable name="tz">
              <type>
                <TIME />
              </type>
            </variable>
            <variable name="init">
              <type>
                <BOOL />
              </type>
            </variable>
          </localVars>
        </interface>
        <body>
          <ST>
            (* if tp was set it should only be active for 1 cycle *)
TP := FALSE;

(* read system time *)
t1 := DWORD_TO_TIME(T_PLC_MS());
tx := t1 - last;

IF rec XOR edge THEN
	edge := rec;
	IF NOT rec AND tx &gt; t#1700ms AND tx &lt; t#2000ms THEN
		(* start condition reached *)
		state := 0;
		tp := NOT error;
	ELSIF NOT rec AND tx &gt; t#700ms AND tx &lt; t#1000ms THEN
		(* second switch detected *)
		IF state &lt; 58 THEN state := state +1; ELSE state := 0; END_IF;
	ELSIF rec AND tx  &lt; t#120ms THEN
		(* bit 0 detected  *)
		bits[state] := 0;
	ELSIF rec AND tx &gt; t#120ms AND tx &lt; t#250ms THEN
		(* bit 1 detected *)
		bits[state] := 1;
	ELSE
		(* error condition received signal is not valid *)
		error := TRUE;
		state := 0;
	END_IF;
	last := last + tx;
	IF rec AND state = 58 THEN
		error := FALSE;

		(* decode the bits and check for possible errors *)
		IF bits[0] OR NOT (bits[17] XOR bits[18]) OR NOT bits[20] THEN error := TRUE; END_IF;
		(* decode minute *)
		MINUTE := 0;
		MINUTE.0 := bits[21];
		MINUTE.1 := bits[22];
		MINUTE.2 := bits[23];
		MINUTE.3 := bits[24];
		IF bits[25] THEN MINUTE := MINUTE + 10; END_IF;
		IF bits[26] THEN MINUTE := MINUTE + 20; END_IF;
		IF bits[27] THEN MINUTE := MINUTE + 40; END_IF;
		IF MINUTE &gt; 59 OR (bits[21] XOR bits[22] XOR bits[23] XOR bits[24] XOR bits[25] XOR bits[26] XOR bits[27] XOR bits[28]) THEN error := TRUE; END_IF;

		(* decode hour *)
		HOUR := 0;
		HOUR.0 := bits[29];
		HOUR.1 := bits[30];
		HOUR.2 := bits[31];
		HOUR.3 := bits[32];
		IF bits[33] THEN HOUR := HOUR + 10; END_IF;
		IF bits[34] THEN HOUR := HOUR +20; END_IF;
		IF HOUR &gt; 23 OR (bits[29] XOR bits[30] XOR bits[31] XOR bits[32] XOR bits[33] XOR bits[34] XOR bits[35]) THEN error := TRUE; END_IF;

		(* decode day of month *)
		day := 0;
		day.0 := bits[36];
		day.1 := bits[37];
		day.2 := bits[38];
		day.3 := bits[39];
		IF bits[40] THEN day := day + 10; END_IF;
		IF bits[41] THEN day := day + 20; END_IF;
		IF day &gt; 31 THEN error := TRUE; END_IF;

		(* decode day of week *)
		wday := 0;
		wday.0 := bits[42];
		wday.1 := bits[43];
		wday.2 := bits[44];
		IF wday &gt; 7 OR wday &lt; 1 THEN error := TRUE; END_IF;

		(* decode month *)
		MONTH := 0;
		MONTH.0 := bits[45];
		MONTH.1 := bits[46];
		MONTH.2 := bits[47];
		MONTH.3 := bits[48];
		IF bits[49] THEN MONTH := MONTH +10; END_IF;
		IF MONTH &gt; 12 THEN error := TRUE; END_IF;

		(* decode year *)
		YEAR := 0;
		YEAR.0 := bits[50];
		YEAR.1 := bits[51];
		YEAR.2 := bits[52];
		YEAR.3 := bits[53];
		IF bits[54] THEN YEAR := YEAR + 10; END_IF;
		IF bits[55] THEN YEAR := YEAR + 20; END_IF;
		IF bits[56] THEN YEAR := YEAR + 40; END_IF;
		IF bits[57] THEN YEAR := YEAR + 80; END_IF;

		(* check parity for bits 36 to 58 *)
		cnt := 0;
		FOR i := 36 TO 58 DO IF bits[i] THEN cnt := cnt + 1; END_IF; END_FOR;
		IF NOT EVEN(cnt) THEN error := TRUE; END_IF;

		(* time must be valid for two cycles to clear error flag *)
		IF NOT error THEN
			(* set outputs *)
			old_time := mez;
			IF YEAR &gt;= 70 THEN YEAR := YEAR + 1900; ELSE YEAR := YEAR + 2000; END_IF;
			mez := SET_DT(YEAR,MONTH,day,HOUR,MINUTE,0);
			DS := bits[17];
			IF DS THEN
				UTC := DWORD_TO_DT(DT_TO_DWORD(mez) - 7200);
			ELSE
				UTC := DWORD_TO_DT(DT_TO_DWORD(mez) - 3600);
			END_IF;

			(* set trigger signal only if the receiver has received 2 successive minutes *)
			IF mez &lt;&gt; old_time + t#1m THEN error := TRUE ; END_IF;
		END_IF;
	END_IF;
END_IF;

(* this portion implements a free running clock which is triggered by the dcf77 signal *)
tz := DWORD_TO_TIME(INT_TO_DWORD(ABS(time_offset))* 3600000);

(* input sdt is copied to utc at first power up *)
IF NOT init OR SET THEN
	init := TRUE;
	utc := sdt;
	tp := TRUE;
	DS := DSI;
END_IF;

IF tp THEN
	rtc := utc;
	IF DS AND dst_en THEN
		IF time_offset &lt; 0 THEN	rtc1 := rtc - tz + t#1h; ELSE rtc1 := rtc + tz + t#1h; END_IF;
	ELSE
		IF time_offset &lt; 0 THEN rtc1 := rtc - tz; ELSE rtc1 := rtc + tz; END_IF;
	END_IF;
	sync := TRUE;
	last_sync := last;
	ty := last;
ELSIF rtc &gt; DWORD_TO_DT(0) AND T1 - ty &gt;= t#1s THEN
	rtc := rtc + t#1s;
	rtc1 := rtc1 + t#1s;
	ty := ty + t#1s;
	sync := ty - last_sync &lt; sync_timeout AND last_sync &gt; DWORD_TO_TIME(0);
	wday := DAY_OF_WEEK(DT_TO_DATE(rtc1));
	DS := dst_en AND DST(utc);
END_IF;
msec := TIME_TO_INT(t1 - ty);



(* decode information
bits		content
0			Bitwert immer 0
1 bis 14	reserviert für Betriebsinformationen (nicht für DCF77-Nutzer bestimmt)
15			Rufbit für Alarmierung der PTB-Mitarbeiter
			(bis Mai 2003: Bitwert = 0 falls normale Antenne in Verwendung; 1 = Backupantenne)
16			Bitwert = 1 falls ein Wechsel von MEZ nach MESZ oder umgekehrt bevorsteht; Dauer der Anzeige: 1 Stunde
17 + 18	gültige Zeit = MEZ, falls Bit 17=0 und Bit 18=1
			gültige Zeit = MESZ, falls Bit 17=1 und Bit 18=0
19			Bitwert = 1 falls innerhalb den nächsten 59 Minuten eine Schaltsekunde angeordnet ist. Beim Einfügen einer Schaltsekunde wird anstelle der 59. die 60. Sekundenmarke weggelassen und in der 58. erfolgt ausnahmsweise ein Trägerabfall.
20			Startbit für Zeitinformation (immer 1)
21 - 27		1, 2, 4, 8, 10, 20, 40 Minuten (bitweise Addition)
28			Prüfbit (gerade Parität) für die Bits 21-27
29 - 34		1, 2, 4, 8, 10, 20 Stunden (bitweise Addition)
35			Prüfbit (gerade Parität) für die Bits 29-34
36 - 41		Tagesnummer im aktuellen Monat: 1, 2, 4, 8, 10, 20 (bitweise Addition)
42 - 44		Tagesnummer in der aktuellen Woche: 1, 2, 4 (bitweise Addition)
45 - 49		Monatsnummer: 1, 2, 4, 8, 10 (bitweise Addition)
50 - 57		Jahr (zweistellig): 1, 2, 4, 8, 10, 20, 40, 80 (bitweise Addition)
58			Prüfbit (gerade Parität) füR die Bits 36-57

*)
(* revision history

hm 2.feb 2007		rev 1.1
	change wday and dst outputs when there is no dcf reception

hm	26.feb 2007		rev 1.2
	changed statements where t#1h would be substracted from DT.
	under certain conditions the compiler would crash translating this statement

hm	17. sep 2007	rev 1.3
	replaced time() with T_PLC_MS() for compatibility reasons

hm	24. oct 2007		rev 1.4
	changed dst calculation because function dst was upgraded no error in DCF77 only a change in DST

hm	12. nov 2007		rev 1.5
	changed time_offset from time to integer to allow for negative offset time zones

hm	8. dec 2007		rev 1.6
	corrected an error in time_zone calculation

hm 23. jan 2008		rev 1.7
	added sdt input which is used to initialize rtc and rtc1 during first cycle.

hm 16. mar 2008		rev 1.8
	changed output weekday to wday and dst to ds for compatibility reasons

hm	19. apr. 2008	rev 1.9
	added input dsi to allow to set daylight savings time when SDT is TRUE.
	added asynchronous SET input

hm	7. oct. 2008	rev 1.10
	changed function weekday to day_of_week

*)



          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>bc21b66e-41d5-43d5-84df-d8ebb1e01869</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="DST" pouType="function">
        <interface>
          <returnType>
            <BOOL />
          </returnType>
          <inputVars>
            <variable name="UTC">
              <type>
                <DT />
              </type>
            </variable>
          </inputVars>
          <localVars>
            <variable name="yr">
              <type>
                <INT />
              </type>
            </variable>
            <variable name="yr4">
              <type>
                <DWORD />
              </type>
            </variable>
            <variable name="ltc">
              <type>
                <DWORD />
              </type>
            </variable>
            <variable name="idate">
              <type>
                <DWORD />
              </type>
            </variable>
          </localVars>
        </interface>
        <body>
          <ST>
            yr := YEAR_OF_DATE(DT_TO_DATE(UTC));
ltc := DT_TO_DWORD(UTC);
idate := DT_TO_DWORD(SET_DT(yr, 3, 31, 1, 0, 0));
yr4 := SHR(5 * INT_TO_DWORD(yr), 2) + 1;
DST := (idate - ((yr4 + 3) MOD 7) * 86400 &lt;= ltc) AND (idate + (214 - (yr4) MOD 7) * 86400 &gt; ltc);


(*
Equation used TO calculate the beginning OF European Summer TIME:
Sunday (31 - (5*y/4 + 4) mod 7) March at 01.00 UTC
(valid through 2099, courtesy of Robert H. van Gent, EC).

European Summer Time ends (clocks go back) at 01.00 UTC on

    * 29 October 2006
    * 28 October 2007
    * 26 October 2008

Equation used to calculate the end of European Summer Time:
Sunday (31 - (5*y/4 + 1) mod 7) October at 01.00 UTC
(validity AND credits as above).

*)



(* revision history
hm	4. aug 2006	rev 1.0
	original version

hm	24. okt 2007	rev 1.1
	deleted time_zone_offset input because dst is generally at 01:00 utc and not mesz
	uk starts 01:00 utc and also greece

hm	1. dec 2007	rev 1.2
	changed code to improve performance

hm	16. mar. 2008	rev 1.3
	added type conversion to avoid warnings under codesys 3.0
	code improvement for better performance

hm	7. oct. 2008	rev 1.4
	changed name of function year to year_of_date

hm	24. jan. 2011	rev 1.5
	improved performance
*)


          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>979c9b7d-b52c-41ed-9b33-b66299b93f3d</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="DT_TO_SDT" pouType="function">
        <interface>
          <returnType>
            <derived name="SDT" />
          </returnType>
          <inputVars>
            <variable name="DTI">
              <type>
                <DT />
              </type>
            </variable>
          </inputVars>
          <localVars>
            <variable name="tmp">
              <type>
                <DATE />
              </type>
            </variable>
            <variable name="tdt">
              <type>
                <DWORD />
              </type>
            </variable>
          </localVars>
        </interface>
        <body>
          <ST>
            tmp := DT_TO_DATE(dti);
tdt := DT_TO_DWORD(dti) - DATE_TO_DWORD(tmp);
DT_TO_SDT.YEAR := YEAR_OF_DATE(tmp);
DT_TO_SDT.MONTH := MONTH_OF_DATE(tmp);
DT_TO_SDT.DAY := DAY_OF_MONTH(tmp);
DT_TO_SDT.WEEKDAY := DAY_OF_WEEK(tmp);
DT_TO_SDT.SECOND := DWORD_TO_INT(tdt MOD 60);
DT_TO_SDT.MINUTE := DWORD_TO_INT((tdt / 60) MOD 60);
DT_TO_SDT.HOUR := DWORD_TO_INT(tdt / 3600);

(* revision history

hm 18. oct. 2008	rev 1.0
	original version

*)
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>fa70134c-babb-4be1-909e-5c6f8527e5ea</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="DT2_TO_SDT" pouType="function">
        <interface>
          <returnType>
            <derived name="SDT" />
          </returnType>
          <inputVars>
            <variable name="DI">
              <type>
                <DATE />
              </type>
            </variable>
            <variable name="TI">
              <type>
                <TOD />
              </type>
            </variable>
          </inputVars>
        </interface>
        <body>
          <ST>
            DT2_TO_SDT.YEAR := YEAR_OF_DATE(di);
DT2_TO_SDT.MONTH := MONTH_OF_DATE(di);
DT2_TO_SDT.DAY := DAY_OF_MONTH(di);
DT2_TO_SDT.WEEKDAY := DAY_OF_WEEK(di);
DT2_TO_SDT.MS := DWORD_TO_INT(TOD_TO_DWORD(ti) MOD 1000);
DT2_TO_SDT.SECOND := DWORD_TO_INT((TOD_TO_DWORD(ti) / 1000) MOD 60);
DT2_TO_SDT.MINUTE := DWORD_TO_INT((TOD_TO_DWORD(ti) / 60000) MOD 60);
DT2_TO_SDT.HOUR := DWORD_TO_INT(TOD_TO_DWORD(ti) / 3600000);

(* revision history

hm 18. oct. 2008	rev 1.0
	original version

*)
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>7e861040-612e-435d-9fe1-3a41e33eaa2f</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="EASTER" pouType="function">
        <interface>
          <returnType>
            <DATE />
          </returnType>
          <inputVars>
            <variable name="year">
              <type>
                <INT />
              </type>
            </variable>
          </inputVars>
          <localVars>
            <variable name="b">
              <type>
                <INT />
              </type>
            </variable>
            <variable name="c">
              <type>
                <INT />
              </type>
            </variable>
            <variable name="oday">
              <type>
                <INT />
              </type>
            </variable>
          </localVars>
        </interface>
        <body>
          <ST>
            b := (204 - 11 * (YEAR MOD 19)) MOD 30;
IF b &gt; 27 THEN b := b - 1; END_IF;
c := (year + SHR(year,2) + b - 13) MOD 7;
oday := 28 + b - c;
IF oday &gt; 33 THEN
	EASTER := SET_DATE(year, 4, oday - 31);
ELSE
	EASTER := SET_DATE(year, 3, oday);
END_IF;




(* alternativer algorithmus ueber das pasah fest
execution time roughly 200us
Der sog. Passah-Vollmond wird berechnet, in dem das Jahr durch 19 ge-
teilt wird und der Rest mit der folgenden Tabelle verglichen wird:
 
    0: Apr 14       5: Apr 18      10: Mrz 25      15: Mrz 30
    1: Apr 03       6: Apr 08      11: Apr 13      16: Apr 17
    2: Mrz 23       7: Mrz 28      12: Apr 02      17: Apr 07
    3: Apr 11       8: Apr 16      13: Mrz 22      18: Mrz 27
    4: Mrz 31       9: Apr 05      14: Apr 10
 
Faellt dieses Datum auf einen Sonntag, ist Ostern der naechste Sonntag!
 
Beispiel: 1992 MOD 19 = 16, daraus folgt 17.04., der naechste Sonntag
          ist dann der 19. April (Ostersonntag)
*)


(* this algorithm is 180 us
a := year MOD 19;
b := year / 100;
c := year MOD 100;
d := b / 4;
e := b MOD 4;
f := (b + 8) / 25;
g := (b - f + 1) / 3;
h := (19 * a + b - d -g + 15) MOD 30;
i := C / 4;
k := c MOD 4;
l := (32 + 2*e + 2*i - h - k) MOD 7;
m := (a + 11 * h + 22 * l) / 451;
x := h + l - 7 * m + 114;
n := X / 31;
o := x MOD 31 + 1;

easter := set_Date(year,n,o);
*)
(*
Im Magazin "Nature" vom 20. April 1876 veröffentlichte ein anonymer Autor eine Tabelle mit Regeln zur Berechnung des (Gregorianischen) Ostersonntages des Jahres J. In Formeln ausgedrückt erhält man das Folgende:
a	=	J mod 19
b	=	int(J / 100)
c	=	J mod 100
d	=	int(b / 4)
e	=	b mod 4
f	=	int((b + 8) / 25)
g	=	int((b - f + 1) / 3
h	=	(19 · a + b - d - g + 15) mod 30
i	=	int(c / 4)
k	=	c mod 4
l	=	(32 + 2 · e + 2 · i - h - k) mod 7
m	=	int((a + 11 · h + 22 · l) / 451)
n	=	int((h + l - 7 · m + 114) / 31)
o	=	(h + l - 7 · m + 114) mod 31

n ist hierbei die Nummer des Monats, o + 1 die Nummer des Tages auf welchen der Ostersonntag im Jahr J fällt. Dieser Algorithmus kommt ohne Hilfszahlen aus.

*)

(* revision history
hm	27. dec 2006	rev 1.0
	original version

hm	15. dec 2007	rev 1.1
	modified code for better performance

hm	3. feb 2008		rev 1.2
	modified code for better performance

hm	7. apr. 2008	rev 1.3
	improved performance
*)
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>50ebb151-5a56-4d42-b4a5-ecd9bcc55b09</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="EVENTS" pouType="functionBlock">
        <interface>
          <inputVars>
            <variable name="DATE_IN">
              <type>
                <DATE />
              </type>
            </variable>
            <variable name="ENA">
              <type>
                <BOOL />
              </type>
            </variable>
          </inputVars>
          <outputVars>
            <variable name="Y">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="NAME">
              <type>
                <string length="30" />
              </type>
            </variable>
          </outputVars>
          <localVars>
            <variable name="i">
              <type>
                <INT />
              </type>
            </variable>
            <variable name="last_active">
              <type>
                <DATE />
              </type>
            </variable>
            <variable name="size">
              <type>
                <INT />
              </type>
              <initialValue>
                <simpleValue value="49" />
              </initialValue>
            </variable>
            <variable name="day_in">
              <type>
                <DINT />
              </type>
            </variable>
            <variable name="cyr">
              <type>
                <INT />
              </type>
            </variable>
            <variable name="lday">
              <type>
                <DINT />
              </type>
            </variable>
            <variable name="check">
              <type>
                <derived name="HOLIDAY_DATA" />
              </type>
            </variable>
            <variable name="y_int">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="name_int">
              <type>
                <string length="30" />
              </type>
            </variable>
          </localVars>
          <inOutVars>
            <variable name="ELIST">
              <type>
                <array>
                  <dimension lower="0" upper="49" />
                  <baseType>
                    <derived name="HOLIDAY_DATA" />
                  </baseType>
                </array>
              </type>
            </variable>
          </inOutVars>
        </interface>
        <body>
          <ST>
            (* for performance reasons only activate once a day *)
IF last_active &lt;&gt; date_in THEN
	last_active := DATE_IN;
	Y_int := FALSE;
	name_int := '';
	day_in := DAY_OF_DATE(DATE_IN);
	cyr := YEAR_OF_DATE(DATE_IN);

	(* search list for events *)
	FOR i := 0 TO size DO
		check := elist[i];
		lday := DAY_OF_DATE(SET_DATE(cyr,check.month, check.day));
		IF day_in &gt;= lday AND day_in &lt;= lday + check.use - 1 THEN
			y_int := TRUE;
			name_int := check.name;
			EXIT;
		END_IF;
	END_FOR;
END_IF;

IF ENA THEN
	Y := y_int;
	NAME := name_int;
ELSE
	Y := FALSE;
	NAME := '';
END_IF;

(* revision history
hm  18. jan. 2011	rev 1.0
	new module

*)


          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>99a95470-81cc-4aa9-a922-8d8973c82571</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="HOLIDAY" pouType="functionBlock">
        <interface>
          <inputVars>
            <variable name="DATE_IN">
              <type>
                <DATE />
              </type>
            </variable>
            <variable name="LANGU">
              <type>
                <INT />
              </type>
            </variable>
            <variable name="FRIDAY">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="SATURDAY">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="SUNDAY">
              <type>
                <BOOL />
              </type>
            </variable>
          </inputVars>
          <inOutVars>
            <variable name="HOLIDAYS">
              <type>
                <array>
                  <dimension lower="0" upper="29" />
                  <baseType>
                    <derived name="HOLIDAY_DATA" />
                  </baseType>
                </array>
              </type>
            </variable>
          </inOutVars>
          <localVars constant="true">
            <variable name="SIZE">
              <type>
                <INT />
              </type>
              <initialValue>
                <simpleValue value="29" />
              </initialValue>
            </variable>
          </localVars>
          <outputVars>
            <variable name="Y">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="NAME">
              <type>
                <string length="30" />
              </type>
            </variable>
          </outputVars>
          <localVars>
            <variable name="last_active">
              <type>
                <DATE />
              </type>
            </variable>
            <variable name="ostern">
              <type>
                <DATE />
              </type>
            </variable>
            <variable name="i">
              <type>
                <INT />
              </type>
            </variable>
            <variable name="jahr">
              <type>
                <INT />
              </type>
            </variable>
            <variable name="x_date">
              <type>
                <DATE />
              </type>
            </variable>
            <variable name="lx">
              <type>
                <INT />
              </type>
            </variable>
            <variable name="wdx">
              <type>
                <INT />
              </type>
            </variable>
          </localVars>
        </interface>
        <body>
          <ST>
            (* for performance reasons only activate once a day *)
IF last_active = date_in THEN RETURN; END_IF;
last_active := DATE_IN;

(* determine language *)
IF LANGU = 0 THEN
	lx := language.DEFAULT;
ELSE
	lx := MIN(language.LMAX, LANGU);
END_IF;

(* berechnung von ostern für das aktuelle jahr *)
jahr := YEAR_OF_DATE(date_in);
ostern := EASTER(jahr);
wdx := DAY_OF_WEEK(DATE_IN);
Y := FALSE;

(* check for holidays *)
FOR i := 0 TO size DO
	x_date := SET_DATE(jahr, HOLIDAYS[i].MONTH , HOLIDAYS[i].DAY);
	IF HOLIDAYS[i].USE = 1 AND HOLIDAYS[i].MONTH &gt; 0 THEN
		(* check for fixed date holiday *)
		IF x_date = date_in THEN
			Y := TRUE;
			NAME := HOLIDAYS[i].NAME;
			RETURN;
		END_IF;
	ELSIF HOLIDAYS[i].USE = 1 AND HOLIDAYS[i].MONTH = 0 THEN
		(* check for holiday in reference to easter *)
		IF DATE_ADD(ostern, HOLIDAYS[i].DAY ,0,0,0) = date_in THEN
			Y := TRUE;
			NAME := HOLIDAYS[i].NAME;
			RETURN;
		END_IF;
	ELSIF HOLIDAYS[i].USE &lt; 0 THEN
		(* check for holiday on a weekday before date *)
		IF DAY_OF_WEEK(date_in) = ABS(HOLIDAYS[i].USE) AND date_in &lt; x_date AND date_in &gt;= DATE_ADD(x_date,-7,0,0,0) THEN
			Y := TRUE;
			NAME := HOLIDAYS[i].NAME;
			RETURN;
		END_IF;
	END_IF;
END_FOR;

(* check array if today is weekend *)
IF NOT Y AND (wdx = 5 AND FRIDAY OR wdx = 6 AND SATURDAY OR wdx = 7 AND SUNDAY) THEN
	Y := TRUE;
	NAME := LANGUAGE.WEEKDAYS[LOCATION.LANGUAGE[lx],wdx];
ELSE
	NAME := '';
END_IF;


(*
Neujahrstag 	1. Januar 	• 	• 	• 	• 	• 	• 	• 	• 	• 	• 	• 	• 	• 	• 	• 	•
Heilige Drei Könige 	6. Januar 	• 	• 												• 		
Karfreitag 	Ostersonntag - 2d 	• 	• 	• 	• 	• 	• 	• 	• 	• 	• 	• 	• 	• 	• 	• 	•
Ostersonntag 	siehe Osterdatum 				(•) 												
Ostermontag 	Ostersonntag + 1d 	• 	• 	• 	• 	• 	• 	• 	• 	• 	• 	• 	• 	• 	• 	• 	•
Tag der Arbeit 	1. Mai 	• 	• 	• 	• 	• 	• 	• 	• 	• 	• 	• 	• 	• 	• 	• 	•
Christi Himmelfahrt 	Ostersonntag + 39d 	• 	• 	• 	• 	• 	• 	• 	• 	• 	• 	• 	• 	• 	• 	• 	•
Pfingstsonntag 	Ostersonntag + 49d 				(•) 												
Pfingstmontag 	Ostersonntag + 50d 	• 	• 	• 	• 	• 	• 	• 	• 	• 	• 	• 	• 	• 	• 	• 	•
Fronleichnam 	Ostersonntag + 60d 	• 	• 					• 			• 	• 	• 	1) 			2)
Augsburger Friedensfest 	8. August 		(3) 														
Mariä Himmelfahrt 	15. August 		(5) 										• 				
Tag der Deutschen Einheit 	3. Oktober 6) 	• 	• 	• 	• 	• 	• 	• 	• 	• 	• 	• 	• 	• 	• 	• 	•
Reformationstag 	31. Oktober 				• 				• 					• 	• 		•
Allerheiligen 	1. November 	• 	• 								• 	• 	• 				
Buß- und Bettag 4) 	Mittwoch vor dem 23.11. 			7 										• 			
1. Weihnachtstag 	25. Dezember 	• 	• 	• 	• 	• 	• 	• 	• 	• 	• 	• 	• 	• 	• 	• 	•
2. Weihnachtstag 	26. Dezember 	• 	• 	• 	• 	• 	• 	• 	• 	• 	• 	• 	• 	• 	• 	• 	•
*)



(* revision history
hm 	27. feb. 2007	rev 1.1
	deleted unused variable init

hm	31. oct. 2007	rev 1.2
	changed holiday definition from constant to input constant to allow easier changes by user without recompilation of the lib

hm 	24. nov. 2007	rev 1.3
	changes F_use of  Buß_und_Bettag to 0 because this is no official holiday

hm	7. apr. 2008	rev 1.4
	improved performance

hm	7. oct. 2008	rev 1.5
	changed code to use setup data from global constants
	changed length of output NAME from 20 to 30
	holiday will now also be indicated on a weekend
	changed function year to year_of_date
	changed function weekday to day_of_week

hm	21. oct. 2008	rev 1.6
	using location constants

hm	18. jan 2011	rev 2.0
	using user specified array for holidays

*)


          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>a8d250c7-4495-4802-a05e-228b03714a3a</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="HOUR" pouType="function">
        <interface>
          <returnType>
            <INT />
          </returnType>
          <inputVars>
            <variable name="itod">
              <type>
                <TOD />
              </type>
            </variable>
          </inputVars>
        </interface>
        <body>
          <ST>
            HOUR := DWORD_TO_INT(TOD_TO_DWORD(itod) / 3600000);


(* change history
hm 4. aug 2006	rev 1.0
	original version

hm 2.10.2006 	rev 1.1
	changed name of input to itod

*)
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>7b580f19-0ebb-43d9-9b10-646c8b46822d</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="HOUR_OF_DT" pouType="function">
        <interface>
          <returnType>
            <INT />
          </returnType>
          <inputVars>
            <variable name="XDT">
              <type>
                <DT />
              </type>
            </variable>
          </inputVars>
        </interface>
        <body>
          <ST>
            HOUR_OF_DT := DWORD_TO_INT((DT_TO_DWORD(XDT) MOD 86400) / 3600);


(* revision history
hm		6.9.2008	rev 1.0
	original version


*)
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>b7e5566d-91d1-4de5-9838-2ab940309944</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="HOUR_TO_TIME" pouType="function">
        <interface>
          <returnType>
            <TIME />
          </returnType>
          <inputVars>
            <variable name="IN">
              <type>
                <REAL />
              </type>
            </variable>
          </inputVars>
        </interface>
        <body>
          <ST>
            HOUR_TO_TIME := DWORD_TO_TIME(REAL_TO_DWORD(IN * 3600000));


(* revision history
hm		4. aug 2006	rev 1.0
	original version

hm	14. mar. 2008	rev 1.1
	rounded the input after the last digit

hm	24. feb. 2009	rev 1.2
	changed input to IN
*)
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>cff5f0d3-4e23-49e4-a0c1-1939c6e296de</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="HOUR_TO_TOD" pouType="function">
        <interface>
          <returnType>
            <TOD />
          </returnType>
          <inputVars>
            <variable name="IN">
              <type>
                <REAL />
              </type>
            </variable>
          </inputVars>
        </interface>
        <body>
          <ST>
            HOUR_TO_TOD := DWORD_TO_TOD(REAL_TO_DWORD(IN * 3600000));


(* revision history
hm	4. aug. 2006	rev 1.0
	original version

hm	14. mar. 2008	rev 1.1
	rounded the input after the last digit

hm	24. feb. 2009	rev 1.2
	changed input to IN
*)
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>85432f27-0a76-413c-bfd7-9b1adf5d945e</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="JD2000" pouType="function">
        <interface>
          <returnType>
            <REAL />
          </returnType>
          <inputVars>
            <variable name="DTI">
              <type>
                <DT />
              </type>
            </variable>
          </inputVars>
        </interface>
        <body>
          <ST>
            JD2000 := DWORD_TO_REAL(DT_TO_DWORD(DTI) - 946728000) / 86400.0;

(* revision histroy
hm	15. jul. 2008	rev 1.0
	original release


*)	

          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>9b50ba1e-d6ea-4955-aceb-3a06015b79b0</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="LEAP_DAY" pouType="function">
        <interface>
          <returnType>
            <BOOL />
          </returnType>
          <inputVars>
            <variable name="IDATE">
              <type>
                <DATE />
              </type>
            </variable>
          </inputVars>
        </interface>
        <body>
          <ST>
            LEAP_DAY := DATE_TO_UDINT(IDATE) MOD 126230400 = 68169600;


(* change history

hm 	15. jun. 2008	rev 1.0
	original version

hm	7. oct. 2008	rev 1.1
	changed function month to month_of_date

hm	24. jan. 2011	rev 1.2
	improved performance
*)
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>de3736eb-5d81-4f96-8377-fa04e1270b83</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="LEAP_OF_DATE" pouType="function">
        <interface>
          <returnType>
            <BOOL />
          </returnType>
          <inputVars>
            <variable name="idate">
              <type>
                <DATE />
              </type>
            </variable>
          </inputVars>
        </interface>
        <body>
          <ST>
            LEAP_OF_DATE := SHL(((DATE_TO_DWORD(idate) + 43200) / 31557600), 30) = 16#80000000;


(* change history

2.10.2006		rev 1.1
the function now calls leap_year to accomodate further accuracy.
the function now works for any year from 1970 to 2100

8. jan 2008		rev 1.2
	improved code for better performance

28. jan. 2011	rev 1.3
	improved performance
*)
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>9bb0941c-4159-436c-9ff7-be3a3d42c7ca</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="LEAP_YEAR" pouType="function">
        <interface>
          <returnType>
            <BOOL />
          </returnType>
          <inputVars>
            <variable name="yr">
              <type>
                <INT />
              </type>
            </variable>
          </inputVars>
        </interface>
        <body>
          <ST>
            LEAP_YEAR := SHL(yr,14) = 0;

(* this code was used prior to rev 1.1

IF yr MOD 400 = 0 THEN leap_year := TRUE;
ELSIF yr MOD 100 = 0 THEN leap_year := FALSE;
ELSIF yr MOD 4 =0 THEN leap_year := TRUE;
ELSE leap_year := FALSE;
END_IF;

*)

(* change history

hm 	2.10.2006		rev 1.1
	the function now works for any year from 1970 up to 2100

hm	1. oct 2007		rev 1.2
	chaged code for higher performance
*)
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>674ada8e-472f-4182-879e-ca8194bb0c2c</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="LTIME_TO_UTC" pouType="function">
        <interface>
          <returnType>
            <DT />
          </returnType>
          <inputVars>
            <variable name="LOCAL_TIME">
              <type>
                <DT />
              </type>
            </variable>
            <variable name="DST">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="TIME_ZONE_OFFSET">
              <type>
                <INT />
              </type>
            </variable>
          </inputVars>
        </interface>
        <body>
          <ST>
            LTIME_TO_UTC := UDINT_TO_DT(DT_TO_UDINT(LOCAL_TIME) - INT_TO_UDINT(TIME_ZONE_OFFSET) * 60);
IF DST THEN LTIME_TO_UTC := LTIME_TO_UTC - T#1h; END_IF;

(* revision history
hm 5.7.2007		rev 1.0		
	original version

hm 5.11.2007		rev 1.1
	replaced literal constant with variable because of error in möller ecp4 compiler

hm	12.nov 2007	rev 1.2
	changed Type of time_zone_offset from time to int to allow for time zones with negative offset

hm	8. dec 2007	rev 1.3
	corrected a problem with time_zone_offset

hm	14. oct. 2008	rev 1.4
	changed time_zone_offset from int to real to allow for half hour offset

hm	20. oct. 2006	rev 1.5
	changed time_zone_offset from Real to INT, now in Minutes

hm	27. feb. 2009	rev 1.6
	added type conversions to avoid warnings under codesys 3.0

ks	13. nov. 2009	rev 1.7
	corrected error in formula

*)
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>8318a546-8a3c-419b-bdc6-8029c95420b0</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="MINUTE" pouType="function">
        <interface>
          <returnType>
            <INT />
          </returnType>
          <inputVars>
            <variable name="itod">
              <type>
                <TOD />
              </type>
            </variable>
          </inputVars>
        </interface>
        <body>
          <ST>
            MINUTE := DWORD_TO_INT(TOD_TO_DWORD(itod) / 60000 - TOD_TO_DWORD(itod) / 3600000 * 60);


(* change history

2.10.2006 changes name of input to itod

*)
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>9f053585-5b8b-4938-b197-569cd954ba42</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="MINUTE_OF_DT" pouType="function">
        <interface>
          <returnType>
            <INT />
          </returnType>
          <inputVars>
            <variable name="XDT">
              <type>
                <DT />
              </type>
            </variable>
          </inputVars>
        </interface>
        <body>
          <ST>
            MINUTE_OF_DT := DWORD_TO_INT(DT_TO_DWORD(XDT) MOD 3600) / 60;


(* revision history
hm		6.9.2008	rev 1.0
	original version


*)
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>658d9cc5-46c9-4129-86d6-046c2d31d711</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="MINUTE_TO_TIME" pouType="function">
        <interface>
          <returnType>
            <TIME />
          </returnType>
          <inputVars>
            <variable name="IN">
              <type>
                <REAL />
              </type>
            </variable>
          </inputVars>
        </interface>
        <body>
          <ST>
            MINUTE_TO_TIME := DWORD_TO_TIME(REAL_TO_DWORD(IN * 60000.0));


(* revision history
hm	4. aug 2006	rev 1.0
	original version

hm	14. mar 2008	rev 1.1
	rounded the input after the last digit

hm	24. feb. 2009	rev 1.2
	changed input to IN

*)
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>f85f0c3a-4397-4a5d-b472-eb75d0f5e45f</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="MONTH_BEGIN" pouType="function">
        <interface>
          <returnType>
            <DATE />
          </returnType>
          <inputVars>
            <variable name="idate">
              <type>
                <DATE />
              </type>
            </variable>
          </inputVars>
        </interface>
        <body>
          <ST>
            MONTH_BEGIN := DWORD_TO_DATE(DATE_TO_DWORD(idate) - INT_TO_DWORD(DAY_OF_MONTH(idate) - 1) * 86400);

(* revision history
hm	15. jun. 2008	rev 1.0
	original version	

*)
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>dc8e6366-9280-4749-bf4a-440f23d88870</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="MONTH_END" pouType="function">
        <interface>
          <returnType>
            <DATE />
          </returnType>
          <inputVars>
            <variable name="IDATE">
              <type>
                <DATE />
              </type>
            </variable>
          </inputVars>
        </interface>
        <body>
          <ST>
            MONTH_END := DWORD_TO_DATE(DATE_TO_DWORD(SET_DATE(YEAR_OF_DATE(idate),MONTH_OF_DATE(idate)+1,1)) - 86400);



(* revision history
hm	15. jun. 2008	rev 1.0
	original version	

hm	7. oct. 2008	rev 1.1
	changed function year to year_of_date
	changed function month to month_of_date

*)
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>96dafb94-da74-4c9d-9217-a0d7eede3161</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="MONTH_OF_DATE" pouType="function">
        <interface>
          <returnType>
            <INT />
          </returnType>
          <inputVars>
            <variable name="IDATE">
              <type>
                <DATE />
              </type>
            </variable>
          </inputVars>
        </interface>
        <body>
          <ST>
            MONTH_OF_DATE := DAY_OF_YEAR(idate);
IF MONTH_OF_DATE &lt; 32 THEN
	MONTH_OF_DATE := 1;
ELSIF LEAP_OF_DATE(IDATE) THEN
	MONTH_OF_DATE := (MONTH_OF_DATE * 53 + 1668) / 1623;
ELSE
	MONTH_OF_DATE := (MONTH_OF_DATE * 53 + 1700) / 1620;
END_IF;


(* code for rev 1.2
MONTH_OF_DATE := DAY_OF_YEAR(IDATE);
IF LEAP_OF_DATE(IDATE) THEN
	CASE MONTH_OF_DATE OF
		1..31 	:	MONTH_OF_DATE := 1;
		32..60	:	MONTH_OF_DATE := 2;
		61..91	:	MONTH_OF_DATE := 3;
		92..121 :	MONTH_OF_DATE := 4;
		122..152:	MONTH_OF_DATE := 5;
		153..182:	MONTH_OF_DATE := 6;
		183..213:	MONTH_OF_DATE := 7;
		214..244:	MONTH_OF_DATE := 8;
		245..274:	MONTH_OF_DATE := 9;
		275..305:	MONTH_OF_DATE := 10;
		306..335:	MONTH_OF_DATE := 11;
		336..366:	MONTH_OF_DATE := 12;
	END_CASE;
ELSE
	CASE MONTH_OF_DATE OF
		1..31 	:	MONTH_OF_DATE := 1;
		32..59	:	MONTH_OF_DATE := 2;
		60..90	:	MONTH_OF_DATE := 3;
		91..120 :	MONTH_OF_DATE := 4;
		121..151:	MONTH_OF_DATE := 5;
		152..181:	MONTH_OF_DATE := 6;
		182..212:	MONTH_OF_DATE := 7;
		213..243:	MONTH_OF_DATE := 8;
		244..273:	MONTH_OF_DATE := 9;
		274..304:	MONTH_OF_DATE := 10;
		305..334:	MONTH_OF_DATE := 11;
		335..365:	MONTH_OF_DATE := 12;
	END_CASE;
END_IF;
*)


(* revision history
hm	1. aug 2006	rev 1.0
	original version	

hm	1. okt 2007	rev 1.1
	replaced old code (string conversion) with mathematics
	the execution time is now multiple times faster.

hm	7. oct. 2008	rev 1.2
	changed name of function from month to MONTH_OF_DATE

hm	27. mar. 2009	rev 1.3
	new improved code

*)
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>79474c5f-2707-4f5a-9240-f0494046490d</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="MULTIME" pouType="function">
        <interface>
          <returnType>
            <TIME />
          </returnType>
          <inputVars>
            <variable name="t">
              <type>
                <TIME />
              </type>
            </variable>
            <variable name="M">
              <type>
                <REAL />
              </type>
            </variable>
          </inputVars>
        </interface>
        <body>
          <ST>
            MULTIME := DWORD_TO_TIME(REAL_TO_DWORD(DWORD_TO_REAL(TIME_TO_DWORD(t))*M));

(* revision history
hm		2. oct 2006	rev 1.0
	original version

hm		14. mar 2008	rev 1.1
	rounded the result after the last digit

*)
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>c9f6d29b-4e86-4560-9a48-5322c108eb1d</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="PERIOD" pouType="function">
        <interface>
          <returnType>
            <BOOL />
          </returnType>
          <inputVars>
            <variable name="d1">
              <type>
                <DATE />
              </type>
            </variable>
            <variable name="dx">
              <type>
                <DATE />
              </type>
            </variable>
            <variable name="d2">
              <type>
                <DATE />
              </type>
            </variable>
          </inputVars>
          <localVars>
            <variable name="day1">
              <type>
                <INT />
              </type>
            </variable>
            <variable name="day2">
              <type>
                <INT />
              </type>
            </variable>
            <variable name="dayx">
              <type>
                <INT />
              </type>
            </variable>
          </localVars>
        </interface>
        <body>
          <ST>
            day1 := DAY_OF_YEAR(d1);
day2 := DAY_OF_YEAR(d2);
dayx := DAY_OF_YEAR(dx);
IF NOT LEAP_OF_DATE(dx) AND dayx &gt; 58 THEN dayx := dayx + 1; END_IF;
IF NOT LEAP_OF_DATE(d1) AND day1 &gt; 58 THEN day1 := day1 + 1; END_IF;
IF NOT LEAP_OF_DATE(d2) AND day2 &gt; 58 THEN day2 := day2 + 1; END_IF;

IF day2 &lt; day1 THEN
	(* the period spans over the new year *)
	PERIOD := dayx &lt;= day2 OR dayx &gt;= day1;
ELSE
	PERIOD := dayx &gt;= day1 AND dayx &lt;= day2;
END_IF;

(* code before rev 1.2
yx := year(dx);
p1 := date_add(d1,0,0,0,yx - year(d1));
p2 := date_add(d2,0,0,0,yx - year(d2));

IF p2 &gt;= p1 THEN
	period := dx &lt;= p2  AND dx &gt;= p1;
ELSE
	period := dx &lt;= p2 OR dx &gt;= p1;
END_IF;
*)


(* revision history

hm		19. sep 2007	rev 1.0
	original version

hm		20. sep 2007	rev 1.1
	corrected a problem with leap year

hm		4. jan 2008		rev 1.2
	changed code for better performance

hm		22. mar. 2008	rev 1.3
	function would deliver wrong results when d1, d2 or dx are a leap_year

*)
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>acba15bb-fb0a-4ec1-aa76-4ccfaa44ef0a</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="PERIOD2" pouType="function">
        <interface>
          <returnType>
            <BOOL />
          </returnType>
          <inputVars>
            <variable name="DP">
              <type>
                <array>
                  <dimension lower="0" upper="3" />
                  <dimension lower="0" upper="1" />
                  <baseType>
                    <DATE />
                  </baseType>
                </array>
              </type>
            </variable>
            <variable name="DX">
              <type>
                <DATE />
              </type>
            </variable>
          </inputVars>
        </interface>
        <body>
          <ST>
            PERIOD2 := 	(DX &gt;= DP[0,0] AND DX &lt;= DP[0,1]) OR
			(DX &gt;= DP[1,0] AND DX &lt;= DP[1,1]) OR
			(DX &gt;= DP[2,0] AND DX &lt;= DP[2,1]) OR
			(DX &gt;= DP[3,0] AND DX &lt;= DP[3,1]);


(* revision history

hm		27. apr 2008	rev 1.0
	original version


*) 
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>bf2368ca-93cd-46f0-87fb-0546dba54b80</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="REFRACTION" pouType="function">
        <interface>
          <returnType>
            <REAL />
          </returnType>
          <inputVars>
            <variable name="ELEV">
              <type>
                <REAL />
              </type>
            </variable>
          </inputVars>
        </interface>
        <body>
          <ST>
            elev := LIMIT(-1.9, elev, 80.0);
REFRACTION := 0.0174532925199433 / TAN(0.0174532925199433 * (ELEV + 10.3 / (ELEV + 5.11)));


(* revision histroy
hm	14. jul. 2008	rev 1.0
	original release

hm	7. mar. 2009	rev 1.1
	using new formula

*)	

          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>992ca931-d919-4c1d-be66-33259889295f</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="RTC_2" pouType="functionBlock">
        <interface>
          <inputVars>
            <variable name="SET">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="SDT">
              <type>
                <DT />
              </type>
            </variable>
            <variable name="SMS">
              <type>
                <INT />
              </type>
            </variable>
            <variable name="DEN">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="OFS">
              <type>
                <INT />
              </type>
            </variable>
          </inputVars>
          <outputVars>
            <variable name="UDT">
              <type>
                <DT />
              </type>
            </variable>
            <variable name="LOCAL_DT">
              <type>
                <DT />
              </type>
            </variable>
            <variable name="DSO">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="XMS">
              <type>
                <INT />
              </type>
            </variable>
          </outputVars>
          <localVars>
            <variable name="RT">
              <type>
                <derived name="RTC_MS" />
              </type>
            </variable>
          </localVars>
        </interface>
        <body>
          <ST>
            (* call rtc *)
RT(SET := SET, SDT := SDT, SMS := SMS);
UDT := rt.xdt;
XMS := rt.XMS;

(* check for daylight savings time and set dso output *)
DSO := DST(udt) AND DEN;

(* calculate time offset and set ldt output *)
LOCAL_DT := DWORD_TO_DT(DT_TO_DWORD(UDT) + INT_TO_DWORD(ofs + BOOL_TO_INT(DSO)*60) * 60);


(* revision history
hm		20. jan. 2008	rev 1.0
	original version

hm		20. feb. 2008	rev 1.1
	added Millisecond Set input

hm		12. jun. 2008	rev 1.2
	improved performance

hm		20. jan. 2011	rev 1.3
	changed offset to be in minutes

hm		27. apr. 2011	rev 1.4
	fixed error with local time calculation

hm     3. Feb 2021     rev 1.5
     changed LDT to LOCAL_DT for compatibility with IEC61131-3

*)
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>ae2b8050-0bde-472f-8c38-8a6ddf2723c4</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="RTC_MS" pouType="functionBlock">
        <interface>
          <inputVars>
            <variable name="SET">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="SDT">
              <type>
                <DT />
              </type>
            </variable>
            <variable name="SMS">
              <type>
                <INT />
              </type>
            </variable>
          </inputVars>
          <outputVars>
            <variable name="XDT">
              <type>
                <DT />
              </type>
            </variable>
            <variable name="XMS">
              <type>
                <INT />
              </type>
            </variable>
          </outputVars>
          <localVars>
            <variable name="init">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="last">
              <type>
                <DWORD />
              </type>
            </variable>
            <variable name="Tx">
              <type>
                <DWORD />
              </type>
            </variable>
          </localVars>
        </interface>
        <body>
          <ST>
            tx := T_PLC_MS();
IF set OR NOT init THEN
	(* clock needs to be set when set is true or after power up *)
	init := TRUE;
	xdt := SDT;
	XMS := SMS;
ELSE
	XMS := XMS + DWORD_TO_INT(tx - last);
	(* check if one second has expired *)
	IF XMS &gt; 999 THEN
		XDT := XDT + T#1s;
		XMS := XMS - 1000;
	END_IF;
END_IF;
last := tx;


(* revision history
hm		20. jan. 2008	rev 1.0
	original version

hm		20. feb. 2008	rev 1.1
	added Millisecond Set input
*)
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>b48ce9e3-cb85-4d4a-ace5-b0a6e49f9ad1</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="SDT_TO_DATE" pouType="function">
        <interface>
          <returnType>
            <DATE />
          </returnType>
          <inputVars>
            <variable name="DTI">
              <type>
                <derived name="SDT" />
              </type>
            </variable>
          </inputVars>
        </interface>
        <body>
          <ST>
            SDT_TO_DATE := SET_DATE(DTI.YEAR, DTI.MONTH, DTI.DAY);



(* revision history

hm 18. oct. 2008	rev 1.0
	original version

*)
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>152856c9-2e13-4945-98f0-115daaf66d35</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="SDT_TO_DT" pouType="function">
        <interface>
          <returnType>
            <DT />
          </returnType>
          <inputVars>
            <variable name="DTI">
              <type>
                <derived name="SDT" />
              </type>
            </variable>
          </inputVars>
        </interface>
        <body>
          <ST>
            SDT_TO_DT := SET_DT(DTI.YEAR, DTI.MONTH, DTI.DAY, DTI.HOUR, DTI.MINUTE, DTI.SECOND);



(* revision history

hm 18. oct. 2008	rev 1.0
	original version

*)
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>69883865-e7e2-43ce-918c-aa104f87a5eb</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="SDT_TO_TOD" pouType="function">
        <interface>
          <returnType>
            <TOD />
          </returnType>
          <inputVars>
            <variable name="DTI">
              <type>
                <derived name="SDT" />
              </type>
            </variable>
          </inputVars>
        </interface>
        <body>
          <ST>
            SDT_TO_TOD := DWORD_TO_TOD(INT_TO_DWORD(DTI.HOUR) * 3600000 + INT_TO_DWORD(DTI.MINUTE) * 60000 + INT_TO_DWORD(DTI.SECOND) * 1000 + INT_TO_DWORD(DTI.MS));



(* revision history

hm 18. oct. 2008	rev 1.0
	original version

hm	16. nov. 2008	rev 1.1
	added typecasts to avoid warnings
*)
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>119ba0c9-3d18-4816-ad2c-bb1c7c0d5323</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="SECOND" pouType="function">
        <interface>
          <returnType>
            <REAL />
          </returnType>
          <inputVars>
            <variable name="itod">
              <type>
                <TOD />
              </type>
            </variable>
          </inputVars>
        </interface>
        <body>
          <ST>
            SECOND := DWORD_TO_REAL(TOD_TO_DWORD(itod) - TOD_TO_DWORD(itod)/60000 * 60000) / 1000.0;



(* change history

hm	2. oct. 2006 rev 1.1 
	changed name of input to itod

*)
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>5171167e-26bb-4c07-8d88-760636c52d2c</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="SECOND_OF_DT" pouType="function">
        <interface>
          <returnType>
            <INT />
          </returnType>
          <inputVars>
            <variable name="XDT">
              <type>
                <DT />
              </type>
            </variable>
          </inputVars>
        </interface>
        <body>
          <ST>
            SECOND_OF_DT := DWORD_TO_INT(DT_TO_DWORD(XDT) MOD 60);

(* revision history
hm		6.9.2008	rev 1.0
	original version

*)
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>7b98b509-d552-4c0b-8d8c-3ab0b5e03dc0</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="SECOND_TO_TIME" pouType="function">
        <interface>
          <returnType>
            <TIME />
          </returnType>
          <inputVars>
            <variable name="IN">
              <type>
                <REAL />
              </type>
            </variable>
          </inputVars>
        </interface>
        <body>
          <ST>
            SECOND_TO_TIME := DWORD_TO_TIME(REAL_TO_DWORD(IN * 1000.0));

(* revision history
hm	4. aug. 2006	rev 1.0
	original version

hm	14. mar. 2008	rev 1.1
	rounded the input after the last digit

hm	24. feb. 2009	rev 1.2
	changed input to IN
*)
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>53d672fc-e995-479b-8195-2c851ba4f40e</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="SET_DATE" pouType="function">
        <interface>
          <returnType>
            <DATE />
          </returnType>
          <inputVars>
            <variable name="YEAR">
              <type>
                <INT />
              </type>
            </variable>
            <variable name="MONTH">
              <type>
                <INT />
              </type>
            </variable>
            <variable name="DAY">
              <type>
                <INT />
              </type>
            </variable>
          </inputVars>
          <localVars>
            <variable name="count">
              <type>
                <INT />
              </type>
            </variable>
            <variable name="ofs">
              <type>
                <array>
                  <dimension lower="1" upper="12" />
                  <baseType>
                    <INT />
                  </baseType>
                </array>
              </type>
              <initialValue>
                <arrayValue>
                  <value>
                    <simpleValue value="0" />
                  </value>
                  <value>
                    <simpleValue value="31" />
                  </value>
                  <value>
                    <simpleValue value="59" />
                  </value>
                  <value>
                    <simpleValue value="90" />
                  </value>
                  <value>
                    <simpleValue value="120" />
                  </value>
                  <value>
                    <simpleValue value="151" />
                  </value>
                  <value>
                    <simpleValue value="181" />
                  </value>
                  <value>
                    <simpleValue value="212" />
                  </value>
                  <value>
                    <simpleValue value="243" />
                  </value>
                  <value>
                    <simpleValue value="273" />
                  </value>
                  <value>
                    <simpleValue value="304" />
                  </value>
                  <value>
                    <simpleValue value="334" />
                  </value>
                </arrayValue>
              </initialValue>
            </variable>
            <variable name="ENDIF">
              <type>
                <BOOL />
              </type>
            </variable>
          </localVars>
        </interface>
        <body>
          <ST>
            IF (MONTH &gt; 2) AND (SHL(YEAR,14) = 0)
THEN (* we add one day for leap year *)
	SET_DATE := DWORD_TO_DATE((INT_TO_DWORD(ofs[MONTH] + day ) + SHR(INT_TO_DWORD(year) * 1461 - 2878169, 2))*86400);
ELSE
	SET_DATE := DWORD_TO_DATE((INT_TO_DWORD(ofs[MONTH] + day - 1 ) + SHR(INT_TO_DWORD(year) * 1461 - 2878169, 2))*86400);
END_IF;


(* old code
IF month &gt; 2 THEN
	count := (month - 1) * 30;
	IF month &gt; 7 THEN count := count + SHR(month - 3,1); ELSE count := count + SHR(month - 4,1); END_IF;
	(* chech for leap year and add one day if true *)
	IF SHL(year,14) = 0 THEN count := count + 1; END_IF;
ELSE
	count := (month - 1) * 31;
END_IF;

SET_DATE := DWORD_TO_DATE((INT_TO_DWORD(count + day - 1) + SHR(INT_TO_DWORD(year) * 1461 - 2878169, 2)) * 86400);
*)

(* revision history
hm	4. aug. 2006	rev 1.0
	original version

hm	19 sep. 2007	rev 1.1
	use function leap_year to calculate leap year, more exceptions are handled

hm	1. okt	2007	rev 1.2
	added compatibility to step7

hm	16.dec 2007		rev 1.3
	changed code to improove performance

hm	3. jan. 2008	rev 1.4
	further improvements in performance

hm	16. mar. 2008	rev 1.5
	added type conversions to avoid warnings under codesys 3.0

hm	7. apr. 2008	rev 1.6
	deleted unused step7 code

hm	14. oct. 2008	rev 1.7
	optimized code for better performance

hm	25. oct. 2008	rev 2.0
	new code using setup constants

hm	16. nov. 2008	rev 2.1
	added typecasts to avoid warnings

hm	22. jan. 2011	rev 2.2
	improved performance

hm	29. dec. 2011	rev 2.3
	improved performance

hm 3. FEB 2021 rev 2.4
	new code to be more readable
*)
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>3ca7c2e2-05ff-49ec-9f2f-0454d3bae3aa</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="SET_DT" pouType="function">
        <interface>
          <returnType>
            <DT />
          </returnType>
          <inputVars>
            <variable name="year">
              <type>
                <INT />
              </type>
            </variable>
            <variable name="month">
              <type>
                <INT />
              </type>
            </variable>
            <variable name="day">
              <type>
                <INT />
              </type>
            </variable>
            <variable name="hour">
              <type>
                <INT />
              </type>
            </variable>
            <variable name="minute">
              <type>
                <INT />
              </type>
            </variable>
            <variable name="second">
              <type>
                <INT />
              </type>
            </variable>
          </inputVars>
        </interface>
        <body>
          <ST>
            SET_DT := DWORD_TO_DT(DATE_TO_DWORD(SET_DATE(YEAR, MONTH, day)) + INT_TO_DWORD(SECOND) + INT_TO_DWORD(MINUTE) * 60 + INT_TO_DWORD(HOUR) * 3600);


(* revision history
hm	4. aug. 2006		rev 1.0
	original version

hm		19 sep. 2007	rev 1.1
	use function leap_year to calculate leap year, more exceptions are handled

hm		1. okt 2007		rev 1.2
	added step7 compatibility
	call function set_date

hm		8. oct 2007		rev 1.3
	deleted unused variables count and leap

hm		1. 11 2007		rev 1.4
	converted hour type integer to dword in calculation to avoid overrun on möller ecp4

hm		16. mar 2008	rev 1.5
	added type conversions to avoid warnings under codesys 3.0
*)


          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>75a4d16c-74d7-47ad-bd11-ae36f42b2675</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="SET_TOD" pouType="function">
        <interface>
          <returnType>
            <TOD />
          </returnType>
          <inputVars>
            <variable name="hour">
              <type>
                <INT />
              </type>
            </variable>
            <variable name="minute">
              <type>
                <INT />
              </type>
            </variable>
            <variable name="second">
              <type>
                <REAL />
              </type>
            </variable>
          </inputVars>
        </interface>
        <body>
          <ST>
            SET_TOD := DWORD_TO_TOD(REAL_TO_DWORD(SECOND * 1000.0) + INT_TO_DWORD(MINUTE) * 60000 + INT_TO_DWORD(HOUR) * 3600000);

(* revision history

hm		4.aug.2006		rev 1.0
	original version

hm		11. sep 2007	rev 1.1
	changed coding to avoid a compiler warning under twincat.

hm		1. nov 2007	rev 1.2
	changed coding to avoid possible overrun situation on möller ecp4

hm		2. Nov	2007	rev 1.3
	changed dword to DINT in calcualtion to avoid warnings with some compilers

hm		14. mar 2008	rev 1.4
	changed code to avoid rounding problem at last digit of millisecond

hm		16. mar. 2008	rev 1.5
	added type conversions to avoid warning under codesys 3.0
*)
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>5f39cff3-e5fd-43da-a5f7-972312f75cb4</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="SUN_MIDDAY" pouType="function">
        <interface>
          <returnType>
            <TOD />
          </returnType>
          <inputVars>
            <variable name="LON">
              <type>
                <REAL />
              </type>
            </variable>
            <variable name="UTC">
              <type>
                <DATE />
              </type>
            </variable>
          </inputVars>
          <localVars>
            <variable name="T">
              <type>
                <REAL />
              </type>
            </variable>
            <variable name="OFFSET">
              <type>
                <REAL />
              </type>
            </variable>
          </localVars>
        </interface>
        <body>
          <ST>
            T := INT_TO_REAL(DAY_OF_YEAR(utc));
OFFSET := -0.1752 * SIN(0.033430 * T + 0.5474) - 0.1340 * SIN(0.018234 * T - 0.1939);
SUN_MIDDAY := HOUR_TO_TOD(12.0 - OFFSET - lon * 0.0666666666666);


(* revision history

hm	26. jan. 2011	rev 1.0
	initial release

*)
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>a9a2c525-1c7b-4da1-a931-741bf0d4c017</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="SUN_POS" pouType="functionBlock">
        <interface>
          <inputVars>
            <variable name="latitude">
              <type>
                <REAL />
              </type>
              <documentation>
                 latitude of geographical position  
              </documentation>
            </variable>
            <variable name="longitude">
              <type>
                <REAL />
              </type>
              <documentation>
                 longitude of geographical position  
              </documentation>
            </variable>
            <variable name="utc">
              <type>
                <DT />
              </type>
              <documentation>
                	world time				
              </documentation>
            </variable>
          </inputVars>
          <outputVars>
            <variable name="B">
              <type>
                <REAL />
              </type>
            </variable>
            <variable name="H">
              <type>
                <REAL />
              </type>
            </variable>
            <variable name="HR">
              <type>
                <REAL />
              </type>
            </variable>
          </outputVars>
          <tempVars>
            <variable name="g">
              <type>
                <REAL />
              </type>
            </variable>
            <variable name="a">
              <type>
                <REAL />
              </type>
            </variable>
            <variable name="d">
              <type>
                <REAL />
              </type>
            </variable>
            <variable name="t1">
              <type>
                <REAL />
              </type>
            </variable>
            <variable name="n">
              <type>
                <REAL />
              </type>
            </variable>
            <variable name="e">
              <type>
                <REAL />
              </type>
            </variable>
            <variable name="c">
              <type>
                <REAL />
              </type>
            </variable>
            <variable name="tau">
              <type>
                <REAL />
              </type>
            </variable>
            <variable name="sin_d">
              <type>
                <REAL />
              </type>
            </variable>
            <variable name="rlat">
              <type>
                <REAL />
              </type>
            </variable>
            <variable name="sin_lat">
              <type>
                <REAL />
              </type>
            </variable>
            <variable name="cos_lat">
              <type>
                <REAL />
              </type>
            </variable>
            <variable name="cos_tau">
              <type>
                <REAL />
              </type>
            </variable>
            <variable name="cos_d">
              <type>
                <REAL />
              </type>
            </variable>
          </tempVars>
        </interface>
        <body>
          <ST>
            
(* n is the julian date and the number of days since 1.1.2000-12:00 midday *)
(* be careful for step7 date startes 1.1.1990 instead of 1.1.1970 *)
(* for step7 this line must change *)
n := DWORD_TO_REAL(DT_TO_DWORD(UTC) - 946728000) * 0.000011574074074074;
g :=MODR(6.240040768 + 0.01720197 * n, math.PI2);
d := MODR(4.89495042 + 0.017202792 * n, math.PI2) + 0.033423055 * SIN(g) + 0.000349066 * SIN(2.0*g);
e := 0.409087723 - 0.000000006981317008 * n;
cos_d := COS(d);
sin_d := SIN(d);
a := ATAN(COS(e) * sin_d / cos_d);
IF cos_d &lt; 0.0 THEN a := a + math.PI; END_IF;
c := ASIN(SIN(e) * sin_d);

(* also here we must be very careful utc is from 1.1.1970 for step7 the formula must change *)
tau := RAD(MODR(6.697376 + (n - 0.25) * 0.0657098245037645 + DWORD_TO_REAL(TOD_TO_DWORD(DT_TO_TOD(utc))) * 0.0000002785383333, 24.0) * 15.0 + longitude) - a;
rlat := RAD(latitude);
sin_lat := SIN(rlat);
cos_lat := COS(rlat);
cos_tau := COS(tau);
t1 := cos_tau * sin_lat - TAN(c) * cos_lat;
B := ATAN(SIN(tau) / t1);
IF t1&lt; 0.0 THEN B := B + math.PI2; ELSE B := B + math.PI; END_IF;
B := DEG(MODR(B, math.PI2));
h := DEG(ASIN(COS(C) * cos_tau * cos_lat +SIN(c) * sin_lat));
IF h &gt; 180.0 THEN h := h - 360.0; END_IF;
(* consider refraction *)
HR := h + REFRACTION(h);


(* revision history
hm	1. feb 2007	rev 1.0
	original version

hm	6. jan 2008	rev 1.1
	performance improvements

hm	18. jan 2008	rev 1.2
	further performance improvements
	only calculate once every 10 seconds

hm	16. mar. 2008	rev 1.3
	added type conversion to avoid warnings under codesys 3.0

hm	30. jun. 2008	rev 1.4
	added type conversions to avoid warnings under codesys 3.0

hm	18. oct. 2008	rev 1.5
	using math constants

hm	17. dec. 2008	rev 1.6
	angles below horizon are displayed in negative degrees

hm	27. feb. 2009	rev 2.0
	new code with better accuracy

hm	7. mar. 2009	rev 2.1
	refraction is added after angle normalization
	deleted 10 second lockout
	added output for astronomical heigth h
*)
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>2b98af6e-d793-4b05-bcf8-83e149eadcec</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="SUN_TIME" pouType="functionBlock">
        <interface>
          <inputVars>
            <variable name="LATITUDE">
              <type>
                <REAL />
              </type>
              <documentation>
                 latitude of geographical position  
              </documentation>
            </variable>
            <variable name="LONGITUDE">
              <type>
                <REAL />
              </type>
              <documentation>
                 longitude of geographical position  
              </documentation>
            </variable>
            <variable name="UTC">
              <type>
                <DATE />
              </type>
              <documentation>
                	world time	
              </documentation>
            </variable>
            <variable name="H">
              <type>
                <REAL />
              </type>
              <initialValue>
                <simpleValue value="-0.83333333333" />
              </initialValue>
              <documentation>
                 heighth above horizon for sunrise 
              </documentation>
            </variable>
          </inputVars>
          <outputVars>
            <variable name="MIDDAY">
              <type>
                <TOD />
              </type>
              <documentation>
                	astrological midday in hours when sun stands at south direction	
              </documentation>
            </variable>
            <variable name="SUN_RISE">
              <type>
                <TOD />
              </type>
              <documentation>
                	sun rise for current day in local time 
              </documentation>
            </variable>
            <variable name="SUN_SET">
              <type>
                <TOD />
              </type>
              <documentation>
                	sun set for current day in local time 
              </documentation>
            </variable>
            <variable name="SUN_DECLINATION">
              <type>
                <REAL />
              </type>
              <documentation>
                	sun declination above horizon at midday in degrees	
              </documentation>
            </variable>
          </outputVars>
          <localVars>
            <variable name="dk">
              <type>
                <REAL />
              </type>
              <documentation>
                 sun declination at midday 
              </documentation>
            </variable>
            <variable name="delta">
              <type>
                <TIME />
              </type>
              <documentation>
                 delta from midday for sunrise and sunset  
              </documentation>
            </variable>
            <variable name="b">
              <type>
                <REAL />
              </type>
            </variable>
          </localVars>
        </interface>
        <body>
          <ST>
            B := latitude * 0.0174532925199433;
MIDDAY := SUN_MIDDAY(longitude, utc);
DK := 0.40954 * SIN(0.0172 * (INT_TO_REAL(DAY_OF_YEAR(utc)) - 79.35));
sun_declination := DEG(DK);
IF sun_declination &gt; 180.0 THEN sun_declination := sun_declination - 360.0; END_IF;
sun_declination := 90.0 - LATITUDE + sun_declination;
delta := HOUR_TO_TIME(ACOS((SIN(RAD(H)) - SIN(B) * SIN(DK)) / (COS(B) * COS(DK))) * 3.819718632);
sun_rise := MIDDAY - delta;
sun_set := MIDDAY + delta;

(* revision history

rev 1.1	hm	20.1.2007
	deleted unused variables sun_riseR and sun_setR

rev 1.2 hm 17.4.2007
	corrected error while sun:midday would not be corrected for longitude.

rev 1.3	hm	6. jan 2008
	performance improvements

rev	1.4 hm	17. jan 2008
	calculation is now only performed once a day

hm	10. mar. 2009	rev 1.5
	improved performance
	calculation will be performed on every call to allow movong installations

hm	26. jul 2009	rev 1.6
	fixed a problem with wrong midday calculation

hm	25. jan. 2011	rev 1.7
	using function sun_midday
	corrected angle of sun_declination
	added input H
*)
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>26475e96-934d-4384-9fd9-2ad8beacfa4b</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="TIMECHECK" pouType="function">
        <interface>
          <returnType>
            <BOOL />
          </returnType>
          <inputVars>
            <variable name="TD">
              <type>
                <TOD />
              </type>
            </variable>
            <variable name="START">
              <type>
                <TOD />
              </type>
            </variable>
            <variable name="STOP">
              <type>
                <TOD />
              </type>
            </variable>
          </inputVars>
        </interface>
        <body>
          <ST>
            IF stop &lt; start THEN
	TIMECHECK := start &lt;= TD OR TD &lt; stop;
ELSE
	TIMECHECK := start &lt;= TD AND TD &lt; stop;
END_IF;



(* revision history
hm 19. jul. 2009	rev 1.0
	original release

*)
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>03df35b1-fc1a-4e33-949e-cc5924f7fe09</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="UTC_TO_LTIME" pouType="function">
        <interface>
          <returnType>
            <DT />
          </returnType>
          <inputVars>
            <variable name="UTC">
              <type>
                <DT />
              </type>
            </variable>
            <variable name="DST_ENABLE">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="TIME_ZONE_OFFSET">
              <type>
                <INT />
              </type>
            </variable>
          </inputVars>
          <localVars>
            <variable name="tmp">
              <type>
                <INT />
              </type>
            </variable>
          </localVars>
        </interface>
        <body>
          <ST>
            tmp := TIME_ZONE_OFFSET * 60 + BOOL_TO_INT(DST_ENABLE AND DST(UTC)) * 3600;
IF tmp &lt; 0 THEN
	tmp := ABS(tmp);
	UTC_TO_LTIME := DWORD_TO_DT(DT_TO_DWORD(UTC) -  INT_TO_DWORD(tmp));
ELSE
	UTC_TO_LTIME := DWORD_TO_DT(DT_TO_DWORD(UTC) +  INT_TO_DWORD(tmp));
END_IF;


(* revision history

hm 2.10.2006	rev 1.1
	corrected an error where dst would be delayed by 0.1second

hm 17.1.2007	rev 1.2
	added utc input instead of internal sysrtcgettime because this would only work on wago.
	dst_enable would not be checked before dst would be enabled.

hm 18.3.2007	rev 1.3
	changed code, dst would not work during first cycle.

hm 24.10.2007	rev 1.4
	changed code because the execution every 100ms can cause major problems if the supplied time was not correct at start.
	use of new dst function

hm 12. nov 2007	rev 1.5
		changed Type of time_zone_offset from time to int to allow for time zones with negative offset

hm	8 dec 2007		rev 1.6
	corrected a problem with time_zone_offset

hm	14. oct. 2008	rev 1.7
	renamed module from LTIME to UTC_TO_LTIME
	changed function weekday to day_of_week
	optimized code for better performance

hm	20. oct. 2008	rev 1.8
	changes type of input TIME_ZONE_OFFSET from real to int, now is in +/-minutes
	deleted outputs DST_ON and WDAY
	converted to function

hm	27. feb. 2009	rev 1.9
	added type conversions to avoid warnings under codesys 3.0

*)
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>d1bae1fa-ec84-4434-b2d8-7f9ddafc6f15</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="WORK_WEEK" pouType="function">
        <interface>
          <returnType>
            <INT />
          </returnType>
          <inputVars>
            <variable name="idate">
              <type>
                <DATE />
              </type>
            </variable>
          </inputVars>
          <localVars>
            <variable name="d1">
              <type>
                <DATE />
              </type>
            </variable>
            <variable name="w1">
              <type>
                <INT />
              </type>
            </variable>
            <variable name="ds">
              <type>
                <DWORD />
              </type>
            </variable>
            <variable name="yr">
              <type>
                <INT />
              </type>
            </variable>
            <variable name="w31">
              <type>
                <INT />
              </type>
            </variable>
            <variable name="w01">
              <type>
                <INT />
              </type>
            </variable>
            <variable name="wm">
              <type>
                <INT />
              </type>
            </variable>
          </localVars>
        </interface>
        <body>
          <ST>
            (* berechne den 1.1 des jahres von idate. *)
yr := YEAR_OF_DATE(idate);
d1 := YEAR_BEGIN(yr);
(* wochentag von d1 *)
w1 := DAY_OF_WEEK(d1);
(* offset des montags der eletzten KW des vorjahres *)
(* wenn der erste tag des jahres größer als donnerstag ist dann beginnt die letzte kw am montag davor *)
(* wenn der erste tag des jahres ein donnerstag oder kleiner ist beginnt die erste kw 2 montage davor *)
IF w1 &lt; 5 THEN
	ds := DATE_TO_DWORD(d1) - INT_TO_DWORD(w1+6) * 86400;
ELSE
	ds := DATE_TO_DWORD(d1) - INT_TO_DWORD(w1-1) * 86400;
END_IF;

(* kalenderwoche des eingangsdatums *)
WORK_WEEK := DWORD_TO_INT((DATE_TO_DWORD(idate) - ds) / 604800);

(* korrektur wenn work_week = 0 *)
IF work_week = 0 THEN
	(* work_week needs to be 53 when 1.jan of the year before is thursday or dec 31. is thursday. *)
	(* first and last weekday of a year is equal and one more day for a leap_year. *)
	IF w1 &gt; 1 THEN w31 := w1 - 1; ELSE W31 := 7; END_IF;
	IF LEAP_YEAR(yr - 1) AND w31 &gt; 1 THEN w01 := W31 - 1; ELSE w1 := 7; END_IF;
	(* if first or last day of a year is a thursday, the year has 53 weeks *)
	WORK_WEEK := 52 + BOOL_TO_INT(w31 = 4 OR w01 = 4);
ELSE
	(* end of year calculation *)
	(* calculated the first and last weekday *)
	IF leap_year(yr) THEN
		IF w1 &lt; 7 THEN w31 := w1 + 1; ELSE w31 := 1; END_IF;
	ELSE
		w31 := w1;
	END_IF;
	(* if first or last day is thursday then the year has 53 weeks otherwise only 52 *)
	wm := 52 + BOOL_TO_INT(w31 = 4 OR w1 = 4);
	IF WORK_WEEK &gt; wm THEN WORK_WEEK := 1; END_IF;
END_IF;



(* revision history

hm 	17.1.2007		rev 1.1
	deleted unused variable yday

hm	19. dec 2007	rev 1.2
	changed code for better performance
	changed code to comply with ISO8601

hm	16. mar 2008	rev 1.3
	added type conversions to avoid warnings under codesys 3.0

hm	7. oct. 2008	rev 1.4
	changed function year to year_of_date
	changed function weekday to day_of_week

hm	25. oct. 2008	rev 1.5
	optimized code for performance
*)
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>f053a519-3383-4dfc-bfef-ca0dee368b6b</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="YEAR_BEGIN" pouType="function">
        <interface>
          <returnType>
            <DATE />
          </returnType>
          <inputVars>
            <variable name="y">
              <type>
                <INT />
              </type>
            </variable>
          </inputVars>
        </interface>
        <body>
          <ST>
            YEAR_BEGIN := DWORD_TO_DATE(SHR(INT_TO_DWORD(y) * 1461 - 2878169,2) * 86400);



(* revision history
hm	19. dec 2007	rev 1.0
	original version

hm	4. jan 2008		rev 1.1
	formula for step7 was incorrect during leap years

hm	7. apr. 2008	rev 1.2
	deleted unused step7 code
*)

          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>2f64f915-5694-4a93-a59f-9902165cca88</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="YEAR_END" pouType="function">
        <interface>
          <returnType>
            <DATE />
          </returnType>
          <inputVars>
            <variable name="y">
              <type>
                <INT />
              </type>
            </variable>
          </inputVars>
        </interface>
        <body>
          <ST>
            YEAR_END := DWORD_TO_DATE(SHR(INT_TO_DWORD(y) * 1461 - 2876712, 2) * 86400);



(* revision history
hm	15. jun. 2008	rev 1.0
	original version

hm	24. jan 2011	rev 1.1
	improved performance
*)

          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>1ca613ed-46f4-4c15-84a8-688a1b98b0ce</ObjectId>
          </data>
        </addData>
      </pou>
      <pou name="YEAR_OF_DATE" pouType="function">
        <interface>
          <returnType>
            <INT />
          </returnType>
          <inputVars>
            <variable name="IDATE">
              <type>
                <DATE />
              </type>
            </variable>
          </inputVars>
        </interface>
        <body>
          <ST>
            YEAR_OF_DATE := DWORD_TO_INT((DATE_TO_DWORD(idate) + 43200) / 31557600 + 1970);


(* revision history
hm	4. aug 2006		rev 1.0
	original version

hm	1. okt 2007		rev 1.1
	corrected error in algorithm
	adjustment for S7 compatibility

hm	23.12.2007		rev 1.2
	changed code for better performance

hm	7. apr. 2008	rev 1.3
	deleted unused step7 code

hm	7. oct. 2008	rev 1.4
	renamed function (year) to year_of_date

*)
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>6fa22285-f5c8-466c-a164-9bc70e037b47</ObjectId>
          </data>
        </addData>
      </pou>
    </pous>
</project>