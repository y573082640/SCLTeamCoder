{
    "title": "Device Activation and Deactivation State Machine",
    "name": "LGF_ActDeactDevice",
    "description": "## Short description ##\n\nLGF_ActDeactDevice implements a compact state machine to activate and monitor or deactivate \ndecentral devices.\nThe module monitors as well the device connection and error state after activation.\nIt works for PN (S7-1200 / S7-1500) and DP (S7-1500) devices.\n\n## Functional description ##\n\nThe module provides the procedure for activating and deactivating remote IO-Devices in the \nProfinet (PN, S7-1500 & S7-1200) and Profibus (DP, S7-1500) network.\nThe activation of the device (defined at hwId) is initiated by a rising edge at activate, after \ncomplete activation this is indicated at the output isActivated and deviceStateOK. After that the \nconnection status is displayed at the deviceStateOK output.\nThe connection is monitored and in case of a failure of this of more than the set monitoring time \ntimeOutStateMonitoring at the output and reported as an error. After successful recovery of the \nconnection by the system, the configured time is also waited until the error is reset to ensure \nstability.\nNote The connection status of the decentralized device can also be displayed in the TIA Portal \nproject navigation in the PLC, which is the controller, under the item ‘Distributed I/O’, if they \nare online with the engineering system.\nDeactivation of the device (defined at hwId) is initiated by a rising edge at deactivate, after \ncomplete activation this is indicated at the output isDeactivated.\nIt is possible to define the states for switching on and off, as well as the monitoring times for \nactivating and deactivating and the connection monitoring.All errors are automatically reset as soon as the faulty state is eliminated.\nThe exception to this are errors that can only be corrected by an intervention in the software, \nsuch as an incorrect or non-existent hardware ID of a non-existent decentralized IO device.",
    "type": "FUNCTION_BLOCK",
    "input": [
        {
            "name": "enable",
            "type": "Bool",
            "description": "Enable functionality of FB"
        },
        {
            "name": "activate",
            "type": "Bool",
            "description": "Rising edge: Activate device given by `hwId`"
        },
        {
            "name": "deactivate",
            "type": "Bool",
            "description": "Rising edge: Deactivate device given by `hwId`"
        },
        {
            "name": "hwId",
            "type": "HW_DEVICE",
            "description": "Hardware ID of the device which should be activated / deactivated"
        },
        {
            "name": "parameter",
            "type": "LGF_typeActDeactDeviceParameter",
            "description": "Parameter dataset for the function `LGF_ActDeactDevice`"
        }
    ],
    "output": [
        {
            "name": "valid",
            "type": "Bool",
            "description": "TRUE: Valid set of output values available at the FB"
        },
        {
            "name": "busy",
            "type": "Bool",
            "description": "TRUE: FB is not finished and new output values can be expected"
        },
        {
            "name": "error",
            "type": "Bool",
            "description": "TRUE: An error occurred during the execution of the FB"
        },
        {
            "name": "status",
            "type": "Word",
            "description": "Status and error identification"
        },
        {
            "name": "activating",
            "type": "Bool",
            "description": "Activation of device active"
        },
        {
            "name": "isActivated",
            "type": "Bool",
            "description": "Device activated"
        },
        {
            "name": "deactivating",
            "type": "Bool",
            "description": "Deactivating of device active"
        },
        {
            "name": "isDeactivated",
            "type": "Bool",
            "description": "Device deactivated"
        },
        {
            "name": "deviceStateOK",
            "type": "Bool",
            "description": "Device is activated and connected to IO-System"
        },
        {
            "name": "diagnostics",
            "type": "LGF_typeDiagnostics",
            "description": "Diagnostic structure to store and transfer diagnostic information from blocks trough the interface."
        }
    ],
    "in/out": [],
    "return_value": [],
    "status_codes": {
        "16#7000": "STATUS_NO_CALL: No job being currently processed",
        "16#7001": "STATUS_FIRST_CALL: First call after incoming new job",
        "16#7002": "STATUS_SUBSEQUENT_CALL: Subsequent call during active processing",
        "16#8600": "ERR_UNDEFINED_STATE: Due to an undefined state in state machine",
        "16#8601": "ERR_LOG2GEO / ERR_GEO2LOG: Log2Geo or Geo2Log error, check diagnostics for more info",
        "16#8640": "ERR_DEVICE_DEACTIVATING: Error during device deactivation",
        "16#8641": "ERR_DEVICE_DEACTIVATING_TIME_OUT: Deactivation timeout error",
        "16#8660": "ERR_DEVICE_ACTIVATING: Error during device activation",
        "16#8661": "ERR_DEVICE_ACTIVATING_TIME_OUT: Activation timeout error",
        "16#8662": "ERR_READ_DEVICES_STATES_DURING_ACTIVATION: Error: Read Device states (DeviceStates) during device activation",
        "16#8670": "ERR_READ_DEVICES_STATES_WHILE_ACTIVE:Error: Read Device states (DeviceStates) while device active",
        "16#8671": "ERR_DEVICE_STATE_WHILE_ACTIVE: Device states present error and is unreachable, faulty Device or IO-System",
        "16#8672": "ERR_READ_ACTIVATION_STATE_WHILE_ACTIVE:Activation state (D_ACT_DP) of device is wrong",
        "16#8690": "ERR_DISABLING_DEACT_DEVICE: Deactivation (D_ACT_DP) of device throws an error while disabling",
        "16#8691": "ERR_DISABLING_WATCHDOG:Watchdog timer expired while disabling"
    },
    "user_defined_types": [
        {
            "name": "LGF_typeActDeactDeviceParameter",
            "description": "UDT for configuring the behavior of the activation and deactivation process.",
            "member": [
                {
                    "name": "timeOutActDeact",
                    "type": "Time",
                    "default": "T#2500ms",
                    "description": "Time to monitor activation and deactivation commands"
                },
                {
                    "name": "timeOutStateMonitoring",
                    "type": "Time",
                    "default": "T#100ms",
                    "description": "Time to monitor device state"
                },
                {
                    "name": "enableAndDeactivate",
                    "type": "Bool",
                    "default": "TRUE",
                    "description": "Disable device during startup"
                },
                {
                    "name": "enableAndActivate",
                    "type": "Bool",
                    "default": "FALSE",
                    "description": "Enable device during startup"
                },
                {
                    "name": "disableAndDeactivate",
                    "type": "Bool",
                    "default": "TRUE",
                    "description": "Disable device during module disabling"
                }
            ]
        },
        {
            "name": "LGF_typeDiagnostics",
            "description": "UDT for diagnostic information from blocks.",
            "member": [
                {
                    "name": "status",
                    "type": "Word",
                    "default": "16#0000",
                    "description": "Status of the block or error identification"
                },
                {
                    "name": "subfunctionStatus",
                    "type": "Word",
                    "default": "16#0000",
                    "description": "Status or return value of called blocks"
                },
                {
                    "name": "stateNumber",
                    "type": "DInt",
                    "default": "0",
                    "description": "State in the state machine where error occurred"
                }
            ]
        }
    ]
}