{
    "title": "GPS-based Sunrise and Sunset Time Determination",
    "name": "LGF_AstroClock",
    "description": "## Short description ##\n\nThis function calculates the times of sunrise and sunset based on the local time for a specific  place on Earth. The exact position is transferred in the form of geographical GPS coordinates (longitude and latitude).\n\n## Functional description ##\n\nNote The status of called commands is output in subFunctionStatus. In this case, the output value \nin status indicates which command caused the error. In this case, refer to the TIA Portal \nOnline Help section for information on the respective commands.\nIf processes must run automatically depending on the change between day and night, the \nfunction of an astronomical clock is required. Examples of this would be switching outdoor \nlighting on and off or opening and closing roller shutters.\nIf these processes are to be executed with a time delay i.e. a defined time before or after \nsunrise or sunset an offset is required in each case.\nNote For precise execution of the function, it must be ensured that system time and local time of \nthe SIMATIC controller are set correctly.\nBased on the system time/local time of the SIMATIC controller and the set coordinates, the \nblock calculates the times for sunrise and sunset. The offset times are added to the sunrise and \nsunset and output on the sunrise and sunset outputs. If the systems local time of the SIMATIC \ncontroller is between these values, the output isDaytime is set to the value TRUE.\nNote Since the times for sunrise and sunset change daily, it is possible that the isDaytime output \nremains permanently on TRUE or FALSE over a longer period of time:\n• with correspondingly large offset values\n• for a place on the other side of the Arctic Circle\nThe input of the GPS coordinate values is checked for valid values. If there are invalid values, \nan appropriate error code is output to status.\nIf there is an invalid coordinate value for a formal parameter, the outputs sunrise and sunset\nare set to the value DTL#1970-01-01-00:00:00.",
    "type": "FUNCTION_BLOCK",
    "input": [
        {
            "name": "enable",
            "type": "Bool",
            "description": "TRUE: Activates the functionality of the FB"
        },
        {
            "name": "positionGps",
            "type": "LGF_typeGPS_DD",
            "description": "GPS position to calculate the time of sunrise and sunset"
        },
        {
            "name": "offsetSunrise",
            "type": "Time",
            "description": "Offset to sunrise (added to sunrise time, considered at `isDaytime`, negative time allowed)"
        },
        {
            "name": "positionGps",
            "type": "Time",
            "description": "Offset to sunset (added to sunset time, considered at `isDaytime`, negative time allowed)"
        }
    ],
    "output": [
        {
            "name": "valid",
            "type": "Bool",
            "description": "TRUE: Valid set of output values available at the FB"
        },
        {
            "name": "busy",
            "type": "Bool",
            "description": "TRUE: FB is active and new output values can be expected"
        },
        {
            "name": "error",
            "type": "Bool",
            "description": "FALSE: No error / TRUE: An error occurred during the execution of the FB"
        },
        {
            "name": "status",
            "type": "Word",
            "description": "16#0000-16#7FFF: Status of the FB / 16#8000-16#FFFF: Error identification"
        },
        {
            "name": "subFunctionStatus",
            "type": "Word",
            "description": "Status or return value of called FB's, FC's and system blocks"
        },
        {
            "name": "actualLocalTime",
            "type": "DTL",
            "description": "Current time (local time)"
        },
        {
            "name": "sunriseTime",
            "type": "DTL",
            "description": "Sunrise time (localtime)"
        },
        {
            "name": "sunsetTime",
            "type": "DTL",
            "description": "Sunset time (localtime)"
        },
        {
            "name": "isDaytime",
            "type": "Bool",
            "description": "TRUE: If the local time of the controller is between “sunrise” and “sunset”"
        }
    ],
    "in/out": [],
    "return_value": [],
    "status_codes": {
        "16#0000": "STATUS_EXECUTION_FINISHED_NO_ERROR",
        "16#7000": "STATUS_NO_CALL",
        "16#7001": "STATUS_IN_OPERATION",
        "16#8204": "ERR_LATITUDE_VALUE",
        "16#8205": "ERR_LONGITUDE_VALUE",
        "16#8601": "ERR_RD_SYS_T",
        "16#8602": "ERR_RD_LOC_T"
    },
    "user_defined_types": [
        {
            "name": "LGF_typeGPS_DD",
            "description": "Datatype for GPS Coordinates in decimal degrees. For a whole GPS Data set.",
            "member": [
                {
                    "name": "latitude",
                    "type": "Real",
                    "default": "0.0",
                    "description": "Degrees latitude with decimal places (Unit: degree decimal), North = positive; South = negative) valid value range [-90.00000..90.00000] "
                },
                {
                    "name": "longitude",
                    "type": "Real",
                    "default": "0.0",
                    "description": "Degrees longitude with decimal places (Unit: degree decimal), East = positive; West = negative) valid value range [-180.00000..180.00000] "
                }
            ]
        }
    ]
}