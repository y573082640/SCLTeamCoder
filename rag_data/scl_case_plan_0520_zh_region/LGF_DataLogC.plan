{"variables": [], "instructions": [], "planning": "\n- 概述\n这段代码是一个使用SCL编写的功能块，名为“LGF_DataLogC”，用于集成所有数据记录系统功能，可以用作独立的数据记录器。它可以创建、打开、写入、清除和删除数据记录，并支持基于触发器或时间间隔的数据记录。\n\n- 变量定义\n代码中定义了以下几类变量：\n- 输入变量：使能、名称、触发记录、清除记录、删除记录、参数\n- 输出变量：有效、忙、错误、状态、写入记录完成、清除记录完成、删除记录完成、最后一个记录已到达、条目数、诊断\n- 输入/输出变量：数据\n- 内部变量：状态数据记录命令、实例间隔定时器、实例数据记录创建、实例数据记录打开、实例数据记录关闭、实例数据记录写入、实例数据记录清除、实例数据记录删除、状态内部、状态写入记录完成、条目数、最后一个记录已到达\n- 临时变量：临时使能、临时退出状态循环\n- 常量：FB状态无处理、FB状态数据记录打开、FB状态数据记录创建、FB状态数据记录新、FB状态等待触发、FB状态等待写入周期、FB状态数据记录写入、FB状态数据记录清除、FB状态数据记录清除完成、FB状态数据记录删除、FB状态数据记录删除完成、FB状态禁用、FB状态禁用完成、状态无调用、状态第一次调用、状态后续调用、状态最大条目数已达到、状态完成无错误、子状态无错误、错误未定义状态、错误命令调用顺序错误、错误数据记录打开、错误数据记录创建、错误数据记录关闭、错误数据记录写入、错误数据记录清除、错误数据记录删除、内部错误代码、子错误数据记录不存在、内部常量、数据记录默认ID、数据记录无时间戳格式、数据记录最后一个记录已写入、数据记录删除旧条目、数据记录保留旧条目\n\n- \n-- REGION ENABLING/DISABLING\n   此区域处理功能块的使能和禁用逻辑。首先，使用临时变量存储使能输入的值。如果使能输入为真且状态为“无调用”，则初始化功能块并开始处理。这包括设置内部状态、错误和诊断信息，并将状态设置为“第一次调用”。如果使能输入为假且上一个周期为真，则开始禁用功能块。如果状态为“第一次调用”，则将状态设置为“后续调用”。最后，使用边缘检测来跟踪使能输入的变化。\n   - 错误命令调用顺序\n     如果在使能期间检测到清除记录或删除记录命令，则会设置一个错误，因为命令调用顺序不正确。\n   - 使能FB\n     如果使能输入为真且上一个周期为假，则初始化功能块。这包括设置内部状态、错误和诊断信息，并将状态设置为“第一次调用”。然后，初始化数据记录命令参数，包括名称、标题、记录数、时间戳格式、记录间隔、清除打开和启用环形缓冲区。如果未启用环形缓冲区且已到达最后一个条目，则会设置一个错误，因为数据记录已满。\n   - 初始化子函数调用\n     如果参数检查成功，则初始化所有数据记录子函数的实例，包括创建、打开、关闭、写入、清除和删除。\n   - 禁用FB\n     如果使能输入为假且上一个周期为真，则开始禁用功能块，并将状态设置为“禁用”。\n\n-- REGION Command evaluation\n   此区域检测清除记录和删除记录命令。首先，检查当前状态是否为“无处理”或是否在“数据记录创建”和“数据记录删除”之间。如果是，则检查是否有清除记录或删除记录命令。如果有，则将状态设置为相应的开始状态。\n\n-- REGION STATE_MACHINE\n   此区域实现了功能块的状态机。首先，使用一个循环来处理状态之间的转换。在循环中，首先将退出循环的标志设置为真。然后，根据当前状态，执行不同的逻辑。每个状态都有相应的处理逻辑，包括错误处理、超时处理等。在处理完一个状态后，检查是否有必要再次运行循环。如果是，则继续循环。否则，退出循环。\n   - #FB_STATE_NO_PROCESSING\n       此状态表示功能块当前没有处理任何操作。在这个状态下，不执行任何操作。\n   - #FB_STATE_DL_OPEN\n       此状态表示功能块正在打开数据记录。在这个状态下，调用数据记录打开函数，并检查是否成功。如果成功，则根据记录模式将状态设置为“数据记录写入”或“等待触发”。否则，检查是否有错误发生。如果有，则将错误信息存储到诊断缓冲区，并设置错误标志。\n   - #FB_STATE_DL_CREATE\n       此状态表示功能块正在创建数据记录。在这个状态下，调用数据记录创建函数，并检查是否成功。如果成功，则根据记录模式将状态设置为“数据记录写入”或“等待触发”。否则，检查是否有错误发生。如果有，则将错误信息存储到诊断缓冲区，并设置错误标志。\n   - #FB_STATE_DL_WAIT_FOR_TRIGGER\n       此状态表示功能块正在等待触发记录。在这个状态下，检查是否有触发记录命令。如果有，则将状态设置为“数据记录写入”。\n   - #FB_STATE_DL_WAIT_FOR_WRITE_CYCLE\n       此状态表示功能块正在等待写入周期。在这个状态下，检查是否时间间隔已过。如果是，则将状态设置为“数据记录写入”。\n   - #FB_STATE_DL_WRITE\n       此状态表示功能块正在写入数据记录。在这个状态下，调用数据记录写入函数，并检查是否成功。如果成功，则根据记录模式和是否启用了环形缓冲区，将状态设置为“等待写入周期”、“等待触发”或“无处理”。否则，检查是否有错误发生。如果有，则将错误信息存储到诊断缓冲区，并设置错误标志。\n   - #FB_STATE_DL_CLEAR\n       此状态表示功能块正在清除数据记录。在这个状态下，调用数据记录清除函数，并检查是否成功。如果成功，则将状态设置为“数据记录清除完成”。否则，检查是否有错误发生。如果有，则将错误信息存储到诊断缓冲区，并设置错误标志。\n   - #FB_STATE_DL_CLEAR_DONE\n       此状态表示数据记录已清除。在这个状态下，检查是否有清除记录命令。如果没有，则根据记录模式将状态设置为“数据记录写入”或“等待触发”。\n   - #FB_STATE_DL_DELETE\n       此状态表示功能块正在删除数据记录。在这个状态下，调用数据记录删除函数，并检查是否成功。如果成功，则将状态设置为“数据记录删除完成”。否则，检查是否有错误发生。如果有，则将错误信息存储到诊断缓冲区，并设置错误标志。\n   - #FB_STATE_DL_DELETE_DONE\n       此状态表示数据记录已删除。在这个状态下，检查是否有删除记录命令。如果没有，则将状态设置为“禁用完成”。\n   - #FB_STATE_DISABLING\n       此状态表示功能块正在禁用。在这个状态下，调用数据记录关闭函数，并检查是否成功。如果成功，则将状态设置为“禁用完成”。否则，检查是否有错误发生。如果有，则将错误信息存储到诊断缓冲区，并设置错误标志。\n   - #FB_STATE_DISABLING_COMPLETED\n       此状态表示功能块已禁用。在这个状态下，将禁用完成的标志设置为真。\n   - ELSE\n       如果状态机达到未定义的状态，则将错误信息存储到诊断缓冲区，并设置错误标志。\n\n-- REGION Edge memory\n   此区域存储/重置边缘内存，用于跟踪触发记录、清除记录和删除记录命令的边缘。\n\n-- REGION OUTPUTS\n   此区域将内部变量的值写入输出变量。首先，检查是否禁用完成。如果是，则重置输出。然后，检查是否有用户清除的错误。如果有，则将错误输出设置为真，并写入诊断信息。否则，检查是否有自动清除的错误。如果有，则将错误输出设置为真，并写入诊断信息。否则，将有效和忙输出设置为相应的值。最后，写入一些应用特定的静态值到输出。\n   - 禁用\n     如果禁用完成，则重置所有内部状态和错误标志。\n   - 错误用户清除\n     如果有用户清除的错误，则将错误输出设置为真，并写入诊断信息。\n   - 错误自动清除\n     如果有自动清除的错误，则将错误输出设置为真，并写入诊断信息。\n   - 写入静态值到输出\n     将内部状态的有效、忙、错误、状态、最后一个记录已到达、条目数、写入记录完成、清除记录完成和删除记录完成写入输出变量。\n\n\n", "name": "LGF_DataLogC"}