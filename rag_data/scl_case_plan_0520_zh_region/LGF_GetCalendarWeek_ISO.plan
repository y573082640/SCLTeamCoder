{"variables": [], "instructions": [], "planning": "\n- 概述\n这段代码是一个名为“LGF_GetCalendarWeek_ISO”的SCL函数，用于根据ISO 8601标准计算日历周数。该函数接受一个日期输入，并返回日历周数以及相关的日历日和错误状态。\n\n- 变量定义\n代码中定义了以下几类变量：\n - 输入变量：date (日期)\n - 输出变量：calendarDay (日历日), error (错误标志), status (状态码)\n - 临时变量：用于存储日期、周数、是否为闰年等计算过程中的中间结果\n - 常量：用于定义星期几、月份、年份等固定值，以及错误状态码\n\n- \n- 主逻辑部分\n  -- REGION BLOCK INFO HEADER\n     此区域包含函数的元信息，如标题、功能描述、库、作者、测试环境等。\n  -- REGION DESCRIPTION\n     此区域目前为空，但可以包含函数的简单描述。\n  -- REGION INITIALISATION\n     此区域初始化一些临时变量，如tempDays和tempWeek，用于存储计算过程中的中间结果。\n  -- REGION COUNT DAYS\n     此区域计算输入日期是一年中的第几天。它调用另一个函数“LGF_GetCalendarDay”来获取这个值，并检查是否有错误发生。如果有错误，则函数返回。\n  -- REGION COUNT WEEKS\n     此区域计算日历周数。首先，它确定当前年份、前一年和下一年的年份，并检查当前年份和前一年是否为闰年。然后，它计算当年和前一年1月1日和12月31日的星期几。接下来，它检查前一年是否有53周，以及当前年份是否有53周。最后，根据1月1日的星期几对tempDays进行校正，并计算周数。如果tempDaysCorr小于0，则表示1月1日属于前一年的最后一周，并根据前一年是否有53周设置周数。否则，它计算周数，并根据当前年份是否有53周调整周数。\n        CASE #tempCurrentYearWeekday1Jan OF\n          #SUNDAY:\n            #tempDaysCorr := #tempDays - #TWO_DAYS;\n          #MONDAY:\n            #tempDaysCorr := #tempDays - #ONE_DAY;\n          #TUESDAY:\n            #tempDaysCorr := #tempDays;\n          #WEDNESDAY:\n            #tempDaysCorr := #tempDays + #ONE_DAY;\n          #THURSDAY:\n            #tempDaysCorr := #tempDays + #TWO_DAYS;\n          #FRIDAY:\n            #tempDaysCorr := #tempDays - #FOUR_DAYS;\n          #SATURDAY:\n            #tempDaysCorr := #tempDays - #THREE_DAYS;\n          ELSE\n            ;\n        END_CASE;\n        \n        IF #tempDaysCorr < 0 THEN\n          // 1., 2. and 3. January can belong to the last week of the previous year\n          IF #tempIsPrevYearWith53Weeks THEN\n            #tempWeek := #WEEK_53;\n          ELSE\n            #tempWeek := #WEEK_52;\n          END_IF;\n        ELSE\n          // calculate the number of the week\n          #tempWeek := #tempDaysCorr / #SEVEN_DAYS + #ONE_WEEK;\n          \n          // 29., 30. and 31. December can belong to the first week of the next year\n          IF #tempWeek = #WEEK_53 THEN\n            IF #tempIsCurrentYearWith53Weeks THEN\n              #tempWeek := #WEEK_53;\n            ELSE\n              #tempWeek := #WEEK_1;\n            END_IF;\n          END_IF;\n        END_IF;\n  -- REGION OUTPUTS\n     此区域将计算结果写入输出变量，包括日历日、错误标志和状态码。然后，它将周数赋值给函数的返回值，并将ENO设置为真。\n\n\n", "name": "LGF_GetCalendarWeek_ISO"}